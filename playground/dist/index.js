var fA=Object.create;var Uc=Object.defineProperty,uA=Object.defineProperties,hA=Object.getOwnPropertyDescriptor,dA=Object.getOwnPropertyDescriptors,pA=Object.getOwnPropertyNames,Vc=Object.getOwnPropertySymbols,mA=Object.getPrototypeOf,dd=Object.prototype.hasOwnProperty,i0=Object.prototype.propertyIsEnumerable;var hd=(r,e,t)=>e in r?Uc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,w=(r,e)=>{for(var t in e||(e={}))dd.call(e,t)&&hd(r,t,e[t]);if(Vc)for(var t of Vc(e))i0.call(e,t)&&hd(r,t,e[t]);return r},I=(r,e)=>uA(r,dA(e));var o0=(r=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(r,{get:(e,t)=>(typeof require!="undefined"?require:e)[t]}):r)(function(r){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var s0=(r,e)=>{var t={};for(var n in r)dd.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Vc)for(var n of Vc(r))e.indexOf(n)<0&&i0.call(r,n)&&(t[n]=r[n]);return t};var Hc=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),dn=(r,e)=>{for(var t in e)Uc(r,t,{get:e[t],enumerable:!0})},gA=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of pA(e))!dd.call(r,i)&&i!==t&&Uc(r,i,{get:()=>e[i],enumerable:!(n=hA(e,i))||n.enumerable});return r};var pn=(r,e,t)=>(t=r!=null?fA(mA(r)):{},gA(e||!r||!r.__esModule?Uc(t,"default",{value:r,enumerable:!0}):t,r));var ce=(r,e,t)=>(hd(r,typeof e!="symbol"?e+"":e,t),t),pd=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var _=(r,e,t)=>(pd(r,e,"read from private field"),t?t.call(r):e.get(r)),U=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},X=(r,e,t,n)=>(pd(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var a0=(r,e,t)=>(pd(r,e,"access private method"),t);var du=Hc((Lz,Lv)=>{Lv.exports=function(r,e,t,n,i){var o,s;if(n===void 0)n=0;else if(n=n|0,n<0||n>=r.length)throw new RangeError("invalid lower bound");if(i===void 0)i=r.length-1;else if(i=i|0,i<n||i>=r.length)throw new RangeError("invalid upper bound");for(;n<=i;)if(o=n+(i-n>>>1),s=+t(r[o],e,o,r),s<0)n=o+1;else if(s>0)i=o-1;else return o;return~n}});var pu=Hc((Iz,Iv)=>{"use strict";Iv.exports=cR;function Ps(r){return r instanceof Buffer?Buffer.from(r):new r.constructor(r.buffer.slice(),r.byteOffset,r.length)}function cR(r){if(r=r||{},r.circles)return fR(r);return r.proto?n:t;function e(i,o){for(var s=Object.keys(i),a=new Array(s.length),l=0;l<s.length;l++){var c=s[l],f=i[c];typeof f!="object"||f===null?a[c]=f:f instanceof Date?a[c]=new Date(f):ArrayBuffer.isView(f)?a[c]=Ps(f):a[c]=o(f)}return a}function t(i){if(typeof i!="object"||i===null)return i;if(i instanceof Date)return new Date(i);if(Array.isArray(i))return e(i,t);if(i instanceof Map)return new Map(e(Array.from(i),t));if(i instanceof Set)return new Set(e(Array.from(i),t));var o={};for(var s in i)if(Object.hasOwnProperty.call(i,s)!==!1){var a=i[s];typeof a!="object"||a===null?o[s]=a:a instanceof Date?o[s]=new Date(a):a instanceof Map?o[s]=new Map(e(Array.from(a),t)):a instanceof Set?o[s]=new Set(e(Array.from(a),t)):ArrayBuffer.isView(a)?o[s]=Ps(a):o[s]=t(a)}return o}function n(i){if(typeof i!="object"||i===null)return i;if(i instanceof Date)return new Date(i);if(Array.isArray(i))return e(i,n);if(i instanceof Map)return new Map(e(Array.from(i),n));if(i instanceof Set)return new Set(e(Array.from(i),n));var o={};for(var s in i){var a=i[s];typeof a!="object"||a===null?o[s]=a:a instanceof Date?o[s]=new Date(a):a instanceof Map?o[s]=new Map(e(Array.from(a),n)):a instanceof Set?o[s]=new Set(e(Array.from(a),n)):ArrayBuffer.isView(a)?o[s]=Ps(a):o[s]=n(a)}return o}}function fR(r){var e=[],t=[];return r.proto?o:i;function n(s,a){for(var l=Object.keys(s),c=new Array(l.length),f=0;f<l.length;f++){var u=l[f],h=s[u];if(typeof h!="object"||h===null)c[u]=h;else if(h instanceof Date)c[u]=new Date(h);else if(ArrayBuffer.isView(h))c[u]=Ps(h);else{var d=e.indexOf(h);d!==-1?c[u]=t[d]:c[u]=a(h)}}return c}function i(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return n(s,i);if(s instanceof Map)return new Map(n(Array.from(s),i));if(s instanceof Set)return new Set(n(Array.from(s),i));var a={};e.push(s),t.push(a);for(var l in s)if(Object.hasOwnProperty.call(s,l)!==!1){var c=s[l];if(typeof c!="object"||c===null)a[l]=c;else if(c instanceof Date)a[l]=new Date(c);else if(c instanceof Map)a[l]=new Map(n(Array.from(c),i));else if(c instanceof Set)a[l]=new Set(n(Array.from(c),i));else if(ArrayBuffer.isView(c))a[l]=Ps(c);else{var f=e.indexOf(c);f!==-1?a[l]=t[f]:a[l]=i(c)}}return e.pop(),t.pop(),a}function o(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return n(s,o);if(s instanceof Map)return new Map(n(Array.from(s),o));if(s instanceof Set)return new Set(n(Array.from(s),o));var a={};e.push(s),t.push(a);for(var l in s){var c=s[l];if(typeof c!="object"||c===null)a[l]=c;else if(c instanceof Date)a[l]=new Date(c);else if(c instanceof Map)a[l]=new Map(n(Array.from(c),o));else if(c instanceof Set)a[l]=new Set(n(Array.from(c),o));else if(ArrayBuffer.isView(c))a[l]=Ps(c);else{var f=e.indexOf(c);f!==-1?a[l]=t[f]:a[l]=o(c)}}return e.pop(),t.pop(),a}}});var Au=Hc((tk,Cu)=>{(function(r){if(typeof Cu=="object"&&typeof Cu.exports=="object"){var e=r(o0,tk);e!==void 0&&(Cu.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],r)})(function(r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=void 0;class t{constructor(c,f,u,h){this._uri=c,this._languageId=f,this._version=u,this._content=h,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(c){if(c){let f=this.offsetAt(c.start),u=this.offsetAt(c.end);return this._content.substring(f,u)}return this._content}update(c,f){for(let u of c)if(t.isIncremental(u)){let h=s(u.range),d=this.offsetAt(h.start),m=this.offsetAt(h.end);this._content=this._content.substring(0,d)+u.text+this._content.substring(m,this._content.length);let y=Math.max(h.start.line,0),g=Math.max(h.end.line,0),v=this._lineOffsets,T=o(u.text,!1,d);if(g-y===T.length)for(let x=0,D=T.length;x<D;x++)v[x+y+1]=T[x];else T.length<1e4?v.splice(y+1,g-y,...T):this._lineOffsets=v=v.slice(0,y+1).concat(T,v.slice(g+1));let M=u.text.length-(m-d);if(M!==0)for(let x=y+1+T.length,D=v.length;x<D;x++)v[x]=v[x]+M}else if(t.isFull(u))this._content=u.text,this._lineOffsets=void 0;else throw new Error("Unknown change event received");this._version=f}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=o(this._content,!0)),this._lineOffsets}positionAt(c){c=Math.max(Math.min(c,this._content.length),0);let f=this.getLineOffsets(),u=0,h=f.length;if(h===0)return{line:0,character:c};for(;u<h;){let m=Math.floor((u+h)/2);f[m]>c?h=m:u=m+1}let d=u-1;return{line:d,character:c-f[d]}}offsetAt(c){let f=this.getLineOffsets();if(c.line>=f.length)return this._content.length;if(c.line<0)return 0;let u=f[c.line],h=c.line+1<f.length?f[c.line+1]:this._content.length;return Math.max(Math.min(u+c.character,h),u)}get lineCount(){return this.getLineOffsets().length}static isIncremental(c){let f=c;return f!=null&&typeof f.text=="string"&&f.range!==void 0&&(f.rangeLength===void 0||typeof f.rangeLength=="number")}static isFull(c){let f=c;return f!=null&&typeof f.text=="string"&&f.range===void 0&&f.rangeLength===void 0}}var n;(function(l){function c(h,d,m,y){return new t(h,d,m,y)}l.create=c;function f(h,d,m){if(h instanceof t)return h.update(d,m),h;throw new Error("TextDocument.update: document must be created by TextDocument.create")}l.update=f;function u(h,d){let m=h.getText(),y=i(d.map(a),(T,M)=>{let x=T.range.start.line-M.range.start.line;return x===0?T.range.start.character-M.range.start.character:x}),g=0,v=[];for(let T of y){let M=h.offsetAt(T.range.start);if(M<g)throw new Error("Overlapping edit");M>g&&v.push(m.substring(g,M)),T.newText.length&&v.push(T.newText),g=h.offsetAt(T.range.end)}return v.push(m.substr(g)),v.join("")}l.applyEdits=u})(n=e.TextDocument||(e.TextDocument={}));function i(l,c){if(l.length<=1)return l;let f=l.length/2|0,u=l.slice(0,f),h=l.slice(f);i(u,c),i(h,c);let d=0,m=0,y=0;for(;d<u.length&&m<h.length;)c(u[d],h[m])<=0?l[y++]=u[d++]:l[y++]=h[m++];for(;d<u.length;)l[y++]=u[d++];for(;m<h.length;)l[y++]=h[m++];return l}function o(l,c,f=0){let u=c?[f]:[];for(let h=0;h<l.length;h++){let d=l.charCodeAt(h);(d===13||d===10)&&(d===13&&h+1<l.length&&l.charCodeAt(h+1)===10&&h++,u.push(f+h+1))}return u}function s(l){let c=l.start,f=l.end;return c.line>f.line||c.line===f.line&&c.character>f.character?{start:f,end:c}:l}function a(l){let c=s(l.range);return c!==l.range?{newText:l.newText,range:c}:l}})});var $k=Hc((Yu,jk)=>{(function(r,e){typeof Yu=="object"&&typeof jk<"u"?e(Yu):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r["base64-arraybuffer"]={}))})(Yu,function(r){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=typeof Uint8Array>"u"?[]:new Uint8Array(256),n=0;n<e.length;n++)t[e.charCodeAt(n)]=n;var i=function(s){var a=new Uint8Array(s),l,c=a.length,f="";for(l=0;l<c;l+=3)f+=e[a[l]>>2],f+=e[(a[l]&3)<<4|a[l+1]>>4],f+=e[(a[l+1]&15)<<2|a[l+2]>>6],f+=e[a[l+2]&63];return c%3===2?f=f.substring(0,f.length-1)+"=":c%3===1&&(f=f.substring(0,f.length-2)+"=="),f},o=function(s){var a=s.length*.75,l=s.length,c,f=0,u,h,d,m;s[s.length-1]==="="&&(a--,s[s.length-2]==="="&&a--);var y=new ArrayBuffer(a),g=new Uint8Array(y);for(c=0;c<l;c+=4)u=t[s.charCodeAt(c)],h=t[s.charCodeAt(c+1)],d=t[s.charCodeAt(c+2)],m=t[s.charCodeAt(c+3)],g[f++]=u<<2|h>>4,g[f++]=(h&15)<<4|d>>2,g[f++]=(d&3)<<6|m&63;return y};r.decode=o,r.encode=i,Object.defineProperty(r,"__esModule",{value:!0})})});var ve=class{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,n){let i=[];return this.decompose(0,e,i,2),n.length&&n.decompose(0,n.length,i,3),this.decompose(t,this.length,i,1),Cr.from(i,this.length-(t-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let n=[];return this.decompose(e,t,n,0),Cr.from(n,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),i=new lo(this),o=new lo(e);for(let s=t,a=t;;){if(i.next(s),o.next(s),s=0,i.lineBreak!=o.lineBreak||i.done!=o.done||i.value!=o.value)return!1;if(a+=i.value.length,i.done||a>=n)return!0}}iter(e=1){return new lo(this,e)}iterRange(e,t=this.length){return new Gc(this,e,t)}iterLines(e,t){let n;if(e==null)n=this.iter();else{t==null&&(t=this.lines+1);let i=this.line(e).from;n=this.iterRange(i,Math.max(i,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new Zc(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?ve.empty:e.length<=32?new We(e):Cr.from(We.split(e,[]))}},We=class extends ve{constructor(e,t=yA(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,n,i){for(let o=0;;o++){let s=this.text[o],a=i+s.length;if((t?n:a)>=e)return new gd(i,a,n,s);i=a+1,n++}}decompose(e,t,n,i){let o=e<=0&&t>=this.length?this:new We(l0(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(i&1){let s=n.pop(),a=Kc(o.text,s.text.slice(),0,o.length);if(a.length<=32)n.push(new We(a,s.length+o.length));else{let l=a.length>>1;n.push(new We(a.slice(0,l)),new We(a.slice(l)))}}else n.push(o)}replace(e,t,n){if(!(n instanceof We))return super.replace(e,t,n);let i=Kc(this.text,Kc(n.text,l0(this.text,0,e)),t),o=this.length+n.length-(t-e);return i.length<=32?new We(i,o):Cr.from(We.split(i,[]),o)}sliceString(e,t=this.length,n=`
`){let i="";for(let o=0,s=0;o<=t&&s<this.text.length;s++){let a=this.text[s],l=o+a.length;o>e&&s&&(i+=n),e<l&&t>o&&(i+=a.slice(Math.max(0,e-o),t-o)),o=l+1}return i}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let n=[],i=-1;for(let o of e)n.push(o),i+=o.length+1,n.length==32&&(t.push(new We(n,i)),n=[],i=-1);return i>-1&&t.push(new We(n,i)),t}},Cr=class extends ve{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let n of e)this.lines+=n.lines}lineInner(e,t,n,i){for(let o=0;;o++){let s=this.children[o],a=i+s.length,l=n+s.lines-1;if((t?l:a)>=e)return s.lineInner(e,t,n,i);i=a+1,n=l+1}}decompose(e,t,n,i){for(let o=0,s=0;s<=t&&o<this.children.length;o++){let a=this.children[o],l=s+a.length;if(e<=l&&t>=s){let c=i&((s<=e?1:0)|(l>=t?2:0));s>=e&&l<=t&&!c?n.push(a):a.decompose(e-s,t-s,n,c)}s=l+1}}replace(e,t,n){if(n.lines<this.lines)for(let i=0,o=0;i<this.children.length;i++){let s=this.children[i],a=o+s.length;if(e>=o&&t<=a){let l=s.replace(e-o,t-o,n),c=this.lines-s.lines+l.lines;if(l.lines<c>>5-1&&l.lines>c>>5+1){let f=this.children.slice();return f[i]=l,new Cr(f,this.length-(t-e)+n.length)}return super.replace(o,a,l)}o=a+1}return super.replace(e,t,n)}sliceString(e,t=this.length,n=`
`){let i="";for(let o=0,s=0;o<this.children.length&&s<=t;o++){let a=this.children[o],l=s+a.length;s>e&&o&&(i+=n),e<l&&t>s&&(i+=a.sliceString(e-s,t-s,n)),s=l+1}return i}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof Cr))return 0;let n=0,[i,o,s,a]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;i+=t,o+=t){if(i==s||o==a)return n;let l=this.children[i],c=e.children[o];if(l!=c)return n+l.scanIdentical(c,t);n+=l.length+1}}static from(e,t=e.reduce((n,i)=>n+i.length+1,-1)){let n=0;for(let d of e)n+=d.lines;if(n<32){let d=[];for(let m of e)m.flatten(d);return new We(d,t)}let i=Math.max(32,n>>5),o=i<<1,s=i>>1,a=[],l=0,c=-1,f=[];function u(d){let m;if(d.lines>o&&d instanceof Cr)for(let y of d.children)u(y);else d.lines>s&&(l>s||!l)?(h(),a.push(d)):d instanceof We&&l&&(m=f[f.length-1])instanceof We&&d.lines+m.lines<=32?(l+=d.lines,c+=d.length+1,f[f.length-1]=new We(m.text.concat(d.text),m.length+1+d.length)):(l+d.lines>i&&h(),l+=d.lines,c+=d.length+1,f.push(d))}function h(){l!=0&&(a.push(f.length==1?f[0]:Cr.from(f,c)),c=-1,l=f.length=0)}for(let d of e)u(d);return h(),a.length==1?a[0]:new Cr(a,t)}};ve.empty=new We([""],0);function yA(r){let e=-1;for(let t of r)e+=t.length+1;return e}function Kc(r,e,t=0,n=1e9){for(let i=0,o=0,s=!0;o<r.length&&i<=n;o++){let a=r[o],l=i+a.length;l>=t&&(l>n&&(a=a.slice(0,n-i)),i<t&&(a=a.slice(t-i)),s?(e[e.length-1]+=a,s=!1):e.push(a)),i=l+1}return e}function l0(r,e,t){return Kc(r,[""],e,t)}var lo=class{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof We?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,i=this.nodes[n],o=this.offsets[n],s=o>>1,a=i instanceof We?i.text.length:i.children.length;if(s==(t>0?a:0)){if(n==0)return this.done=!0,this.value="",this;t>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((o&1)==(t>0?0:1)){if(this.offsets[n]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(i instanceof We){let l=i.text[s+(t<0?-1:0)];if(this.offsets[n]+=t,l.length>Math.max(0,e))return this.value=e==0?l:t>0?l.slice(e):l.slice(0,l.length-e),this;e-=l.length}else{let l=i.children[s+(t<0?-1:0)];e>l.length?(e-=l.length,this.offsets[n]+=t):(t<0&&this.offsets[n]--,this.nodes.push(l),this.offsets.push(t>0?1:(l instanceof We?l.text.length:l.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}},Gc=class{constructor(e,t,n){this.value="",this.done=!1,this.cursor=new lo(e,t>n?-1:1),this.pos=t>n?e.length:0,this.from=Math.min(t,n),this.to=Math.max(t,n)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let n=t<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:i}=this.cursor.next(e);return this.pos+=(i.length+e)*t,this.value=i.length<=n?i:t<0?i.slice(i.length-n):i.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},Zc=class{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:n,value:i}=this.inner.next(e);return t?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=i,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol<"u"&&(ve.prototype[Symbol.iterator]=function(){return this.iter()},lo.prototype[Symbol.iterator]=Gc.prototype[Symbol.iterator]=Zc.prototype[Symbol.iterator]=function(){return this});var gd=class{constructor(e,t,n,i){this.from=e,this.to=t,this.number=n,this.text=i}get length(){return this.to-this.from}},ss="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(r=>r?parseInt(r,36):1);for(let r=1;r<ss.length;r++)ss[r]+=ss[r-1];function bA(r){for(let e=1;e<ss.length;e+=2)if(ss[e]>r)return ss[e-1]<=r;return!1}function c0(r){return r>=127462&&r<=127487}var f0=8205;function qt(r,e,t=!0,n=!0){return(t?g0:_A)(r,e,n)}function g0(r,e,t){if(e==r.length)return e;e&&y0(r.charCodeAt(e))&&b0(r.charCodeAt(e-1))&&e--;let n=lt(r,e);for(e+=er(n);e<r.length;){let i=lt(r,e);if(n==f0||i==f0||t&&bA(i))e+=er(i),n=i;else if(c0(i)){let o=0,s=e-2;for(;s>=0&&c0(lt(r,s));)o++,s-=2;if(o%2==0)break;e+=2}else break}return e}function _A(r,e,t){for(;e>0;){let n=g0(r,e-2,t);if(n<e)return n;e--}return 0}function y0(r){return r>=56320&&r<57344}function b0(r){return r>=55296&&r<56320}function lt(r,e){let t=r.charCodeAt(e);if(!b0(t)||e+1==r.length)return t;let n=r.charCodeAt(e+1);return y0(n)?(t-55296<<10)+(n-56320)+65536:t}function za(r){return r<=65535?String.fromCharCode(r):(r-=65536,String.fromCharCode((r>>10)+55296,(r&1023)+56320))}function er(r){return r<65536?1:2}var yd=/\r\n?|\n/,xt=function(r){return r[r.Simple=0]="Simple",r[r.TrackDel=1]="TrackDel",r[r.TrackBefore=2]="TrackBefore",r[r.TrackAfter=3]="TrackAfter",r}(xt||(xt={})),Ar=class{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let n=this.sections[t+1];e+=n<0?this.sections[t]:n}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,n=0,i=0;t<this.sections.length;){let o=this.sections[t++],s=this.sections[t++];s<0?(e(n,i,o),i+=o):i+=s,n+=o}}iterChangedRanges(e,t=!1){bd(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let n=this.sections[t++],i=this.sections[t++];i<0?e.push(n,i):e.push(i,n)}return new Ar(e)}composeDesc(e){return this.empty?e:e.empty?this:_0(this,e)}mapDesc(e,t=!1){return e.empty?this:_d(this,e,t)}mapPos(e,t=-1,n=xt.Simple){let i=0,o=0;for(let s=0;s<this.sections.length;){let a=this.sections[s++],l=this.sections[s++],c=i+a;if(l<0){if(c>e)return o+(e-i);o+=a}else{if(n!=xt.Simple&&c>=e&&(n==xt.TrackDel&&i<e&&c>e||n==xt.TrackBefore&&i<e||n==xt.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!a)return e==i||t<0?o:o+l;o+=l}i=c}if(e>i)throw new RangeError(`Position ${e} is out of range for changeset of length ${i}`);return o}touchesRange(e,t=e){for(let n=0,i=0;n<this.sections.length&&i<=t;){let o=this.sections[n++],s=this.sections[n++],a=i+o;if(s>=0&&i<=t&&a>=e)return i<e&&a>t?"cover":!0;i=a}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let n=this.sections[t++],i=this.sections[t++];e+=(e?" ":"")+n+(i>=0?":"+i:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Ar(e)}},Ge=class extends Ar{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return bd(this,(t,n,i,o,s)=>e=e.replace(i,i+(n-t),s),!1),e}mapDesc(e,t=!1){return _d(this,e,t,!0)}invert(e){let t=this.sections.slice(),n=[];for(let i=0,o=0;i<t.length;i+=2){let s=t[i],a=t[i+1];if(a>=0){t[i]=a,t[i+1]=s;let l=i>>1;for(;n.length<l;)n.push(ve.empty);n.push(s?e.slice(o,o+s):ve.empty)}o+=s}return new Ge(t,n)}compose(e){return this.empty?e:e.empty?this:_0(this,e,!0)}map(e,t=!1){return e.empty?this:_d(this,e,t,!0)}iterChanges(e,t=!1){bd(this,e,t)}get desc(){return new Ar(this.sections)}filter(e){let t=[],n=[],i=[],o=new co(this);e:for(let s=0,a=0;;){let l=s==e.length?1e9:e[s++];for(;a<l||a==l&&o.len==0;){if(o.done)break e;let f=Math.min(o.len,l-a);Wt(i,f,-1);let u=o.ins==-1?-1:o.off==0?o.ins:0;Wt(t,f,u),u>0&&ao(n,t,o.text),o.forward(f),a+=f}let c=e[s++];for(;a<c;){if(o.done)break e;let f=Math.min(o.len,c-a);Wt(t,f,-1),Wt(i,f,o.ins==-1?-1:o.off==0?o.ins:0),o.forward(f),a+=f}}return{changes:new Ge(t,n),filtered:new Ar(i)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let n=this.sections[t],i=this.sections[t+1];i<0?e.push(n):i==0?e.push([n]):e.push([n].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,n){let i=[],o=[],s=0,a=null;function l(f=!1){if(!f&&!i.length)return;s<t&&Wt(i,t-s,-1);let u=new Ge(i,o);a=a?a.compose(u.map(a)):u,i=[],o=[],s=0}function c(f){if(Array.isArray(f))for(let u of f)c(u);else if(f instanceof Ge){if(f.length!=t)throw new RangeError(`Mismatched change set length (got ${f.length}, expected ${t})`);l(),a=a?a.compose(f.map(a)):f}else{let{from:u,to:h=u,insert:d}=f;if(u>h||u<0||h>t)throw new RangeError(`Invalid change range ${u} to ${h} (in doc of length ${t})`);let m=d?typeof d=="string"?ve.of(d.split(n||yd)):d:ve.empty,y=m.length;if(u==h&&y==0)return;u<s&&l(),u>s&&Wt(i,u-s,-1),Wt(i,h-u,y),ao(o,i,m),s=h}}return c(e),l(!a),a}static empty(e){return new Ge(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],n=[];for(let i=0;i<e.length;i++){let o=e[i];if(typeof o=="number")t.push(o,-1);else{if(!Array.isArray(o)||typeof o[0]!="number"||o.some((s,a)=>a&&typeof s!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(o.length==1)t.push(o[0],0);else{for(;n.length<i;)n.push(ve.empty);n[i]=ve.of(o.slice(1)),t.push(o[0],n[i].length)}}}return new Ge(t,n)}};function Wt(r,e,t,n=!1){if(e==0&&t<=0)return;let i=r.length-2;i>=0&&t<=0&&t==r[i+1]?r[i]+=e:e==0&&r[i]==0?r[i+1]+=t:n?(r[i]+=e,r[i+1]+=t):r.push(e,t)}function ao(r,e,t){if(t.length==0)return;let n=e.length-2>>1;if(n<r.length)r[r.length-1]=r[r.length-1].append(t);else{for(;r.length<n;)r.push(ve.empty);r.push(t)}}function bd(r,e,t){let n=r.inserted;for(let i=0,o=0,s=0;s<r.sections.length;){let a=r.sections[s++],l=r.sections[s++];if(l<0)i+=a,o+=a;else{let c=i,f=o,u=ve.empty;for(;c+=a,f+=l,l&&n&&(u=u.append(n[s-2>>1])),!(t||s==r.sections.length||r.sections[s+1]<0);)a=r.sections[s++],l=r.sections[s++];e(i,c,o,f,u),i=c,o=f}}}function _d(r,e,t,n=!1){let i=[],o=n?[]:null,s=new co(r),a=new co(e);for(let l=0,c=0;;)if(s.ins==-1)l+=s.len,s.next();else if(a.ins==-1&&c<l){let f=Math.min(a.len,l-c);a.forward(f),Wt(i,f,-1),c+=f}else if(a.ins>=0&&(s.done||c<l||c==l&&(a.len<s.len||a.len==s.len&&!t))){for(Wt(i,a.ins,-1);l>c&&!s.done&&l+s.len<c+a.len;)l+=s.len,s.next();c+=a.len,a.next()}else if(s.ins>=0){let f=0,u=l+s.len;for(;;)if(a.ins>=0&&c>l&&c+a.len<u)f+=a.ins,c+=a.len,a.next();else if(a.ins==-1&&c<u){let h=Math.min(a.len,u-c);f+=h,a.forward(h),c+=h}else break;Wt(i,f,s.ins),o&&ao(o,i,s.text),l=u,s.next()}else{if(s.done&&a.done)return o?new Ge(i,o):new Ar(i);throw new Error("Mismatched change set lengths")}}function _0(r,e,t=!1){let n=[],i=t?[]:null,o=new co(r),s=new co(e);for(let a=!1;;){if(o.done&&s.done)return i?new Ge(n,i):new Ar(n);if(o.ins==0)Wt(n,o.len,0,a),o.next();else if(s.len==0&&!s.done)Wt(n,0,s.ins,a),i&&ao(i,n,s.text),s.next();else{if(o.done||s.done)throw new Error("Mismatched change set lengths");{let l=Math.min(o.len2,s.len),c=n.length;if(o.ins==-1){let f=s.ins==-1?-1:s.off?0:s.ins;Wt(n,l,f,a),i&&f&&ao(i,n,s.text)}else s.ins==-1?(Wt(n,o.off?0:o.len,l,a),i&&ao(i,n,o.textBit(l))):(Wt(n,o.off?0:o.len,s.off?0:s.ins,a),i&&!s.off&&ao(i,n,s.text));a=(o.ins>l||s.ins>=0&&s.len>l)&&(a||n.length>c),o.forward2(l),s.forward(l)}}}}var co=class{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?ve.empty:e[t]}textBit(e){let{inserted:t}=this.set,n=this.i-2>>1;return n>=t.length&&!e?ve.empty:t[n].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}},ai=class{constructor(e,t,n){this.from=e,this.to=t,this.flags=n}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,t=-1){let n,i;return this.empty?n=i=e.mapPos(this.from,t):(n=e.mapPos(this.from,1),i=e.mapPos(this.to,-1)),n==this.from&&i==this.to?this:new ai(n,i,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return N.range(e,t);let n=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return N.range(this.anchor,n)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return N.range(e.anchor,e.head)}},N=class{constructor(e,t=0){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:N.create(this.ranges.map(n=>n.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new N([this.main])}addRange(e,t=!0){return N.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let n=this.ranges.slice();return n[t]=e,N.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new N(e.ranges.map(t=>ai.fromJSON(t)),e.main)}static single(e,t=e){return new N([N.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let n=0,i=0;i<e.length;i++){let o=e[i];if(o.empty?o.from<=n:o.from<n)return vA(e.slice(),t);n=o.to}return new N(e,t)}static cursor(e,t=0,n,i){return new ai(e,e,(t==0?0:t<0?4:8)|(n==null?3:Math.min(2,n))|(i??33554431)<<5)}static range(e,t,n){let i=(n??33554431)<<5;return t<e?new ai(t,e,16|i|8):new ai(e,t,i|(t>e?4:0))}};function vA(r,e=0){let t=r[e];r.sort((n,i)=>n.from-i.from),e=r.indexOf(t);for(let n=1;n<r.length;n++){let i=r[n],o=r[n-1];if(i.empty?i.from<=o.to:i.from<o.to){let s=o.from,a=Math.max(i.to,o.to);n<=e&&e--,r.splice(--n,2,i.anchor>i.head?N.range(a,s):N.range(s,a))}}return new N(r,e)}function v0(r,e){for(let t of r.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}var Td=0,Z=class{constructor(e,t,n,i,o){this.combine=e,this.compareInput=t,this.compare=n,this.isStatic=i,this.extensions=o,this.id=Td++,this.default=e([])}static define(e={}){return new Z(e.combine||(t=>t),e.compareInput||((t,n)=>t===n),e.compare||(e.combine?(t,n)=>t===n:Od),!!e.static,e.enables)}of(e){return new as([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new as(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new as(e,this,2,t)}from(e,t){return t||(t=n=>n),this.compute([e],n=>t(n.field(e)))}};function Od(r,e){return r==e||r.length==e.length&&r.every((t,n)=>t===e[n])}var as=class{constructor(e,t,n,i){this.dependencies=e,this.facet=t,this.type=n,this.value=i,this.id=Td++}dynamicSlot(e){var t;let n=this.value,i=this.facet.compareInput,o=this.id,s=e[o]>>1,a=this.type==2,l=!1,c=!1,f=[];for(let u of this.dependencies)u=="doc"?l=!0:u=="selection"?c=!0:(((t=e[u.id])!==null&&t!==void 0?t:1)&1)==0&&f.push(e[u.id]);return{create(u){return u.values[s]=n(u),1},update(u,h){if(l&&h.docChanged||c&&(h.docChanged||h.selection)||vd(u,f)){let d=n(u);if(a?!u0(d,u.values[s],i):!i(d,u.values[s]))return u.values[s]=d,1}return 0},reconfigure:(u,h)=>{let d=n(u),m=h.config.address[o];if(m!=null){let y=Yc(h,m);if(this.dependencies.every(g=>g instanceof Z?h.facet(g)===u.facet(g):g instanceof Ee?h.field(g,!1)==u.field(g,!1):!0)||(a?u0(d,y,i):i(d,y)))return u.values[s]=y,0}return u.values[s]=d,1}}}};function u0(r,e,t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function vd(r,e){let t=!1;for(let n of e)Pa(r,n)&1&&(t=!0);return t}function kA(r,e,t){let n=t.map(l=>r[l.id]),i=t.map(l=>l.type),o=n.filter(l=>!(l&1)),s=r[e.id]>>1;function a(l){let c=[];for(let f=0;f<n.length;f++){let u=Yc(l,n[f]);if(i[f]==2)for(let h of u)c.push(h);else c.push(u)}return e.combine(c)}return{create(l){for(let c of n)Pa(l,c);return l.values[s]=a(l),1},update(l,c){if(!vd(l,o))return 0;let f=a(l);return e.compare(f,l.values[s])?0:(l.values[s]=f,1)},reconfigure(l,c){let f=vd(l,n),u=c.config.facets[e.id],h=c.facet(e);if(u&&!f&&Od(t,u))return l.values[s]=h,0;let d=a(l);return e.compare(d,h)?(l.values[s]=h,0):(l.values[s]=d,1)}}}var h0=Z.define({static:!0}),Ee=class{constructor(e,t,n,i,o){this.id=e,this.createF=t,this.updateF=n,this.compareF=i,this.spec=o,this.provides=void 0}static define(e){let t=new Ee(Td++,e.create,e.update,e.compare||((n,i)=>n===i),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(h0).find(n=>n.field==this);return(t?.create||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:n=>(n.values[t]=this.create(n),1),update:(n,i)=>{let o=n.values[t],s=this.updateF(o,i);return this.compareF(o,s)?0:(n.values[t]=s,1)},reconfigure:(n,i)=>i.config.address[this.id]!=null?(n.values[t]=i.field(this),0):(n.values[t]=this.create(n),1)}}init(e){return[this,h0.of({field:this,create:e})]}get extension(){return this}},os={lowest:4,low:3,default:2,high:1,highest:0};function Na(r){return e=>new Jc(e,r)}var Fn={highest:Na(os.highest),high:Na(os.high),default:Na(os.default),low:Na(os.low),lowest:Na(os.lowest)},Jc=class{constructor(e,t){this.inner=e,this.prec=t}},cs=class{of(e){return new La(this,e)}reconfigure(e){return cs.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}},La=class{constructor(e,t){this.compartment=e,this.inner=t}},fs=class{constructor(e,t,n,i,o,s){for(this.base=e,this.compartments=t,this.dynamicSlots=n,this.address=i,this.staticValues=o,this.facets=s,this.statusTemplate=[];this.statusTemplate.length<n.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,n){let i=[],o=Object.create(null),s=new Map;for(let h of wA(e,t,s))h instanceof Ee?i.push(h):(o[h.facet.id]||(o[h.facet.id]=[])).push(h);let a=Object.create(null),l=[],c=[];for(let h of i)a[h.id]=c.length<<1,c.push(d=>h.slot(d));let f=n?.config.facets;for(let h in o){let d=o[h],m=d[0].facet,y=f&&f[h]||[];if(d.every(g=>g.type==0))if(a[m.id]=l.length<<1|1,Od(y,d))l.push(n.facet(m));else{let g=m.combine(d.map(v=>v.value));l.push(n&&m.compare(g,n.facet(m))?n.facet(m):g)}else{for(let g of d)g.type==0?(a[g.id]=l.length<<1|1,l.push(g.value)):(a[g.id]=c.length<<1,c.push(v=>g.dynamicSlot(v)));a[m.id]=c.length<<1,c.push(g=>kA(g,m,d))}}let u=c.map(h=>h(a));return new fs(e,s,u,a,l,o)}};function wA(r,e,t){let n=[[],[],[],[],[]],i=new Map;function o(s,a){let l=i.get(s);if(l!=null){if(l<=a)return;let c=n[l].indexOf(s);c>-1&&n[l].splice(c,1),s instanceof La&&t.delete(s.compartment)}if(i.set(s,a),Array.isArray(s))for(let c of s)o(c,a);else if(s instanceof La){if(t.has(s.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(s.compartment)||s.inner;t.set(s.compartment,c),o(c,a)}else if(s instanceof Jc)o(s.inner,s.prec);else if(s instanceof Ee)n[a].push(s),s.provides&&o(s.provides,a);else if(s instanceof as)n[a].push(s),s.facet.extensions&&o(s.facet.extensions,a);else{let c=s.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${s}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);o(c,a)}}return o(r,os.default),n.reduce((s,a)=>s.concat(a))}function Pa(r,e){if(e&1)return 2;let t=e>>1,n=r.status[t];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;r.status[t]=4;let i=r.computeSlot(r,r.config.dynamicSlots[t]);return r.status[t]=2|i}function Yc(r,e){return e&1?r.config.staticValues[e>>1]:r.values[e>>1]}var k0=Z.define(),w0=Z.define({combine:r=>r.some(e=>e),static:!0}),x0=Z.define({combine:r=>r.length?r[0]:void 0,static:!0}),S0=Z.define(),C0=Z.define(),A0=Z.define(),T0=Z.define({combine:r=>r.length?r[0]:!1}),Jr=class{constructor(e,t){this.type=e,this.value=t}static define(){return new kd}},kd=class{of(e){return new Jr(this,e)}},wd=class{constructor(e){this.map=e}of(e){return new ae(this,e)}},ae=class{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new ae(this.type,t)}is(e){return this.type==e}static define(e={}){return new wd(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let n=[];for(let i of e){let o=i.map(t);o&&n.push(o)}return n}};ae.reconfigure=ae.define();ae.appendConfig=ae.define();var Ze=class{constructor(e,t,n,i,o,s){this.startState=e,this.changes=t,this.selection=n,this.effects=i,this.annotations=o,this.scrollIntoView=s,this._doc=null,this._state=null,n&&v0(n,t.newLength),o.some(a=>a.type==Ze.time)||(this.annotations=o.concat(Ze.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Ze.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}};Ze.time=Jr.define();Ze.userEvent=Jr.define();Ze.addToHistory=Jr.define();Ze.remote=Jr.define();function xA(r,e){let t=[];for(let n=0,i=0;;){let o,s;if(n<r.length&&(i==e.length||e[i]>=r[n]))o=r[n++],s=r[n++];else if(i<e.length)o=e[i++],s=e[i++];else return t;!t.length||t[t.length-1]<o?t.push(o,s):t[t.length-1]<s&&(t[t.length-1]=s)}}function O0(r,e,t){var n;let i,o,s;return t?(i=e.changes,o=Ge.empty(e.changes.length),s=r.changes.compose(e.changes)):(i=e.changes.map(r.changes),o=r.changes.mapDesc(e.changes,!0),s=r.changes.compose(i)),{changes:s,selection:e.selection?e.selection.map(o):(n=r.selection)===null||n===void 0?void 0:n.map(i),effects:ae.mapEffects(r.effects,i).concat(ae.mapEffects(e.effects,o)),annotations:r.annotations.length?r.annotations.concat(e.annotations):e.annotations,scrollIntoView:r.scrollIntoView||e.scrollIntoView}}function xd(r,e,t){let n=e.selection,i=ls(e.annotations);return e.userEvent&&(i=i.concat(Ze.userEvent.of(e.userEvent))),{changes:e.changes instanceof Ge?e.changes:Ge.of(e.changes||[],t,r.facet(x0)),selection:n&&(n instanceof N?n:N.single(n.anchor,n.head)),effects:ls(e.effects),annotations:i,scrollIntoView:!!e.scrollIntoView}}function E0(r,e,t){let n=xd(r,e.length?e[0]:{},r.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let o=1;o<e.length;o++){e[o].filter===!1&&(t=!1);let s=!!e[o].sequential;n=O0(n,xd(r,e[o],s?n.changes.newLength:r.doc.length),s)}let i=new Ze(r,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return CA(t?SA(i):i)}function SA(r){let e=r.startState,t=!0;for(let i of e.facet(S0)){let o=i(r);if(o===!1){t=!1;break}Array.isArray(o)&&(t=t===!0?o:xA(t,o))}if(t!==!0){let i,o;if(t===!1)o=r.changes.invertedDesc,i=Ge.empty(e.doc.length);else{let s=r.changes.filter(t);i=s.changes,o=s.filtered.invertedDesc}r=new Ze(e,i,r.selection&&r.selection.map(o),ae.mapEffects(r.effects,o),r.annotations,r.scrollIntoView)}let n=e.facet(C0);for(let i=n.length-1;i>=0;i--){let o=n[i](r);o instanceof Ze?r=o:Array.isArray(o)&&o.length==1&&o[0]instanceof Ze?r=o[0]:r=E0(e,ls(o),!1)}return r}function CA(r){let e=r.startState,t=e.facet(A0),n=r;for(let i=t.length-1;i>=0;i--){let o=t[i](r);o&&Object.keys(o).length&&(n=O0(r,xd(e,o,r.changes.newLength),!0))}return n==r?r:new Ze(e,r.changes,r.selection,n.effects,n.annotations,n.scrollIntoView)}var AA=[];function ls(r){return r==null?AA:Array.isArray(r)?r:[r]}var at=function(r){return r[r.Word=0]="Word",r[r.Space=1]="Space",r[r.Other=2]="Other",r}(at||(at={})),TA=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Sd;try{Sd=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function OA(r){if(Sd)return Sd.test(r);for(let e=0;e<r.length;e++){let t=r[e];if(/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||TA.test(t)))return!0}return!1}function EA(r){return e=>{if(!/\S/.test(e))return at.Space;if(OA(e))return at.Word;for(let t=0;t<r.length;t++)if(e.indexOf(r[t])>-1)return at.Word;return at.Other}}var de=class{constructor(e,t,n,i,o,s){this.config=e,this.doc=t,this.selection=n,this.values=i,this.status=e.statusTemplate.slice(),this.computeSlot=o,s&&(s._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)Pa(this,a<<1);this.computeSlot=null}field(e,t=!0){let n=this.config.address[e.id];if(n==null){if(t)throw new RangeError("Field is not present in this state");return}return Pa(this,n),Yc(this,n)}update(...e){return E0(this,e,!0)}applyTransaction(e){let t=this.config,{base:n,compartments:i}=t;for(let s of e.effects)s.is(cs.reconfigure)?(t&&(i=new Map,t.compartments.forEach((a,l)=>i.set(l,a)),t=null),i.set(s.value.compartment,s.value.extension)):s.is(ae.reconfigure)?(t=null,n=s.value):s.is(ae.appendConfig)&&(t=null,n=ls(n).concat(s.value));let o;t?o=e.startState.values.slice():(t=fs.resolve(n,i,this),o=new de(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(a,l)=>l.reconfigure(a,this),null).values),new de(t,e.newDoc,e.newSelection,o,(s,a)=>a.update(s,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:N.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,n=e(t.ranges[0]),i=this.changes(n.changes),o=[n.range],s=ls(n.effects);for(let a=1;a<t.ranges.length;a++){let l=e(t.ranges[a]),c=this.changes(l.changes),f=c.map(i);for(let h=0;h<a;h++)o[h]=o[h].map(f);let u=i.mapDesc(c,!0);o.push(l.range.map(u)),i=i.compose(f),s=ae.mapEffects(s,f).concat(ae.mapEffects(ls(l.effects),u))}return{changes:i,selection:N.create(o,t.mainIndex),effects:s}}changes(e=[]){return e instanceof Ge?e:Ge.of(e,this.doc.length,this.facet(de.lineSeparator))}toText(e){return ve.of(e.split(this.facet(de.lineSeparator)||yd))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(Pa(this,t),Yc(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let n in e){let i=e[n];i instanceof Ee&&(t[n]=i.spec.toJSON(this.field(e[n]),this))}return t}static fromJSON(e,t={},n){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let i=[];if(n)for(let o in n){let s=n[o],a=e[o];i.push(s.init(l=>s.spec.fromJSON(a,l)))}return de.create({doc:e.doc,selection:N.fromJSON(e.selection),extensions:t.extensions?i.concat([t.extensions]):i})}static create(e={}){let t=fs.resolve(e.extensions||[],new Map),n=e.doc instanceof ve?e.doc:ve.of((e.doc||"").split(t.staticFacet(de.lineSeparator)||yd)),i=e.selection?e.selection instanceof N?e.selection:N.single(e.selection.anchor,e.selection.head):N.single(0);return v0(i,n.length),t.staticFacet(w0)||(i=i.asSingle()),new de(t,n,i,t.dynamicSlots.map(()=>null),(o,s)=>s.create(o),null)}get tabSize(){return this.facet(de.tabSize)}get lineBreak(){return this.facet(de.lineSeparator)||`
`}get readOnly(){return this.facet(T0)}phrase(e){for(let t of this.facet(de.phrases))if(Object.prototype.hasOwnProperty.call(t,e))return t[e];return e}languageDataAt(e,t,n=-1){let i=[];for(let o of this.facet(k0))for(let s of o(this,t,n))Object.prototype.hasOwnProperty.call(s,e)&&i.push(s[e]);return i}charCategorizer(e){return EA(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:n,length:i}=this.doc.lineAt(e),o=this.charCategorizer(e),s=e-n,a=e-n;for(;s>0;){let l=qt(t,s,!1);if(o(t.slice(l,s))!=at.Word)break;s=l}for(;a<i;){let l=qt(t,a);if(o(t.slice(a,l))!=at.Word)break;a=l}return s==a?null:N.range(s+n,a+n)}};de.allowMultipleSelections=w0;de.tabSize=Z.define({combine:r=>r.length?r[0]:4});de.lineSeparator=x0;de.readOnly=T0;de.phrases=Z.define({compare(r,e){let t=Object.keys(r),n=Object.keys(e);return t.length==n.length&&t.every(i=>r[i]==e[i])}});de.languageData=k0;de.changeFilter=S0;de.transactionFilter=C0;de.transactionExtender=A0;cs.reconfigure=ae.define();function Kt(r,e,t={}){let n={};for(let i of r)for(let o of Object.keys(i)){let s=i[o],a=n[o];if(a===void 0)n[o]=s;else if(!(a===s||s===void 0))if(Object.hasOwnProperty.call(t,o))n[o]=t[o](a,s);else throw new Error("Config merge conflict for field "+o)}for(let i in e)n[i]===void 0&&(n[i]=e[i]);return n}var Yr=class{eq(e){return this==e}range(e,t=e){return new Ia(e,t,this)}};Yr.prototype.startSide=Yr.prototype.endSide=0;Yr.prototype.point=!1;Yr.prototype.mapMode=xt.TrackDel;var Ia=class{constructor(e,t,n){this.from=e,this.to=t,this.value=n}};function Cd(r,e){return r.from-e.from||r.value.startSide-e.value.startSide}var Ba=class{constructor(e,t,n,i){this.from=e,this.to=t,this.value=n,this.maxPoint=i}get length(){return this.to[this.to.length-1]}findIndex(e,t,n,i=0){let o=n?this.to:this.from;for(let s=i,a=o.length;;){if(s==a)return s;let l=s+a>>1,c=o[l]-e||(n?this.value[l].endSide:this.value[l].startSide)-t;if(l==s)return c>=0?s:a;c>=0?a=l:s=l+1}}between(e,t,n,i){for(let o=this.findIndex(t,-1e9,!0),s=this.findIndex(n,1e9,!1,o);o<s;o++)if(i(this.from[o]+e,this.to[o]+e,this.value[o])===!1)return!1}map(e,t){let n=[],i=[],o=[],s=-1,a=-1;for(let l=0;l<this.value.length;l++){let c=this.value[l],f=this.from[l]+e,u=this.to[l]+e,h,d;if(f==u){let m=t.mapPos(f,c.startSide,c.mapMode);if(m==null||(h=d=m,c.startSide!=c.endSide&&(d=t.mapPos(f,c.endSide),d<h)))continue}else if(h=t.mapPos(f,c.startSide),d=t.mapPos(u,c.endSide),h>d||h==d&&c.startSide>0&&c.endSide<=0)continue;(d-h||c.endSide-c.startSide)<0||(s<0&&(s=h),c.point&&(a=Math.max(a,d-h)),n.push(c),i.push(h-s),o.push(d-s))}return{mapped:n.length?new Ba(i,o,n,a):null,pos:s}}},ke=class{constructor(e,t,n=ke.empty,i){this.chunkPos=e,this.chunk=t,this.nextLayer=n,this.maxPoint=i}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:n=!1,filterFrom:i=0,filterTo:o=this.length}=e,s=e.filter;if(t.length==0&&!s)return this;if(n&&(t=t.slice().sort(Cd)),this.isEmpty)return t.length?ke.of(t):this;let a=new Xc(this,null,-1).goto(0),l=0,c=[],f=new cr;for(;a.value||l<t.length;)if(l<t.length&&(a.from-t[l].from||a.startSide-t[l].value.startSide)>=0){let u=t[l++];f.addInner(u.from,u.to,u.value)||c.push(u)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(l==t.length||this.chunkEnd(a.chunkIndex)<t[l].from)&&(!s||i>this.chunkEnd(a.chunkIndex)||o<this.chunkPos[a.chunkIndex])&&f.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!s||i>a.to||o<a.from||s(a.from,a.to,a.value))&&(f.addInner(a.from,a.to,a.value)||c.push(new Ia(a.from,a.to,a.value))),a.next());return f.finishInner(this.nextLayer.isEmpty&&!c.length?ke.empty:this.nextLayer.update({add:c,filter:s,filterFrom:i,filterTo:o}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],n=[],i=-1;for(let s=0;s<this.chunk.length;s++){let a=this.chunkPos[s],l=this.chunk[s],c=e.touchesRange(a,a+l.length);if(c===!1)i=Math.max(i,l.maxPoint),t.push(l),n.push(e.mapPos(a));else if(c===!0){let{mapped:f,pos:u}=l.map(a,e);f&&(i=Math.max(i,f.maxPoint),t.push(f),n.push(u))}}let o=this.nextLayer.map(e);return t.length==0?o:new ke(n,t,o,i)}between(e,t,n){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let o=this.chunkPos[i],s=this.chunk[i];if(t>=o&&e<=o+s.length&&s.between(o,e-o,t-o,n)===!1)return}this.nextLayer.between(e,t,n)}}iter(e=0){return fo.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return fo.from(e).goto(t)}static compare(e,t,n,i,o=-1){let s=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=o),a=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=o),l=d0(s,a,n),c=new so(s,l,o),f=new so(a,l,o);n.iterGaps((u,h,d)=>p0(c,u,f,h,d,i)),n.empty&&n.length==0&&p0(c,0,f,0,0,i)}static eq(e,t,n=0,i){i==null&&(i=1e9);let o=e.filter(f=>!f.isEmpty&&t.indexOf(f)<0),s=t.filter(f=>!f.isEmpty&&e.indexOf(f)<0);if(o.length!=s.length)return!1;if(!o.length)return!0;let a=d0(o,s),l=new so(o,a,0).goto(n),c=new so(s,a,0).goto(n);for(;;){if(l.to!=c.to||!Ad(l.active,c.active)||l.point&&(!c.point||!l.point.eq(c.point)))return!1;if(l.to>i)return!0;l.next(),c.next()}}static spans(e,t,n,i,o=-1){let s=new so(e,null,o).goto(t),a=t,l=s.openStart;for(;;){let c=Math.min(s.to,n);if(s.point?(i.point(a,c,s.point,s.activeForPoint(s.to),l,s.pointRank),l=s.openEnd(c)+(s.to>c?1:0)):c>a&&(i.span(a,c,s.active,l),l=s.openEnd(c)),s.to>n)break;a=s.to,s.next()}return l}static of(e,t=!1){let n=new cr;for(let i of e instanceof Ia?[e]:t?RA(e):e)n.add(i.from,i.to,i.value);return n.finish()}};ke.empty=new ke([],[],null,-1);function RA(r){if(r.length>1)for(let e=r[0],t=1;t<r.length;t++){let n=r[t];if(Cd(e,n)>0)return r.slice().sort(Cd);e=n}return r}ke.empty.nextLayer=ke.empty;var cr=class{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new Ba(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,t,n){this.addInner(e,t,n)||(this.nextLayer||(this.nextLayer=new cr)).add(e,t,n)}addInner(e,t,n){let i=e-this.lastTo||n.startSide-this.last.endSide;if(i<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return i<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=n,this.lastFrom=e,this.lastTo=t,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let n=t.value.length-1;return this.last=t.value[n],this.lastFrom=t.from[n]+e,this.lastTo=t.to[n]+e,!0}finish(){return this.finishInner(ke.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=new ke(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}};function d0(r,e,t){let n=new Map;for(let o of r)for(let s=0;s<o.chunk.length;s++)o.chunk[s].maxPoint<=0&&n.set(o.chunk[s],o.chunkPos[s]);let i=new Set;for(let o of e)for(let s=0;s<o.chunk.length;s++){let a=n.get(o.chunk[s]);a!=null&&(t?t.mapPos(a):a)==o.chunkPos[s]&&!t?.touchesRange(a,a+o.chunk[s].length)&&i.add(o.chunk[s])}return i}var Xc=class{constructor(e,t,n,i=0){this.layer=e,this.skip=t,this.minPoint=n,this.rank=i}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,n){for(;this.chunkIndex<this.layer.chunk.length;){let i=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(i)||this.layer.chunkEnd(this.chunkIndex)<e||i.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let i=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!n||this.rangeIndex<i)&&this.setRangeIndex(i)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],n=e+t.from[this.rangeIndex];if(this.from=n,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}},fo=class{constructor(e){this.heap=e}static from(e,t=null,n=-1){let i=[];for(let o=0;o<e.length;o++)for(let s=e[o];!s.isEmpty;s=s.nextLayer)s.maxPoint>=n&&i.push(new Xc(s,t,n,o));return i.length==1?i[0]:new fo(i)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let n of this.heap)n.goto(e,t);for(let n=this.heap.length>>1;n>=0;n--)md(this.heap,n);return this.next(),this}forward(e,t){for(let n of this.heap)n.forward(e,t);for(let n=this.heap.length>>1;n>=0;n--)md(this.heap,n);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),md(this.heap,0)}}};function md(r,e){for(let t=r[e];;){let n=(e<<1)+1;if(n>=r.length)break;let i=r[n];if(n+1<r.length&&i.compare(r[n+1])>=0&&(i=r[n+1],n++),t.compare(i)<0)break;r[n]=t,r[e]=i,e=n}}var so=class{constructor(e,t,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=fo.from(e,t,n)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Wc(this.active,e),Wc(this.activeTo,e),Wc(this.activeRank,e),this.minActive=m0(this.active,this.activeTo)}addActive(e){let t=0,{value:n,to:i,rank:o}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=o;)t++;qc(this.active,t,n),qc(this.activeTo,t,i),qc(this.activeRank,t,o),e&&qc(e,t,this.cursor.from),this.minActive=m0(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let n=this.openStart<0?[]:null,i=0;for(;;){let o=this.minActive;if(o>-1&&(this.activeTo[o]-this.cursor.from||this.active[o].endSide-this.cursor.startSide)<0){if(this.activeTo[o]>e){this.to=this.activeTo[o],this.endSide=this.active[o].endSide;break}this.removeActive(o),n&&Wc(n,o)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(n),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.from<e&&(i=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(n){let o=0;for(;o<n.length&&n[o]<e;)o++;this.openStart=o+i}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>=this.point.endSide)&&t.push(this.active[n]);return t.reverse()}openEnd(e){let t=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)t++;return t}};function p0(r,e,t,n,i,o){r.goto(e),t.goto(n);let s=n+i,a=n,l=n-e;for(;;){let c=r.to+l-t.to||r.endSide-t.endSide,f=c<0?r.to+l:t.to,u=Math.min(f,s);if(r.point||t.point?r.point&&t.point&&(r.point==t.point||r.point.eq(t.point))&&Ad(r.activeForPoint(r.to+l),t.activeForPoint(t.to))||o.comparePoint(a,u,r.point,t.point):u>a&&!Ad(r.active,t.active)&&o.compareRange(a,u,r.active,t.active),f>s)break;a=f,c<=0&&r.next(),c>=0&&t.next()}}function Ad(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!=e[t]&&!r[t].eq(e[t]))return!1;return!0}function Wc(r,e){for(let t=e,n=r.length-1;t<n;t++)r[t]=r[t+1];r.pop()}function qc(r,e,t){for(let n=r.length-1;n>=e;n--)r[n+1]=r[n];r[e]=t}function m0(r,e){let t=-1,n=1e9;for(let i=0;i<e.length;i++)(e[i]-n||r[i].endSide-r[t].endSide)<0&&(t=i,n=e[i]);return t}function li(r,e,t=r.length){let n=0;for(let i=0;i<t;)r.charCodeAt(i)==9?(n+=e-n%e,i++):(n++,i=qt(r,i));return n}function Qc(r,e,t,n){for(let i=0,o=0;;){if(o>=e)return i;if(i==r.length)break;o+=r.charCodeAt(i)==9?t-o%t:1,i=qt(r,i)}return n===!0?-1:r.length}var Ed="\u037C",R0=typeof Symbol>"u"?"__"+Ed:Symbol.for(Ed),Rd=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),M0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{},Tr=class{constructor(e,t){this.rules=[];let{finish:n}=t||{};function i(s){return/^@/.test(s)?[s]:s.split(/,\s*/)}function o(s,a,l,c){let f=[],u=/^@(\w+)\b/.exec(s[0]),h=u&&u[1]=="keyframes";if(u&&a==null)return l.push(s[0]+";");for(let d in a){let m=a[d];if(/&/.test(d))o(d.split(/,\s*/).map(y=>s.map(g=>y.replace(/&/,g))).reduce((y,g)=>y.concat(g)),m,l);else if(m&&typeof m=="object"){if(!u)throw new RangeError("The value of a property ("+d+") should be a primitive value.");o(i(d),m,f,h)}else m!=null&&f.push(d.replace(/_.*/,"").replace(/[A-Z]/g,y=>"-"+y.toLowerCase())+": "+m+";")}(f.length||h)&&l.push((n&&!u&&!c?s.map(n):s).join(", ")+" {"+f.join(" ")+"}")}for(let s in e)o(i(s),e[s],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=M0[R0]||1;return M0[R0]=e+1,Ed+e.toString(36)}static mount(e,t){(e[Rd]||new Md(e)).mount(Array.isArray(t)?t:[t])}},ef=null,Md=class{constructor(e){if(!e.head&&e.adoptedStyleSheets&&typeof CSSStyleSheet<"u"){if(ef)return e.adoptedStyleSheets=[ef.sheet].concat(e.adoptedStyleSheets),e[Rd]=ef;this.sheet=new CSSStyleSheet,e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets),ef=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");let t=e.head||e;t.insertBefore(this.styleTag,t.firstChild)}this.modules=[],e[Rd]=this}mount(e){let t=this.sheet,n=0,i=0;for(let o=0;o<e.length;o++){let s=e[o],a=this.modules.indexOf(s);if(a<i&&a>-1&&(this.modules.splice(a,1),i--,a=-1),a==-1){if(this.modules.splice(i++,0,s),t)for(let l=0;l<s.rules.length;l++)t.insertRule(s.rules[l],n++)}else{for(;i<a;)n+=this.modules[i++].rules.length;n+=s.rules.length,i++}}if(!t){let o="";for(let s=0;s<this.modules.length;s++)o+=this.modules[s].getRules()+`
`;this.styleTag.textContent=o}}};var Vn={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},rf={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},D0=typeof navigator<"u"&&/Chrome\/(\d+)/.exec(navigator.userAgent),MA=typeof navigator<"u"&&/Apple Computer/.test(navigator.vendor),DA=typeof navigator<"u"&&/Gecko\/\d+/.test(navigator.userAgent),N0=typeof navigator<"u"&&/Mac/.test(navigator.platform),NA=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),PA=D0&&(N0||+D0[1]<57)||DA&&N0;for(nt=0;nt<10;nt++)Vn[48+nt]=Vn[96+nt]=String(nt);var nt;for(nt=1;nt<=24;nt++)Vn[nt+111]="F"+nt;var nt;for(nt=65;nt<=90;nt++)Vn[nt]=String.fromCharCode(nt+32),rf[nt]=String.fromCharCode(nt);var nt;for(tf in Vn)rf.hasOwnProperty(tf)||(rf[tf]=Vn[tf]);var tf;function P0(r){var e=PA&&(r.ctrlKey||r.altKey||r.metaKey)||(MA||NA)&&r.shiftKey&&r.key&&r.key.length==1,t=!e&&r.key||(r.shiftKey?rf:Vn)[r.keyCode]||r.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function ff(r){let e;return r.nodeType==11?e=r.getSelection?r:r.ownerDocument:e=r,e.getSelection()}function ms(r,e){return e?r==e||r.contains(e.nodeType!=1?e.parentNode:e):!1}function LA(){let r=document.activeElement;for(;r&&r.shadowRoot;)r=r.shadowRoot.activeElement;return r}function Fd(r,e){if(!e.anchorNode)return!1;try{return ms(r,e.anchorNode)}catch{return!1}}function Za(r){return r.nodeType==3?Ja(r,0,r.nodeValue.length).getClientRects():r.nodeType==1?r.getClientRects():[]}function uf(r,e,t,n){return t?L0(r,e,t,n,-1)||L0(r,e,t,n,1):!1}function Vd(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e}function L0(r,e,t,n,i){for(;;){if(r==t&&e==n)return!0;if(e==(i<0?0:hf(r))){if(r.nodeName=="DIV")return!1;let o=r.parentNode;if(!o||o.nodeType!=1)return!1;e=Vd(r)+(i<0?0:1),r=o}else if(r.nodeType==1){if(r=r.childNodes[e+(i<0?-1:0)],r.nodeType==1&&r.contentEditable=="false")return!1;e=i<0?hf(r):0}else return!1}}function hf(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}var vb={left:0,right:0,top:0,bottom:0};function Tf(r,e){let t=e?r.left:r.right;return{left:t,right:t,top:r.top,bottom:r.bottom}}function IA(r){return{left:0,right:r.innerWidth,top:0,bottom:r.innerHeight}}function BA(r,e,t,n,i,o,s,a){let l=r.ownerDocument,c=l.defaultView;for(let f=r;f;)if(f.nodeType==1){let u,h=f==l.body;if(h)u=IA(c);else{if(f.scrollHeight<=f.clientHeight&&f.scrollWidth<=f.clientWidth){f=f.parentNode;continue}let y=f.getBoundingClientRect();u={left:y.left,right:y.left+f.clientWidth,top:y.top,bottom:y.top+f.clientHeight}}let d=0,m=0;if(i=="nearest")e.top<u.top?(m=-(u.top-e.top+s),t>0&&e.bottom>u.bottom+m&&(m=e.bottom-u.bottom+m+s)):e.bottom>u.bottom&&(m=e.bottom-u.bottom+s,t<0&&e.top-m<u.top&&(m=-(u.top+m-e.top+s)));else{let y=e.bottom-e.top,g=u.bottom-u.top;m=(i=="center"&&y<=g?e.top+y/2-g/2:i=="start"||i=="center"&&t<0?e.top-s:e.bottom-g+s)-u.top}if(n=="nearest"?e.left<u.left?(d=-(u.left-e.left+o),t>0&&e.right>u.right+d&&(d=e.right-u.right+d+o)):e.right>u.right&&(d=e.right-u.right+o,t<0&&e.left<u.left+d&&(d=-(u.left+d-e.left+o))):d=(n=="center"?e.left+(e.right-e.left)/2-(u.right-u.left)/2:n=="start"==a?e.left-o:e.right-(u.right-u.left)+o)-u.left,d||m)if(h)c.scrollBy(d,m);else{if(m){let y=f.scrollTop;f.scrollTop+=m,m=f.scrollTop-y}if(d){let y=f.scrollLeft;f.scrollLeft+=d,d=f.scrollLeft-y}e={left:e.left-d,top:e.top-m,right:e.right-d,bottom:e.bottom-m}}if(h)break;f=f.assignedSlot||f.parentNode,n=i="nearest"}else if(f.nodeType==11)f=f.host;else break}var Ud=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,t,n,i){this.anchorNode=e,this.anchorOffset=t,this.focusNode=n,this.focusOffset=i}},us=null;function kb(r){if(r.setActive)return r.setActive();if(us)return r.focus(us);let e=[];for(let t=r;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(r.focus(us==null?{get preventScroll(){return us={preventScroll:!0},!0}}:void 0),!us){us=!1;for(let t=0;t<e.length;){let n=e[t++],i=e[t++],o=e[t++];n.scrollTop!=i&&(n.scrollTop=i),n.scrollLeft!=o&&(n.scrollLeft=o)}}}var I0;function Ja(r,e,t=e){let n=I0||(I0=document.createRange());return n.setEnd(r,t),n.setStart(r,e),n}function Ha(r,e,t){let n={key:e,code:e,keyCode:t,which:t,cancelable:!0},i=new KeyboardEvent("keydown",n);i.synthetic=!0,r.dispatchEvent(i);let o=new KeyboardEvent("keyup",n);return o.synthetic=!0,r.dispatchEvent(o),i.defaultPrevented||o.defaultPrevented}function zA(r){for(;r;){if(r&&(r.nodeType==9||r.nodeType==11&&r.host))return r;r=r.assignedSlot||r.parentNode}return null}function wb(r){for(;r.attributes.length;)r.removeAttributeNode(r.attributes[0])}var ft=class{constructor(e,t,n=!0){this.node=e,this.offset=t,this.precise=n}static before(e,t){return new ft(e.parentNode,Vd(e),t)}static after(e,t){return new ft(e.parentNode,Vd(e)+1,t)}},Cp=[],Ve=class{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let n of this.children){if(n==e)return t;t+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,t){return null}sync(e){if(this.dirty&2){let t=this.dom,n=null,i;for(let o of this.children){if(o.dirty){if(!o.dom&&(i=n?n.nextSibling:t.firstChild)){let s=Ve.get(i);(!s||!s.parent&&s.constructor==o.constructor)&&o.reuseDOM(i)}o.sync(e),o.dirty=0}if(i=n?n.nextSibling:t.firstChild,e&&!e.written&&e.node==t&&i!=o.dom&&(e.written=!0),o.dom.parentNode==t)for(;i&&i!=o.dom;)i=B0(i);else t.insertBefore(o.dom,i);n=o.dom}for(i=n?n.nextSibling:t.firstChild,i&&e&&e.node==t&&(e.written=!0);i;)i=B0(i)}else if(this.dirty&1)for(let t of this.children)t.dirty&&(t.sync(e),t.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let n;if(e==this.dom)n=this.dom.childNodes[t];else{let i=hf(e)==0?0:t==0?-1:1;for(;;){let o=e.parentNode;if(o==this.dom)break;i==0&&o.firstChild!=o.lastChild&&(e==o.firstChild?i=-1:i=1),e=o}i<0?n=e:n=e.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!Ve.get(n);)n=n.nextSibling;if(!n)return this.length;for(let i=0,o=0;;i++){let s=this.children[i];if(s.dom==n)return o;o+=s.length+s.breakAfter}}domBoundsAround(e,t,n=0){let i=-1,o=-1,s=-1,a=-1;for(let l=0,c=n,f=n;l<this.children.length;l++){let u=this.children[l],h=c+u.length;if(c<e&&h>t)return u.domBoundsAround(e,t,c);if(h>=e&&i==-1&&(i=l,o=c),c>t&&u.dom.parentNode==this.dom){s=l,a=f;break}f=h,c=h+u.breakAfter}return{from:o,to:a<0?n+this.length:a,startDOM:(i?this.children[i-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:s<this.children.length&&s>=0?this.children[s].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),t.dirty&1)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,n=Cp){this.markDirty();for(let i=e;i<t;i++){let o=this.children[i];o.parent==this&&o.destroy()}this.children.splice(e,t-e,...n);for(let i=0;i<n.length;i++)n[i].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new df(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,t,n,i,o,s){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}};Ve.prototype.breakAfter=0;function B0(r){let e=r.nextSibling;return r.parentNode.removeChild(r),e}var df=class{constructor(e,t,n){this.children=e,this.pos=t,this.i=n,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}};function xb(r,e,t,n,i,o,s,a,l){let{children:c}=r,f=c.length?c[e]:null,u=o.length?o[o.length-1]:null,h=u?u.breakAfter:s;if(!(e==n&&f&&!s&&!h&&o.length<2&&f.merge(t,i,o.length?u:null,t==0,a,l))){if(n<c.length){let d=c[n];d&&i<d.length?(e==n&&(d=d.split(i),i=0),!h&&u&&d.merge(0,i,u,!0,0,l)?o[o.length-1]=d:(i&&d.merge(0,i,null,!1,0,l),o.push(d))):d?.breakAfter&&(u?u.breakAfter=1:s=1),n++}for(f&&(f.breakAfter=s,t>0&&(!s&&o.length&&f.merge(t,f.length,o[0],!1,a,0)?f.breakAfter=o.shift().breakAfter:(t<f.length||f.children.length&&f.children[f.children.length-1].length==0)&&f.merge(t,f.length,null,!1,a,0),e++));e<n&&o.length;)if(c[n-1].become(o[o.length-1]))n--,o.pop(),l=o.length?0:a;else if(c[e].become(o[0]))e++,o.shift(),a=o.length?0:l;else break;!o.length&&e&&n<c.length&&!c[e-1].breakAfter&&c[n].merge(0,0,c[e-1],!1,a,l)&&e--,(e<n||o.length)&&r.replaceChildren(e,n,o)}}function Sb(r,e,t,n,i,o){let s=r.childCursor(),{i:a,off:l}=s.findPos(t,1),{i:c,off:f}=s.findPos(e,-1),u=e-t;for(let h of n)u+=h.length;r.length+=u,xb(r,c,f,a,l,n,0,i,o)}var fr=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},Hd=typeof document<"u"?document:{documentElement:{style:{}}},Wd=/Edge\/(\d+)/.exec(fr.userAgent),Cb=/MSIE \d/.test(fr.userAgent),qd=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(fr.userAgent),Of=!!(Cb||qd||Wd),z0=!Of&&/gecko\/(\d+)/i.test(fr.userAgent),Dd=!Of&&/Chrome\/(\d+)/.exec(fr.userAgent),j0="webkitFontSmoothing"in Hd.documentElement.style,Ab=!Of&&/Apple Computer/.test(fr.vendor),$0=Ab&&(/Mobile\/\w+/.test(fr.userAgent)||fr.maxTouchPoints>2),ne={mac:$0||/Mac/.test(fr.platform),windows:/Win/.test(fr.platform),linux:/Linux|X11/.test(fr.platform),ie:Of,ie_version:Cb?Hd.documentMode||6:qd?+qd[1]:Wd?+Wd[1]:0,gecko:z0,gecko_version:z0?+(/Firefox\/(\d+)/.exec(fr.userAgent)||[0,0])[1]:0,chrome:!!Dd,chrome_version:Dd?+Dd[1]:0,ios:$0,android:/Android\b/.test(fr.userAgent),webkit:j0,safari:Ab,webkit_version:j0?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:Hd.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"},jA=256,bn=class extends Ve{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,n){return n&&(!(n instanceof bn)||this.length-(t-e)+n.length>jA)?!1:(this.text=this.text.slice(0,e)+(n?n.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new bn(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new ft(this.dom,e)}domBoundsAround(e,t,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return Kd(this.dom,e,t)}},Or=class extends Ve{constructor(e,t=[],n=0){super(),this.mark=e,this.children=t,this.length=n;for(let i of t)i.setParent(this)}setAttrs(e){if(wb(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,t,n,i,o,s){return n&&(!(n instanceof Or&&n.mark.eq(this.mark))||e&&o<=0||t<this.length&&s<=0)?!1:(Sb(this,e,t,n?n.children:[],o-1,s-1),this.markDirty(),!0)}split(e){let t=[],n=0,i=-1,o=0;for(let a of this.children){let l=n+a.length;l>e&&t.push(n<e?a.split(e-n):a),i<0&&n>=e&&(i=o),n=l,o++}let s=this.length-e;return this.length=e,i>-1&&(this.children.length=i,this.markDirty()),new Or(this.mark,t,s)}domAtPos(e){return Ob(this.dom,this.children,e)}coordsAt(e,t){return Rb(this,e,t)}};function Kd(r,e,t){let n=r.nodeValue.length;e>n&&(e=n);let i=e,o=e,s=0;e==0&&t<0||e==n&&t>=0?ne.chrome||ne.gecko||(e?(i--,s=1):(o++,s=-1)):t<0?i--:o++;let a=Ja(r,i,o).getClientRects();if(!a.length)return vb;let l=a[(s?s<0:t>=0)?0:a.length-1];return ne.safari&&!s&&l.width==0&&(l=Array.prototype.find.call(a,c=>c.width)||l),s?Tf(l,s<0):l||null}var gn=class extends Ve{constructor(e,t,n){super(),this.widget=e,this.length=t,this.side=n,this.prevWidget=null}static create(e,t,n){return new(e.customView||gn)(e,t,n)}split(e){let t=gn.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,n,i,o,s){return n&&(!(n instanceof gn)||!this.widget.compare(n.widget)||e>0&&o<=0||t<this.length&&s<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-t),!0)}become(e){return e.length==this.length&&e instanceof gn&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return ve.empty;let e=this;for(;e.parent;)e=e.parent;let t=e.editorView,n=t&&t.state.doc,i=this.posAtStart;return n?n.slice(i,i+this.length):ve.empty}domAtPos(e){return e==0?ft.before(this.dom):ft.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let n=this.dom.getClientRects(),i=null;if(!n.length)return vb;for(let o=e>0?n.length-1:0;i=n[o],!(e>0?o==0:o==n.length-1||i.top<i.bottom);o+=e>0?-1:1);return e==0&&t>0||e==this.length&&t<=0?i:Tf(i,e==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},pf=class extends gn{domAtPos(e){let{topView:t,text:n}=this.widget;return t?Gd(e,0,t,n,(i,o)=>i.domAtPos(o),i=>new ft(n,Math.min(i,n.nodeValue.length))):new ft(n,Math.min(e,n.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){let{topView:n,text:i}=this.widget;return n?Tb(e,t,n,i):Math.min(t,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){let{topView:n,text:i}=this.widget;return n?Gd(e,t,n,i,(o,s,a)=>o.coordsAt(s,a),(o,s)=>Kd(i,o,s)):Kd(i,e,t)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}};function Gd(r,e,t,n,i,o){if(t instanceof Or){for(let s of t.children){let a=ms(s.dom,n),l=a?n.nodeValue.length:s.length;if(r<l||r==l&&s.getSide()<=0)return a?Gd(r,e,s,n,i,o):i(s,r,e);r-=l}return i(t,t.length,-1)}else return t.dom==n?o(r,e):i(t,r,e)}function Tb(r,e,t,n){if(t instanceof Or)for(let i of t.children){let o=0,s=ms(i.dom,n);if(ms(i.dom,r))return o+(s?Tb(r,e,i,n):i.localPosFromDOM(r,e));o+=s?n.nodeValue.length:i.length}else if(t.dom==n)return Math.min(e,n.nodeValue.length);return t.localPosFromDOM(r,e)}var hi=class extends Ve{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof hi&&e.side==this.side}split(){return new hi(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return ft.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let t=this.dom.getBoundingClientRect(),n=$A(this,this.side>0?-1:1);return n&&n.top<t.bottom&&n.bottom>t.top?{left:t.left,right:t.right,top:n.top,bottom:n.bottom}:t}get overrideDOMText(){return ve.empty}};bn.prototype.children=gn.prototype.children=hi.prototype.children=Cp;function $A(r,e){let t=r.parent,n=t?t.children.indexOf(r):-1;for(;t&&n>=0;)if(e<0?n>0:n<t.children.length){let i=t.children[n+e];if(i instanceof bn){let o=i.coordsAt(e<0?i.length:0,e);if(o)return o}n+=e}else if(t instanceof Or&&t.parent)n=t.parent.children.indexOf(t)+(e<0?0:1),t=t.parent;else{let i=t.dom.lastChild;if(i&&i.nodeName=="BR")return i.getClientRects()[0];break}}function Ob(r,e,t){let n=0;for(let i=0;n<e.length;n++){let o=e[n],s=i+o.length;if(!(s==i&&o.getSide()<=0)){if(t>i&&t<s&&o.dom.parentNode==r)return o.domAtPos(t-i);if(t<=i)break;i=s}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==r)return ft.after(i)}return new ft(r,0)}function Eb(r,e,t){let n,{children:i}=r;t>0&&e instanceof Or&&i.length&&(n=i[i.length-1])instanceof Or&&n.mark.eq(e.mark)?Eb(n,e.children[0],t-1):(i.push(e),e.setParent(r)),r.length+=e.length}function Rb(r,e,t){for(let o=0,s=0;s<r.children.length;s++){let a=r.children[s],l=o+a.length,c;if((t<=0||l==r.length||a.getSide()>0?l>=e:l>e)&&(e<l||s+1==r.children.length||(c=r.children[s+1]).length||c.getSide()>0)){let f=0;if(l==o){if(a.getSide()<=0)continue;f=t=-a.getSide()}let u=a.coordsAt(Math.max(0,e-o),t);return f&&u?Tf(u,t<0):u}o=l}let n=r.dom.lastChild;if(!n)return r.dom.getBoundingClientRect();let i=Za(n);return i[i.length-1]||null}function Zd(r,e){for(let t in r)t=="class"&&e.class?e.class+=" "+r.class:t=="style"&&e.style?e.style+=";"+r.style:e[t]=r[t];return e}function Ap(r,e){if(r==e)return!0;if(!r||!e)return!1;let t=Object.keys(r),n=Object.keys(e);if(t.length!=n.length)return!1;for(let i of t)if(n.indexOf(i)==-1||r[i]!==e[i])return!1;return!0}function Jd(r,e,t){let n=null;if(e)for(let i in e)t&&i in t||r.removeAttribute(n=i);if(t)for(let i in t)e&&e[i]==t[i]||r.setAttribute(n=i,t[i]);return!!n}var ur=class{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}},Ne=function(r){return r[r.Text=0]="Text",r[r.WidgetBefore=1]="WidgetBefore",r[r.WidgetAfter=2]="WidgetAfter",r[r.WidgetRange=3]="WidgetRange",r}(Ne||(Ne={})),Y=class extends Yr{constructor(e,t,n,i){super(),this.startSide=e,this.endSide=t,this.widget=n,this.spec=i}get heightRelevant(){return!1}static mark(e){return new gs(e)}static widget(e){let t=e.side||0,n=!!e.block;return t+=n?t>0?3e8:-4e8:t>0?1e8:-1e8,new Hn(e,t,t,n,e.widget||null,!1)}static replace(e){let t=!!e.block,n,i;if(e.isBlockGap)n=-5e8,i=4e8;else{let{start:o,end:s}=Mb(e,t);n=(o?t?-3e8:-1:5e8)-1,i=(s?t?2e8:1:-6e8)+1}return new Hn(e,n,i,t,e.widget||null,!0)}static line(e){return new uo(e)}static set(e,t=!1){return ke.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};Y.none=ke.empty;var gs=class extends Y{constructor(e){let{start:t,end:n}=Mb(e);super(t?-1:5e8,n?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof gs&&this.tagName==e.tagName&&this.class==e.class&&Ap(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}};gs.prototype.point=!1;var uo=class extends Y{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof uo&&Ap(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}};uo.prototype.mapMode=xt.TrackBefore;uo.prototype.point=!0;var Hn=class extends Y{constructor(e,t,n,i,o,s){super(t,n,o,e),this.block=i,this.isReplace=s,this.mapMode=i?t<=0?xt.TrackBefore:xt.TrackAfter:xt.TrackDel}get type(){return this.startSide<this.endSide?Ne.WidgetRange:this.startSide<=0?Ne.WidgetBefore:Ne.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof Hn&&FA(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}};Hn.prototype.point=!0;function Mb(r,e=!1){let{inclusiveStart:t,inclusiveEnd:n}=r;return t==null&&(t=r.inclusive),n==null&&(n=r.inclusive),{start:t??e,end:n??e}}function FA(r,e){return r==e||!!(r&&e&&r.compare(e))}function Yd(r,e,t,n=0){let i=t.length-1;i>=0&&t[i]+n>=r?t[i]=Math.max(t[i],e):t.push(r,e)}var St=class extends Ve{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,n,i,o,s){if(n){if(!(n instanceof St))return!1;this.dom||n.transferDOM(this)}return i&&this.setDeco(n?n.attrs:null),Sb(this,e,t,n?n.children:[],o,s),!0}split(e){let t=new St;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i:n,off:i}=this.childPos(e);i&&(t.append(this.children[n].split(i),0),this.children[n].merge(i,this.children[n].length,null,!1,0,0),n++);for(let o=n;o<this.children.length;o++)t.append(this.children[o],0);for(;n>0&&this.children[n-1].length==0;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=e,t}transferDOM(e){!this.dom||(e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Ap(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Eb(this,e,t)}addLineDeco(e){let t=e.spec.attributes,n=e.spec.class;t&&(this.attrs=Zd(t,this.attrs||{})),n&&(this.attrs=Zd({class:n},this.attrs||{}))}domAtPos(e){return Ob(this.dom,this.children,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e){var t;this.dom?this.dirty&4&&(wb(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Jd(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let n=this.dom.lastChild;for(;n&&Ve.get(n)instanceof Or;)n=n.lastChild;if(!n||!this.length||n.nodeName!="BR"&&((t=Ve.get(n))===null||t===void 0?void 0:t.isEditable)==!1&&(!ne.ios||!this.children.some(i=>i instanceof bn))){let i=document.createElement("BR");i.cmIgnore=!0,this.dom.appendChild(i)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let t of this.children){if(!(t instanceof bn))return null;let n=Za(t.dom);if(n.length!=1)return null;e+=n[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,t){return Rb(this,e,t)}become(e){return!1}get type(){return Ne.Text}static find(e,t){for(let n=0,i=0;n<e.children.length;n++){let o=e.children[n],s=i+o.length;if(s>=t){if(o instanceof St)return o;if(s>t)break}i=s+o.breakAfter}return null}},Un=class extends Ve{constructor(e,t,n){super(),this.widget=e,this.length=t,this.type=n,this.breakAfter=0,this.prevWidget=null}merge(e,t,n,i,o,s){return n&&(!(n instanceof Un)||!this.widget.compare(n.widget)||e>0&&o<=0||t<this.length&&s<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?ft.before(this.dom):ft.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let n=new Un(this.widget,t,this.type);return n.breakAfter=this.breakAfter,n}get children(){return Cp}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):ve.empty}domBoundsAround(){return null}become(e){return e instanceof Un&&e.type==this.type&&e.widget.constructor==this.widget.constructor?(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}},Ya=class{constructor(e,t,n,i){this.doc=e,this.pos=t,this.end=n,this.disallowBlockEffectsFor=i,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof Un&&e.type==Ne.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new St),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append(nf(new hi(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,t,n){for(;e>0;){if(this.textOff==this.text.length){let{value:o,lineBreak:s,done:a}=this.cursor.next(this.skip);if(this.skip=0,a)throw new Error("Ran out of text content when drawing inline views");if(s){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}else this.text=o,this.textOff=0}let i=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(0,n)),this.getLine().append(nf(new bn(this.text.slice(this.textOff,this.textOff+i)),t),n),this.atCursorPos=!0,this.textOff+=i,e-=i,n=0}}span(e,t,n,i){this.buildText(t-e,n,i),this.pos=t,this.openStart<0&&(this.openStart=i)}point(e,t,n,i,o,s){if(this.disallowBlockEffectsFor[s]&&n instanceof Hn){if(n.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=t-e;if(n instanceof Hn)if(n.block){let{type:l}=n;l==Ne.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Un(n.widget||new mf("div"),a,l))}else{let l=gn.create(n.widget||new mf("span"),a,n.startSide),c=this.atCursorPos&&!l.isEditable&&o<=i.length&&(e<t||n.startSide>0),f=!l.isEditable&&(e<t||n.startSide<=0),u=this.getLine();this.pendingBuffer==2&&!c&&(this.pendingBuffer=0),this.flushBuffer(i),c&&(u.append(nf(new hi(1),i),o),o=i.length+Math.max(0,o-i.length)),u.append(nf(l,i),o),this.atCursorPos=f,this.pendingBuffer=f?e<t?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(n);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=o)}static build(e,t,n,i,o){let s=new Ya(e,t,n,o);return s.openEnd=ke.spans(i,t,n,s),s.openStart<0&&(s.openStart=s.openEnd),s.finish(s.openEnd),s}};function nf(r,e){for(let t of e)r=new Or(t,[r],r.length);return r}var mf=class extends ur{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}},Db=Z.define(),Nb=Z.define(),Pb=Z.define(),Lb=Z.define(),Xd=Z.define(),Ib=Z.define(),Bb=Z.define({combine:r=>r.some(e=>e)}),ys=class{constructor(e,t="nearest",n="nearest",i=5,o=5){this.range=e,this.y=t,this.x=n,this.yMargin=i,this.xMargin=o}map(e){return e.empty?this:new ys(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}},F0=ae.define({map:(r,e)=>r.map(e)});function Pt(r,e,t){let n=r.facet(Lb);n.length?n[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}var tl=Z.define({combine:r=>r.length?r[0]:!0}),VA=0,ja=Z.define(),Pe=class{constructor(e,t,n,i){this.id=e,this.create=t,this.domEventHandlers=n,this.extension=i(this)}static define(e,t){let{eventHandlers:n,provide:i,decorations:o}=t||{};return new Pe(VA++,e,n,s=>{let a=[ja.of(s)];return o&&a.push(Xa.of(l=>{let c=l.plugin(s);return c?o(c):Y.none})),i&&a.push(i(s)),a})}static fromClass(e,t){return Pe.define(n=>new e(n),t)}},Wa=class{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(n){if(Pt(t.state,n,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){Pt(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(n){Pt(e.state,n,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}},zb=Z.define(),jb=Z.define(),Xa=Z.define(),$b=Z.define(),Fb=Z.define(),$a=Z.define(),Xr=class{constructor(e,t,n,i){this.fromA=e,this.toA=t,this.fromB=n,this.toB=i}join(e){return new Xr(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,n=this;for(;t>0;t--){let i=e[t-1];if(!(i.fromA>n.toA)){if(i.toA<n.fromA)break;n=n.join(i),e.splice(t-1,1)}}return e.splice(t,0,n),e}static extendWithRanges(e,t){if(t.length==0)return e;let n=[];for(let i=0,o=0,s=0,a=0;;i++){let l=i==e.length?null:e[i],c=s-a,f=l?l.fromB:1e9;for(;o<t.length&&t[o]<f;){let u=t[o],h=t[o+1],d=Math.max(a,u),m=Math.min(f,h);if(d<=m&&new Xr(d+c,m+c,d,m).addToSet(n),h>f)break;o+=2}if(!l)return n;new Xr(l.fromA,l.toA,l.fromB,l.toB).addToSet(n),s=l.toA,a=l.toB}}},bs=class{constructor(e,t,n){this.view=e,this.state=t,this.transactions=n,this.flags=0,this.startState=e.state,this.changes=Ge.empty(this.startState.doc.length);for(let s of n)this.changes=this.changes.compose(s.changes);let i=[];this.changes.iterChangedRanges((s,a,l,c)=>i.push(new Xr(s,a,l,c))),this.changedRanges=i;let o=e.hasFocus;o!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=o,this.flags|=1)}static create(e,t,n){return new bs(e,t,n)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}},$e=function(r){return r[r.LTR=0]="LTR",r[r.RTL=1]="RTL",r}($e||($e={})),Qd=$e.LTR,UA=$e.RTL;function Vb(r){let e=[];for(let t=0;t<r.length;t++)e.push(1<<+r[t]);return e}var HA=Vb("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),WA=Vb("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),ep=Object.create(null),mn=[];for(let r of["()","[]","{}"]){let e=r.charCodeAt(0),t=r.charCodeAt(1);ep[e]=t,ep[t]=-e}function qA(r){return r<=247?HA[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?WA[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||r==8204?256:1}var KA=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,ui=class{constructor(e,t,n){this.from=e,this.to=t,this.level=n}get dir(){return this.level%2?UA:Qd}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,n,i){let o=-1;for(let s=0;s<e.length;s++){let a=e[s];if(a.from<=t&&a.to>=t){if(a.level==n)return s;(o<0||(i!=0?i<0?a.from<t:a.to>t:e[o].level>a.level))&&(o=s)}}if(o<0)throw new RangeError("Index out of range");return o}},qe=[];function GA(r,e){let t=r.length,n=e==Qd?1:2,i=e==Qd?2:1;if(!r||n==1&&!KA.test(r))return Ub(t);for(let s=0,a=n,l=n;s<t;s++){let c=qA(r.charCodeAt(s));c==512?c=a:c==8&&l==4&&(c=16),qe[s]=c==4?2:c,c&7&&(l=c),a=c}for(let s=0,a=n,l=n;s<t;s++){let c=qe[s];if(c==128)s<t-1&&a==qe[s+1]&&a&24?c=qe[s]=a:qe[s]=256;else if(c==64){let f=s+1;for(;f<t&&qe[f]==64;)f++;let u=s&&a==8||f<t&&qe[f]==8?l==1?1:8:256;for(let h=s;h<f;h++)qe[h]=u;s=f-1}else c==8&&l==1&&(qe[s]=1);a=c,c&7&&(l=c)}for(let s=0,a=0,l=0,c,f,u;s<t;s++)if(f=ep[c=r.charCodeAt(s)])if(f<0){for(let h=a-3;h>=0;h-=3)if(mn[h+1]==-f){let d=mn[h+2],m=d&2?n:d&4?d&1?i:n:0;m&&(qe[s]=qe[mn[h]]=m),a=h;break}}else{if(mn.length==189)break;mn[a++]=s,mn[a++]=c,mn[a++]=l}else if((u=qe[s])==2||u==1){let h=u==n;l=h?0:1;for(let d=a-3;d>=0;d-=3){let m=mn[d+2];if(m&2)break;if(h)mn[d+2]|=2;else{if(m&4)break;mn[d+2]|=4}}}for(let s=0;s<t;s++)if(qe[s]==256){let a=s+1;for(;a<t&&qe[a]==256;)a++;let l=(s?qe[s-1]:n)==1,c=(a<t?qe[a]:n)==1,f=l==c?l?1:2:n;for(let u=s;u<a;u++)qe[u]=f;s=a-1}let o=[];if(n==1)for(let s=0;s<t;){let a=s,l=qe[s++]!=1;for(;s<t&&l==(qe[s]!=1);)s++;if(l)for(let c=s;c>a;){let f=c,u=qe[--c]!=2;for(;c>a&&u==(qe[c-1]!=2);)c--;o.push(new ui(c,f,u?2:1))}else o.push(new ui(a,s,0))}else for(let s=0;s<t;){let a=s,l=qe[s++]==2;for(;s<t&&l==(qe[s]==2);)s++;o.push(new ui(a,s,l?1:2))}return o}function Ub(r){return[new ui(0,r,0)]}var Hb="";function ZA(r,e,t,n,i){var o;let s=n.head-r.from,a=-1;if(s==0){if(!i||!r.length)return null;e[0].level!=t&&(s=e[0].side(!1,t),a=0)}else if(s==r.length){if(i)return null;let h=e[e.length-1];h.level!=t&&(s=h.side(!0,t),a=e.length-1)}a<0&&(a=ui.find(e,s,(o=n.bidiLevel)!==null&&o!==void 0?o:-1,n.assoc));let l=e[a];s==l.side(i,t)&&(l=e[a+=i?1:-1],s=l.side(!i,t));let c=i==(l.dir==t),f=qt(r.text,s,c);if(Hb=r.text.slice(Math.min(s,f),Math.max(s,f)),f!=l.side(i,t))return N.cursor(f+r.from,c?-1:1,l.level);let u=a==(i?e.length-1:0)?null:e[a+(i?1:-1)];return!u&&l.level!=t?N.cursor(i?r.to:r.from,i?-1:1,t):u&&u.level<l.level?N.cursor(u.side(!i,t)+r.from,i?1:-1,u.level):N.cursor(f+r.from,i?-1:1,l.level)}var fi="\uFFFF",gf=class{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(de.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=fi}readRange(e,t){if(!e)return this;let n=e.parentNode;for(let i=e;;){this.findPointBefore(n,i),this.readNode(i);let o=i.nextSibling;if(o==t)break;let s=Ve.get(i),a=Ve.get(o);(s&&a?s.breakAfter:(s?s.breakAfter:V0(i))||V0(o)&&(i.nodeName!="BR"||i.cmIgnore))&&this.lineBreak(),i=o}return this.findPointBefore(n,t),this}readTextNode(e){let t=e.nodeValue;for(let n of this.points)n.node==e&&(n.pos=this.text.length+Math.min(n.offset,t.length));for(let n=0,i=this.lineSeparator?null:/\r\n?|\n/g;;){let o=-1,s=1,a;if(this.lineSeparator?(o=t.indexOf(this.lineSeparator,n),s=this.lineSeparator.length):(a=i.exec(t))&&(o=a.index,s=a[0].length),this.append(t.slice(n,o<0?t.length:o)),o<0)break;if(this.lineBreak(),s>1)for(let l of this.points)l.node==e&&l.pos>this.text.length&&(l.pos-=s-1);n=o+s}}readNode(e){if(e.cmIgnore)return;let t=Ve.get(e),n=t&&t.overrideDOMText;if(n!=null){this.findPointInside(e,n.length);for(let i=n.iter();!i.next().done;)i.lineBreak?this.lineBreak():this.append(i.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let n of this.points)n.node==e&&e.childNodes[n.offset]==t&&(n.pos=this.text.length)}findPointInside(e,t){for(let n of this.points)(e.nodeType==3?n.node==e:e.contains(n.node))&&(n.pos=this.text.length+Math.min(t,n.offset))}};function V0(r){return r.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(r.nodeName)}var yf=class{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}},bf=class extends Ve{constructor(e){super(),this.view=e,this.compositionDeco=Y.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new St],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Xr(0,0,0,e.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every(({fromA:s,toA:a})=>a<this.minWidthFrom||s>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Y.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=YA(this.view,e.changes)),(ne.ie||ne.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let n=this.decorations,i=this.updateDeco(),o=QA(n,i,e.changes);return t=Xr.extendWithRanges(t,o),this.dirty==0&&t.length==0?!1:(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:n}=this.view;n.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let o=ne.chrome||ne.ios?{node:n.selectionRange.focusNode,written:!1}:void 0;this.sync(o),this.dirty=0,o&&(o.written||n.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""});let i=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof Un&&o.widget instanceof _f&&i.push(o.dom);n.updateGaps(i)}updateChildren(e,t){let n=this.childCursor(t);for(let i=e.length-1;;i--){let o=i>=0?e[i]:null;if(!o)break;let{fromA:s,toA:a,fromB:l,toB:c}=o,{content:f,breakAtStart:u,openStart:h,openEnd:d}=Ya.build(this.view.state.doc,l,c,this.decorations,this.dynamicDecorationMap),{i:m,off:y}=n.findPos(a,1),{i:g,off:v}=n.findPos(s,-1);xb(this,g,v,m,y,f,u,h,d)}}updateSelection(e=!1,t=!1){if(e&&this.view.observer.readSelectionRange(),!(t||this.mayControlSelection())||ne.ios&&this.view.inputState.rapidCompositionStart)return;let n=this.forceSelection;this.forceSelection=!1;let i=this.view.state.selection.main,o=this.domAtPos(i.anchor),s=i.empty?o:this.domAtPos(i.head);if(ne.gecko&&i.empty&&JA(o)){let l=document.createTextNode("");this.view.observer.ignore(()=>o.node.insertBefore(l,o.node.childNodes[o.offset]||null)),o=s=new ft(l,0),n=!0}let a=this.view.observer.selectionRange;(n||!a.focusNode||!uf(o.node,o.offset,a.anchorNode,a.anchorOffset)||!uf(s.node,s.offset,a.focusNode,a.focusOffset))&&(this.view.observer.ignore(()=>{ne.android&&ne.chrome&&this.dom.contains(a.focusNode)&&e2(a.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let l=ff(this.root);if(i.empty){if(ne.gecko){let c=XA(o.node,o.offset);if(c&&c!=3){let f=qb(o.node,o.offset,c==1?1:-1);f&&(o=new ft(f,c==1?0:f.nodeValue.length))}}l.collapse(o.node,o.offset),i.bidiLevel!=null&&a.cursorBidiLevel!=null&&(a.cursorBidiLevel=i.bidiLevel)}else if(l.extend)l.collapse(o.node,o.offset),l.extend(s.node,s.offset);else{let c=document.createRange();i.anchor>i.head&&([o,s]=[s,o]),c.setEnd(s.node,s.offset),c.setStart(o.node,o.offset),l.removeAllRanges(),l.addRange(c)}}),this.view.observer.setSelectionRange(o,s)),this.impreciseAnchor=o.precise?null:new ft(a.anchorNode,a.anchorOffset),this.impreciseHead=s.precise?null:new ft(a.focusNode,a.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let e=this.view.state.selection.main,t=ff(this.root);if(!e.empty||!e.assoc||!t.modify)return;let n=St.find(this,e.head);if(!n)return;let i=n.posAtStart;if(e.head==i||e.head==i+n.length)return;let o=this.coordsAt(e.head,-1),s=this.coordsAt(e.head,1);if(!o||!s||o.bottom>s.top)return;let a=this.domAtPos(e.head+e.assoc);t.collapse(a.node,a.offset),t.modify("move",e.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(tl)?this.root.activeElement==this.dom:Fd(this.dom,this.view.observer.selectionRange)}nearest(e){for(let t=e;t;){let n=Ve.get(t);if(n&&n.rootView==this)return n;t=t.parentNode}return null}posFromDOM(e,t){let n=this.nearest(e);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(e,t)+n.posAtStart}domAtPos(e){let{i:t,off:n}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let i=this.children[t];if(n<i.length||i instanceof St)break;t++,n=0}return this.children[t].domAtPos(n)}coordsAt(e,t){for(let n=this.length,i=this.children.length-1;;i--){let o=this.children[i],s=n-o.breakAfter-o.length;if(e>s||e==s&&o.type!=Ne.WidgetBefore&&o.type!=Ne.WidgetAfter&&(!i||t==2||this.children[i-1].breakAfter||this.children[i-1].type==Ne.WidgetBefore&&t>-2))return o.coordsAt(e-s,t);n=s}}measureVisibleLineHeights(e){let t=[],{from:n,to:i}=e,o=this.view.contentDOM.clientWidth,s=o>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,l=this.view.textDirection==$e.LTR;for(let c=0,f=0;f<this.children.length;f++){let u=this.children[f],h=c+u.length;if(h>i)break;if(c>=n){let d=u.dom.getBoundingClientRect();if(t.push(d.height),s){let m=u.dom.lastChild,y=m?Za(m):[];if(y.length){let g=y[y.length-1],v=l?g.right-d.left:d.right-g.left;v>a&&(a=v,this.minWidth=o,this.minWidthFrom=c,this.minWidthTo=h)}}}c=h+u.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?$e.RTL:$e.LTR}measureTextSize(){for(let i of this.children)if(i instanceof St){let o=i.measureTextSize();if(o)return o}let e=document.createElement("div"),t,n;return e.className="cm-line",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let i=Za(e.firstChild)[0];t=e.getBoundingClientRect().height,n=i?i.width/27:7,e.remove()}),{lineHeight:t,charWidth:n}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new df(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let n=0,i=0;;i++){let o=i==t.viewports.length?null:t.viewports[i],s=o?o.from-1:this.length;if(s>n){let a=t.lineBlockAt(s).bottom-t.lineBlockAt(n).top;e.push(Y.replace({widget:new _f(a),block:!0,inclusive:!0,isBlockGap:!0}).range(n,s))}if(!o)break;n=o.to+1}return Y.set(e)}updateDeco(){let e=this.view.state.facet(Xa).map((t,n)=>(this.dynamicDecorationMap[n]=typeof t=="function")?t(this.view):t);for(let t=e.length;t<e.length+3;t++)this.dynamicDecorationMap[t]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:t}=e,n=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),i;if(!n)return;!t.empty&&(i=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(n={left:Math.min(n.left,i.left),top:Math.min(n.top,i.top),right:Math.max(n.right,i.right),bottom:Math.max(n.bottom,i.bottom)});let o=0,s=0,a=0,l=0;for(let f of this.view.state.facet(Fb).map(u=>u(this.view)))if(f){let{left:u,right:h,top:d,bottom:m}=f;u!=null&&(o=Math.max(o,u)),h!=null&&(s=Math.max(s,h)),d!=null&&(a=Math.max(a,d)),m!=null&&(l=Math.max(l,m))}let c={left:n.left-o,top:n.top-a,right:n.right+s,bottom:n.bottom+l};BA(this.view.scrollDOM,c,t.head<t.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==$e.LTR)}};function JA(r){return r.node.nodeType==1&&r.node.firstChild&&(r.offset==0||r.node.childNodes[r.offset-1].contentEditable=="false")&&(r.offset==r.node.childNodes.length||r.node.childNodes[r.offset].contentEditable=="false")}var _f=class extends ur{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}};function Wb(r){let e=r.observer.selectionRange,t=e.focusNode&&qb(e.focusNode,e.focusOffset,0);if(!t)return null;let n=r.docView.nearest(t);if(!n)return null;if(n instanceof St){let i=t;for(;i.parentNode!=n.dom;)i=i.parentNode;let o=i.previousSibling;for(;o&&!Ve.get(o);)o=o.previousSibling;let s=o?Ve.get(o).posAtEnd:n.posAtStart;return{from:s,to:s,node:i,text:t}}else{for(;;){let{parent:o}=n;if(!o)return null;if(o instanceof St)break;n=o}let i=n.posAtStart;return{from:i,to:i+n.length,node:n.dom,text:t}}}function YA(r,e){let t=Wb(r);if(!t)return Y.none;let{from:n,to:i,node:o,text:s}=t,a=e.mapPos(n,1),l=Math.max(a,e.mapPos(i,-1)),{state:c}=r,f=o.nodeType==3?o.nodeValue:new gf([],c).readRange(o.firstChild,null).text;if(l-a<f.length)if(c.doc.sliceString(a,Math.min(c.doc.length,a+f.length),fi)==f)l=a+f.length;else if(c.doc.sliceString(Math.max(0,l-f.length),l,fi)==f)a=l-f.length;else return Y.none;else if(c.doc.sliceString(a,l,fi)!=f)return Y.none;let u=Ve.get(o);return u instanceof pf?u=u.widget.topView:u&&(u.parent=null),Y.set(Y.replace({widget:new tp(o,s,u),inclusive:!0}).range(a,l))}var tp=class extends ur{constructor(e,t,n){super(),this.top=e,this.text=t,this.topView=n}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return pf}};function qb(r,e,t){for(;;){if(r.nodeType==3)return r;if(r.nodeType==1&&e>0&&t<=0)r=r.childNodes[e-1],e=hf(r);else if(r.nodeType==1&&e<r.childNodes.length&&t>=0)r=r.childNodes[e],e=0;else return null}}function XA(r,e){return r.nodeType!=1?0:(e&&r.childNodes[e-1].contentEditable=="false"?1:0)|(e<r.childNodes.length&&r.childNodes[e].contentEditable=="false"?2:0)}var rp=class{constructor(){this.changes=[]}compareRange(e,t){Yd(e,t,this.changes)}comparePoint(e,t){Yd(e,t,this.changes)}};function QA(r,e,t){let n=new rp;return ke.compare(r,e,t,n),n.changes}function e2(r,e){for(let t=r;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function t2(r,e,t=1){let n=r.charCategorizer(e),i=r.doc.lineAt(e),o=e-i.from;if(i.length==0)return N.cursor(e);o==0?t=1:o==i.length&&(t=-1);let s=o,a=o;t<0?s=qt(i.text,o,!1):a=qt(i.text,o);let l=n(i.text.slice(s,a));for(;s>0;){let c=qt(i.text,s,!1);if(n(i.text.slice(c,s))!=l)break;s=c}for(;a<i.length;){let c=qt(i.text,a);if(n(i.text.slice(a,c))!=l)break;a=c}return N.range(s+i.from,a+i.from)}function r2(r,e){return e.left>r?e.left-r:Math.max(0,r-e.right)}function n2(r,e){return e.top>r?e.top-r:Math.max(0,r-e.bottom)}function Nd(r,e){return r.top<e.bottom-1&&r.bottom>e.top+1}function U0(r,e){return e<r.top?{top:e,left:r.left,right:r.right,bottom:r.bottom}:r}function H0(r,e){return e>r.bottom?{top:r.top,left:r.left,right:r.right,bottom:e}:r}function np(r,e,t){let n,i,o,s,a,l,c,f;for(let d=r.firstChild;d;d=d.nextSibling){let m=Za(d);for(let y=0;y<m.length;y++){let g=m[y];i&&Nd(i,g)&&(g=U0(H0(g,i.bottom),i.top));let v=r2(e,g),T=n2(t,g);if(v==0&&T==0)return d.nodeType==3?W0(d,e,t):np(d,e,t);(!n||s>T||s==T&&o>v)&&(n=d,i=g,o=v,s=T),v==0?t>g.bottom&&(!c||c.bottom<g.bottom)?(a=d,c=g):t<g.top&&(!f||f.top>g.top)&&(l=d,f=g):c&&Nd(c,g)?c=H0(c,g.bottom):f&&Nd(f,g)&&(f=U0(f,g.top))}}if(c&&c.bottom>=t?(n=a,i=c):f&&f.top<=t&&(n=l,i=f),!n)return{node:r,offset:0};let u=Math.max(i.left,Math.min(i.right,e));if(n.nodeType==3)return W0(n,u,t);if(!o&&n.contentEditable=="true")return np(n,u,t);let h=Array.prototype.indexOf.call(r.childNodes,n)+(e>=(i.left+i.right)/2?1:0);return{node:r,offset:h}}function W0(r,e,t){let n=r.nodeValue.length,i=-1,o=1e9,s=0;for(let a=0;a<n;a++){let l=Ja(r,a,a+1).getClientRects();for(let c=0;c<l.length;c++){let f=l[c];if(f.top==f.bottom)continue;s||(s=e-f.left);let u=(f.top>t?f.top-t:t-f.bottom)-1;if(f.left-1<=e&&f.right+1>=e&&u<o){let h=e>=(f.left+f.right)/2,d=h;if((ne.chrome||ne.gecko)&&Ja(r,a).getBoundingClientRect().left==f.right&&(d=!h),u<=0)return{node:r,offset:a+(d?1:0)};i=a+(d?1:0),o=u}}}return{node:r,offset:i>-1?i:s>0?r.nodeValue.length:0}}function Kb(r,{x:e,y:t},n,i=-1){var o;let s=r.contentDOM.getBoundingClientRect(),a=s.top+r.viewState.paddingTop,l,{docHeight:c}=r.viewState,f=t-a;if(f<0)return 0;if(f>c)return r.state.doc.length;for(let v=r.defaultLineHeight/2,T=!1;l=r.elementAtHeight(f),l.type!=Ne.Text;)for(;f=i>0?l.bottom+v:l.top-v,!(f>=0&&f<=c);){if(T)return n?null:0;T=!0,i=-i}t=a+f;let u=l.from;if(u<r.viewport.from)return r.viewport.from==0?0:n?null:q0(r,s,l,e,t);if(u>r.viewport.to)return r.viewport.to==r.state.doc.length?r.state.doc.length:n?null:q0(r,s,l,e,t);let h=r.dom.ownerDocument,d=r.root.elementFromPoint?r.root:h,m=d.elementFromPoint(e,t);m&&!r.contentDOM.contains(m)&&(m=null),m||(e=Math.max(s.left+1,Math.min(s.right-1,e)),m=d.elementFromPoint(e,t),m&&!r.contentDOM.contains(m)&&(m=null));let y,g=-1;if(m&&((o=r.docView.nearest(m))===null||o===void 0?void 0:o.isEditable)!=!1){if(h.caretPositionFromPoint){let v=h.caretPositionFromPoint(e,t);v&&({offsetNode:y,offset:g}=v)}else if(h.caretRangeFromPoint){let v=h.caretRangeFromPoint(e,t);v&&({startContainer:y,startOffset:g}=v,ne.safari&&i2(y,g,e)&&(y=void 0))}}if(!y||!r.docView.dom.contains(y)){let v=St.find(r.docView,u);if(!v)return f>l.top+l.height/2?l.to:l.from;({node:y,offset:g}=np(v.dom,e,t))}return r.docView.posFromDOM(y,g)}function q0(r,e,t,n,i){let o=Math.round((n-e.left)*r.defaultCharacterWidth);r.lineWrapping&&t.height>r.defaultLineHeight*1.5&&(o+=Math.floor((i-t.top)/r.defaultLineHeight)*r.viewState.heightOracle.lineLength);let s=r.state.sliceDoc(t.from,t.to);return t.from+Qc(s,o,r.state.tabSize)}function i2(r,e,t){let n;if(r.nodeType!=3||e!=(n=r.nodeValue.length))return!1;for(let i=r.nextSibling;i;i=i.nextSibling)if(i.nodeType!=1||i.nodeName!="BR")return!1;return Ja(r,n-1,n).getBoundingClientRect().left>t}function o2(r,e,t,n){let i=r.state.doc.lineAt(e.head),o=!n||!r.lineWrapping?null:r.coordsAtPos(e.assoc<0&&e.head>i.from?e.head-1:e.head);if(o){let l=r.dom.getBoundingClientRect(),c=r.textDirectionAt(i.from),f=r.posAtCoords({x:t==(c==$e.LTR)?l.right-1:l.left+1,y:(o.top+o.bottom)/2});if(f!=null)return N.cursor(f,t?-1:1)}let s=St.find(r.docView,e.head),a=s?t?s.posAtEnd:s.posAtStart:t?i.to:i.from;return N.cursor(a,t?-1:1)}function K0(r,e,t,n){let i=r.state.doc.lineAt(e.head),o=r.bidiSpans(i),s=r.textDirectionAt(i.from);for(let a=e,l=null;;){let c=ZA(i,o,s,a,t),f=Hb;if(!c){if(i.number==(t?r.state.doc.lines:1))return a;f=`
`,i=r.state.doc.line(i.number+(t?1:-1)),o=r.bidiSpans(i),c=N.cursor(t?i.from:i.to)}if(l){if(!l(f))return a}else{if(!n)return c;l=n(f)}a=c}}function s2(r,e,t){let n=r.state.charCategorizer(e),i=n(t);return o=>{let s=n(o);return i==at.Space&&(i=s),i==s}}function a2(r,e,t,n){let i=e.head,o=t?1:-1;if(i==(t?r.state.doc.length:0))return N.cursor(i,e.assoc);let s=e.goalColumn,a,l=r.contentDOM.getBoundingClientRect(),c=r.coordsAtPos(i),f=r.documentTop;if(c)s==null&&(s=c.left-l.left),a=o<0?c.top:c.bottom;else{let d=r.viewState.lineBlockAt(i);s==null&&(s=Math.min(l.right-l.left,r.defaultCharacterWidth*(i-d.from))),a=(o<0?d.top:d.bottom)+f}let u=l.left+s,h=n??r.defaultLineHeight>>1;for(let d=0;;d+=10){let m=a+(h+d)*o,y=Kb(r,{x:u,y:m},!1,o);if(m<l.top||m>l.bottom||(o<0?y<i:y>i))return N.cursor(y,e.assoc,void 0,s)}}function Pd(r,e,t){let n=r.state.facet($b).map(i=>i(r));for(;;){let i=!1;for(let o of n)o.between(t.from-1,t.from+1,(s,a,l)=>{t.from>s&&t.from<a&&(t=e.from>t.from?N.cursor(s,1):N.cursor(a,-1),i=!0)});if(!i)return t}}var ip=class{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let t in mt){let n=mt[t];e.contentDOM.addEventListener(t,i=>{!G0(e,i)||this.ignoreDuringComposition(i)||t=="keydown"&&this.keydown(e,i)||(this.mustFlushObserver(i)&&e.observer.forceFlush(),this.runCustomHandlers(t,e,i)?i.preventDefault():n(e,i))}),this.registeredEvents.push(t)}this.notifiedFocused=e.hasFocus,ne.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,t){var n;let i;this.customHandlers=[];for(let o of t)if(i=(n=o.update(e).spec)===null||n===void 0?void 0:n.domEventHandlers){this.customHandlers.push({plugin:o.value,handlers:i});for(let s in i)this.registeredEvents.indexOf(s)<0&&s!="scroll"&&(this.registeredEvents.push(s),e.contentDOM.addEventListener(s,a=>{!G0(e,a)||this.runCustomHandlers(s,e,a)&&a.preventDefault()}))}}runCustomHandlers(e,t,n){for(let i of this.customHandlers){let o=i.handlers[e];if(o)try{if(o.call(i.plugin,n,t)||n.defaultPrevented)return!0}catch(s){Pt(t.state,s)}}return!1}runScrollHandlers(e,t){for(let n of this.customHandlers){let i=n.handlers.scroll;if(i)try{i.call(n.plugin,t,e)}catch(o){Pt(e.state,o)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(ne.android&&ne.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let n;return ne.ios&&(n=Gb.find(i=>i.keyCode==t.keyCode))&&!(t.ctrlKey||t.altKey||t.metaKey)&&!t.synthetic?(this.pendingIOSKey=n,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let t=this.pendingIOSKey;return t?(this.pendingIOSKey=void 0,Ha(e.contentDOM,t.key,t.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:ne.safari&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229||e.type=="compositionend"&&!ne.ios}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}},Gb=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Zb=[16,17,18,20,91,92,224,225],op=class{constructor(e,t,n,i){this.view=e,this.style=n,this.mustSelect=i,this.lastEvent=t;let o=e.contentDOM.ownerDocument;o.addEventListener("mousemove",this.move=this.move.bind(this)),o.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(de.allowMultipleSelections)&&l2(e,t),this.dragMove=c2(e,t),this.dragging=f2(e,t)&&Tp(t)==1?null:!1,this.dragging===!1&&(t.preventDefault(),this.select(t))}move(e){if(e.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=e)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let t=this.style.get(e,this.extend,this.multiple);(this.mustSelect||!t.eq(this.view.state.selection)||t.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:t,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}};function l2(r,e){let t=r.state.facet(Db);return t.length?t[0](e):ne.mac?e.metaKey:e.ctrlKey}function c2(r,e){let t=r.state.facet(Nb);return t.length?t[0](e):ne.mac?!e.altKey:!e.ctrlKey}function f2(r,e){let{main:t}=r.state.selection;if(t.empty)return!1;let n=ff(r.root);if(n.rangeCount==0)return!0;let i=n.getRangeAt(0).getClientRects();for(let o=0;o<i.length;o++){let s=i[o];if(s.left<=e.clientX&&s.right>=e.clientX&&s.top<=e.clientY&&s.bottom>=e.clientY)return!0}return!1}function G0(r,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,n;t!=r.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(n=Ve.get(t))&&n.ignoreEvent(e))return!1;return!0}var mt=Object.create(null),Jb=ne.ie&&ne.ie_version<15||ne.ios&&ne.webkit_version<604;function u2(r){let e=r.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{r.focus(),t.remove(),Yb(r,t.value)},50)}function Yb(r,e){let{state:t}=r,n,i=1,o=t.toText(e),s=o.lines==t.selection.ranges.length;if(sp!=null&&t.selection.ranges.every(l=>l.empty)&&sp==o.toString()){let l=-1;n=t.changeByRange(c=>{let f=t.doc.lineAt(c.from);if(f.from==l)return{range:c};l=f.from;let u=t.toText((s?o.line(i++).text:e)+t.lineBreak);return{changes:{from:f.from,insert:u},range:N.cursor(c.from+u.length)}})}else s?n=t.changeByRange(l=>{let c=o.line(i++);return{changes:{from:l.from,to:l.to,insert:c.text},range:N.cursor(l.from+c.length)}}):n=t.replaceSelection(o);r.dispatch(n,{userEvent:"input.paste",scrollIntoView:!0})}mt.keydown=(r,e)=>{r.inputState.setSelectionOrigin("select"),e.keyCode==27?r.inputState.lastEscPress=Date.now():Zb.indexOf(e.keyCode)<0&&(r.inputState.lastEscPress=0)};var Xb=0;mt.touchstart=(r,e)=>{Xb=Date.now(),r.inputState.setSelectionOrigin("select.pointer")};mt.touchmove=r=>{r.inputState.setSelectionOrigin("select.pointer")};mt.mousedown=(r,e)=>{if(r.observer.flush(),Xb>Date.now()-2e3&&Tp(e)==1)return;let t=null;for(let n of r.state.facet(Pb))if(t=n(r,e),t)break;if(!t&&e.button==0&&(t=p2(r,e)),t){let n=r.root.activeElement!=r.contentDOM;n&&r.observer.ignore(()=>kb(r.contentDOM)),r.inputState.startMouseSelection(new op(r,e,t,n))}};function Z0(r,e,t,n){if(n==1)return N.cursor(e,t);if(n==2)return t2(r.state,e,t);{let i=St.find(r.docView,e),o=r.state.doc.lineAt(i?i.posAtEnd:e),s=i?i.posAtStart:o.from,a=i?i.posAtEnd:o.to;return a<r.state.doc.length&&a==o.to&&a++,N.range(s,a)}}var Qb=(r,e)=>r>=e.top&&r<=e.bottom,J0=(r,e,t)=>Qb(e,t)&&r>=t.left&&r<=t.right;function h2(r,e,t,n){let i=St.find(r.docView,e);if(!i)return 1;let o=e-i.posAtStart;if(o==0)return 1;if(o==i.length)return-1;let s=i.coordsAt(o,-1);if(s&&J0(t,n,s))return-1;let a=i.coordsAt(o,1);return a&&J0(t,n,a)?1:s&&Qb(n,s)?-1:1}function Y0(r,e){let t=r.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:h2(r,t,e.clientX,e.clientY)}}var d2=ne.ie&&ne.ie_version<=11,X0=null,Q0=0,eb=0;function Tp(r){if(!d2)return r.detail;let e=X0,t=eb;return X0=r,eb=Date.now(),Q0=!e||t>Date.now()-400&&Math.abs(e.clientX-r.clientX)<2&&Math.abs(e.clientY-r.clientY)<2?(Q0+1)%3:1}function p2(r,e){let t=Y0(r,e),n=Tp(e),i=r.state.selection,o=t,s=e;return{update(a){a.docChanged&&(t&&(t.pos=a.changes.mapPos(t.pos)),i=i.map(a.changes),s=null)},get(a,l,c){let f;if(s&&a.clientX==s.clientX&&a.clientY==s.clientY?f=o:(f=o=Y0(r,a),s=a),!f||!t)return i;let u=Z0(r,f.pos,f.bias,n);if(t.pos!=f.pos&&!l){let h=Z0(r,t.pos,t.bias,n),d=Math.min(h.from,u.from),m=Math.max(h.to,u.to);u=d<u.from?N.range(d,m):N.range(m,d)}return l?i.replaceRange(i.main.extend(u.from,u.to)):c?i.addRange(u):N.create([u])}}}mt.dragstart=(r,e)=>{let{selection:{main:t}}=r.state,{mouseSelection:n}=r.inputState;n&&(n.dragging=t),e.dataTransfer&&(e.dataTransfer.setData("Text",r.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove")};function tb(r,e,t,n){if(!t)return;let i=r.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:o}=r.inputState,s=n&&o&&o.dragging&&o.dragMove?{from:o.dragging.from,to:o.dragging.to}:null,a={from:i,insert:t},l=r.state.changes(s?[s,a]:a);r.focus(),r.dispatch({changes:l,selection:{anchor:l.mapPos(i,-1),head:l.mapPos(i,1)},userEvent:s?"move.drop":"input.drop"})}mt.drop=(r,e)=>{if(!e.dataTransfer)return;if(r.state.readOnly)return e.preventDefault();let t=e.dataTransfer.files;if(t&&t.length){e.preventDefault();let n=Array(t.length),i=0,o=()=>{++i==t.length&&tb(r,e,n.filter(s=>s!=null).join(r.state.lineBreak),!1)};for(let s=0;s<t.length;s++){let a=new FileReader;a.onerror=o,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(n[s]=a.result),o()},a.readAsText(t[s])}}else tb(r,e,e.dataTransfer.getData("Text"),!0)};mt.paste=(r,e)=>{if(r.state.readOnly)return e.preventDefault();r.observer.flush();let t=Jb?null:e.clipboardData;t?(Yb(r,t.getData("text/plain")),e.preventDefault()):u2(r)};function m2(r,e){let t=r.dom.parentNode;if(!t)return;let n=t.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout(()=>{n.remove(),r.focus()},50)}function g2(r){let e=[],t=[],n=!1;for(let i of r.selection.ranges)i.empty||(e.push(r.sliceDoc(i.from,i.to)),t.push(i));if(!e.length){let i=-1;for(let{from:o}of r.selection.ranges){let s=r.doc.lineAt(o);s.number>i&&(e.push(s.text),t.push({from:s.from,to:Math.min(r.doc.length,s.to+1)})),i=s.number}n=!0}return{text:e.join(r.lineBreak),ranges:t,linewise:n}}var sp=null;mt.copy=mt.cut=(r,e)=>{let{text:t,ranges:n,linewise:i}=g2(r.state);if(!t&&!i)return;sp=i?t:null;let o=Jb?null:e.clipboardData;o?(e.preventDefault(),o.clearData(),o.setData("text/plain",t)):m2(r,t),e.type=="cut"&&!r.state.readOnly&&r.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})};function e_(r){setTimeout(()=>{r.hasFocus!=r.inputState.notifiedFocused&&r.update([])},10)}mt.focus=e_;mt.blur=r=>{r.observer.clearSelectionRange(),e_(r)};function t_(r,e){if(r.docView.compositionDeco.size){r.inputState.rapidCompositionStart=e;try{r.update([])}finally{r.inputState.rapidCompositionStart=!1}}}mt.compositionstart=mt.compositionupdate=r=>{r.inputState.compositionFirstChange==null&&(r.inputState.compositionFirstChange=!0),r.inputState.composing<0&&(r.inputState.composing=0,r.docView.compositionDeco.size&&(r.observer.flush(),t_(r,!0)))};mt.compositionend=r=>{r.inputState.composing=-1,r.inputState.compositionEndedAt=Date.now(),r.inputState.compositionFirstChange=null,setTimeout(()=>{r.inputState.composing<0&&t_(r,!1)},50)};mt.contextmenu=r=>{r.inputState.lastContextMenu=Date.now()};mt.beforeinput=(r,e)=>{var t;let n;if(ne.chrome&&ne.android&&(n=Gb.find(i=>i.inputType==e.inputType))&&(r.observer.delayAndroidKey(n.key,n.keyCode),n.key=="Backspace"||n.key=="Delete")){let i=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>i+10&&r.hasFocus&&(r.contentDOM.blur(),r.focus())},100)}};var rb=["pre-wrap","normal","pre-line","break-spaces"],ap=class{constructor(){this.doc=ve.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let n=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(n+=Math.ceil((t-e-n*this.lineLength*.5)/this.lineLength)),this.lineHeight*n}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return rb.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let n=0;n<e.length;n++){let i=e[n];i<0?n++:this.heightSamples[Math.floor(i*10)]||(t=!0,this.heightSamples[Math.floor(i*10)]=!0)}return t}refresh(e,t,n,i,o){let s=rb.indexOf(e)>-1,a=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=s;if(this.lineWrapping=s,this.lineHeight=t,this.charWidth=n,this.lineLength=i,a){this.heightSamples={};for(let l=0;l<o.length;l++){let c=o[l];c<0?l++:this.heightSamples[Math.floor(c*10)]=!0}}return a}},lp=class{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}},yn=class{constructor(e,t,n,i,o){this.from=e,this.length=t,this.top=n,this.height=i,this.type=o}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let t=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new yn(this.from,this.length+e.length,this.top,this.height+e.height,t)}},je=function(r){return r[r.ByPos=0]="ByPos",r[r.ByHeight=1]="ByHeight",r[r.ByPosNoHeight=2]="ByPosNoHeight",r}(je||(je={})),af=.001,Lt=class{constructor(e,t,n=2){this.length=e,this.height=t,this.flags=n}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>af&&(e.heightChanged=!0),this.height=t)}replace(e,t,n){return Lt.of(n)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,n,i){let o=this;for(let s=i.length-1;s>=0;s--){let{fromA:a,toA:l,fromB:c,toB:f}=i[s],u=o.lineAt(a,je.ByPosNoHeight,t,0,0),h=u.to>=l?u:o.lineAt(l,je.ByPosNoHeight,t,0,0);for(f+=h.to-l,l=h.to;s>0&&u.from<=i[s-1].toA;)a=i[s-1].fromA,c=i[s-1].fromB,s--,a<u.from&&(u=o.lineAt(a,je.ByPosNoHeight,t,0,0));c+=u.from-a,a=u.from;let d=Qa.build(n,e,c,f);o=o.replace(a,l,d)}return o.updateHeight(n,0)}static empty(){return new Gt(0,0)}static of(e){if(e.length==1)return e[0];let t=0,n=e.length,i=0,o=0;for(;;)if(t==n)if(i>o*2){let a=e[t-1];a.break?e.splice(--t,1,a.left,null,a.right):e.splice(--t,1,a.left,a.right),n+=1+a.break,i-=a.size}else if(o>i*2){let a=e[n];a.break?e.splice(n,1,a.left,null,a.right):e.splice(n,1,a.left,a.right),n+=2+a.break,o-=a.size}else break;else if(i<o){let a=e[t++];a&&(i+=a.size)}else{let a=e[--n];a&&(o+=a.size)}let s=0;return e[t-1]==null?(s=1,t--):e[t]==null&&(s=1,n++),new cp(Lt.of(e.slice(0,t)),s,Lt.of(e.slice(n)))}};Lt.prototype.size=1;var vf=class extends Lt{constructor(e,t,n){super(e,t),this.type=n}blockAt(e,t,n,i){return new yn(i,this.length,n,this.height,this.type)}lineAt(e,t,n,i,o){return this.blockAt(0,n,i,o)}forEachLine(e,t,n,i,o,s){e<=o+this.length&&t>=o&&s(this.blockAt(0,n,i,o))}updateHeight(e,t=0,n=!1,i){return i&&i.from<=t&&i.more&&this.setHeight(e,i.heights[i.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}},Gt=class extends vf{constructor(e,t){super(e,t,Ne.Text),this.collapsed=0,this.widgetHeight=0}replace(e,t,n){let i=n[0];return n.length==1&&(i instanceof Gt||i instanceof ct&&i.flags&4)&&Math.abs(this.length-i.length)<10?(i instanceof ct?i=new Gt(i.length,this.height):i.height=this.height,this.outdated||(i.outdated=!1),i):Lt.of(n)}updateHeight(e,t=0,n=!1,i){return i&&i.from<=t&&i.more?this.setHeight(e,i.heights[i.index++]):(n||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}},ct=class extends Lt{constructor(e){super(e,0)}lines(e,t){let n=e.lineAt(t).number,i=e.lineAt(t+this.length).number;return{firstLine:n,lastLine:i,lineHeight:this.height/(i-n+1)}}blockAt(e,t,n,i){let{firstLine:o,lastLine:s,lineHeight:a}=this.lines(t,i),l=Math.max(0,Math.min(s-o,Math.floor((e-n)/a))),{from:c,length:f}=t.line(o+l);return new yn(c,f,n+a*l,a,Ne.Text)}lineAt(e,t,n,i,o){if(t==je.ByHeight)return this.blockAt(e,n,i,o);if(t==je.ByPosNoHeight){let{from:u,to:h}=n.lineAt(e);return new yn(u,h-u,0,0,Ne.Text)}let{firstLine:s,lineHeight:a}=this.lines(n,o),{from:l,length:c,number:f}=n.lineAt(e);return new yn(l,c,i+a*(f-s),a,Ne.Text)}forEachLine(e,t,n,i,o,s){let{firstLine:a,lineHeight:l}=this.lines(n,o);for(let c=Math.max(e,o),f=Math.min(o+this.length,t);c<=f;){let u=n.lineAt(c);c==e&&(i+=l*(u.number-a)),s(new yn(u.from,u.length,i,l,Ne.Text)),i+=l,c=u.to+1}}replace(e,t,n){let i=this.length-t;if(i>0){let o=n[n.length-1];o instanceof ct?n[n.length-1]=new ct(o.length+i):n.push(null,new ct(i-1))}if(e>0){let o=n[0];o instanceof ct?n[0]=new ct(e+o.length):n.unshift(new ct(e-1),null)}return Lt.of(n)}decomposeLeft(e,t){t.push(new ct(e-1),null)}decomposeRight(e,t){t.push(null,new ct(this.length-e-1))}updateHeight(e,t=0,n=!1,i){let o=t+this.length;if(i&&i.from<=t+this.length&&i.more){let s=[],a=Math.max(t,i.from),l=-1,c=e.heightChanged;for(i.from>t&&s.push(new ct(i.from-t-1).updateHeight(e,t));a<=o&&i.more;){let u=e.doc.lineAt(a).length;s.length&&s.push(null);let h=i.heights[i.index++];l==-1?l=h:Math.abs(h-l)>=af&&(l=-2);let d=new Gt(u,h);d.outdated=!1,s.push(d),a+=u+1}a<=o&&s.push(null,new ct(o-a).updateHeight(e,a));let f=Lt.of(s);return e.heightChanged=c||l<0||Math.abs(f.height-this.height)>=af||Math.abs(l-this.lines(e.doc,t).lineHeight)>=af,f}else(n||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}},cp=class extends Lt{constructor(e,t,n){super(e.length+t+n.length,e.height+n.height,t|(e.outdated||n.outdated?2:0)),this.left=e,this.right=n,this.size=e.size+n.size}get break(){return this.flags&1}blockAt(e,t,n,i){let o=n+this.left.height;return e<o?this.left.blockAt(e,t,n,i):this.right.blockAt(e,t,o,i+this.left.length+this.break)}lineAt(e,t,n,i,o){let s=i+this.left.height,a=o+this.left.length+this.break,l=t==je.ByHeight?e<s:e<a,c=l?this.left.lineAt(e,t,n,i,o):this.right.lineAt(e,t,n,s,a);if(this.break||(l?c.to<a:c.from>a))return c;let f=t==je.ByPosNoHeight?je.ByPosNoHeight:je.ByPos;return l?c.join(this.right.lineAt(a,f,n,s,a)):this.left.lineAt(a,f,n,i,o).join(c)}forEachLine(e,t,n,i,o,s){let a=i+this.left.height,l=o+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,t,n,i,o,s),t>=l&&this.right.forEachLine(e,t,n,a,l,s);else{let c=this.lineAt(l,je.ByPos,n,i,o);e<c.from&&this.left.forEachLine(e,c.from-1,n,i,o,s),c.to>=e&&c.from<=t&&s(c),t>c.to&&this.right.forEachLine(c.to+1,t,n,a,l,s)}}replace(e,t,n){let i=this.left.length+this.break;if(t<i)return this.balanced(this.left.replace(e,t,n),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-i,t-i,n));let o=[];e>0&&this.decomposeLeft(e,o);let s=o.length;for(let a of n)o.push(a);if(e>0&&nb(o,s-1),t<this.length){let a=o.length;this.decomposeRight(t,o),nb(o,a)}return Lt.of(o)}decomposeLeft(e,t){let n=this.left.length;if(e<=n)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(n++,e>=n&&t.push(null)),e>n&&this.right.decomposeLeft(e-n,t)}decomposeRight(e,t){let n=this.left.length,i=n+this.break;if(e>=i)return this.right.decomposeRight(e-i,t);e<n&&this.left.decomposeRight(e,t),this.break&&e<i&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Lt.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,n=!1,i){let{left:o,right:s}=this,a=t+o.length+this.break,l=null;return i&&i.from<=t+o.length&&i.more?l=o=o.updateHeight(e,t,n,i):o.updateHeight(e,t,n),i&&i.from<=a+s.length&&i.more?l=s=s.updateHeight(e,a,n,i):s.updateHeight(e,a,n),l?this.balanced(o,s):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}};function nb(r,e){let t,n;r[e]==null&&(t=r[e-1])instanceof ct&&(n=r[e+1])instanceof ct&&r.splice(e-1,3,new ct(t.length+1+n.length))}var y2=5,Qa=class{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let n=Math.min(t,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof Gt?i.length+=n-this.pos:(n>this.pos||!this.isCovered)&&this.nodes.push(new Gt(n-this.pos,-1)),this.writtenTo=n,t>n&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,n){if(e<t||n.heightRelevant){let i=n.widget?n.widget.estimatedHeight:0;i<0&&(i=this.oracle.lineHeight);let o=t-e;n.block?this.addBlock(new vf(o,i,n.type)):(o||i>=y2)&&this.addLineDeco(i,o)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Gt(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let n=new ct(t-e);return this.oracle.doc.lineAt(e).to==t&&(n.flags|=4),n}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Gt)return e;let t=new Gt(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine(),e.type==Ne.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=Ne.WidgetBefore&&(this.covering=e)}addLineDeco(e,t){let n=this.ensureLine();n.length+=t,n.collapsed+=t,n.widgetHeight=Math.max(n.widgetHeight,e),this.writtenTo=this.pos=this.pos+t}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof Gt)&&!this.isCovered?this.nodes.push(new Gt(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let n=e;for(let i of this.nodes)i instanceof Gt&&i.updateHeight(this.oracle,n),n+=i?i.length:1;return this.nodes}static build(e,t,n,i){let o=new Qa(n,e);return ke.spans(t,n,i,o,0),o.finish(n)}};function b2(r,e,t){let n=new fp;return ke.compare(r,e,t,n,0),n.changes}var fp=class{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,n,i){(e<t||n&&n.heightRelevant||i&&i.heightRelevant)&&Yd(e,t,this.changes,5)}};function _2(r,e){let t=r.getBoundingClientRect(),n=Math.max(0,t.left),i=Math.min(innerWidth,t.right),o=Math.max(0,t.top),s=Math.min(innerHeight,t.bottom),a=r.ownerDocument.body;for(let l=r.parentNode;l&&l!=a;)if(l.nodeType==1){let c=l,f=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&f.overflow!="visible"){let u=c.getBoundingClientRect();n=Math.max(n,u.left),i=Math.min(i,u.right),o=Math.max(o,u.top),s=Math.min(s,u.bottom)}l=f.position=="absolute"||f.position=="fixed"?c.offsetParent:c.parentNode}else if(l.nodeType==11)l=l.host;else break;return{left:n-t.left,right:Math.max(n,i)-t.left,top:o-(t.top+e),bottom:Math.max(o,s)-(t.top+e)}}function v2(r,e){let t=r.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}var qa=class{constructor(e,t,n){this.from=e,this.to=t,this.size=n}static same(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++){let i=e[n],o=t[n];if(i.from!=o.from||i.to!=o.to||i.size!=o.size)return!1}return!0}draw(e){return Y.replace({widget:new up(this.size,e)}).range(this.from,this.to)}},up=class extends ur{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}},kf=class{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new ap,this.scaler=sb,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=$e.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=e.facet(Xa).filter(t=>typeof t!="function"),this.heightMap=Lt.empty().applyChanges(this.stateDeco,ve.empty,this.heightOracle.setDoc(e.doc),[new Xr(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Y.set(this.lineGaps.map(t=>t.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let n=0;n<=1;n++){let i=n?t.head:t.anchor;if(!e.some(({from:o,to:s})=>i>=o&&i<=s)){let{from:o,to:s}=this.lineBlockAt(i);e.push(new hs(o,s))}}this.viewports=e.sort((n,i)=>n.from-i.from),this.scaler=this.heightMap.height<=7e6?sb:new hp(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:Fa(e,this.scaler))})}update(e,t=null){this.state=e.state;let n=this.stateDeco;this.stateDeco=this.state.facet(Xa).filter(c=>typeof c!="function");let i=e.changedRanges,o=Xr.extendWithRanges(i,b2(n,this.stateDeco,e?e.changes:Ge.empty(this.state.doc.length))),s=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=s&&(e.flags|=2);let a=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let l=!e.changes.empty||e.flags&2||a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,n=window.getComputedStyle(t),i=this.heightOracle,o=n.whiteSpace;this.defaultTextDirection=n.direction=="rtl"?$e.RTL:$e.LTR;let s=this.heightOracle.mustRefreshForWrapping(o),a=s||this.mustMeasureContent||this.contentDOMHeight!=t.clientHeight;this.contentDOMHeight=t.clientHeight,this.mustMeasureContent=!1;let l=0,c=0,f=parseInt(n.paddingTop)||0,u=parseInt(n.paddingBottom)||0;(this.paddingTop!=f||this.paddingBottom!=u)&&(this.paddingTop=f,this.paddingBottom=u,l|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(i.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,l|=8);let h=(this.printing?v2:_2)(t,this.paddingTop),d=h.top-this.pixelViewport.top,m=h.bottom-this.pixelViewport.bottom;this.pixelViewport=h;let y=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(y!=this.inView&&(this.inView=y,y&&(a=!0)),!this.inView)return 0;let g=t.clientWidth;if((this.contentDOMWidth!=g||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=g,this.editorHeight=e.scrollDOM.clientHeight,l|=8),a){let T=e.docView.measureVisibleLineHeights(this.viewport);if(i.mustRefreshForHeights(T)&&(s=!0),s||i.lineWrapping&&Math.abs(g-this.contentDOMWidth)>i.charWidth){let{lineHeight:M,charWidth:x}=e.docView.measureTextSize();s=i.refresh(o,M,x,g/x,T),s&&(e.docView.minWidth=0,l|=8)}d>0&&m>0?c=Math.max(d,m):d<0&&m<0&&(c=Math.min(d,m)),i.heightChanged=!1;for(let M of this.viewports){let x=M.from==this.viewport.from?T:e.docView.measureVisibleLineHeights(M);this.heightMap=this.heightMap.updateHeight(i,0,s,new lp(M.from,x))}i.heightChanged&&(l|=2)}let v=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return v&&(this.viewport=this.getViewport(c,this.scrollTarget)),this.updateForViewport(),(l&2||v)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(s?[]:this.lineGaps)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let n=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),i=this.heightMap,o=this.state.doc,{visibleTop:s,visibleBottom:a}=this,l=new hs(i.lineAt(s-n*1e3,je.ByHeight,o,0,0).from,i.lineAt(a+(1-n)*1e3,je.ByHeight,o,0,0).to);if(t){let{head:c}=t.range;if(c<l.from||c>l.to){let f=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=i.lineAt(c,je.ByPos,o,0,0),h;t.y=="center"?h=(u.top+u.bottom)/2-f/2:t.y=="start"||t.y=="nearest"&&c<l.from?h=u.top:h=u.bottom-f,l=new hs(i.lineAt(h-1e3/2,je.ByHeight,o,0,0).from,i.lineAt(h+f+1e3/2,je.ByHeight,o,0,0).to)}}return l}mapViewport(e,t){let n=t.mapPos(e.from,-1),i=t.mapPos(e.to,1);return new hs(this.heightMap.lineAt(n,je.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(i,je.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:t},n=0){if(!this.inView)return!0;let{top:i}=this.heightMap.lineAt(e,je.ByPos,this.state.doc,0,0),{bottom:o}=this.heightMap.lineAt(t,je.ByPos,this.state.doc,0,0),{visibleTop:s,visibleBottom:a}=this;return(e==0||i<=s-Math.max(10,Math.min(-n,250)))&&(t==this.state.doc.length||o>=a+Math.max(10,Math.min(n,250)))&&i>s-2*1e3&&o<a+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let n=[];for(let i of e)t.touchesRange(i.from,i.to)||n.push(new qa(t.mapPos(i.from),t.mapPos(i.to),i.size));return n}ensureLineGaps(e){let t=[];if(this.defaultTextDirection!=$e.LTR)return t;for(let n of this.viewportLines){if(n.length<4e3)continue;let i=k2(n.from,n.to,this.stateDeco);if(i.total<4e3)continue;let o,s;if(this.heightOracle.lineWrapping){let c=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;o=of(i,(this.visibleTop-n.top-c)/n.height),s=of(i,(this.visibleBottom-n.top+c)/n.height)}else{let c=i.total*this.heightOracle.charWidth,f=2e3*this.heightOracle.charWidth;o=of(i,(this.pixelViewport.left-f)/c),s=of(i,(this.pixelViewport.right+f)/c)}let a=[];o>n.from&&a.push({from:n.from,to:o}),s<n.to&&a.push({from:s,to:n.to});let l=this.state.selection.main;l.from>=n.from&&l.from<=n.to&&ob(a,l.from-10,l.from+10),!l.empty&&l.to>=n.from&&l.to<=n.to&&ob(a,l.to-10,l.to+10);for(let{from:c,to:f}of a)f-c>1e3&&t.push(w2(e,u=>u.from>=n.from&&u.to<=n.to&&Math.abs(u.from-c)<1e3&&Math.abs(u.to-f)<1e3)||new qa(c,f,this.gapSize(n,c,f,i)))}return t}gapSize(e,t,n,i){let o=ib(i,n)-ib(i,t);return this.heightOracle.lineWrapping?e.height*o:i.total*this.heightOracle.charWidth*o}updateLineGaps(e){qa.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Y.set(e.map(t=>t.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];ke.spans(e,this.viewport.from,this.viewport.to,{span(i,o){t.push({from:i,to:o})},point(){}},20);let n=t.length!=this.visibleRanges.length||this.visibleRanges.some((i,o)=>i.from!=t[o].from||i.to!=t[o].to);return this.visibleRanges=t,n?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Fa(this.heightMap.lineAt(e,je.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return Fa(this.heightMap.lineAt(this.scaler.fromDOM(e),je.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return Fa(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}},hs=class{constructor(e,t){this.from=e,this.to=t}};function k2(r,e,t){let n=[],i=r,o=0;return ke.spans(t,r,e,{span(){},point(s,a){s>i&&(n.push({from:i,to:s}),o+=s-i),i=a}},20),i<e&&(n.push({from:i,to:e}),o+=e-i),{total:o,ranges:n}}function of({total:r,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let n=Math.floor(r*t);for(let i=0;;i++){let{from:o,to:s}=e[i],a=s-o;if(n<=a)return o+n;n-=a}}function ib(r,e){let t=0;for(let{from:n,to:i}of r.ranges){if(e<=i){t+=e-n;break}t+=i-n}return t/r.total}function ob(r,e,t){for(let n=0;n<r.length;n++){let i=r[n];if(i.from<t&&i.to>e){let o=[];i.from<e&&o.push({from:i.from,to:e}),i.to>t&&o.push({from:t,to:i.to}),r.splice(n,1,...o),n+=o.length-1}}}function w2(r,e){for(let t of r)if(e(t))return t}var sb={toDOM(r){return r},fromDOM(r){return r},scale:1},hp=class{constructor(e,t,n){let i=0,o=0,s=0;this.viewports=n.map(({from:a,to:l})=>{let c=t.lineAt(a,je.ByPos,e,0,0).top,f=t.lineAt(l,je.ByPos,e,0,0).bottom;return i+=f-c,{from:a,to:l,top:c,bottom:f,domTop:0,domBottom:0}}),this.scale=(7e6-i)/(t.height-i);for(let a of this.viewports)a.domTop=s+(a.top-o)*this.scale,s=a.domBottom=a.domTop+(a.bottom-a.top),o=a.bottom}toDOM(e){for(let t=0,n=0,i=0;;t++){let o=t<this.viewports.length?this.viewports[t]:null;if(!o||e<o.top)return i+(e-n)*this.scale;if(e<=o.bottom)return o.domTop+(e-o.top);n=o.bottom,i=o.domBottom}}fromDOM(e){for(let t=0,n=0,i=0;;t++){let o=t<this.viewports.length?this.viewports[t]:null;if(!o||e<o.domTop)return n+(e-i)/this.scale;if(e<=o.domBottom)return o.top+(e-o.domTop);n=o.bottom,i=o.domBottom}}};function Fa(r,e){if(e.scale==1)return r;let t=e.toDOM(r.top),n=e.toDOM(r.bottom);return new yn(r.from,r.length,t,n-t,Array.isArray(r.type)?r.type.map(i=>Fa(i,e)):r.type)}var sf=Z.define({combine:r=>r.join(" ")}),dp=Z.define({combine:r=>r.indexOf(!0)>-1}),pp=Tr.newName(),r_=Tr.newName(),n_=Tr.newName(),i_={"&light":"."+r_,"&dark":"."+n_};function mp(r,e,t){return new Tr(e,{finish(n){return/&/.test(n)?n.replace(/&\w*/,i=>{if(i=="&")return r;if(!t||!t[i])throw new RangeError(`Unsupported selector: ${i}`);return t[i]}):r+" "+n}})}var x2=mp("."+pp,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},i_),S2={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Ld=ne.ie&&ne.ie_version<=11,gp=class{constructor(e,t,n){this.view=e,this.onChange=t,this.onScrollChanged=n,this.active=!1,this.selectionRange=new Ud,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(i=>{for(let o of i)this.queue.push(o);(ne.ie&&ne.ie_version<=11||ne.ios&&e.composing)&&i.some(o=>o.type=="childList"&&o.removedNodes.length||o.type=="characterData"&&o.oldValue.length>o.target.nodeValue.length)?this.flushSoon():this.flush()}),Ld&&(this.onCharData=i=>{this.queue.push({target:i.target,type:"characterData",oldValue:i.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(e.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(i=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),i.length>0&&i[i.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(i=>{i.length>0&&i[i.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,n)=>t!=e[n]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:t}=this,n=this.selectionRange;if(t.state.facet(tl)?t.root.activeElement!=this.dom:!Fd(t.dom,n))return;let i=n.anchorNode&&t.docView.nearest(n.anchorNode);i&&i.ignoreEvent(e)||((ne.ie&&ne.ie_version<=11||ne.android&&ne.chrome)&&!t.state.selection.main.empty&&n.focusNode&&uf(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:e}=this.view,t=ff(e),n=ne.safari&&e.nodeType==11&&LA()==this.view.contentDOM&&C2(this.view)||t;return this.selectionRange.eq(n)?!1:(this.selectionRange.setRange(n),this.selectionChanged=!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let n=this.dom;n;)if(n.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==n?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);for(let n of this.scrollTargets=t)n.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,S2),Ld&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!this.active||(this.active=!1,this.observer.disconnect(),Ld&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){this.delayedAndroidKey||requestAnimationFrame(()=>{let n=this.delayedAndroidKey;this.delayedAndroidKey=null;let i=this.view.state;this.readSelectionRange(),Ha(this.view.contentDOM,n.key,n.keyCode)?this.processRecords():this.flush(),this.view.state==i&&this.view.update([])}),(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let e=this.queue;for(let o of this.observer.takeRecords())e.push(o);e.length&&(this.queue=[]);let t=-1,n=-1,i=!1;for(let o of e){let s=this.readMutation(o);!s||(s.typeOver&&(i=!0),t==-1?{from:t,to:n}=s:(t=Math.min(s.from,t),n=Math.max(s.to,n)))}return{from:t,to:n,typeOver:i}}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;e&&this.readSelectionRange();let{from:t,to:n,typeOver:i}=this.processRecords(),o=this.selectionChanged&&Fd(this.dom,this.selectionRange);if(t<0&&!o)return;this.selectionChanged=!1;let s=this.view.state;this.onChange(t,n,i),this.view.state==s&&this.view.update([])}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.dirty|=4),e.type=="childList"){let n=ab(t,e.previousSibling||e.target.previousSibling,-1),i=ab(t,e.nextSibling||e.target.nextSibling,1);return{from:n?t.posAfter(n):t.posAtStart,to:i?t.posBefore(i):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}destroy(){var e,t,n;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(n=this.resize)===null||n===void 0||n.disconnect();for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}};function ab(r,e,t){for(;e;){let n=Ve.get(e);if(n&&n.parent==r)return n;let i=e.parentNode;e=i!=r.dom?i:t>0?e.nextSibling:e.previousSibling}return null}function C2(r){let e=null;function t(l){l.preventDefault(),l.stopImmediatePropagation(),e=l.getTargetRanges()[0]}if(r.contentDOM.addEventListener("beforeinput",t,!0),document.execCommand("indent"),r.contentDOM.removeEventListener("beforeinput",t,!0),!e)return null;let n=e.startContainer,i=e.startOffset,o=e.endContainer,s=e.endOffset,a=r.docView.domAtPos(r.state.selection.main.anchor);return uf(a.node,a.offset,o,s)&&([n,i,o,s]=[o,s,n,i]),{anchorNode:n,anchorOffset:i,focusNode:o,focusOffset:s}}function A2(r,e,t,n){let i,o,s=r.state.selection.main;if(e>-1){let a=r.docView.domBoundsAround(e,t,0);if(!a||r.state.readOnly)return;let{from:l,to:c}=a,f=r.docView.impreciseHead||r.docView.impreciseAnchor?[]:O2(r),u=new gf(f,r.state);u.readRange(a.startDOM,a.endDOM);let h=s.from,d=null;(r.inputState.lastKeyCode===8&&r.inputState.lastKeyTime>Date.now()-100||ne.android&&u.text.length<c-l)&&(h=s.to,d="end");let m=T2(r.state.doc.sliceString(l,c,fi),u.text,h-l,d);m&&(ne.chrome&&r.inputState.lastKeyCode==13&&m.toB==m.from+2&&u.text.slice(m.from,m.toB)==fi+fi&&m.toB--,i={from:l+m.from,to:l+m.toA,insert:ve.of(u.text.slice(m.from,m.toB).split(fi))}),o=E2(f,l)}else if(r.hasFocus||!r.state.facet(tl)){let a=r.observer.selectionRange,{impreciseHead:l,impreciseAnchor:c}=r.docView,f=l&&l.node==a.focusNode&&l.offset==a.focusOffset||!ms(r.contentDOM,a.focusNode)?r.state.selection.main.head:r.docView.posFromDOM(a.focusNode,a.focusOffset),u=c&&c.node==a.anchorNode&&c.offset==a.anchorOffset||!ms(r.contentDOM,a.anchorNode)?r.state.selection.main.anchor:r.docView.posFromDOM(a.anchorNode,a.anchorOffset);(f!=s.head||u!=s.anchor)&&(o=N.single(u,f))}if(!(!i&&!o)){if(!i&&n&&!s.empty&&o&&o.main.empty?i={from:s.from,to:s.to,insert:r.state.doc.slice(s.from,s.to)}:i&&i.from>=s.from&&i.to<=s.to&&(i.from!=s.from||i.to!=s.to)&&s.to-s.from-(i.to-i.from)<=4?i={from:s.from,to:s.to,insert:r.state.doc.slice(s.from,i.from).append(i.insert).append(r.state.doc.slice(i.to,s.to))}:ne.mac&&i&&i.from==i.to&&i.from==s.head-1&&i.insert.toString()=="."&&(i={from:s.from,to:s.to,insert:ve.of([" "])}),i){let a=r.state;if(ne.ios&&r.inputState.flushIOSKey(r)||ne.android&&(i.from==s.from&&i.to==s.to&&i.insert.length==1&&i.insert.lines==2&&Ha(r.contentDOM,"Enter",13)||i.from==s.from-1&&i.to==s.to&&i.insert.length==0&&Ha(r.contentDOM,"Backspace",8)||i.from==s.from&&i.to==s.to+1&&i.insert.length==0&&Ha(r.contentDOM,"Delete",46)))return;let l=i.insert.toString();if(r.state.facet(Ib).some(u=>u(r,i.from,i.to,l)))return;r.inputState.composing>=0&&r.inputState.composing++;let c;if(i.from>=s.from&&i.to<=s.to&&i.to-i.from>=(s.to-s.from)/3&&(!o||o.main.empty&&o.main.from==i.from+i.insert.length)&&r.inputState.composing<0){let u=s.from<i.from?a.sliceDoc(s.from,i.from):"",h=s.to>i.to?a.sliceDoc(i.to,s.to):"";c=a.replaceSelection(r.state.toText(u+i.insert.sliceString(0,void 0,r.state.lineBreak)+h))}else{let u=a.changes(i),h=o&&!a.selection.main.eq(o.main)&&o.main.to<=u.newLength?o.main:void 0;if(a.selection.ranges.length>1&&r.inputState.composing>=0&&i.to<=s.to&&i.to>=s.to-10){let d=r.state.sliceDoc(i.from,i.to),m=Wb(r)||r.state.doc.lineAt(s.head),y=s.to-i.to,g=s.to-s.from;c=a.changeByRange(v=>{if(v.from==s.from&&v.to==s.to)return{changes:u,range:h||v.map(u)};let T=v.to-y,M=T-d.length;if(v.to-v.from!=g||r.state.sliceDoc(M,T)!=d||m&&v.to>=m.from&&v.from<=m.to)return{range:v};let x=a.changes({from:M,to:T,insert:i.insert}),D=v.to-s.to;return{changes:x,range:h?N.range(Math.max(0,h.anchor+D),Math.max(0,h.head+D)):v.map(x)}})}else c={changes:u,selection:h&&a.selection.replaceRange(h)}}let f="input.type";r.composing&&(f+=".compose",r.inputState.compositionFirstChange&&(f+=".start",r.inputState.compositionFirstChange=!1)),r.dispatch(c,{scrollIntoView:!0,userEvent:f})}else if(o&&!o.main.eq(s)){let a=!1,l="select";r.inputState.lastSelectionTime>Date.now()-50&&(r.inputState.lastSelectionOrigin=="select"&&(a=!0),l=r.inputState.lastSelectionOrigin),r.dispatch({selection:o,scrollIntoView:a,userEvent:l})}}}function T2(r,e,t,n){let i=Math.min(r.length,e.length),o=0;for(;o<i&&r.charCodeAt(o)==e.charCodeAt(o);)o++;if(o==i&&r.length==e.length)return null;let s=r.length,a=e.length;for(;s>0&&a>0&&r.charCodeAt(s-1)==e.charCodeAt(a-1);)s--,a--;if(n=="end"){let l=Math.max(0,o-Math.min(s,a));t-=s+l-o}return s<o&&r.length<e.length?(o-=t<=o&&t>=s?o-t:0,a=o+(a-s),s=o):a<o&&(o-=t<=o&&t>=a?o-t:0,s=o+(s-a),a=o),{from:o,toA:s,toB:a}}function O2(r){let e=[];if(r.root.activeElement!=r.contentDOM)return e;let{anchorNode:t,anchorOffset:n,focusNode:i,focusOffset:o}=r.observer.selectionRange;return t&&(e.push(new yf(t,n)),(i!=t||o!=n)&&e.push(new yf(i,o))),e}function E2(r,e){if(r.length==0)return null;let t=r[0].pos,n=r.length==2?r[1].pos:t;return t>-1&&n>-1?N.single(t+e,n+e):null}var G=class{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=e.root||zA(e.parent)||document,this.viewState=new kf(e.state||de.create()),this.plugins=this.state.facet(ja).map(t=>new Wa(t));for(let t of this.plugins)t.update(this);this.observer=new gp(this,(t,n,i)=>{A2(this,t,n,i)},t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()}),this.inputState=new ip(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new bf(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...e){this._dispatch(e.length==1&&e[0]instanceof Ze?e[0]:this.state.update(...e))}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,n=!1,i,o=this.state;for(let a of e){if(a.startState!=o)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");o=a.state}if(this.destroyed){this.viewState.state=o;return}if(o.facet(de.phrases)!=this.state.facet(de.phrases))return this.setState(o);i=bs.create(this,o,e);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let a of e){if(s&&(s=s.map(a.changes)),a.scrollIntoView){let{main:l}=a.state.selection;s=new ys(l.empty?l:N.cursor(l.head,l.head>l.anchor?-1:1))}for(let l of a.effects)l.is(F0)&&(s=l.value)}this.viewState.update(i,s),this.bidiCache=_s.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),t=this.docView.update(i),this.state.facet($a)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(a=>a.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(sf)!=i.state.facet(sf)&&(this.viewState.mustMeasureContent=!0),(t||n||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!i.empty)for(let a of this.state.facet(Xd))a(i)}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let n of this.plugins)n.destroy(this);this.viewState=new kf(e),this.plugins=e.facet(ja).map(n=>new Wa(n)),this.pluginMap.clear();for(let n of this.plugins)n.update(this);this.docView=new bf(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(ja),n=e.state.facet(ja);if(t!=n){let i=[];for(let o of n){let s=t.indexOf(o);if(s<0)i.push(new Wa(o));else{let a=this.plugins[s];a.mustUpdate=e,i.push(a)}}for(let o of this.plugins)o.mustUpdate!=e&&o.destroy(this);this.plugins=i,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let i of this.plugins)i.mustUpdate=e;for(let i=0;i<this.plugins.length;i++)this.plugins[i].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.flush();let t=null;try{for(let n=0;;n++){this.updateState=1;let i=this.viewport,o=this.viewState.measure(this);if(!o&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(n>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];o&4||([this.measureRequests,s]=[s,this.measureRequests]);let a=s.map(u=>{try{return u.read(this)}catch(h){return Pt(this.state,h),lb}}),l=bs.create(this,this.state,[]),c=!1,f=!1;l.flags|=o,t?t.flags|=o:t=l,this.updateState=2,l.empty||(this.updatePlugins(l),this.inputState.update(l),this.updateAttrs(),c=this.docView.update(l));for(let u=0;u<s.length;u++)if(a[u]!=lb)try{let h=s[u];h.write&&h.write(a[u],this)}catch(h){Pt(this.state,h)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,f=!0),c&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!f&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let n of this.state.facet(Xd))n(t)}get themeClasses(){return pp+" "+(this.state.facet(dp)?n_:r_)+" "+this.state.facet(sf)}updateAttrs(){let e=cb(this,zb,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(tl)?"true":"false",class:"cm-content",style:`${ne.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),cb(this,jb,t);let n=this.observer.ignore(()=>{let i=Jd(this.contentDOM,this.contentAttrs,t),o=Jd(this.dom,this.editorAttrs,e);return i||o});return this.editorAttrs=e,this.contentAttrs=t,n}showAnnouncements(e){let t=!0;for(let n of e)for(let i of n.effects)if(i.is(G.announce)){t&&(this.announceDOM.textContent=""),t=!1;let o=this.announceDOM.appendChild(document.createElement("div"));o.textContent=i.value}}mountStyles(){this.styleModules=this.state.facet($a),Tr.mount(this.root,this.styleModules.concat(x2).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),e){if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(n=>n.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,n){return Pd(this,e,K0(this,e,t,n))}moveByGroup(e,t){return Pd(this,e,K0(this,e,t,n=>s2(this,e.head,n)))}moveToLineBoundary(e,t,n=!0){return o2(this,e,t,n)}moveVertically(e,t,n){return Pd(this,e,a2(this,e,t,n))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),Kb(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let n=this.docView.coordsAt(e,t);if(!n||n.left==n.right)return n;let i=this.state.doc.lineAt(e),o=this.bidiSpans(i),s=o[ui.find(o,e-i.from,-1,t)];return Tf(n,s.dir==$e.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(Bb)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>R2)return Ub(e.length);let t=this.textDirectionAt(e.from);for(let i of this.bidiCache)if(i.from==e.from&&i.dir==t)return i.order;let n=GA(e.text,t);return this.bidiCache.push(new _s(e.from,e.to,t,n)),n}get hasFocus(){var e;return(document.hasFocus()||ne.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{kb(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return F0.of(new ys(typeof e=="number"?N.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Pe.define(()=>({}),{eventHandlers:e})}static theme(e,t){let n=Tr.newName(),i=[sf.of(n),$a.of(mp(`.${n}`,e))];return t&&t.dark&&i.push(dp.of(!0)),i}static baseTheme(e){return Fn.lowest($a.of(mp("."+pp,e,i_)))}};G.styleModule=$a;G.inputHandler=Ib;G.perLineTextDirection=Bb;G.exceptionSink=Lb;G.updateListener=Xd;G.editable=tl;G.mouseSelectionStyle=Pb;G.dragMovesSelection=Nb;G.clickAddsSelectionRange=Db;G.decorations=Xa;G.atomicRanges=$b;G.scrollMargins=Fb;G.darkTheme=dp;G.contentAttributes=jb;G.editorAttributes=zb;G.lineWrapping=G.contentAttributes.of({class:"cm-lineWrapping"});G.announce=ae.define();var R2=4096,lb={},_s=class{constructor(e,t,n,i){this.from=e,this.to=t,this.dir=n,this.order=i}static update(e,t){if(t.empty)return e;let n=[],i=e.length?e[e.length-1].dir:$e.LTR;for(let o=Math.max(0,e.length-10);o<e.length;o++){let s=e[o];s.dir==i&&!t.touchesRange(s.from,s.to)&&n.push(new _s(t.mapPos(s.from,1),t.mapPos(s.to,-1),s.dir,s.order))}return n}};function cb(r,e,t){for(let n=r.state.facet(e),i=n.length-1;i>=0;i--){let o=n[i],s=typeof o=="function"?o(r):o;s&&Zd(s,t)}return t}var M2=ne.mac?"mac":ne.windows?"win":ne.linux?"linux":"key";function D2(r,e){let t=r.split(/-(?!$)/),n=t[t.length-1];n=="Space"&&(n=" ");let i,o,s,a;for(let l=0;l<t.length-1;++l){let c=t[l];if(/^(cmd|meta|m)$/i.test(c))a=!0;else if(/^a(lt)?$/i.test(c))i=!0;else if(/^(c|ctrl|control)$/i.test(c))o=!0;else if(/^s(hift)?$/i.test(c))s=!0;else if(/^mod$/i.test(c))e=="mac"?a=!0:o=!0;else throw new Error("Unrecognized modifier name: "+c)}return i&&(n="Alt-"+n),o&&(n="Ctrl-"+n),a&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function Id(r,e,t){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),t!==!1&&e.shiftKey&&(r="Shift-"+r),r}var N2=G.domEventHandlers({keydown(r,e){return a_(o_(e.state),r,e,"editor")}}),po=Z.define({enables:N2}),fb=new WeakMap;function o_(r){let e=r.facet(po),t=fb.get(e);return t||fb.set(e,t=L2(e.reduce((n,i)=>n.concat(i),[]))),t}function s_(r,e,t){return a_(o_(r.state),e,r,t)}var ci=null,P2=4e3;function L2(r,e=M2){let t=Object.create(null),n=Object.create(null),i=(s,a)=>{let l=n[s];if(l==null)n[s]=a;else if(l!=a)throw new Error("Key binding "+s+" is used both as a regular binding and as a multi-stroke prefix")},o=(s,a,l,c)=>{let f=t[s]||(t[s]=Object.create(null)),u=a.split(/ (?!$)/).map(m=>D2(m,e));for(let m=1;m<u.length;m++){let y=u.slice(0,m).join(" ");i(y,!0),f[y]||(f[y]={preventDefault:!0,commands:[g=>{let v=ci={view:g,prefix:y,scope:s};return setTimeout(()=>{ci==v&&(ci=null)},P2),!0}]})}let h=u.join(" ");i(h,!1);let d=f[h]||(f[h]={preventDefault:!1,commands:[]});d.commands.push(l),c&&(d.preventDefault=!0)};for(let s of r){let a=s[e]||s.key;if(!!a)for(let l of s.scope?s.scope.split(" "):["editor"])o(l,a,s.run,s.preventDefault),s.shift&&o(l,"Shift-"+a,s.shift,s.preventDefault)}return t}function a_(r,e,t,n){let i=P0(e),o=i.length==1&&i!=" ",s="",a=!1;ci&&ci.view==t&&ci.scope==n&&(s=ci.prefix+" ",(a=Zb.indexOf(e.keyCode)<0)&&(ci=null));let l=u=>{if(u){for(let h of u.commands)if(h(t))return!0;u.preventDefault&&(a=!0)}return!1},c=r[n],f;if(c){if(l(c[s+Id(i,e,!o)]))return!0;if(o&&(e.shiftKey||e.altKey||e.metaKey)&&(f=Vn[e.keyCode])&&f!=i){if(l(c[s+Id(f,e,!0)]))return!0}else if(o&&e.shiftKey&&l(c[s+Id(i,e,!0)]))return!0}return a}var l_=!ne.ios,Va=Z.define({combine(r){return Kt(r,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function c_(r={}){return[Va.of(r),I2,B2]}var wf=class{constructor(e,t,n,i,o){this.left=e,this.top=t,this.width=n,this.height=i,this.className=o}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width>=0&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}},I2=Pe.fromClass(class{constructor(r){this.view=r,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=r.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=r.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),r.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(Va).cursorBlinkRate+"ms"}update(r){let e=r.startState.facet(Va)!=r.state.facet(Va);(e||r.selectionSet||r.geometryChanged||r.viewportChanged)&&this.view.requestMeasure(this.measureReq),r.transactions.some(t=>t.scrollIntoView)&&(this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink"),e&&this.setBlinkRate()}readPos(){let{state:r}=this.view,e=r.facet(Va),t=r.selection.ranges.map(i=>i.empty?[]:z2(this.view,i)).reduce((i,o)=>i.concat(o)),n=[];for(let i of r.selection.ranges){let o=i==r.selection.main;if(i.empty?!o||l_:e.drawRangeCursor){let s=j2(this.view,i,o);s&&n.push(s)}}return{rangePieces:t,cursors:n}}drawSel({rangePieces:r,cursors:e}){if(r.length!=this.rangePieces.length||r.some((t,n)=>!t.eq(this.rangePieces[n]))){this.selectionLayer.textContent="";for(let t of r)this.selectionLayer.appendChild(t.draw());this.rangePieces=r}if(e.length!=this.cursors.length||e.some((t,n)=>!t.eq(this.cursors[n]))){let t=this.cursorLayer.children;if(t.length!==e.length){this.cursorLayer.textContent="";for(let n of e)this.cursorLayer.appendChild(n.draw())}else e.forEach((n,i)=>n.adjust(t[i]));this.cursors=e}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),f_={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};l_&&(f_[".cm-line"].caretColor="transparent !important");var B2=Fn.highest(G.theme(f_));function u_(r){let e=r.scrollDOM.getBoundingClientRect();return{left:(r.textDirection==$e.LTR?e.left:e.right-r.scrollDOM.clientWidth)-r.scrollDOM.scrollLeft,top:e.top-r.scrollDOM.scrollTop}}function ub(r,e,t){let n=N.cursor(e);return{from:Math.max(t.from,r.moveToLineBoundary(n,!1,!0).from),to:Math.min(t.to,r.moveToLineBoundary(n,!0,!0).from),type:Ne.Text}}function hb(r,e){let t=r.lineBlockAt(e);if(Array.isArray(t.type)){for(let n of t.type)if(n.to>e||n.to==e&&(n.to==t.to||n.type==Ne.Text))return n}return t}function z2(r,e){if(e.to<=r.viewport.from||e.from>=r.viewport.to)return[];let t=Math.max(e.from,r.viewport.from),n=Math.min(e.to,r.viewport.to),i=r.textDirection==$e.LTR,o=r.contentDOM,s=o.getBoundingClientRect(),a=u_(r),l=window.getComputedStyle(o.firstChild),c=s.left+parseInt(l.paddingLeft)+Math.min(0,parseInt(l.textIndent)),f=s.right-parseInt(l.paddingRight),u=hb(r,t),h=hb(r,n),d=u.type==Ne.Text?u:null,m=h.type==Ne.Text?h:null;if(r.lineWrapping&&(d&&(d=ub(r,t,d)),m&&(m=ub(r,n,m))),d&&m&&d.from==m.from)return g(v(e.from,e.to,d));{let M=d?v(e.from,null,d):T(u,!1),x=m?v(null,e.to,m):T(h,!0),D=[];return(d||u).to<(m||h).from-1?D.push(y(c,M.bottom,f,x.top)):M.bottom<x.top&&r.elementAtHeight((M.bottom+x.top)/2).type==Ne.Text&&(M.bottom=x.top=(M.bottom+x.top)/2),g(M).concat(D).concat(g(x))}function y(M,x,D,j){return new wf(M-a.left,x-a.top-.01,D-M,j-x+.01,"cm-selectionBackground")}function g({top:M,bottom:x,horizontal:D}){let j=[];for(let A=0;A<D.length;A+=2)j.push(y(D[A],M,D[A+1],x));return j}function v(M,x,D){let j=1e9,A=-1e9,L=[];function z(Te,ze,Dt,st,rt){let Nt=r.coordsAtPos(Te,Te==D.to?-2:2),wt=r.coordsAtPos(Dt,Dt==D.from?2:-2);j=Math.min(Nt.top,wt.top,j),A=Math.max(Nt.bottom,wt.bottom,A),rt==$e.LTR?L.push(i&&ze?c:Nt.left,i&&st?f:wt.right):L.push(!i&&st?c:wt.left,!i&&ze?f:Nt.right)}let $=M??D.from,K=x??D.to;for(let Te of r.visibleRanges)if(Te.to>$&&Te.from<K)for(let ze=Math.max(Te.from,$),Dt=Math.min(Te.to,K);;){let st=r.state.doc.lineAt(ze);for(let rt of r.bidiSpans(st)){let Nt=rt.from+st.from,wt=rt.to+st.from;if(Nt>=Dt)break;wt>ze&&z(Math.max(Nt,ze),M==null&&Nt<=$,Math.min(wt,Dt),x==null&&wt>=K,rt.dir)}if(ze=st.to+1,ze>=Dt)break}return L.length==0&&z($,M==null,K,x==null,r.textDirection),{top:j,bottom:A,horizontal:L}}function T(M,x){let D=s.top+(x?M.top:M.bottom);return{top:D,bottom:D,horizontal:[]}}}function j2(r,e,t){let n=r.coordsAtPos(e.head,e.assoc||1);if(!n)return null;let i=u_(r);return new wf(n.left-i.left,n.top-i.top,-1,n.bottom-n.top,t?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}var h_=ae.define({map(r,e){return r==null?null:e.mapPos(r)}}),Ua=Ee.define({create(){return null},update(r,e){return r!=null&&(r=e.changes.mapPos(r)),e.effects.reduce((t,n)=>n.is(h_)?n.value:t,r)}}),$2=Pe.fromClass(class{constructor(r){this.view=r,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(r){var e;let t=r.state.field(Ua);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(r.startState.field(Ua)!=t||r.docChanged||r.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let r=this.view.state.field(Ua),e=r!=null&&this.view.coordsAtPos(r);if(!e)return null;let t=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-t.left+this.view.scrollDOM.scrollLeft,top:e.top-t.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(r){this.cursor&&(r?(this.cursor.style.left=r.left+"px",this.cursor.style.top=r.top+"px",this.cursor.style.height=r.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(r){this.view.state.field(Ua)!=r&&this.view.dispatch({effects:h_.of(r)})}},{eventHandlers:{dragover(r){this.setDropPos(this.view.posAtCoords({x:r.clientX,y:r.clientY}))},dragleave(r){(r.target==this.view.contentDOM||!this.view.contentDOM.contains(r.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function d_(){return[Ua,$2]}function db(r,e,t,n,i){e.lastIndex=0;for(let o=r.iterRange(t,n),s=t,a;!o.next().done;s+=o.value.length)if(!o.lineBreak)for(;a=e.exec(o.value);)i(s+a.index,s+a.index+a[0].length,a)}function F2(r,e){let t=r.visibleRanges;if(t.length==1&&t[0].from==r.viewport.from&&t[0].to==r.viewport.to)return t;let n=[];for(let{from:i,to:o}of t)i=Math.max(r.state.doc.lineAt(i).from,i-e),o=Math.min(r.state.doc.lineAt(o).to,o+e),n.length&&n[n.length-1].to>=i?n[n.length-1].to=o:n.push({from:i,to:o});return n}var yp=class{constructor(e){let{regexp:t,decoration:n,boundary:i,maxLength:o=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=t,this.getDeco=typeof n=="function"?n:()=>n,this.boundary=i,this.maxLength=o}createDeco(e){let t=new cr;for(let{from:n,to:i}of F2(e,this.maxLength))db(e.state.doc,this.regexp,n,i,(o,s,a)=>t.add(o,s,this.getDeco(a,e,o)));return t.finish()}updateDeco(e,t){let n=1e9,i=-1;return e.docChanged&&e.changes.iterChanges((o,s,a,l)=>{l>e.view.viewport.from&&a<e.view.viewport.to&&(n=Math.min(a,n),i=Math.max(l,i))}),e.viewportChanged||i-n>1e3?this.createDeco(e.view):i>-1?this.updateRange(e.view,t.map(e.changes),n,i):t}updateRange(e,t,n,i){for(let o of e.visibleRanges){let s=Math.max(o.from,n),a=Math.min(o.to,i);if(a>s){let l=e.state.doc.lineAt(s),c=l.to<a?e.state.doc.lineAt(a):l,f=Math.max(o.from,l.from),u=Math.min(o.to,c.to);if(this.boundary){for(;s>l.from;s--)if(this.boundary.test(l.text[s-1-l.from])){f=s;break}for(;a<c.to;a++)if(this.boundary.test(c.text[a-c.from])){u=a;break}}let h=[],d;if(l==c)for(this.regexp.lastIndex=f-l.from;(d=this.regexp.exec(l.text))&&d.index<u-l.from;){let m=d.index+l.from;h.push(this.getDeco(d,e,m).range(m,m+d[0].length))}else db(e.state.doc,this.regexp,f,u,(m,y,g)=>h.push(this.getDeco(g,e,m).range(m,y)));t=t.update({filterFrom:f,filterTo:u,filter:(m,y)=>m<f||y>u,add:h})}}return t}},bp=/x/.unicode!=null?"gu":"g",V2=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\uFEFF\uFFF9-\uFFFC]`,bp),U2={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"},Bd=null;function H2(){var r;if(Bd==null&&typeof document<"u"&&document.body){let e=document.body.style;Bd=((r=e.tabSize)!==null&&r!==void 0?r:e.MozTabSize)!=null}return Bd||!1}var lf=Z.define({combine(r){let e=Kt(r,{render:null,specialChars:V2,addSpecialChars:null});return(e.replaceTabs=!H2())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,bp)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,bp)),e}});function p_(r={}){return[lf.of(r),W2()]}var pb=null;function W2(){return pb||(pb=Pe.fromClass(class{constructor(r){this.view=r,this.decorations=Y.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(r.state.facet(lf)),this.decorations=this.decorator.createDeco(r)}makeDecorator(r){return new yp({regexp:r.specialChars,decoration:(e,t,n)=>{let{doc:i}=t.state,o=lt(e[0],0);if(o==9){let s=i.lineAt(n),a=t.state.tabSize,l=li(s.text,a,n-s.from);return Y.replace({widget:new vp((a-l%a)*this.view.defaultCharacterWidth)})}return this.decorationCache[o]||(this.decorationCache[o]=Y.replace({widget:new _p(r,o)}))},boundary:r.replaceTabs?void 0:/[^]/})}update(r){let e=r.state.facet(lf);r.startState.facet(lf)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(r.view)):this.decorations=this.decorator.updateDeco(r,this.decorations)}},{decorations:r=>r.decorations}))}var q2="\u2022";function K2(r){return r>=32?q2:r==10?"\u2424":String.fromCharCode(9216+r)}var _p=class extends ur{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=K2(this.code),n=e.state.phrase("Control character")+" "+(U2[this.code]||"0x"+this.code.toString(16)),i=this.options.render&&this.options.render(this.code,n,t);if(i)return i;let o=document.createElement("span");return o.textContent=t,o.title=n,o.setAttribute("aria-label",n),o.className="cm-specialChar",o}ignoreEvent(){return!1}},vp=class extends ur{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}};function m_(){return Z2}var G2=Y.line({class:"cm-activeLine"}),Z2=Pe.fromClass(class{constructor(r){this.decorations=this.getDeco(r)}update(r){(r.docChanged||r.selectionSet)&&(this.decorations=this.getDeco(r.view))}getDeco(r){let e=-1,t=[];for(let n of r.state.selection.ranges){if(!n.empty)return Y.none;let i=r.lineBlockAt(n.head);i.from>e&&(t.push(G2.range(i.from)),e=i.from)}return Y.set(t)}},{decorations:r=>r.decorations});var kp=2e3;function J2(r,e,t){let n=Math.min(e.line,t.line),i=Math.max(e.line,t.line),o=[];if(e.off>kp||t.off>kp||e.col<0||t.col<0){let s=Math.min(e.off,t.off),a=Math.max(e.off,t.off);for(let l=n;l<=i;l++){let c=r.doc.line(l);c.length<=a&&o.push(N.range(c.from+s,c.to+a))}}else{let s=Math.min(e.col,t.col),a=Math.max(e.col,t.col);for(let l=n;l<=i;l++){let c=r.doc.line(l),f=Qc(c.text,s,r.tabSize,!0);if(f>-1){let u=Qc(c.text,a,r.tabSize);o.push(N.range(c.from+f,c.from+u))}}}return o}function Y2(r,e){let t=r.coordsAtPos(r.viewport.from);return t?Math.round(Math.abs((t.left-e)/r.defaultCharacterWidth)):-1}function mb(r,e){let t=r.posAtCoords({x:e.clientX,y:e.clientY},!1),n=r.state.doc.lineAt(t),i=t-n.from,o=i>kp?-1:i==n.length?Y2(r,e.clientX):li(n.text,r.state.tabSize,t-n.from);return{line:n.number,col:o,off:i}}function X2(r,e){let t=mb(r,e),n=r.state.selection;return t?{update(i){if(i.docChanged){let o=i.changes.mapPos(i.startState.doc.line(t.line).from),s=i.state.doc.lineAt(o);t={line:s.number,col:t.col,off:Math.min(t.off,s.length)},n=n.map(i.changes)}},get(i,o,s){let a=mb(r,i);if(!a)return n;let l=J2(r.state,t,a);return l.length?s?N.create(l.concat(n.ranges)):N.create(l):n}}:null}function g_(r){let e=r?.eventFilter||(t=>t.altKey&&t.button==0);return G.mouseSelectionStyle.of((t,n)=>e(n)?X2(t,n):null)}var Q2={Alt:[18,r=>r.altKey],Control:[17,r=>r.ctrlKey],Shift:[16,r=>r.shiftKey],Meta:[91,r=>r.metaKey]},eT={style:"cursor: crosshair"};function y_(r={}){let[e,t]=Q2[r.key||"Alt"],n=Pe.fromClass(class{constructor(i){this.view=i,this.isDown=!1}set(i){this.isDown!=i&&(this.isDown=i,this.view.update([]))}},{eventHandlers:{keydown(i){this.set(i.keyCode==e||t(i))},keyup(i){(i.keyCode==e||!t(i))&&this.set(!1)}}});return[n,G.contentAttributes.of(i=>{var o;return!((o=i.plugin(n))===null||o===void 0)&&o.isDown?eT:null})]}var zd="-10000px",xf=class{constructor(e,t,n){this.facet=t,this.createTooltipView=n,this.input=e.state.facet(t),this.tooltips=this.input.filter(i=>i),this.tooltipViews=this.tooltips.map(n)}update(e){let t=e.state.facet(this.facet),n=t.filter(o=>o);if(t===this.input){for(let o of this.tooltipViews)o.update&&o.update(e);return!1}let i=[];for(let o=0;o<n.length;o++){let s=n[o],a=-1;if(!!s){for(let l=0;l<this.tooltips.length;l++){let c=this.tooltips[l];c&&c.create==s.create&&(a=l)}if(a<0)i[o]=this.createTooltipView(s);else{let l=i[o]=this.tooltipViews[a];l.update&&l.update(e)}}}for(let o of this.tooltipViews)i.indexOf(o)<0&&o.dom.remove();return this.input=t,this.tooltips=n,this.tooltipViews=i,!0}};function tT(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}var jd=Z.define({combine:r=>{var e,t,n;return{position:ne.ios?"absolute":((e=r.find(i=>i.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=r.find(i=>i.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((n=r.find(i=>i.tooltipSpace))===null||n===void 0?void 0:n.tooltipSpace)||tT}}}),b_=Pe.fromClass(class{constructor(r){var e;this.view=r,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let t=r.state.facet(jd);this.position=t.position,this.parent=t.parent,this.classes=r.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new xf(r,rl,n=>this.createTooltip(n)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(n=>{Date.now()>this.lastTransaction-50&&n.length>0&&n[n.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),(e=r.dom.ownerDocument.defaultView)===null||e===void 0||e.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let r of this.manager.tooltipViews)this.intersectionObserver.observe(r.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(r){r.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(r);e&&this.observeIntersection();let t=e||r.geometryChanged,n=r.state.facet(jd);if(n.position!=this.position){this.position=n.position;for(let i of this.manager.tooltipViews)i.dom.style.position=this.position;t=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let i of this.manager.tooltipViews)this.container.appendChild(i.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(r){let e=r.create(this.view);if(e.dom.classList.add("cm-tooltip"),r.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let t=document.createElement("div");t.className="cm-tooltip-arrow",e.dom.appendChild(t)}return e.dom.style.position=this.position,e.dom.style.top=zd,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var r,e;(r=this.view.dom.ownerDocument.defaultView)===null||r===void 0||r.removeEventListener("resize",this.measureSoon);for(let{dom:t}of this.manager.tooltipViews)t.remove();(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let r=this.view.dom.getBoundingClientRect();return{editor:r,parent:this.parent?this.container.getBoundingClientRect():r,pos:this.manager.tooltips.map((e,t)=>{let n=this.manager.tooltipViews[t];return n.getCoords?n.getCoords(e.pos):this.view.coordsAtPos(e.pos)}),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet(jd).tooltipSpace(this.view)}}writeMeasure(r){let{editor:e,space:t}=r,n=[];for(let i=0;i<this.manager.tooltips.length;i++){let o=this.manager.tooltips[i],s=this.manager.tooltipViews[i],{dom:a}=s,l=r.pos[i],c=r.size[i];if(!l||l.bottom<=Math.max(e.top,t.top)||l.top>=Math.min(e.bottom,t.bottom)||l.right<Math.max(e.left,t.left)-.1||l.left>Math.min(e.right,t.right)+.1){a.style.top=zd;continue}let f=o.arrow?s.dom.querySelector(".cm-tooltip-arrow"):null,u=f?7:0,h=c.right-c.left,d=c.bottom-c.top,m=s.offset||nT,y=this.view.textDirection==$e.LTR,g=c.width>t.right-t.left?y?t.left:t.right-c.width:y?Math.min(l.left-(f?14:0)+m.x,t.right-h):Math.max(t.left,l.left-h+(f?14:0)-m.x),v=!!o.above;!o.strictSide&&(v?l.top-(c.bottom-c.top)-m.y<t.top:l.bottom+(c.bottom-c.top)+m.y>t.bottom)&&v==t.bottom-l.bottom>l.top-t.top&&(v=!v);let T=v?l.top-d-u-m.y:l.bottom+u+m.y,M=g+h;if(s.overlap!==!0)for(let x of n)x.left<M&&x.right>g&&x.top<T+d&&x.bottom>T&&(T=v?x.top-d-2-u:x.bottom+u+2);this.position=="absolute"?(a.style.top=T-r.parent.top+"px",a.style.left=g-r.parent.left+"px"):(a.style.top=T+"px",a.style.left=g+"px"),f&&(f.style.left=`${l.left+(y?m.x:-m.x)-(g+14-7)}px`),s.overlap!==!0&&n.push({left:g,top:T,right:M,bottom:T+d}),a.classList.toggle("cm-tooltip-above",v),a.classList.toggle("cm-tooltip-below",!v),s.positioned&&s.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let r of this.manager.tooltipViews)r.dom.style.top=zd}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),rT=G.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:`${7}px`,width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:`${7}px solid transparent`,borderRight:`${7}px solid transparent`},".cm-tooltip-above &":{bottom:`-${7}px`,"&:before":{borderTop:`${7}px solid #bbb`},"&:after":{borderTop:`${7}px solid #f5f5f5`,bottom:"1px"}},".cm-tooltip-below &":{top:`-${7}px`,"&:before":{borderBottom:`${7}px solid #bbb`},"&:after":{borderBottom:`${7}px solid #f5f5f5`,top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),nT={x:0,y:0},rl=Z.define({enables:[b_,rT]}),Sf=Z.define(),el=class{constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new xf(e,Sf,t=>this.createHostedView(t))}static create(e){return new el(e)}createHostedView(e){let t=e.create(this.view);return t.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(t.dom),this.mounted&&t.mount&&t.mount(this.view),t}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(){for(let e of this.manager.tooltipViews)e.positioned&&e.positioned()}update(e){this.manager.update(e)}},iT=rl.compute([Sf],r=>{let e=r.facet(Sf).filter(t=>t);return e.length===0?null:{pos:Math.min(...e.map(t=>t.pos)),end:Math.max(...e.filter(t=>t.end!=null).map(t=>t.end)),create:el.create,above:e[0].above,arrow:e.some(t=>t.arrow)}}),wp=class{constructor(e,t,n,i,o){this.view=e,this.source=t,this.field=n,this.setHover=i,this.hoverTime=o,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:e}=this,t=this.view.contentDOM.contains(e.target)?this.view.posAtCoords(e):null;if(t==null)return;let n=this.view.coordsAtPos(t);if(n==null||e.y<n.top||e.y>n.bottom||e.x<n.left-this.view.defaultCharacterWidth||e.x>n.right+this.view.defaultCharacterWidth)return;let i=this.view.bidiSpans(this.view.state.doc.lineAt(t)).find(a=>a.from<=t&&a.to>=t),o=i&&i.dir==$e.RTL?-1:1,s=this.source(this.view,t,e.x<n.left?-o:o);if(s?.then){let a=this.pending={pos:t};s.then(l=>{this.pending==a&&(this.pending=null,l&&this.view.dispatch({effects:this.setHover.of(l)}))},l=>Pt(this.view.state,l,"hover tooltip"))}else s&&this.view.dispatch({effects:this.setHover.of(s)})}mousemove(e){var t;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let n=this.active;if(n&&!oT(this.lastMove.target)||this.pending){let{pos:i}=n||this.pending,o=(t=n?.end)!==null&&t!==void 0?t:i;(i==o?this.view.posAtCoords(this.lastMove)!=i:!sT(this.view,i,o,e.clientX,e.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}};function oT(r){for(let e=r;e;e=e.parentNode)if(e.nodeType==1&&e.classList.contains("cm-tooltip"))return!0;return!1}function sT(r,e,t,n,i,o){let s=document.createRange(),a=r.domAtPos(e),l=r.domAtPos(t);s.setEnd(l.node,l.offset),s.setStart(a.node,a.offset);let c=s.getClientRects();s.detach();for(let f=0;f<c.length;f++){let u=c[f];if(Math.max(u.top-i,i-u.bottom,u.left-n,n-u.right)<=o)return!0}return!1}function __(r,e={}){let t=ae.define(),n=Ee.define({create(){return null},update(i,o){if(i&&(e.hideOnChange&&(o.docChanged||o.selection)||e.hideOn&&e.hideOn(o,i)))return null;if(i&&o.docChanged){let s=o.changes.mapPos(i.pos,-1,xt.TrackDel);if(s==null)return null;let a=Object.assign(Object.create(null),i);a.pos=s,i.end!=null&&(a.end=o.changes.mapPos(i.end)),i=a}for(let s of o.effects)s.is(t)&&(i=s.value),s.is(aT)&&(i=null);return i},provide:i=>Sf.from(i)});return[n,Pe.define(i=>new wp(i,r,n,t,e.hoverTime||300)),iT]}function v_(r,e){let t=r.plugin(b_);if(!t)return null;let n=t.manager.tooltips.indexOf(e);return n<0?null:t.manager.tooltipViews[n]}var aT=ae.define();var gb=Z.define({combine(r){let e,t;for(let n of r)e=e||n.topContainer,t=t||n.bottomContainer;return{topContainer:e,bottomContainer:t}}});function mo(r,e){let t=r.plugin(k_),n=t?t.specs.indexOf(e):-1;return n>-1?t.panels[n]:null}var k_=Pe.fromClass(class{constructor(r){this.input=r.state.facet(ho),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(r));let e=r.state.facet(gb);this.top=new ds(r,!0,e.topContainer),this.bottom=new ds(r,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(r){let e=r.state.facet(gb);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new ds(r.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new ds(r.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=r.state.facet(ho);if(t!=this.input){let n=t.filter(l=>l),i=[],o=[],s=[],a=[];for(let l of n){let c=this.specs.indexOf(l),f;c<0?(f=l(r.view),a.push(f)):(f=this.panels[c],f.update&&f.update(r)),i.push(f),(f.top?o:s).push(f)}this.specs=n,this.panels=i,this.top.sync(o),this.bottom.sync(s);for(let l of a)l.dom.classList.add("cm-panel"),l.mount&&l.mount()}else for(let n of this.panels)n.update&&n.update(r)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:r=>G.scrollMargins.of(e=>{let t=e.plugin(r);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})}),ds=class{constructor(e,t,n){this.view=e,this.top=t,this.container=n,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=yb(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=yb(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}};function yb(r){let e=r.nextSibling;return r.remove(),e}var ho=Z.define({enables:k_}),hr=class extends Yr{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}};hr.prototype.elementClass="";hr.prototype.toDOM=void 0;hr.prototype.mapMode=xt.TrackBefore;hr.prototype.startSide=hr.prototype.endSide=-1;hr.prototype.point=!0;var cf=Z.define(),lT={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>ke.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Ka=Z.define();function Op(r){return[w_(),Ka.of(Object.assign(Object.assign({},lT),r))]}var xp=Z.define({combine:r=>r.some(e=>e)});function w_(r){let e=[cT];return r&&r.fixed===!1&&e.push(xp.of(!0)),e}var cT=Pe.fromClass(class{constructor(r){this.view=r,this.prevViewport=r.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=r.state.facet(Ka).map(e=>new Cf(r,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!r.state.facet(xp),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),r.scrollDOM.insertBefore(this.dom,r.contentDOM)}update(r){if(this.updateGutters(r)){let e=this.prevViewport,t=r.view.viewport,n=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(n<(t.to-t.from)*.8)}r.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(xp)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=r.view.viewport}syncGutters(r){let e=this.dom.nextSibling;r&&this.dom.remove();let t=ke.iter(this.view.state.facet(cf),this.view.viewport.from),n=[],i=this.gutters.map(o=>new Sp(o,this.view.viewport,-this.view.documentPadding.top));for(let o of this.view.viewportLineBlocks){let s;if(Array.isArray(o.type)){for(let a of o.type)if(a.type==Ne.Text){s=a;break}}else s=o.type==Ne.Text?o:void 0;if(!!s){n.length&&(n=[]),x_(t,n,o.from);for(let a of i)a.line(this.view,s,n)}}for(let o of i)o.finish();r&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(r){let e=r.startState.facet(Ka),t=r.state.facet(Ka),n=r.docChanged||r.heightChanged||r.viewportChanged||!ke.eq(r.startState.facet(cf),r.state.facet(cf),r.view.viewport.from,r.view.viewport.to);if(e==t)for(let i of this.gutters)i.update(r)&&(n=!0);else{n=!0;let i=[];for(let o of t){let s=e.indexOf(o);s<0?i.push(new Cf(this.view,o)):(this.gutters[s].update(r),i.push(this.gutters[s]))}for(let o of this.gutters)o.dom.remove(),i.indexOf(o)<0&&o.destroy();for(let o of i)this.dom.appendChild(o.dom);this.gutters=i}return n}destroy(){for(let r of this.gutters)r.destroy();this.dom.remove()}},{provide:r=>G.scrollMargins.of(e=>{let t=e.plugin(r);return!t||t.gutters.length==0||!t.fixed?null:e.textDirection==$e.LTR?{left:t.dom.offsetWidth}:{right:t.dom.offsetWidth}})});function bb(r){return Array.isArray(r)?r:[r]}function x_(r,e,t){for(;r.value&&r.from<=t;)r.from==t&&e.push(r.value),r.next()}var Sp=class{constructor(e,t,n){this.gutter=e,this.height=n,this.localMarkers=[],this.i=0,this.cursor=ke.iter(e.markers,t.from)}line(e,t,n){this.localMarkers.length&&(this.localMarkers=[]),x_(this.cursor,this.localMarkers,t.from);let i=n.length?this.localMarkers.concat(n):this.localMarkers,o=this.gutter.config.lineMarker(e,t,i);o&&i.unshift(o);let s=this.gutter;if(i.length==0&&!s.config.renderEmptyElements)return;let a=t.top-this.height;if(this.i==s.elements.length){let l=new Af(e,t.height,a,i);s.elements.push(l),s.dom.appendChild(l.dom)}else s.elements[this.i].update(e,t.height,a,i);this.height=t.bottom,this.i++}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}},Cf=class{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in t.domEventHandlers)this.dom.addEventListener(n,i=>{let o=e.lineBlockAtHeight(i.clientY-e.documentTop);t.domEventHandlers[n](e,o,i)&&i.preventDefault()});this.markers=bb(t.markers(e)),t.initialSpacer&&(this.spacer=new Af(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=bb(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let i=this.config.updateSpacer(this.spacer.markers[0],e);i!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[i])}let n=e.view.viewport;return!ke.eq(this.markers,t,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}},Af=class{constructor(e,t,n,i){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,n,i)}update(e,t,n,i){this.height!=t&&(this.dom.style.height=(this.height=t)+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)?n+"px":""),fT(this.markers,i)||this.setMarkers(e,i)}setMarkers(e,t){let n="cm-gutterElement",i=this.dom.firstChild;for(let o=0,s=0;;){let a=s,l=o<t.length?t[o++]:null,c=!1;if(l){let f=l.elementClass;f&&(n+=" "+f);for(let u=s;u<this.markers.length;u++)if(this.markers[u].compare(l)){a=u,c=!0;break}}else a=this.markers.length;for(;s<a;){let f=this.markers[s++];if(f.toDOM){f.destroy(i);let u=i.nextSibling;i.remove(),i=u}}if(!l)break;l.toDOM&&(c?i=i.nextSibling:this.dom.insertBefore(l.toDOM(e),i)),c&&s++}this.dom.className=n,this.markers=t}destroy(){this.setMarkers(null,[])}};function fT(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(!r[t].compare(e[t]))return!1;return!0}var uT=Z.define(),ps=Z.define({combine(r){return Kt(r,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let n=Object.assign({},e);for(let i in t){let o=n[i],s=t[i];n[i]=o?(a,l,c)=>o(a,l,c)||s(a,l,c):s}return n}})}}),Ga=class extends hr{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}};function $d(r,e){return r.state.facet(ps).formatNumber(e,r.state)}var hT=Ka.compute([ps],r=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(uT)},lineMarker(e,t,n){return n.some(i=>i.toDOM)?null:new Ga($d(e,e.state.doc.lineAt(t.from).number))},lineMarkerChange:e=>e.startState.facet(ps)!=e.state.facet(ps),initialSpacer(e){return new Ga($d(e,_b(e.state.doc.lines)))},updateSpacer(e,t){let n=$d(t.view,_b(t.view.state.doc.lines));return n==e.number?e:new Ga(n)},domEventHandlers:r.facet(ps).domEventHandlers}));function S_(r={}){return[ps.of(r),w_(),hT]}function _b(r){let e=9;for(;e<r;)e=e*10+9;return e}var dT=new class extends hr{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},pT=cf.compute(["selection"],r=>{let e=[],t=-1;for(let n of r.selection.ranges)if(n.empty){let i=r.doc.lineAt(n.head).from;i>t&&(t=i,e.push(dT.range(i)))}return ke.of(e)});function C_(){return pT}var mT=0,nl=class{constructor(e,t){this.from=e,this.to=t}},pe=class{constructor(e={}){this.id=mT++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Zt.match(e)),t=>{let n=e(t);return n===void 0?null:[this,n]}}};pe.closedBy=new pe({deserialize:r=>r.split(" ")});pe.openedBy=new pe({deserialize:r=>r.split(" ")});pe.group=new pe({deserialize:r=>r.split(" ")});pe.contextHash=new pe({perNode:!0});pe.lookAhead=new pe({perNode:!0});pe.mounted=new pe({perNode:!0});var gT=Object.create(null),Zt=class{constructor(e,t,n,i=0){this.name=e,this.props=t,this.id=n,this.flags=i}static define(e){let t=e.props&&e.props.length?Object.create(null):gT,n=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),i=new Zt(e.name||"",t,e.id,n);if(e.props){for(let o of e.props)if(Array.isArray(o)||(o=o(i)),o){if(o[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[o[0].id]=o[1]}}return i}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(pe.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let n in e)for(let i of n.split(" "))t[i]=e[n];return n=>{for(let i=n.prop(pe.group),o=-1;o<(i?i.length:0);o++){let s=t[o<0?n.name:i[o]];if(s)return s}}}};Zt.none=new Zt("",Object.create(null),0,8);var Ef=new WeakMap,A_=new WeakMap,Ct;(function(r){r[r.ExcludeBuffers=1]="ExcludeBuffers",r[r.IncludeAnonymous=2]="IncludeAnonymous",r[r.IgnoreMounts=4]="IgnoreMounts",r[r.IgnoreOverlays=8]="IgnoreOverlays"})(Ct||(Ct={}));var ut=class{constructor(e,t,n,i,o){if(this.type=e,this.children=t,this.positions=n,this.length=i,this.props=null,o&&o.length){this.props=Object.create(null);for(let[s,a]of o)this.props[typeof s=="number"?s:s.id]=a}}toString(){let e=this.prop(pe.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let n of this.children){let i=n.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new ks(this.topNode,e)}cursorAt(e,t=0,n=0){let i=Ef.get(this)||this.topNode,o=new ks(i);return o.moveTo(e,t),Ef.set(this,o._tree),o}get topNode(){return new Qr(this,0,0,null)}resolve(e,t=0){let n=vs(Ef.get(this)||this.topNode,e,t,!1);return Ef.set(this,n),n}resolveInner(e,t=0){let n=vs(A_.get(this)||this.topNode,e,t,!0);return A_.set(this,n),n}iterate(e){let{enter:t,leave:n,from:i=0,to:o=this.length}=e;for(let s=this.cursor((e.mode||0)|Ct.IncludeAnonymous);;){let a=!1;if(s.from<=o&&s.to>=i&&(s.type.isAnonymous||t(s)!==!1)){if(s.firstChild())continue;a=!0}for(;a&&n&&!s.type.isAnonymous&&n(s),!s.nextSibling();){if(!s.parent())return;a=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Dp(Zt.none,this.children,this.positions,0,this.children.length,0,this.length,(t,n,i)=>new ut(this.type,t,n,i,this.propValues),e.makeTree||((t,n,i)=>new ut(Zt.none,t,n,i)))}static build(e){return yT(e)}};ut.empty=new ut(Zt.none,[],[],0);var il=class{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new il(this.buffer,this.index)}},Wn=class{constructor(e,t,n){this.buffer=e,this.length=t,this.set=n}get type(){return Zt.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],n=this.buffer[e+3],i=this.set.types[t],o=i.name;if(/\W/.test(o)&&!i.isError&&(o=JSON.stringify(o)),e+=4,n==e)return o;let s=[];for(;e<n;)s.push(this.childString(e)),e=this.buffer[e+3];return o+"("+s.join(",")+")"}findChild(e,t,n,i,o){let{buffer:s}=this,a=-1;for(let l=e;l!=t&&!(O_(o,i,s[l+1],s[l+2])&&(a=l,n>0));l=s[l+3]);return a}slice(e,t,n,i){let o=this.buffer,s=new Uint16Array(t-e);for(let a=e,l=0;a<t;)s[l++]=o[a++],s[l++]=o[a++]-n,s[l++]=o[a++]-n,s[l++]=o[a++]-e;return new Wn(s,i-n,this.set)}};function O_(r,e,t,n){switch(r){case-2:return t<e;case-1:return n>=e&&t<e;case 0:return t<e&&n>e;case 1:return t<=e&&n>e;case 2:return n>e;case 4:return!0}}function E_(r,e){let t=r.childBefore(e);for(;t;){let n=t.lastChild;if(!n||n.to!=t.to)break;n.type.isError&&n.from==n.to?(r=t,t=n.prevSibling):t=n}return r}function vs(r,e,t,n){for(var i;r.from==r.to||(t<1?r.from>=e:r.from>e)||(t>-1?r.to<=e:r.to<e);){let s=!n&&r instanceof Qr&&r.index<0?null:r.parent;if(!s)return r;r=s}let o=n?0:Ct.IgnoreOverlays;if(n)for(let s=r,a=s.parent;a;s=a,a=s.parent)s instanceof Qr&&s.index<0&&((i=a.enter(e,t,o))===null||i===void 0?void 0:i.from)!=s.from&&(r=a);for(;;){let s=r.enter(e,t,o);if(!s)return r;r=s}}var Qr=class{constructor(e,t,n,i){this._tree=e,this.from=t,this.index=n,this._parent=i}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,n,i,o=0){for(let s=this;;){for(let{children:a,positions:l}=s._tree,c=t>0?a.length:-1;e!=c;e+=t){let f=a[e],u=l[e]+s.from;if(!!O_(i,n,u,u+f.length)){if(f instanceof Wn){if(o&Ct.ExcludeBuffers)continue;let h=f.findChild(0,f.buffer.length,t,n-u,i);if(h>-1)return new _n(new Ep(s,f,e,u),null,h)}else if(o&Ct.IncludeAnonymous||!f.type.isAnonymous||Mp(f)){let h;if(!(o&Ct.IgnoreMounts)&&f.props&&(h=f.prop(pe.mounted))&&!h.overlay)return new Qr(h.tree,u,e,s);let d=new Qr(f,u,e,s);return o&Ct.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(t<0?f.children.length-1:0,t,n,i)}}}if(o&Ct.IncludeAnonymous||!s.type.isAnonymous||(s.index>=0?e=s.index+t:e=t<0?-1:s._parent._tree.children.length,s=s._parent,!s))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,n=0){let i;if(!(n&Ct.IgnoreOverlays)&&(i=this._tree.prop(pe.mounted))&&i.overlay){let o=e-this.from;for(let{from:s,to:a}of i.overlay)if((t>0?s<=o:s<o)&&(t<0?a>=o:a>o))return new Qr(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,n)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new ks(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,t=0){return vs(this,e,t,!1)}resolveInner(e,t=0){return vs(this,e,t,!0)}enterUnfinishedNodesBefore(e){return E_(this,e)}getChild(e,t=null,n=null){let i=Mf(this,e,t,n);return i.length?i[0]:null}getChildren(e,t=null,n=null){return Mf(this,e,t,n)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return Df(this,e)}};function Mf(r,e,t,n){let i=r.cursor(),o=[];if(!i.firstChild())return o;if(t!=null){for(;!i.type.is(t);)if(!i.nextSibling())return o}for(;;){if(n!=null&&i.type.is(n))return o;if(i.type.is(e)&&o.push(i.node),!i.nextSibling())return n==null?o:[]}}function Df(r,e,t=e.length-1){for(let n=r.parent;t>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(e[t]&&e[t]!=n.name)return!1;t--}}return!0}var Ep=class{constructor(e,t,n,i){this.parent=e,this.buffer=t,this.index=n,this.start=i}},_n=class{constructor(e,t,n){this.context=e,this._parent=t,this.index=n,this.type=e.buffer.set.types[e.buffer.buffer[n]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,n){let{buffer:i}=this.context,o=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.context.start,n);return o<0?null:new _n(this.context,this,o)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,n=0){if(n&Ct.ExcludeBuffers)return null;let{buffer:i}=this.context,o=i.findChild(this.index+4,i.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return o<0?null:new _n(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new _n(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new _n(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}cursor(e=0){return new ks(this,e)}get tree(){return null}toTree(){let e=[],t=[],{buffer:n}=this.context,i=this.index+4,o=n.buffer[this.index+3];if(o>i){let s=n.buffer[this.index+1],a=n.buffer[this.index+2];e.push(n.slice(i,o,s,a)),t.push(0)}return new ut(this.type,e,t,this.to-this.from)}resolve(e,t=0){return vs(this,e,t,!1)}resolveInner(e,t=0){return vs(this,e,t,!0)}enterUnfinishedNodesBefore(e){return E_(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,n=null){let i=Mf(this,e,t,n);return i.length?i[0]:null}getChildren(e,t=null,n=null){return Mf(this,e,t,n)}get node(){return this}matchContext(e){return Df(this,e)}},ks=class{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Qr)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let n=e._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:n,buffer:i}=this.buffer;return this.type=t||i.set.types[i.buffer[e]],this.from=n+i.buffer[e+1],this.to=n+i.buffer[e+2],!0}yield(e){return e?e instanceof Qr?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,n){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,n,this.mode));let{buffer:i}=this.buffer,o=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.buffer.start,n);return o<0?!1:(this.stack.push(this.index),this.yieldBuf(o))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,n=this.mode){return this.buffer?n&Ct.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,n))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Ct.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Ct.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,n=this.stack.length-1;if(e<0){let i=n<0?0:this.stack[n]+4;if(this.index!=i)return this.yieldBuf(t.findChild(i,this.index,-1,0,4))}else{let i=t.buffer[this.index+3];if(i<(n<0?t.buffer.length:t.buffer[this.stack[n]+3]))return this.yieldBuf(i)}return n<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,n,{buffer:i}=this;if(i){if(e>0){if(this.index<i.buffer.buffer.length)return!1}else for(let o=0;o<this.index;o++)if(i.buffer.buffer[o+3]<this.index)return!1;({index:t,parent:n}=i)}else({index:t,_parent:n}=this._tree);for(;n;{index:t,_parent:n}=n)if(t>-1)for(let o=t+e,s=e<0?-1:n._tree.children.length;o!=s;o+=e){let a=n._tree.children[o];if(this.mode&Ct.IncludeAnonymous||a instanceof Wn||!a.type.isAnonymous||Mp(a))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,n=0;if(e&&e.context==this.buffer){e:for(let i=this.index,o=this.stack.length;o>=0;){for(let s=e;s;s=s._parent)if(s.index==i){if(i==this.index)return s;t=s,n=o+1;break e}i=this.stack[--o]}}for(let i=n;i<this.stack.length;i++)t=new _n(this.buffer,t,this.stack[i]);return this.bufferNode=new _n(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let n=0;;){let i=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){n++;continue}this.type.isAnonymous||(i=!0)}for(;i&&t&&t(this),i=this.type.isAnonymous,!this.nextSibling();){if(!n)return;this.parent(),n--,i=!0}}}matchContext(e){if(!this.buffer)return Df(this.node,e);let{buffer:t}=this.buffer,{types:n}=t.set;for(let i=e.length-1,o=this.stack.length-1;i>=0;o--){if(o<0)return Df(this.node,e,i);let s=n[t.buffer[this.stack[o]]];if(!s.isAnonymous){if(e[i]&&e[i]!=s.name)return!1;i--}}return!0}};function Mp(r){return r.children.some(e=>e instanceof Wn||!e.type.isAnonymous||Mp(e))}function yT(r){var e;let{buffer:t,nodeSet:n,maxBufferLength:i=1024,reused:o=[],minRepeatType:s=n.types.length}=r,a=Array.isArray(t)?new il(t,t.length):t,l=n.types,c=0,f=0;function u(x,D,j,A,L){let{id:z,start:$,end:K,size:Te}=a,ze=f;for(;Te<0;)if(a.next(),Te==-1){let wt=o[z];j.push(wt),A.push($-x);return}else if(Te==-3){c=z;return}else if(Te==-4){f=z;return}else throw new RangeError(`Unrecognized record size: ${Te}`);let Dt=l[z],st,rt,Nt=$-x;if(K-$<=i&&(rt=y(a.pos-D,L))){let wt=new Uint16Array(rt.size-rt.skip),Zr=a.pos-rt.size,$n=wt.length;for(;a.pos>Zr;)$n=g(rt.start,wt,$n);st=new Wn(wt,K-rt.start,n),Nt=rt.start-x}else{let wt=a.pos-Te;a.next();let Zr=[],$n=[],oo=z>=s?z:-1,is=0,Fc=K;for(;a.pos>wt;)oo>=0&&a.id==oo&&a.size>=0?(a.end<=Fc-i&&(d(Zr,$n,$,is,a.end,Fc,oo,ze),is=Zr.length,Fc=a.end),a.next()):u($,wt,Zr,$n,oo);if(oo>=0&&is>0&&is<Zr.length&&d(Zr,$n,$,is,$,Fc,oo,ze),Zr.reverse(),$n.reverse(),oo>-1&&is>0){let n0=h(Dt);st=Dp(Dt,Zr,$n,0,Zr.length,0,K-$,n0,n0)}else st=m(Dt,Zr,$n,K-$,ze-K)}j.push(st),A.push(Nt)}function h(x){return(D,j,A)=>{let L=0,z=D.length-1,$,K;if(z>=0&&($=D[z])instanceof ut){if(!z&&$.type==x&&$.length==A)return $;(K=$.prop(pe.lookAhead))&&(L=j[z]+$.length+K)}return m(x,D,j,A,L)}}function d(x,D,j,A,L,z,$,K){let Te=[],ze=[];for(;x.length>A;)Te.push(x.pop()),ze.push(D.pop()+j-L);x.push(m(n.types[$],Te,ze,z-L,K-z)),D.push(L-j)}function m(x,D,j,A,L=0,z){if(c){let $=[pe.contextHash,c];z=z?[$].concat(z):[$]}if(L>25){let $=[pe.lookAhead,L];z=z?[$].concat(z):[$]}return new ut(x,D,j,A,z)}function y(x,D){let j=a.fork(),A=0,L=0,z=0,$=j.end-i,K={size:0,start:0,skip:0};e:for(let Te=j.pos-x;j.pos>Te;){let ze=j.size;if(j.id==D&&ze>=0){K.size=A,K.start=L,K.skip=z,z+=4,A+=4,j.next();continue}let Dt=j.pos-ze;if(ze<0||Dt<Te||j.start<$)break;let st=j.id>=s?4:0,rt=j.start;for(j.next();j.pos>Dt;){if(j.size<0)if(j.size==-3)st+=4;else break e;else j.id>=s&&(st+=4);j.next()}L=rt,A+=ze,z+=st}return(D<0||A==x)&&(K.size=A,K.start=L,K.skip=z),K.size>4?K:void 0}function g(x,D,j){let{id:A,start:L,end:z,size:$}=a;if(a.next(),$>=0&&A<s){let K=j;if($>4){let Te=a.pos-($-4);for(;a.pos>Te;)j=g(x,D,j)}D[--j]=K,D[--j]=z-x,D[--j]=L-x,D[--j]=A}else $==-3?c=A:$==-4&&(f=A);return j}let v=[],T=[];for(;a.pos>0;)u(r.start||0,r.bufferStart||0,v,T,-1);let M=(e=r.length)!==null&&e!==void 0?e:v.length?T[0]+v[0].length:0;return new ut(l[r.topID],v.reverse(),T.reverse(),M)}var T_=new WeakMap;function Rf(r,e){if(!r.isAnonymous||e instanceof Wn||e.type!=r)return 1;let t=T_.get(e);if(t==null){t=1;for(let n of e.children){if(n.type!=r||!(n instanceof ut)){t=1;break}t+=Rf(r,n)}T_.set(e,t)}return t}function Dp(r,e,t,n,i,o,s,a,l){let c=0;for(let m=n;m<i;m++)c+=Rf(r,e[m]);let f=Math.ceil(c*1.5/8),u=[],h=[];function d(m,y,g,v,T){for(let M=g;M<v;){let x=M,D=y[M],j=Rf(r,m[M]);for(M++;M<v;M++){let A=Rf(r,m[M]);if(j+A>=f)break;j+=A}if(M==x+1){if(j>f){let A=m[x];d(A.children,A.positions,0,A.children.length,y[x]+T);continue}u.push(m[x])}else{let A=y[M-1]+m[M-1].length-D;u.push(Dp(r,m,y,x,M,D,A,null,l))}h.push(D+T-o)}}return d(e,t,n,i,0),(a||l)(u,h,s)}var vn=class{constructor(e,t,n,i,o=!1,s=!1){this.from=e,this.to=t,this.tree=n,this.offset=i,this.open=(o?1:0)|(s?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],n=!1){let i=[new vn(0,e.length,e,0,!1,n)];for(let o of t)o.to>e.length&&i.push(o);return i}static applyChanges(e,t,n=128){if(!t.length)return e;let i=[],o=1,s=e.length?e[0]:null;for(let a=0,l=0,c=0;;a++){let f=a<t.length?t[a]:null,u=f?f.fromA:1e9;if(u-l>=n)for(;s&&s.from<u;){let h=s;if(l>=h.from||u<=h.to||c){let d=Math.max(h.from,l)-c,m=Math.min(h.to,u)-c;h=d>=m?null:new vn(d,m,h.tree,h.offset+c,a>0,!!f)}if(h&&i.push(h),s.to>u)break;s=o<e.length?e[o++]:null}if(!f)break;l=f.toA,c=f.toA-f.toB}return i}},Nf=class{startParse(e,t,n){return typeof e=="string"&&(e=new Rp(e)),n=n?n.length?n.map(i=>new nl(i.from,i.to)):[new nl(0,0)]:[new nl(0,e.length)],this.createParse(e,t||[],n)}parse(e,t,n){let i=this.startParse(e,t,n);for(;;){let o=i.advance();if(o)return o}}},Rp=class{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}};var DB=new pe({perNode:!0});var bT=0,Er=class{constructor(e,t,n){this.set=e,this.base=t,this.modified=n,this.id=bT++}static define(e){if(e?.base)throw new Error("Can not derive from a modified tag");let t=new Er([],null,[]);if(t.set.push(t),e)for(let n of e.set)t.set.push(n);return t}static defineModifier(){let e=new ws;return t=>t.modified.indexOf(e)>-1?t:ws.get(t.base||t,t.modified.concat(e).sort((n,i)=>n.id-i.id))}},_T=0,ws=class{constructor(){this.instances=[],this.id=_T++}static get(e,t){if(!t.length)return e;let n=t[0].instances.find(a=>a.base==e&&vT(t,a.modified));if(n)return n;let i=[],o=new Er(i,e,t);for(let a of t)a.instances.push(o);let s=D_(t);for(let a of e.set)for(let l of s)i.push(ws.get(a,l));return o}};function vT(r,e){return r.length==e.length&&r.every((t,n)=>t==e[n])}function D_(r){let e=[r];for(let t=0;t<r.length;t++)for(let n of D_(r.slice(0,t).concat(r.slice(t+1))))e.push(n);return e}function N_(r){let e=Object.create(null);for(let t in r){let n=r[t];Array.isArray(n)||(n=[n]);for(let i of t.split(" "))if(i){let o=[],s=2,a=i;for(let u=0;;){if(a=="..."&&u>0&&u+3==i.length){s=1;break}let h=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!h)throw new RangeError("Invalid path: "+i);if(o.push(h[0]=="*"?"":h[0][0]=='"'?JSON.parse(h[0]):h[0]),u+=h[0].length,u==i.length)break;let d=i[u++];if(u==i.length&&d=="!"){s=0;break}if(d!="/")throw new RangeError("Invalid path: "+i);a=i.slice(u)}let l=o.length-1,c=o[l];if(!c)throw new RangeError("Invalid path: "+i);let f=new Pp(n,s,l>0?o.slice(0,l):null);e[c]=f.sort(e[c])}}return P_.add(e)}var P_=new pe,Pp=class{constructor(e,t,n,i){this.tags=e,this.mode=t,this.context=n,this.next=i}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}};function Bp(r,e){let t=Object.create(null);for(let o of r)if(!Array.isArray(o.tag))t[o.tag.id]=o.class;else for(let s of o.tag)t[s.id]=o.class;let{scope:n,all:i=null}=e||{};return{style:o=>{let s=i;for(let a of o)for(let l of a.set){let c=t[l.id];if(c){s=s?s+" "+c:c;break}}return s},scope:n}}function kT(r,e){let t=null;for(let n of r){let i=n.style(e);i&&(t=t?t+" "+i:i)}return t}function L_(r,e,t,n=0,i=r.length){let o=new Lp(n,Array.isArray(e)?e:[e],t);o.highlightRange(r.cursor(),n,i,"",o.highlighters),o.flush(i)}var Lp=class{constructor(e,t,n){this.at=e,this.highlighters=t,this.span=n,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,n,i,o){let{type:s,from:a,to:l}=e;if(a>=n||l<=t)return;s.isTop&&(o=this.highlighters.filter(d=>!d.scope||d.scope(s)));let c=i,f=s.prop(P_),u=!1;for(;f;){if(!f.context||e.matchContext(f.context)){let d=kT(o,f.tags);d&&(c&&(c+=" "),c+=d,f.mode==1?i+=(i?" ":"")+d:f.mode==0&&(u=!0));break}f=f.next}if(this.startSpan(e.from,c),u)return;let h=e.tree&&e.tree.prop(pe.mounted);if(h&&h.overlay){let d=e.node.enter(h.overlay[0].from+a,1),m=this.highlighters.filter(g=>!g.scope||g.scope(h.tree.type)),y=e.firstChild();for(let g=0,v=a;;g++){let T=g<h.overlay.length?h.overlay[g]:null,M=T?T.from+a:l,x=Math.max(t,v),D=Math.min(n,M);if(x<D&&y)for(;e.from<D&&(this.highlightRange(e,x,D,i,o),this.startSpan(Math.min(n,e.to),c),!(e.to>=M||!e.nextSibling())););if(!T||M>n)break;v=T.to+a,v>t&&(this.highlightRange(d.cursor(),Math.max(t,T.from+a),Math.min(n,v),i,m),this.startSpan(v,c))}y&&e.parent()}else if(e.firstChild()){do if(!(e.to<=t)){if(e.from>=n)break;this.highlightRange(e,t,n,i,o),this.startSpan(Math.min(n,e.to),c)}while(e.nextSibling());e.parent()}}},F=Er.define,Pf=F(),di=F(),R_=F(di),M_=F(di),pi=F(),Lf=F(pi),Np=F(pi),xn=F(),go=F(xn),kn=F(),wn=F(),Ip=F(),ol=F(Ip),If=F(),H={comment:Pf,lineComment:F(Pf),blockComment:F(Pf),docComment:F(Pf),name:di,variableName:F(di),typeName:R_,tagName:F(R_),propertyName:M_,attributeName:F(M_),className:F(di),labelName:F(di),namespace:F(di),macroName:F(di),literal:pi,string:Lf,docString:F(Lf),character:F(Lf),attributeValue:F(Lf),number:Np,integer:F(Np),float:F(Np),bool:F(pi),regexp:F(pi),escape:F(pi),color:F(pi),url:F(pi),keyword:kn,self:F(kn),null:F(kn),atom:F(kn),unit:F(kn),modifier:F(kn),operatorKeyword:F(kn),controlKeyword:F(kn),definitionKeyword:F(kn),moduleKeyword:F(kn),operator:wn,derefOperator:F(wn),arithmeticOperator:F(wn),logicOperator:F(wn),bitwiseOperator:F(wn),compareOperator:F(wn),updateOperator:F(wn),definitionOperator:F(wn),typeOperator:F(wn),controlOperator:F(wn),punctuation:Ip,separator:F(Ip),bracket:ol,angleBracket:F(ol),squareBracket:F(ol),paren:F(ol),brace:F(ol),content:xn,heading:go,heading1:F(go),heading2:F(go),heading3:F(go),heading4:F(go),heading5:F(go),heading6:F(go),contentSeparator:F(xn),list:F(xn),quote:F(xn),emphasis:F(xn),strong:F(xn),link:F(xn),monospace:F(xn),strikethrough:F(xn),inserted:F(),deleted:F(),changed:F(),invalid:F(),meta:If,documentMeta:F(If),annotation:F(If),processingInstruction:F(If),definition:Er.defineModifier(),constant:Er.defineModifier(),function:Er.defineModifier(),standard:Er.defineModifier(),local:Er.defineModifier(),special:Er.defineModifier()},LB=Bp([{tag:H.link,class:"tok-link"},{tag:H.heading,class:"tok-heading"},{tag:H.emphasis,class:"tok-emphasis"},{tag:H.strong,class:"tok-strong"},{tag:H.keyword,class:"tok-keyword"},{tag:H.atom,class:"tok-atom"},{tag:H.bool,class:"tok-bool"},{tag:H.url,class:"tok-url"},{tag:H.labelName,class:"tok-labelName"},{tag:H.inserted,class:"tok-inserted"},{tag:H.deleted,class:"tok-deleted"},{tag:H.literal,class:"tok-literal"},{tag:H.string,class:"tok-string"},{tag:H.number,class:"tok-number"},{tag:[H.regexp,H.escape,H.special(H.string)],class:"tok-string2"},{tag:H.variableName,class:"tok-variableName"},{tag:H.local(H.variableName),class:"tok-variableName tok-local"},{tag:H.definition(H.variableName),class:"tok-variableName tok-definition"},{tag:H.special(H.variableName),class:"tok-variableName2"},{tag:H.definition(H.propertyName),class:"tok-propertyName tok-definition"},{tag:H.typeName,class:"tok-typeName"},{tag:H.namespace,class:"tok-namespace"},{tag:H.className,class:"tok-className"},{tag:H.macroName,class:"tok-macroName"},{tag:H.propertyName,class:"tok-propertyName"},{tag:H.operator,class:"tok-operator"},{tag:H.comment,class:"tok-comment"},{tag:H.meta,class:"tok-meta"},{tag:H.invalid,class:"tok-invalid"},{tag:H.punctuation,class:"tok-punctuation"}]);var zp,Bf=new pe;var Rr=class{constructor(e,t,n=[]){this.data=e,de.prototype.hasOwnProperty("tree")||Object.defineProperty(de.prototype,"tree",{get(){return gt(this)}}),this.parser=t,this.extension=[gi.of(this),de.languageData.of((i,o,s)=>i.facet(I_(i,o,s)))].concat(n)}isActiveAt(e,t,n=-1){return I_(e,t,n)==this.data}findRegions(e){let t=e.facet(gi);if(t?.data==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let n=[],i=(o,s)=>{if(o.prop(Bf)==this.data){n.push({from:s,to:s+o.length});return}let a=o.prop(pe.mounted);if(a){if(a.tree.prop(Bf)==this.data){if(a.overlay)for(let l of a.overlay)n.push({from:l.from+s,to:l.to+s});else n.push({from:s,to:s+o.length});return}else if(a.overlay){let l=n.length;if(i(a.tree,a.overlay[0].from+s),n.length>l)return}}for(let l=0;l<o.children.length;l++){let c=o.children[l];c instanceof ut&&i(c,o.positions[l]+s)}};return i(gt(e),0),n}get allowsNesting(){return!0}};Rr.setState=ae.define();function I_(r,e,t){let n=r.facet(gi);if(!n)return null;let i=n.data;if(n.allowsNesting)for(let o=gt(r).topNode;o;o=o.enter(e,t,Ct.ExcludeBuffers))i=o.type.prop(Bf)||i;return i}function gt(r){let e=r.field(Rr.state,!1);return e?e.tree:ut.empty}var Vp=class{constructor(e,t=e.length){this.doc=e,this.length=t,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let n=this.cursorPos-this.string.length;return e<n||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-n,t-n)}},sl=null,xs=class{constructor(e,t,n=[],i,o,s,a,l){this.parser=e,this.state=t,this.fragments=n,this.tree=i,this.treeLen=o,this.viewport=s,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,t,n){return new xs(e,t,[],ut.empty,0,n,[],null)}startParse(){return this.parser.startParse(new Vp(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=ut.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof e=="number"){let i=Date.now()+e;e=()=>Date.now()>i}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let i=this.parse.advance();if(i)if(this.fragments=this.withoutTempSkipped(vn.addTree(i,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=i,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(vn.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=sl;sl=this;try{return e()}finally{sl=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=B_(e,t.from,t.to);return e}changes(e,t){let{fragments:n,tree:i,treeLen:o,viewport:s,skipped:a}=this;if(this.takeTree(),!e.empty){let l=[];if(e.iterChangedRanges((c,f,u,h)=>l.push({fromA:c,toA:f,fromB:u,toB:h})),n=vn.applyChanges(n,l),i=ut.empty,o=0,s={from:e.mapPos(s.from,-1),to:e.mapPos(s.to,1)},this.skipped.length){a=[];for(let c of this.skipped){let f=e.mapPos(c.from,1),u=e.mapPos(c.to,-1);f<u&&a.push({from:f,to:u})}}}return new xs(this.parser,t,n,i,o,s,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:i,to:o}=this.skipped[n];i<e.to&&o>e.from&&(this.fragments=B_(this.fragments,i,o),this.skipped.splice(n--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Nf{createParse(t,n,i){let o=i[0].from,s=i[i.length-1].to;return{parsedPos:o,advance(){let l=sl;if(l){for(let c of i)l.tempSkipped.push(c);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=s,new ut(Zt.none,[],[],s-o)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return sl}};function B_(r,e,t){return vn.applyChanges(r,[{fromA:e,toA:t,fromB:e,toB:t}])}var mi=class{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),n=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,n)||t.takeTree(),new mi(t)}static init(e){let t=Math.min(3e3,e.doc.length),n=xs.create(e.facet(gi).parser,e,{from:0,to:t});return n.work(20,t)||n.takeTree(),new mi(n)}};Rr.state=Ee.define({create:mi.init,update(r,e){for(let t of e.effects)if(t.is(Rr.setState))return t.value;return e.startState.facet(gi)!=e.state.facet(gi)?mi.init(e.state):r.apply(e)}});var $_=r=>{let e=setTimeout(()=>r(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&($_=r=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(r,{timeout:500-100})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});var jp=typeof navigator<"u"&&((zp=navigator.scheduling)===null||zp===void 0?void 0:zp.isInputPending)?()=>navigator.scheduling.isInputPending():null,wT=Pe.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Rr.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Rr.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=$_(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:i}}=this.view,o=n.field(Rr.state);if(o.tree==o.context.tree&&o.context.isDone(i+1e5))return;let s=Date.now()+Math.min(this.chunkBudget,100,e&&!jp?Math.max(25,e.timeRemaining()-5):1e9),a=o.context.treeLen<i&&n.doc.length>i+1e3,l=o.context.work(()=>jp&&jp()||Date.now()>s,i+(a?0:1e5));this.chunkBudget-=Date.now()-t,(l||this.chunkBudget<=0)&&(o.context.takeTree(),this.view.dispatch({effects:Rr.setState.of(new mi(o.context))})),this.chunkBudget>0&&!(l&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(o.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>Pt(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),gi=Z.define({combine(r){return r.length?r[0]:null},enables:[Rr.state,wT]});var xT=Z.define(),cl=Z.define({combine:r=>{if(!r.length)return"  ";if(!/^(?: +|\t+)$/.test(r[0]))throw new Error("Invalid indent unit: "+JSON.stringify(r[0]));return r[0]}});function fl(r){let e=r.facet(cl);return e.charCodeAt(0)==9?r.tabSize*e.length:e.length}function Cs(r,e){let t="",n=r.tabSize;if(r.facet(cl).charCodeAt(0)==9)for(;e>=n;)t+="	",e-=n;for(let i=0;i<e;i++)t+=" ";return t}function $f(r,e){r instanceof de&&(r=new yo(r));for(let n of r.state.facet(xT)){let i=n(r,e);if(i!=null)return i}let t=gt(r.state);return t?CT(r,t,e):null}var yo=class{constructor(e,t={}){this.state=e,this.options=t,this.unit=fl(e)}lineAt(e,t=1){let n=this.state.doc.lineAt(e),{simulateBreak:i,simulateDoubleBreak:o}=this.options;return i!=null&&i>=n.from&&i<=n.to?o&&i==e?{text:"",from:e}:(t<0?i<e:i<=e)?{text:n.text.slice(i-n.from),from:i}:{text:n.text.slice(0,i-n.from),from:n.from}:n}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:n,from:i}=this.lineAt(e,t);return n.slice(e-i,Math.min(n.length,e+100-i))}column(e,t=1){let{text:n,from:i}=this.lineAt(e,t),o=this.countColumn(n,e-i),s=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return s>-1&&(o+=s-this.countColumn(n,n.search(/\S|$/))),o}countColumn(e,t=e.length){return li(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:n,from:i}=this.lineAt(e,t),o=this.options.overrideIndentation;if(o){let s=o(i);if(s>-1)return s}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}},ST=new pe;function CT(r,e,t){return F_(e.resolveInner(t).enterUnfinishedNodesBefore(t),t,r)}function AT(r){return r.pos==r.options.simulateBreak&&r.options.simulateDoubleBreak}function TT(r){let e=r.type.prop(ST);if(e)return e;let t=r.firstChild,n;if(t&&(n=t.type.prop(pe.closedBy))){let i=r.lastChild,o=i&&n.indexOf(i.name)>-1;return s=>MT(s,!0,1,void 0,o&&!AT(s)?i.from:void 0)}return r.parent==null?OT:null}function F_(r,e,t){for(;r;r=r.parent){let n=TT(r);if(n)return n(ll.create(t,e,r))}return null}function OT(){return 0}var ll=class extends yo{constructor(e,t,n){super(e.state,e.options),this.base=e,this.pos=t,this.node=n}static create(e,t,n){return new ll(e,t,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let t=this.node.resolve(e.from);for(;t.parent&&t.parent.from==t.from;)t=t.parent;if(ET(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?F_(e,this.pos,this.base):0}};function ET(r,e){for(let t=e;t;t=t.parent)if(r==t)return!0;return!1}function RT(r){let e=r.node,t=e.childAfter(e.from),n=e.lastChild;if(!t)return null;let i=r.options.simulateBreak,o=r.state.doc.lineAt(t.from),s=i==null||i<=o.from?o.to:Math.min(o.to,i);for(let a=t.to;;){let l=e.childAfter(a);if(!l||l==n)return null;if(!l.type.isSkipped)return l.from<s?t:null;a=l.to}}function MT(r,e,t,n,i){let o=r.textAfter,s=o.match(/^\s*/)[0].length,a=n&&o.slice(s,s+n.length)==n||i==r.pos+s,l=e?RT(r):null;return l?a?r.column(l.from):r.column(l.to):r.baseIndent+(a?0:r.unit*t)}var DT=200;function V_(){return de.transactionFilter.of(r=>{if(!r.docChanged||!r.isUserEvent("input.type")&&!r.isUserEvent("input.complete"))return r;let e=r.startState.languageDataAt("indentOnInput",r.startState.selection.main.head);if(!e.length)return r;let t=r.newDoc,{head:n}=r.newSelection.main,i=t.lineAt(n);if(n>i.from+DT)return r;let o=t.sliceString(i.from,n);if(!e.some(c=>c.test(o)))return r;let{state:s}=r,a=-1,l=[];for(let{head:c}of s.selection.ranges){let f=s.doc.lineAt(c);if(f.from==a)continue;a=f.from;let u=$f(s,f.from);if(u==null)continue;let h=/^\s*/.exec(f.text)[0],d=Cs(s,u);h!=d&&l.push({from:f.from,to:f.from+h.length,insert:d})}return l.length?[r,{changes:l,sequential:!0}]:r})}var NT=Z.define(),PT=new pe;function LT(r,e,t){let n=gt(r);if(n.length<t)return null;let i=n.resolveInner(t),o=null;for(let s=i;s;s=s.parent){if(s.to<=t||s.from>t)continue;if(o&&s.from<e)break;let a=s.type.prop(PT);if(a&&(s.to<n.length-50||n.length==r.doc.length||!IT(s))){let l=a(s,r);l&&l.from<=t&&l.from>=e&&l.to>t&&(o=l)}}return o}function IT(r){let e=r.lastChild;return e&&e.to==r.to&&e.type.isError}function zf(r,e,t){for(let n of r.facet(NT)){let i=n(r,e,t);if(i)return i}return LT(r,e,t)}function U_(r,e){let t=e.mapPos(r.from,1),n=e.mapPos(r.to,-1);return t>=n?void 0:{from:t,to:n}}var Ff=ae.define({map:U_}),ul=ae.define({map:U_});function H_(r){let e=[];for(let{head:t}of r.state.selection.ranges)e.some(n=>n.from<=t&&n.to>=t)||e.push(r.lineBlockAt(t));return e}var bo=Ee.define({create(){return Y.none},update(r,e){r=r.map(e.changes);for(let t of e.effects)t.is(Ff)&&!BT(r,t.value.from,t.value.to)?r=r.update({add:[UT.range(t.value.from,t.value.to)]}):t.is(ul)&&(r=r.update({filter:(n,i)=>t.value.from!=n||t.value.to!=i,filterFrom:t.value.from,filterTo:t.value.to}));if(e.selection){let t=!1,{head:n}=e.selection.main;r.between(n,n,(i,o)=>{i<n&&o>n&&(t=!0)}),t&&(r=r.update({filterFrom:n,filterTo:n,filter:(i,o)=>o<=n||i>=n}))}return r},provide:r=>G.decorations.from(r)});function jf(r,e,t){var n;let i=null;return(n=r.field(bo,!1))===null||n===void 0||n.between(e,t,(o,s)=>{(!i||i.from>o)&&(i={from:o,to:s})}),i}function BT(r,e,t){let n=!1;return r.between(e,e,(i,o)=>{i==e&&o==t&&(n=!0)}),n}function W_(r,e){return r.field(bo,!1)?e:e.concat(ae.appendConfig.of(Z_()))}var zT=r=>{for(let e of H_(r)){let t=zf(r.state,e.from,e.to);if(t)return r.dispatch({effects:W_(r.state,[Ff.of(t),q_(r,t)])}),!0}return!1},jT=r=>{if(!r.state.field(bo,!1))return!1;let e=[];for(let t of H_(r)){let n=jf(r.state,t.from,t.to);n&&e.push(ul.of(n),q_(r,n,!1))}return e.length&&r.dispatch({effects:e}),e.length>0};function q_(r,e,t=!0){let n=r.state.doc.lineAt(e.from).number,i=r.state.doc.lineAt(e.to).number;return G.announce.of(`${r.state.phrase(t?"Folded lines":"Unfolded lines")} ${n} ${r.state.phrase("to")} ${i}.`)}var $T=r=>{let{state:e}=r,t=[];for(let n=0;n<e.doc.length;){let i=r.lineBlockAt(n),o=zf(e,i.from,i.to);o&&t.push(Ff.of(o)),n=(o?r.lineBlockAt(o.to):i).to+1}return t.length&&r.dispatch({effects:W_(r.state,t)}),!!t.length},FT=r=>{let e=r.state.field(bo,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,r.state.doc.length,(n,i)=>{t.push(ul.of({from:n,to:i}))}),r.dispatch({effects:t}),!0},K_=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:zT},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:jT},{key:"Ctrl-Alt-[",run:$T},{key:"Ctrl-Alt-]",run:FT}],VT={placeholderDOM:null,placeholderText:"\u2026"},G_=Z.define({combine(r){return Kt(r,VT)}});function Z_(r){let e=[bo,WT];return r&&e.push(G_.of(r)),e}var UT=Y.replace({widget:new class extends ur{toDOM(r){let{state:e}=r,t=e.facet(G_),n=o=>{let s=r.lineBlockAt(r.posAtDOM(o.target)),a=jf(r.state,s.from,s.to);a&&r.dispatch({effects:ul.of(a)}),o.preventDefault()};if(t.placeholderDOM)return t.placeholderDOM(r,n);let i=document.createElement("span");return i.textContent=t.placeholderText,i.setAttribute("aria-label",e.phrase("folded code")),i.title=e.phrase("unfold"),i.className="cm-foldPlaceholder",i.onclick=n,i}}}),HT={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{}},al=class extends hr{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}};function J_(r={}){let e=Object.assign(Object.assign({},HT),r),t=new al(e,!0),n=new al(e,!1),i=Pe.fromClass(class{constructor(s){this.from=s.viewport.from,this.markers=this.buildMarkers(s)}update(s){(s.docChanged||s.viewportChanged||s.startState.facet(gi)!=s.state.facet(gi)||s.startState.field(bo,!1)!=s.state.field(bo,!1)||gt(s.startState)!=gt(s.state))&&(this.markers=this.buildMarkers(s.view))}buildMarkers(s){let a=new cr;for(let l of s.viewportLineBlocks){let c=jf(s.state,l.from,l.to)?n:zf(s.state,l.from,l.to)?t:null;c&&a.add(l.from,l.from,c)}return a.finish()}}),{domEventHandlers:o}=e;return[i,Op({class:"cm-foldGutter",markers(s){var a;return((a=s.plugin(i))===null||a===void 0?void 0:a.markers)||ke.empty},initialSpacer(){return new al(e,!1)},domEventHandlers:Object.assign(Object.assign({},o),{click:(s,a,l)=>{if(o.click&&o.click(s,a,l))return!0;let c=jf(s.state,a.from,a.to);if(c)return s.dispatch({effects:ul.of(c)}),!0;let f=zf(s.state,a.from,a.to);return f?(s.dispatch({effects:Ff.of(f)}),!0):!1}})}),Z_()]}var WT=G.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}}),Ss=class{constructor(e,t){let n;function i(a){let l=Tr.newName();return(n||(n=Object.create(null)))["."+l]=a,l}let o=typeof t.all=="string"?t.all:t.all?i(t.all):void 0,s=t.scope;this.scope=s instanceof Rr?a=>a.prop(Bf)==s.data:s?a=>a==s:void 0,this.style=Bp(e.map(a=>({tag:a.tag,class:a.class||i(Object.assign({},a,{tag:null}))})),{all:o}).style,this.module=n?new Tr(n):null,this.themeType=t.themeType}static define(e,t){return new Ss(e,t||{})}},Up=Z.define(),Y_=Z.define({combine(r){return r.length?[r[0]]:null}});function $p(r){let e=r.facet(Up);return e.length?e:r.facet(Y_)}function X_(r,e){let t=[qT],n;return r instanceof Ss&&(r.module&&t.push(G.styleModule.of(r.module)),n=r.themeType),e?.fallback?t.push(Y_.of(r)):n?t.push(Up.computeN([G.darkTheme],i=>i.facet(G.darkTheme)==(n=="dark")?[r]:[])):t.push(Up.of(r)),t}var Hp=class{constructor(e){this.markCache=Object.create(null),this.tree=gt(e.state),this.decorations=this.buildDeco(e,$p(e.state))}update(e){let t=gt(e.state),n=$p(e.state),i=n!=$p(e.startState);t.length<e.view.viewport.to&&!i&&t.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(t!=this.tree||e.viewportChanged||i)&&(this.tree=t,this.decorations=this.buildDeco(e.view,n))}buildDeco(e,t){if(!t||!this.tree.length)return Y.none;let n=new cr;for(let{from:i,to:o}of e.visibleRanges)L_(this.tree,t,(s,a,l)=>{n.add(s,a,this.markCache[l]||(this.markCache[l]=Y.mark({class:l})))},i,o);return n.finish()}},qT=Fn.high(Pe.fromClass(Hp,{decorations:r=>r.decorations})),Q_=Ss.define([{tag:H.meta,color:"#7a757a"},{tag:H.link,textDecoration:"underline"},{tag:H.heading,textDecoration:"underline",fontWeight:"bold"},{tag:H.emphasis,fontStyle:"italic"},{tag:H.strong,fontWeight:"bold"},{tag:H.strikethrough,textDecoration:"line-through"},{tag:H.keyword,color:"#708"},{tag:[H.atom,H.bool,H.url,H.contentSeparator,H.labelName],color:"#219"},{tag:[H.literal,H.inserted],color:"#164"},{tag:[H.string,H.deleted],color:"#a11"},{tag:[H.regexp,H.escape,H.special(H.string)],color:"#e40"},{tag:H.definition(H.variableName),color:"#00f"},{tag:H.local(H.variableName),color:"#30a"},{tag:[H.typeName,H.namespace],color:"#085"},{tag:H.className,color:"#167"},{tag:[H.special(H.variableName),H.macroName],color:"#256"},{tag:H.definition(H.propertyName),color:"#00c"},{tag:H.comment,color:"#940"},{tag:H.invalid,color:"#f00"}]),KT=G.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),e1=1e4,t1="()[]{}",r1=Z.define({combine(r){return Kt(r,{afterCursor:!0,brackets:t1,maxScanDistance:e1,renderMatch:JT})}}),GT=Y.mark({class:"cm-matchingBracket"}),ZT=Y.mark({class:"cm-nonmatchingBracket"});function JT(r){let e=[],t=r.matched?GT:ZT;return e.push(t.range(r.start.from,r.start.to)),r.end&&e.push(t.range(r.end.from,r.end.to)),e}var YT=Ee.define({create(){return Y.none},update(r,e){if(!e.docChanged&&!e.selection)return r;let t=[],n=e.state.facet(r1);for(let i of e.state.selection.ranges){if(!i.empty)continue;let o=en(e.state,i.head,-1,n)||i.head>0&&en(e.state,i.head-1,1,n)||n.afterCursor&&(en(e.state,i.head,1,n)||i.head<e.state.doc.length&&en(e.state,i.head+1,-1,n));o&&(t=t.concat(n.renderMatch(o,e.state)))}return Y.set(t,!0)},provide:r=>G.decorations.from(r)}),XT=[YT,KT];function n1(r={}){return[r1.of(r),XT]}function Wp(r,e,t){let n=r.prop(e<0?pe.openedBy:pe.closedBy);if(n)return n;if(r.name.length==1){let i=t.indexOf(r.name);if(i>-1&&i%2==(e<0?1:0))return[t[i+e]]}return null}function en(r,e,t,n={}){let i=n.maxScanDistance||e1,o=n.brackets||t1,s=gt(r),a=s.resolveInner(e,t);for(let l=a;l;l=l.parent){let c=Wp(l.type,t,o);if(c&&l.from<l.to)return QT(r,e,t,l,c,o)}return eO(r,e,t,s,a.type,i,o)}function QT(r,e,t,n,i,o){let s=n.parent,a={from:n.from,to:n.to},l=0,c=s?.cursor();if(c&&(t<0?c.childBefore(n.from):c.childAfter(n.to)))do if(t<0?c.to<=n.from:c.from>=n.to){if(l==0&&i.indexOf(c.type.name)>-1&&c.from<c.to)return{start:a,end:{from:c.from,to:c.to},matched:!0};if(Wp(c.type,t,o))l++;else if(Wp(c.type,-t,o)&&(l--,l==0))return{start:a,end:c.from==c.to?void 0:{from:c.from,to:c.to},matched:!1}}while(t<0?c.prevSibling():c.nextSibling());return{start:a,matched:!1}}function eO(r,e,t,n,i,o,s){let a=t<0?r.sliceDoc(e-1,e):r.sliceDoc(e,e+1),l=s.indexOf(a);if(l<0||l%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},f=r.doc.iterRange(e,t>0?r.doc.length:0),u=0;for(let h=0;!f.next().done&&h<=o;){let d=f.value;t<0&&(h+=d.length);let m=e+h*t;for(let y=t>0?0:d.length-1,g=t>0?d.length:-1;y!=g;y+=t){let v=s.indexOf(d[y]);if(!(v<0||n.resolve(m+y,1).type!=i))if(v%2==0==t>0)u++;else{if(u==1)return{start:c,end:{from:m+y,to:m+y+1},matched:v>>1==l>>1};u--}}t>0&&(h+=d.length)}return f.done?{start:c,matched:!1}:null}var tO=Object.create(null),z_=[Zt.none];var j_=[],rO=Object.create(null);for(let[r,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])rO[r]=nO(tO,e);function Fp(r,e){j_.indexOf(r)>-1||(j_.push(r),console.warn(e))}function nO(r,e){let t=null;for(let o of e.split(".")){let s=r[o]||H[o];s?typeof s=="function"?t?t=s(t):Fp(o,`Modifier ${o} used at start of tag`):t?Fp(o,`Tag ${o} used as modifier`):t=s:Fp(o,`Unknown highlighting tag ${o}`)}if(!t)return 0;let n=e.replace(/ /g,"_"),i=Zt.define({id:z_.length,name:n,props:[N_({[n]:t})]});return z_.push(i),i.id}var Uf=class{constructor(e,t,n){this.state=e,this.pos=t,this.explicit=n,this.abortListeners=[]}tokenBefore(e){let t=gt(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),n=Math.max(t.from,this.pos-250),i=t.text.slice(n-t.from,this.pos-t.from),o=i.search(u1(e,!1));return o<0?null:{from:n+o,to:this.pos,text:i.slice(o)}}get aborted(){return this.abortListeners==null}addEventListener(e,t){e=="abort"&&this.abortListeners&&this.abortListeners.push(t)}};function i1(r){let e=Object.keys(r).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function iO(r){let e=Object.create(null),t=Object.create(null);for(let{label:i}of r){e[i[0]]=!0;for(let o=1;o<i.length;o++)t[i[o]]=!0}let n=i1(e)+i1(t)+"*$";return[new RegExp("^"+n),new RegExp(n)]}function oO(r){let e=r.map(i=>typeof i=="string"?{label:i}:i),[t,n]=e.every(i=>/^\w+$/.test(i.label))?[/\w*$/,/\w+$/]:iO(e);return i=>{let o=i.matchBefore(n);return o||i.explicit?{from:o?o.from:i.pos,options:e,validFor:t}:null}}var Hf=class{constructor(e,t,n){this.completion=e,this.source=t,this.match=n}};function yi(r){return r.selection.main.head}function u1(r,e){var t;let{source:n}=r,i=e&&n[0]!="^",o=n[n.length-1]!="$";return!i&&!o?r:new RegExp(`${i?"^":""}(?:${n})${o?"$":""}`,(t=r.flags)!==null&&t!==void 0?t:r.ignoreCase?"i":"")}function sO(r,e,t,n){return r.changeByRange(i=>{if(i==r.selection.main)return{changes:{from:t,to:n,insert:e},range:N.cursor(t+e.length)};let o=n-t;return!i.empty||o&&r.sliceDoc(i.from-o,i.from)!=r.sliceDoc(t,n)?{range:i}:{changes:{from:i.from-o,to:i.from,insert:e},range:N.cursor(i.from-o+e.length)}})}function h1(r,e){let t=e.completion.apply||e.completion.label,n=e.source;typeof t=="string"?r.dispatch(sO(r.state,t,n.from,n.to)):t(r,e.completion,n.from,n.to)}var o1=new WeakMap;function aO(r){if(!Array.isArray(r))return r;let e=o1.get(r);return e||o1.set(r,e=oO(r)),e}var Kp=class{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let t=0;t<e.length;){let n=lt(e,t),i=er(n);this.chars.push(n);let o=e.slice(t,t+i),s=o.toUpperCase();this.folded.push(lt(s==o?o.toLowerCase():s,0)),t+=i}this.astral=e.length!=this.chars.length}match(e){if(this.pattern.length==0)return[0];if(e.length<this.pattern.length)return null;let{chars:t,folded:n,any:i,precise:o,byWord:s}=this;if(t.length==1){let T=lt(e,0);return T==t[0]?[0,0,er(T)]:T==n[0]?[-200,0,er(T)]:null}let a=e.indexOf(this.pattern);if(a==0)return[0,0,this.pattern.length];let l=t.length,c=0;if(a<0){for(let T=0,M=Math.min(e.length,200);T<M&&c<l;){let x=lt(e,T);(x==t[c]||x==n[c])&&(i[c++]=T),T+=er(x)}if(c<l)return null}let f=0,u=0,h=!1,d=0,m=-1,y=-1,g=/[a-z]/.test(e),v=!0;for(let T=0,M=Math.min(e.length,200),x=0;T<M&&u<l;){let D=lt(e,T);a<0&&(f<l&&D==t[f]&&(o[f++]=T),d<l&&(D==t[d]||D==n[d]?(d==0&&(m=T),y=T+1,d++):d=0));let j,A=D<255?D>=48&&D<=57||D>=97&&D<=122?2:D>=65&&D<=90?1:0:(j=za(D))!=j.toLowerCase()?1:j!=j.toUpperCase()?2:0;(!T||A==1&&g||x==0&&A!=0)&&(t[u]==D||n[u]==D&&(h=!0)?s[u++]=T:s.length&&(v=!1)),x=A,T+=er(D)}return u==l&&s[0]==0&&v?this.result(-100+(h?-200:0),s,e):d==l&&m==0?[-200-e.length,0,y]:a>-1?[-700-e.length,a,a+this.pattern.length]:d==l?[-200+-700-e.length,m,y]:u==l?this.result(-100+(h?-200:0)+-700+(v?0:-1100),s,e):t.length==2?null:this.result((i[0]?-700:0)+-200+-1100,i,e)}result(e,t,n){let i=[e-n.length],o=1;for(let s of t){let a=s+(this.astral?er(lt(n,s)):1);o>1&&i[o-1]==s?i[o-1]=a:(i[o++]=s,i[o++]=a)}return i}},bi=Z.define({combine(r){return Kt(r,{activateOnTyping:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,optionClass:(e,t)=>n=>lO(e(n),t(n)),addToOptions:(e,t)=>e.concat(t)})}});function lO(r,e){return r?e?r+" "+e:r:e}function cO(r){let e=r.addToOptions.slice();return r.icons&&e.push({render(t){let n=document.createElement("div");return n.classList.add("cm-completionIcon"),t.type&&n.classList.add(...t.type.split(/\s+/g).map(i=>"cm-completionIcon-"+i)),n.setAttribute("aria-hidden","true"),n},position:20}),e.push({render(t,n,i){let o=document.createElement("span");o.className="cm-completionLabel";let{label:s}=t,a=0;for(let l=1;l<i.length;){let c=i[l++],f=i[l++];c>a&&o.appendChild(document.createTextNode(s.slice(a,c)));let u=o.appendChild(document.createElement("span"));u.appendChild(document.createTextNode(s.slice(c,f))),u.className="cm-completionMatchedText",a=f}return a<s.length&&o.appendChild(document.createTextNode(s.slice(a))),o},position:50},{render(t){if(!t.detail)return null;let n=document.createElement("span");return n.className="cm-completionDetail",n.textContent=t.detail,n},position:80}),e.sort((t,n)=>t.position-n.position).map(t=>t.render)}function s1(r,e,t){if(r<=t)return{from:0,to:r};if(e<=r>>1){let i=Math.floor(e/t);return{from:i*t,to:(i+1)*t}}let n=Math.floor((r-e)/t);return{from:r-(n+1)*t,to:r-n*t}}var Gp=class{constructor(e,t){this.view=e,this.stateField=t,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:a=>this.positionInfo(a),key:this};let n=e.state.field(t),{options:i,selected:o}=n.open,s=e.state.facet(bi);this.optionContent=cO(s),this.optionClass=s.optionClass,this.range=s1(i.length,o,s.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",a=>{for(let l=a.target,c;l&&l!=this.dom;l=l.parentNode)if(l.nodeName=="LI"&&(c=/-(\d+)$/.exec(l.id))&&+c[1]<i.length){h1(e,i[+c[1]]),a.preventDefault();return}}),this.list=this.dom.appendChild(this.createListBox(i,n.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})}mount(){this.updateSel()}update(e){e.state.field(this.stateField)!=e.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=s1(t.options.length,t.selected,this.view.state.facet(bi).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})),this.updateSelectedOption(t.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:n}=t.options[t.selected],{info:i}=n;if(!i)return;let o=typeof i=="string"?document.createTextNode(i):i(n);if(!o)return;"then"in o?o.then(s=>{s&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(s)}).catch(s=>Pt(this.view.state,s,"completion info")):this.addInfoPane(o)}}addInfoPane(e){let t=this.info=document.createElement("div");t.className="cm-tooltip cm-completionInfo",t.appendChild(e),this.dom.appendChild(t),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(e){let t=null;for(let n=this.list.firstChild,i=this.range.from;n;n=n.nextSibling,i++)i==e?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),t=n):n.hasAttribute("aria-selected")&&n.removeAttribute("aria-selected");return t&&uO(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),i=e.getBoundingClientRect();if(i.top>Math.min(innerHeight,t.bottom)-10||i.bottom<Math.max(0,t.top)+10)return null;let o=Math.max(0,Math.min(i.top,innerHeight-n.height))-t.top,s=this.view.textDirection==$e.RTL,a=t.left,l=innerWidth-t.right;return s&&a<Math.min(n.width,l)?s=!1:!s&&l<Math.min(n.width,a)&&(s=!0),{top:o,left:s}}positionInfo(e){this.info&&(this.info.style.top=(e?e.top:-1e6)+"px",e&&(this.info.classList.toggle("cm-completionInfo-left",e.left),this.info.classList.toggle("cm-completionInfo-right",!e.left)))}createListBox(e,t,n){let i=document.createElement("ul");i.id=t,i.setAttribute("role","listbox"),i.setAttribute("aria-expanded","true");for(let o=n.from;o<n.to;o++){let{completion:s,match:a}=e[o],l=i.appendChild(document.createElement("li"));l.id=t+"-"+o,l.setAttribute("role","option");let c=this.optionClass(s);c&&(l.className=c);for(let f of this.optionContent){let u=f(s,this.view.state,a);u&&l.appendChild(u)}}return n.from&&i.classList.add("cm-completionListIncompleteTop"),n.to<e.length&&i.classList.add("cm-completionListIncompleteBottom"),i}};function fO(r){return e=>new Gp(e,r)}function uO(r,e){let t=r.getBoundingClientRect(),n=e.getBoundingClientRect();n.top<t.top?r.scrollTop-=t.top-n.top:n.bottom>t.bottom&&(r.scrollTop+=n.bottom-t.bottom)}function a1(r){return(r.boost||0)*100+(r.apply?10:0)+(r.info?5:0)+(r.type?1:0)}function hO(r,e){let t=[],n=0;for(let s of r)if(s.hasResult())if(s.result.filter===!1){let a=s.result.getMatch;for(let l of s.result.options){let c=[1e9-n++];if(a)for(let f of a(l))c.push(f);t.push(new Hf(l,s,c))}}else{let a=new Kp(e.sliceDoc(s.from,s.to)),l;for(let c of s.result.options)(l=a.match(c.label))&&(c.boost!=null&&(l[0]+=c.boost),t.push(new Hf(c,s,l)))}let i=[],o=null;for(let s of t.sort(gO))!o||o.label!=s.completion.label||o.detail!=s.completion.detail||o.type!=null&&s.completion.type!=null&&o.type!=s.completion.type||o.apply!=s.completion.apply?i.push(s):a1(s.completion)>a1(o)&&(i[i.length-1]=s),o=s.completion;return i}var vo=class{constructor(e,t,n,i,o){this.options=e,this.attrs=t,this.tooltip=n,this.timestamp=i,this.selected=o}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new vo(this.options,l1(t,e),this.tooltip,this.timestamp,e)}static build(e,t,n,i,o){let s=hO(e,t);if(!s.length)return null;let a=0;if(i&&i.selected){let l=i.options[i.selected].completion;for(let c=0;c<s.length;c++)if(s[c].completion==l){a=c;break}}return new vo(s,l1(n,a),{pos:e.reduce((l,c)=>c.hasResult()?Math.min(l,c.from):l,1e8),create:fO(Mr),above:o.aboveCursor},i?i.timestamp:Date.now(),a)}map(e){return new vo(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}},As=class{constructor(e,t,n){this.active=e,this.id=t,this.open=n}static start(){return new As(mO,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,n=t.facet(bi),o=(n.override||t.languageDataAt("autocomplete",yi(t)).map(aO)).map(a=>(this.active.find(c=>c.source==a)||new It(a,this.active.some(c=>c.state!=0)?1:0)).update(e,n));o.length==this.active.length&&o.every((a,l)=>a==this.active[l])&&(o=this.active);let s=e.selection||o.some(a=>a.hasResult()&&e.changes.touchesRange(a.from,a.to))||!dO(o,this.active)?vo.build(o,t,this.id,this.open,n):this.open&&e.docChanged?this.open.map(e.changes):this.open;!s&&o.every(a=>a.state!=1)&&o.some(a=>a.hasResult())&&(o=o.map(a=>a.hasResult()?new It(a.source,0):a));for(let a of e.effects)a.is(p1)&&(s=s&&s.setSelected(a.value,this.id));return o==this.active&&s==this.open?this:new As(o,this.id,s)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:pO}};function dO(r,e){if(r==e)return!0;for(let t=0,n=0;;){for(;t<r.length&&!r[t].hasResult;)t++;for(;n<e.length&&!e[n].hasResult;)n++;let i=t==r.length,o=n==e.length;if(i||o)return i==o;if(r[t++].result!=e[n++].result)return!1}}var pO={"aria-autocomplete":"list"};function l1(r,e){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":r+"-"+e,"aria-controls":r}}var mO=[];function gO(r,e){let t=e.match[0]-r.match[0];return t||r.completion.label.localeCompare(e.completion.label)}function Zp(r){return r.isUserEvent("input.type")?"input":r.isUserEvent("delete.backward")?"delete":null}var It=class{constructor(e,t,n=-1){this.source=e,this.state=t,this.explicitPos=n}hasResult(){return!1}update(e,t){let n=Zp(e),i=this;n?i=i.handleUserEvent(e,n,t):e.docChanged?i=i.handleChange(e):e.selection&&i.state!=0&&(i=new It(i.source,0));for(let o of e.effects)if(o.is(Yp))i=new It(i.source,1,o.value?yi(e.state):-1);else if(o.is(Wf))i=new It(i.source,0);else if(o.is(d1))for(let s of o.value)s.source==i.source&&(i=s);return i}handleUserEvent(e,t,n){return t=="delete"||!n.activateOnTyping?this.map(e.changes):new It(this.source,1)}handleChange(e){return e.changes.touchesRange(yi(e.startState))?new It(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new It(this.source,this.state,e.mapPos(this.explicitPos))}},ko=class extends It{constructor(e,t,n,i,o){super(e,2,t),this.result=n,this.from=i,this.to=o}hasResult(){return!0}handleUserEvent(e,t,n){var i;let o=e.changes.mapPos(this.from),s=e.changes.mapPos(this.to,1),a=yi(e.state);if((this.explicitPos<0?a<=o:a<this.from)||a>s||t=="delete"&&yi(e.startState)==this.from)return new It(this.source,t=="input"&&n.activateOnTyping?1:0);let l=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),c;return yO(this.result.validFor,e.state,o,s)?new ko(this.source,l,this.result,o,s):this.result.update&&(c=this.result.update(this.result,o,s,new Uf(e.state,a,l>=0)))?new ko(this.source,l,c,c.from,(i=c.to)!==null&&i!==void 0?i:yi(e.state)):new It(this.source,1,l)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new It(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new ko(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}};function yO(r,e,t,n){if(!r)return!1;let i=e.sliceDoc(t,n);return typeof r=="function"?r(i,t,n,e):u1(r,!0).test(i)}var Yp=ae.define(),Wf=ae.define(),d1=ae.define({map(r,e){return r.map(t=>t.map(e))}}),p1=ae.define(),Mr=Ee.define({create(){return As.start()},update(r,e){return r.update(e)},provide:r=>[rl.from(r,e=>e.tooltip),G.contentAttributes.from(r,e=>e.attrs)]}),m1=75;function Vf(r,e="option"){return t=>{let n=t.state.field(Mr,!1);if(!n||!n.open||Date.now()-n.open.timestamp<m1)return!1;let i=1,o;e=="page"&&(o=v_(t,n.open.tooltip))&&(i=Math.max(2,Math.floor(o.dom.offsetHeight/o.dom.querySelector("li").offsetHeight)-1));let s=n.open.selected+i*(r?1:-1),{length:a}=n.open.options;return s<0?s=e=="page"?0:a-1:s>=a&&(s=e=="page"?a-1:0),t.dispatch({effects:p1.of(s)}),!0}}var bO=r=>{let e=r.state.field(Mr,!1);return r.state.readOnly||!e||!e.open||Date.now()-e.open.timestamp<m1?!1:(h1(r,e.open.options[e.open.selected]),!0)},_O=r=>r.state.field(Mr,!1)?(r.dispatch({effects:Yp.of(!0)}),!0):!1,vO=r=>{let e=r.state.field(Mr,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(r.dispatch({effects:Wf.of(null)}),!0)},Jp=class{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}},c1=50,kO=50,wO=1e3,xO=Pe.fromClass(class{constructor(r){this.view=r,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of r.state.field(Mr).active)e.state==1&&this.startQuery(e)}update(r){let e=r.state.field(Mr);if(!r.selectionSet&&!r.docChanged&&r.startState.field(Mr)==e)return;let t=r.transactions.some(n=>(n.selection||n.docChanged)&&!Zp(n));for(let n=0;n<this.running.length;n++){let i=this.running[n];if(t||i.updates.length+r.transactions.length>kO&&Date.now()-i.time>wO){for(let o of i.context.abortListeners)try{o()}catch(s){Pt(this.view.state,s)}i.context.abortListeners=null,this.running.splice(n--,1)}else i.updates.push(...r.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(n=>n.state==1&&!this.running.some(i=>i.active.source==n.source))?setTimeout(()=>this.startUpdate(),c1):-1,this.composing!=0)for(let n of r.transactions)Zp(n)=="input"?this.composing=2:this.composing==2&&n.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:r}=this.view,e=r.field(Mr);for(let t of e.active)t.state==1&&!this.running.some(n=>n.active.source==t.source)&&this.startQuery(t)}startQuery(r){let{state:e}=this.view,t=yi(e),n=new Uf(e,t,r.explicitPos==t),i=new Jp(r,n);this.running.push(i),Promise.resolve(r.source(n)).then(o=>{i.context.aborted||(i.done=o||null,this.scheduleAccept())},o=>{this.view.dispatch({effects:Wf.of(null)}),Pt(this.view.state,o)})}scheduleAccept(){this.running.every(r=>r.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),c1))}accept(){var r;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(bi);for(let n=0;n<this.running.length;n++){let i=this.running[n];if(i.done===void 0)continue;if(this.running.splice(n--,1),i.done){let s=new ko(i.active.source,i.active.explicitPos,i.done,i.done.from,(r=i.done.to)!==null&&r!==void 0?r:yi(i.updates.length?i.updates[0].startState:this.view.state));for(let a of i.updates)s=s.update(a,t);if(s.hasResult()){e.push(s);continue}}let o=this.view.state.field(Mr).active.find(s=>s.source==i.active.source);if(o&&o.state==1)if(i.done==null){let s=new It(i.active.source,0);for(let a of i.updates)s=s.update(a,t);s.state!=1&&e.push(s)}else this.startQuery(o)}e.length&&this.view.dispatch({effects:d1.of(e)})}},{eventHandlers:{blur(){let r=this.view.state.field(Mr,!1);r&&r.tooltip&&this.view.state.facet(bi).closeOnBlur&&this.view.dispatch({effects:Wf.of(null)})},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:Yp.of(!1)}),20),this.composing=0}}}),SO=G.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});var qf={brackets:["(","[","{","'",'"'],before:")]}:;>"},_o=ae.define({map(r,e){let t=e.mapPos(r,-1,xt.TrackAfter);return t??void 0}}),Xp=ae.define({map(r,e){return e.mapPos(r)}}),Qp=new class extends Yr{};Qp.startSide=1;Qp.endSide=-1;var g1=Ee.define({create(){return ke.empty},update(r,e){if(e.selection){let t=e.state.doc.lineAt(e.selection.main.head).from,n=e.startState.doc.lineAt(e.startState.selection.main.head).from;t!=e.changes.mapPos(n,-1)&&(r=ke.empty)}r=r.map(e.changes);for(let t of e.effects)t.is(_o)?r=r.update({add:[Qp.range(t.value,t.value+1)]}):t.is(Xp)&&(r=r.update({filter:n=>n!=t.value}));return r}});function y1(){return[AO,g1]}var qp="()[]{}<>";function b1(r){for(let e=0;e<qp.length;e+=2)if(qp.charCodeAt(e)==r)return qp.charAt(e+1);return za(r<128?r:r+1)}function _1(r,e){return r.languageDataAt("closeBrackets",e)[0]||qf}var CO=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),AO=G.inputHandler.of((r,e,t,n)=>{if((CO?r.composing:r.compositionStarted)||r.state.readOnly)return!1;let i=r.state.selection.main;if(n.length>2||n.length==2&&er(lt(n,0))==1||e!=i.from||t!=i.to)return!1;let o=OO(r.state,n);return o?(r.dispatch(o),!0):!1}),TO=({state:r,dispatch:e})=>{if(r.readOnly)return!1;let n=_1(r,r.selection.main.head).brackets||qf.brackets,i=null,o=r.changeByRange(s=>{if(s.empty){let a=EO(r.doc,s.head);for(let l of n)if(l==a&&Kf(r.doc,s.head)==b1(lt(l,0)))return{changes:{from:s.head-l.length,to:s.head+l.length},range:N.cursor(s.head-l.length),userEvent:"delete.backward"}}return{range:i=s}});return i||e(r.update(o,{scrollIntoView:!0})),!i},v1=[{key:"Backspace",run:TO}];function OO(r,e){let t=_1(r,r.selection.main.head),n=t.brackets||qf.brackets;for(let i of n){let o=b1(lt(i,0));if(e==i)return o==i?DO(r,i,n.indexOf(i+i+i)>-1):RO(r,i,o,t.before||qf.before);if(e==o&&k1(r,r.selection.main.from))return MO(r,i,o)}return null}function k1(r,e){let t=!1;return r.field(g1).between(0,r.doc.length,n=>{n==e&&(t=!0)}),t}function Kf(r,e){let t=r.sliceString(e,e+2);return t.slice(0,er(lt(t,0)))}function EO(r,e){let t=r.sliceString(e-2,e);return er(lt(t,0))==t.length?t:t.slice(1)}function RO(r,e,t,n){let i=null,o=r.changeByRange(s=>{if(!s.empty)return{changes:[{insert:e,from:s.from},{insert:t,from:s.to}],effects:_o.of(s.to+e.length),range:N.range(s.anchor+e.length,s.head+e.length)};let a=Kf(r.doc,s.head);return!a||/\s/.test(a)||n.indexOf(a)>-1?{changes:{insert:e+t,from:s.head},effects:_o.of(s.head+e.length),range:N.cursor(s.head+e.length)}:{range:i=s}});return i?null:r.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function MO(r,e,t){let n=null,i=r.selection.ranges.map(o=>o.empty&&Kf(r.doc,o.head)==t?N.cursor(o.head+t.length):n=o);return n?null:r.update({selection:N.create(i,r.selection.mainIndex),scrollIntoView:!0,effects:r.selection.ranges.map(({from:o})=>Xp.of(o))})}function DO(r,e,t){let n=null,i=r.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:e,from:o.to}],effects:_o.of(o.to+e.length),range:N.range(o.anchor+e.length,o.head+e.length)};let s=o.head,a=Kf(r.doc,s);if(a==e){if(f1(r,s))return{changes:{insert:e+e,from:s},effects:_o.of(s+e.length),range:N.cursor(s+e.length)};if(k1(r,s)){let l=t&&r.sliceDoc(s,s+e.length*3)==e+e+e;return{range:N.cursor(s+e.length*(l?3:1)),effects:Xp.of(s)}}}else{if(t&&r.sliceDoc(s-2*e.length,s)==e+e&&f1(r,s-2*e.length))return{changes:{insert:e+e+e+e,from:s},effects:_o.of(s+e.length),range:N.cursor(s+e.length)};if(r.charCategorizer(s)(a)!=at.Word){let l=r.sliceDoc(s-1,s);if(l!=e&&r.charCategorizer(s)(l)!=at.Word&&!NO(r,s,e))return{changes:{insert:e+e,from:s},effects:_o.of(s+e.length),range:N.cursor(s+e.length)}}}return{range:n=o}});return n?null:r.update(i,{scrollIntoView:!0,userEvent:"input.type"})}function f1(r,e){let t=gt(r).resolveInner(e+1);return t.parent&&t.from==e}function NO(r,e,t){let n=gt(r).resolveInner(e,-1);for(let i=0;i<5;i++){if(r.sliceDoc(n.from,n.from+t.length)==t)return!0;let o=n.to==e&&n.parent;if(!o)break;n=o}return!1}function Gf(r={}){return[Mr,bi.of(r),xO,PO,SO]}var em=[{key:"Ctrl-Space",run:_O},{key:"Escape",run:vO},{key:"ArrowDown",run:Vf(!0)},{key:"ArrowUp",run:Vf(!1)},{key:"PageDown",run:Vf(!0,"page")},{key:"PageUp",run:Vf(!1,"page")},{key:"Enter",run:bO}],PO=Fn.highest(po.computeN([bi],r=>r.facet(bi).defaultKeymap?[em]:[]));var LO=r=>{let e=sm(r.state);return e.line?IO(r):e.block?zO(r):!1};function om(r,e){return({state:t,dispatch:n})=>{if(t.readOnly)return!1;let i=r(e,t);return i?(n(t.update(i)),!0):!1}}var IO=om(FO,0);var BO=om(N1,0);var zO=om((r,e)=>N1(r,e,$O(e)),0);function sm(r,e=r.selection.main.head){let t=r.languageDataAt("commentTokens",e);return t.length?t[0]:{}}var hl=50;function jO(r,{open:e,close:t},n,i){let o=r.sliceDoc(n-hl,n),s=r.sliceDoc(i,i+hl),a=/\s*$/.exec(o)[0].length,l=/^\s*/.exec(s)[0].length,c=o.length-a;if(o.slice(c-e.length,c)==e&&s.slice(l,l+t.length)==t)return{open:{pos:n-a,margin:a&&1},close:{pos:i+l,margin:l&&1}};let f,u;i-n<=2*hl?f=u=r.sliceDoc(n,i):(f=r.sliceDoc(n,n+hl),u=r.sliceDoc(i-hl,i));let h=/^\s*/.exec(f)[0].length,d=/\s*$/.exec(u)[0].length,m=u.length-d-t.length;return f.slice(h,h+e.length)==e&&u.slice(m,m+t.length)==t?{open:{pos:n+h+e.length,margin:/\s/.test(f.charAt(h+e.length))?1:0},close:{pos:i-d-t.length,margin:/\s/.test(u.charAt(m-1))?1:0}}:null}function $O(r){let e=[];for(let t of r.selection.ranges){let n=r.doc.lineAt(t.from),i=t.to<=n.to?n:r.doc.lineAt(t.to),o=e.length-1;o>=0&&e[o].to>n.from?e[o].to=i.to:e.push({from:n.from,to:i.to})}return e}function N1(r,e,t=e.selection.ranges){let n=t.map(o=>sm(e,o.from).block);if(!n.every(o=>o))return null;let i=t.map((o,s)=>jO(e,n[s],o.from,o.to));if(r!=2&&!i.every(o=>o))return{changes:e.changes(t.map((o,s)=>i[s]?[]:[{from:o.from,insert:n[s].open+" "},{from:o.to,insert:" "+n[s].close}]))};if(r!=1&&i.some(o=>o)){let o=[];for(let s=0,a;s<i.length;s++)if(a=i[s]){let l=n[s],{open:c,close:f}=a;o.push({from:c.pos-l.open.length,to:c.pos+c.margin},{from:f.pos-f.margin,to:f.pos+l.close.length})}return{changes:o}}return null}function FO(r,e,t=e.selection.ranges){let n=[],i=-1;for(let{from:o,to:s}of t){let a=n.length,l=1e9;for(let c=o;c<=s;){let f=e.doc.lineAt(c);if(f.from>i&&(o==s||s>f.from)){i=f.from;let u=sm(e,c).line;if(!u)continue;let h=/^\s*/.exec(f.text)[0].length,d=h==f.length,m=f.text.slice(h,h+u.length)==u?h:-1;h<f.text.length&&h<l&&(l=h),n.push({line:f,comment:m,token:u,indent:h,empty:d,single:!1})}c=f.to+1}if(l<1e9)for(let c=a;c<n.length;c++)n[c].indent<n[c].line.text.length&&(n[c].indent=l);n.length==a+1&&(n[a].single=!0)}if(r!=2&&n.some(o=>o.comment<0&&(!o.empty||o.single))){let o=[];for(let{line:a,token:l,indent:c,empty:f,single:u}of n)(u||!f)&&o.push({from:a.from+c,insert:l+" "});let s=e.changes(o);return{changes:s,selection:e.selection.map(s,1)}}else if(r!=1&&n.some(o=>o.comment>=0)){let o=[];for(let{line:s,comment:a,token:l}of n)if(a>=0){let c=s.from+a,f=c+l.length;s.text[f-s.from]==" "&&f++,o.push({from:c,to:f})}return{changes:o}}return null}var rm=Jr.define(),VO=Jr.define(),UO=Z.define(),P1=Z.define({combine(r){return Kt(r,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function HO(r){let e=0;return r.iterChangedRanges((t,n)=>e=n),e}var L1=Ee.define({create(){return Nr.empty},update(r,e){let t=e.state.facet(P1),n=e.annotation(rm);if(n){let l=e.docChanged?N.single(HO(e.changes)):void 0,c=Bt.fromTransaction(e,l),f=n.side,u=f==0?r.undone:r.done;return c?u=Zf(u,u.length,t.minDepth,c):u=$1(u,e.startState.selection),new Nr(f==0?n.rest:u,f==0?u:n.rest)}let i=e.annotation(VO);if((i=="full"||i=="before")&&(r=r.isolate()),e.annotation(Ze.addToHistory)===!1)return e.changes.empty?r:r.addMapping(e.changes.desc);let o=Bt.fromTransaction(e),s=e.annotation(Ze.time),a=e.annotation(Ze.userEvent);return o?r=r.addChanges(o,s,a,t.newGroupDelay,t.minDepth):e.selection&&(r=r.addSelection(e.startState.selection,s,a,t.newGroupDelay)),(i=="full"||i=="after")&&(r=r.isolate()),r},toJSON(r){return{done:r.done.map(e=>e.toJSON()),undone:r.undone.map(e=>e.toJSON())}},fromJSON(r){return new Nr(r.done.map(Bt.fromJSON),r.undone.map(Bt.fromJSON))}});function I1(r={}){return[L1,P1.of(r),G.domEventHandlers({beforeinput(e,t){let n=e.inputType=="historyUndo"?B1:e.inputType=="historyRedo"?z1:null;return n?(e.preventDefault(),n(t)):!1}})]}function Jf(r,e){return function({state:t,dispatch:n}){if(!e&&t.readOnly)return!1;let i=t.field(L1,!1);if(!i)return!1;let o=i.pop(r,t,e);return o?(n(o),!0):!1}}var B1=Jf(0,!1),z1=Jf(1,!1),WO=Jf(0,!0),qO=Jf(1,!0);var Bt=class{constructor(e,t,n,i,o){this.changes=e,this.effects=t,this.mapped=n,this.startSelection=i,this.selectionsAfter=o}setSelAfter(e){return new Bt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(i=>i.toJSON())}}static fromJSON(e){return new Bt(e.changes&&Ge.fromJSON(e.changes),[],e.mapped&&Ar.fromJSON(e.mapped),e.startSelection&&N.fromJSON(e.startSelection),e.selectionsAfter.map(N.fromJSON))}static fromTransaction(e,t){let n=Dr;for(let i of e.startState.facet(UO)){let o=i(e);o.length&&(n=n.concat(o))}return!n.length&&e.changes.empty?null:new Bt(e.changes.invert(e.startState.doc),n,void 0,t||e.startState.selection,Dr)}static selection(e){return new Bt(void 0,Dr,void 0,void 0,e)}};function Zf(r,e,t,n){let i=e+1>t+20?e-t-1:0,o=r.slice(i,e);return o.push(n),o}function KO(r,e){let t=[],n=!1;return r.iterChangedRanges((i,o)=>t.push(i,o)),e.iterChangedRanges((i,o,s,a)=>{for(let l=0;l<t.length;){let c=t[l++],f=t[l++];a>=c&&s<=f&&(n=!0)}}),n}function GO(r,e){return r.ranges.length==e.ranges.length&&r.ranges.filter((t,n)=>t.empty!=e.ranges[n].empty).length===0}function j1(r,e){return r.length?e.length?r.concat(e):r:e}var Dr=[],ZO=200;function $1(r,e){if(r.length){let t=r[r.length-1],n=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-ZO));return n.length&&n[n.length-1].eq(e)?r:(n.push(e),Zf(r,r.length-1,1e9,t.setSelAfter(n)))}else return[Bt.selection([e])]}function JO(r){let e=r[r.length-1],t=r.slice();return t[r.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function tm(r,e){if(!r.length)return r;let t=r.length,n=Dr;for(;t;){let i=YO(r[t-1],e,n);if(i.changes&&!i.changes.empty||i.effects.length){let o=r.slice(0,t);return o[t-1]=i,o}else e=i.mapped,t--,n=i.selectionsAfter}return n.length?[Bt.selection(n)]:Dr}function YO(r,e,t){let n=j1(r.selectionsAfter.length?r.selectionsAfter.map(a=>a.map(e)):Dr,t);if(!r.changes)return Bt.selection(n);let i=r.changes.map(e),o=e.mapDesc(r.changes,!0),s=r.mapped?r.mapped.composeDesc(o):o;return new Bt(i,ae.mapEffects(r.effects,e),s,r.startSelection.map(o),n)}var XO=/^(input\.type|delete)($|\.)/,Nr=class{constructor(e,t,n=0,i=void 0){this.done=e,this.undone=t,this.prevTime=n,this.prevUserEvent=i}isolate(){return this.prevTime?new Nr(this.done,this.undone):this}addChanges(e,t,n,i,o){let s=this.done,a=s[s.length-1];return a&&a.changes&&!a.changes.empty&&e.changes&&(!n||XO.test(n))&&(!a.selectionsAfter.length&&t-this.prevTime<i&&KO(a.changes,e.changes)||n=="input.type.compose")?s=Zf(s,s.length-1,o,new Bt(e.changes.compose(a.changes),j1(e.effects,a.effects),a.mapped,a.startSelection,Dr)):s=Zf(s,s.length,o,e),new Nr(s,Dr,t,n)}addSelection(e,t,n,i){let o=this.done.length?this.done[this.done.length-1].selectionsAfter:Dr;return o.length>0&&t-this.prevTime<i&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&GO(o[o.length-1],e)?this:new Nr($1(this.done,e),this.undone,t,n)}addMapping(e){return new Nr(tm(this.done,e),tm(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,n){let i=e==0?this.done:this.undone;if(i.length==0)return null;let o=i[i.length-1];if(n&&o.selectionsAfter.length)return t.update({selection:o.selectionsAfter[o.selectionsAfter.length-1],annotations:rm.of({side:e,rest:JO(i)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(o.changes){let s=i.length==1?Dr:i.slice(0,i.length-1);return o.mapped&&(s=tm(s,o.mapped)),t.update({changes:o.changes,selection:o.startSelection,effects:o.effects,annotations:rm.of({side:e,rest:s}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}};Nr.empty=new Nr(Dr,Dr);var F1=[{key:"Mod-z",run:B1,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:z1,preventDefault:!0},{key:"Mod-u",run:WO,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:qO,preventDefault:!0}];function Ts(r,e){return N.create(r.ranges.map(e),r.mainIndex)}function Sn(r,e){return r.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function qn({state:r,dispatch:e},t){let n=Ts(r.selection,t);return n.eq(r.selection)?!1:(e(Sn(r,n)),!0)}function Yf(r,e){return N.cursor(e?r.to:r.from)}function V1(r,e){return qn(r,t=>t.empty?r.moveByChar(t,e):Yf(t,e))}function Pr(r){return r.textDirectionAt(r.state.selection.main.head)==$e.LTR}var U1=r=>V1(r,!Pr(r)),H1=r=>V1(r,Pr(r));function W1(r,e){return qn(r,t=>t.empty?r.moveByGroup(t,e):Yf(t,e))}var QO=r=>W1(r,!Pr(r)),eE=r=>W1(r,Pr(r));function tE(r,e,t){if(e.type.prop(t))return!0;let n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(r.sliceDoc(e.from,e.to)))||e.firstChild}function Xf(r,e,t){let n=gt(r).resolveInner(e.head),i=t?pe.closedBy:pe.openedBy;for(let l=e.head;;){let c=t?n.childAfter(l):n.childBefore(l);if(!c)break;tE(r,c,i)?n=c:l=t?c.to:c.from}let o=n.type.prop(i),s,a;return o&&(s=t?en(r,n.from,1):en(r,n.to,-1))&&s.matched?a=t?s.end.to:s.end.from:a=t?n.to:n.from,N.cursor(a,t?-1:1)}var rE=r=>qn(r,e=>Xf(r.state,e,!Pr(r))),nE=r=>qn(r,e=>Xf(r.state,e,Pr(r)));function q1(r,e){return qn(r,t=>{if(!t.empty)return Yf(t,e);let n=r.moveVertically(t,e);return n.head!=t.head?n:r.moveToLineBoundary(t,e)})}var K1=r=>q1(r,!1),G1=r=>q1(r,!0);function Z1(r,e){let{state:t}=r,n=Ts(t.selection,a=>a.empty?r.moveVertically(a,e,Math.min(r.dom.clientHeight,innerHeight)):Yf(a,e));if(n.eq(t.selection))return!1;let i=r.coordsAtPos(t.selection.main.head),o=r.scrollDOM.getBoundingClientRect(),s;return i&&i.top>o.top&&i.bottom<o.bottom&&i.top-o.top<=r.scrollDOM.scrollHeight-r.scrollDOM.scrollTop-r.scrollDOM.clientHeight&&(s=G.scrollIntoView(n.main.head,{y:"start",yMargin:i.top-o.top})),r.dispatch(Sn(t,n),{effects:s}),!0}var w1=r=>Z1(r,!1),nm=r=>Z1(r,!0);function Qf(r,e,t){let n=r.lineBlockAt(e.head),i=r.moveToLineBoundary(e,t);if(i.head==e.head&&i.head!=(t?n.to:n.from)&&(i=r.moveToLineBoundary(e,t,!1)),!t&&i.head==n.from&&n.length){let o=/^\s*/.exec(r.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;o&&e.head!=n.from+o&&(i=N.cursor(n.from+o))}return i}var x1=r=>qn(r,e=>Qf(r,e,!0)),S1=r=>qn(r,e=>Qf(r,e,!1)),iE=r=>qn(r,e=>N.cursor(r.lineBlockAt(e.head).from,1)),oE=r=>qn(r,e=>N.cursor(r.lineBlockAt(e.head).to,-1));function sE(r,e,t){let n=!1,i=Ts(r.selection,o=>{let s=en(r,o.head,-1)||en(r,o.head,1)||o.head>0&&en(r,o.head-1,1)||o.head<r.doc.length&&en(r,o.head+1,-1);if(!s||!s.end)return o;n=!0;let a=s.start.from==o.head?s.end.to:s.end.from;return t?N.range(o.anchor,a):N.cursor(a)});return n?(e(Sn(r,i)),!0):!1}var aE=({state:r,dispatch:e})=>sE(r,e,!1);function Cn(r,e){let t=Ts(r.state.selection,n=>{let i=e(n);return N.range(n.anchor,i.head,i.goalColumn)});return t.eq(r.state.selection)?!1:(r.dispatch(Sn(r.state,t)),!0)}function J1(r,e){return Cn(r,t=>r.moveByChar(t,e))}var Y1=r=>J1(r,!Pr(r)),X1=r=>J1(r,Pr(r));function Q1(r,e){return Cn(r,t=>r.moveByGroup(t,e))}var lE=r=>Q1(r,!Pr(r)),cE=r=>Q1(r,Pr(r));var fE=r=>Cn(r,e=>Xf(r.state,e,!Pr(r))),uE=r=>Cn(r,e=>Xf(r.state,e,Pr(r)));function ev(r,e){return Cn(r,t=>r.moveVertically(t,e))}var tv=r=>ev(r,!1),rv=r=>ev(r,!0);function nv(r,e){return Cn(r,t=>r.moveVertically(t,e,Math.min(r.dom.clientHeight,innerHeight)))}var C1=r=>nv(r,!1),A1=r=>nv(r,!0),T1=r=>Cn(r,e=>Qf(r,e,!0)),O1=r=>Cn(r,e=>Qf(r,e,!1)),hE=r=>Cn(r,e=>N.cursor(r.lineBlockAt(e.head).from)),dE=r=>Cn(r,e=>N.cursor(r.lineBlockAt(e.head).to)),E1=({state:r,dispatch:e})=>(e(Sn(r,{anchor:0})),!0),R1=({state:r,dispatch:e})=>(e(Sn(r,{anchor:r.doc.length})),!0),M1=({state:r,dispatch:e})=>(e(Sn(r,{anchor:r.selection.main.anchor,head:0})),!0),D1=({state:r,dispatch:e})=>(e(Sn(r,{anchor:r.selection.main.anchor,head:r.doc.length})),!0),pE=({state:r,dispatch:e})=>(e(r.update({selection:{anchor:0,head:r.doc.length},userEvent:"select"})),!0),mE=({state:r,dispatch:e})=>{let t=ru(r).map(({from:n,to:i})=>N.range(n,Math.min(i+1,r.doc.length)));return e(r.update({selection:N.create(t),userEvent:"select"})),!0},gE=({state:r,dispatch:e})=>{let t=Ts(r.selection,n=>{var i;let o=gt(r).resolveInner(n.head,1);for(;!(o.from<n.from&&o.to>=n.to||o.to>n.to&&o.from<=n.from||!(!((i=o.parent)===null||i===void 0)&&i.parent));)o=o.parent;return N.range(o.to,o.from)});return e(Sn(r,t)),!0},yE=({state:r,dispatch:e})=>{let t=r.selection,n=null;return t.ranges.length>1?n=N.create([t.main]):t.main.empty||(n=N.create([N.cursor(t.main.head)])),n?(e(Sn(r,n)),!0):!1};function eu({state:r,dispatch:e},t){if(r.readOnly)return!1;let n="delete.selection",i=r.changeByRange(o=>{let{from:s,to:a}=o;if(s==a){let l=t(s);l<s?n="delete.backward":l>s&&(n="delete.forward"),s=Math.min(s,l),a=Math.max(a,l)}return s==a?{range:o}:{changes:{from:s,to:a},range:N.cursor(s)}});return i.changes.empty?!1:(e(r.update(i,{scrollIntoView:!0,userEvent:n})),!0)}function tu(r,e,t){if(r instanceof G)for(let n of r.state.facet(G.atomicRanges).map(i=>i(r)))n.between(e,e,(i,o)=>{i<e&&o>e&&(e=t?o:i)});return e}var iv=(r,e)=>eu(r,t=>{let{state:n}=r,i=n.doc.lineAt(t),o,s;if(!e&&t>i.from&&t<i.from+200&&!/[^ \t]/.test(o=i.text.slice(0,t-i.from))){if(o[o.length-1]=="	")return t-1;let a=li(o,n.tabSize),l=a%fl(n)||fl(n);for(let c=0;c<l&&o[o.length-1-c]==" ";c++)t--;s=t}else s=qt(i.text,t-i.from,e,e)+i.from,s==t&&i.number!=(e?n.doc.lines:1)&&(s+=e?1:-1);return tu(r,s,e)}),im=r=>iv(r,!1),ov=r=>iv(r,!0),sv=(r,e)=>eu(r,t=>{let n=t,{state:i}=r,o=i.doc.lineAt(n),s=i.charCategorizer(n);for(let a=null;;){if(n==(e?o.to:o.from)){n==t&&o.number!=(e?i.doc.lines:1)&&(n+=e?1:-1);break}let l=qt(o.text,n-o.from,e)+o.from,c=o.text.slice(Math.min(n,l)-o.from,Math.max(n,l)-o.from),f=s(c);if(a!=null&&f!=a)break;(c!=" "||n!=t)&&(a=f),n=l}return tu(r,n,e)}),av=r=>sv(r,!1),bE=r=>sv(r,!0),lv=r=>eu(r,e=>{let t=r.lineBlockAt(e).to;return tu(r,e<t?t:Math.min(r.state.doc.length,e+1),!0)}),_E=r=>eu(r,e=>{let t=r.lineBlockAt(e).from;return tu(r,e>t?t:Math.max(0,e-1),!1)});var vE=({state:r,dispatch:e})=>{if(r.readOnly)return!1;let t=r.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:ve.of(["",""])},range:N.cursor(n.from)}));return e(r.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},kE=({state:r,dispatch:e})=>{if(r.readOnly)return!1;let t=r.changeByRange(n=>{if(!n.empty||n.from==0||n.from==r.doc.length)return{range:n};let i=n.from,o=r.doc.lineAt(i),s=i==o.from?i-1:qt(o.text,i-o.from,!1)+o.from,a=i==o.to?i+1:qt(o.text,i-o.from,!0)+o.from;return{changes:{from:s,to:a,insert:r.doc.slice(i,a).append(r.doc.slice(s,i))},range:N.cursor(a)}});return t.changes.empty?!1:(e(r.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function ru(r){let e=[],t=-1;for(let n of r.selection.ranges){let i=r.doc.lineAt(n.from),o=r.doc.lineAt(n.to);if(!n.empty&&n.to==o.from&&(o=r.doc.lineAt(n.to-1)),t>=i.number){let s=e[e.length-1];s.to=o.to,s.ranges.push(n)}else e.push({from:i.from,to:o.to,ranges:[n]});t=o.number+1}return e}function cv(r,e,t){if(r.readOnly)return!1;let n=[],i=[];for(let o of ru(r)){if(t?o.to==r.doc.length:o.from==0)continue;let s=r.doc.lineAt(t?o.to+1:o.from-1),a=s.length+1;if(t){n.push({from:o.to,to:s.to},{from:o.from,insert:s.text+r.lineBreak});for(let l of o.ranges)i.push(N.range(Math.min(r.doc.length,l.anchor+a),Math.min(r.doc.length,l.head+a)))}else{n.push({from:s.from,to:o.from},{from:o.to,insert:r.lineBreak+s.text});for(let l of o.ranges)i.push(N.range(l.anchor-a,l.head-a))}}return n.length?(e(r.update({changes:n,scrollIntoView:!0,selection:N.create(i,r.selection.mainIndex),userEvent:"move.line"})),!0):!1}var wE=({state:r,dispatch:e})=>cv(r,e,!1),xE=({state:r,dispatch:e})=>cv(r,e,!0);function fv(r,e,t){if(r.readOnly)return!1;let n=[];for(let i of ru(r))t?n.push({from:i.from,insert:r.doc.slice(i.from,i.to)+r.lineBreak}):n.push({from:i.to,insert:r.lineBreak+r.doc.slice(i.from,i.to)});return e(r.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}var SE=({state:r,dispatch:e})=>fv(r,e,!1),CE=({state:r,dispatch:e})=>fv(r,e,!0),AE=r=>{if(r.state.readOnly)return!1;let{state:e}=r,t=e.changes(ru(e).map(({from:i,to:o})=>(i>0?i--:o<e.doc.length&&o++,{from:i,to:o}))),n=Ts(e.selection,i=>r.moveVertically(i,!0)).map(t);return r.dispatch({changes:t,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function TE(r,e){if(/\(\)|\[\]|\{\}/.test(r.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=gt(r).resolveInner(e),n=t.childBefore(e),i=t.childAfter(e),o;return n&&i&&n.to<=e&&i.from>=e&&(o=n.type.prop(pe.closedBy))&&o.indexOf(i.name)>-1&&r.doc.lineAt(n.to).from==r.doc.lineAt(i.from).from?{from:n.to,to:i.from}:null}var OE=uv(!1),EE=uv(!0);function uv(r){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange(i=>{let{from:o,to:s}=i,a=e.doc.lineAt(o),l=!r&&o==s&&TE(e,o);r&&(o=s=(s<=a.to?a:e.doc.lineAt(s)).to);let c=new yo(e,{simulateBreak:o,simulateDoubleBreak:!!l}),f=$f(c,o);for(f==null&&(f=/^\s*/.exec(e.doc.lineAt(o).text)[0].length);s<a.to&&/\s/.test(a.text[s-a.from]);)s++;l?{from:o,to:s}=l:o>a.from&&o<a.from+100&&!/\S/.test(a.text.slice(0,o))&&(o=a.from);let u=["",Cs(e,f)];return l&&u.push(Cs(e,c.lineIndent(a.from,-1))),{changes:{from:o,to:s,insert:ve.of(u)},range:N.cursor(o+1+u[1].length)}});return t(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function am(r,e){let t=-1;return r.changeByRange(n=>{let i=[];for(let s=n.from;s<=n.to;){let a=r.doc.lineAt(s);a.number>t&&(n.empty||n.to>a.from)&&(e(a,i,n),t=a.number),s=a.to+1}let o=r.changes(i);return{changes:i,range:N.range(o.mapPos(n.anchor,1),o.mapPos(n.head,1))}})}var RE=({state:r,dispatch:e})=>{if(r.readOnly)return!1;let t=Object.create(null),n=new yo(r,{overrideIndentation:o=>{let s=t[o];return s??-1}}),i=am(r,(o,s,a)=>{let l=$f(n,o.from);if(l==null)return;/\S/.test(o.text)||(l=0);let c=/^\s*/.exec(o.text)[0],f=Cs(r,l);(c!=f||a.from<o.from+c.length)&&(t[o.from]=l,s.push({from:o.from,to:o.from+c.length,insert:f}))});return i.changes.empty||e(r.update(i,{userEvent:"indent"})),!0},hv=({state:r,dispatch:e})=>r.readOnly?!1:(e(r.update(am(r,(t,n)=>{n.push({from:t.from,insert:r.facet(cl)})}),{userEvent:"input.indent"})),!0),dv=({state:r,dispatch:e})=>r.readOnly?!1:(e(r.update(am(r,(t,n)=>{let i=/^\s*/.exec(t.text)[0];if(!i)return;let o=li(i,r.tabSize),s=0,a=Cs(r,Math.max(0,o-fl(r)));for(;s<i.length&&s<a.length&&i.charCodeAt(s)==a.charCodeAt(s);)s++;n.push({from:t.from+s,to:t.from+i.length,insert:a.slice(s)})}),{userEvent:"delete.dedent"})),!0);var ME=[{key:"Ctrl-b",run:U1,shift:Y1,preventDefault:!0},{key:"Ctrl-f",run:H1,shift:X1},{key:"Ctrl-p",run:K1,shift:tv},{key:"Ctrl-n",run:G1,shift:rv},{key:"Ctrl-a",run:iE,shift:hE},{key:"Ctrl-e",run:oE,shift:dE},{key:"Ctrl-d",run:ov},{key:"Ctrl-h",run:im},{key:"Ctrl-k",run:lv},{key:"Ctrl-Alt-h",run:av},{key:"Ctrl-o",run:vE},{key:"Ctrl-t",run:kE},{key:"Ctrl-v",run:nm}],DE=[{key:"ArrowLeft",run:U1,shift:Y1,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:QO,shift:lE},{mac:"Cmd-ArrowLeft",run:S1,shift:O1},{key:"ArrowRight",run:H1,shift:X1,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:eE,shift:cE},{mac:"Cmd-ArrowRight",run:x1,shift:T1},{key:"ArrowUp",run:K1,shift:tv,preventDefault:!0},{mac:"Cmd-ArrowUp",run:E1,shift:M1},{mac:"Ctrl-ArrowUp",run:w1,shift:C1},{key:"ArrowDown",run:G1,shift:rv,preventDefault:!0},{mac:"Cmd-ArrowDown",run:R1,shift:D1},{mac:"Ctrl-ArrowDown",run:nm,shift:A1},{key:"PageUp",run:w1,shift:C1},{key:"PageDown",run:nm,shift:A1},{key:"Home",run:S1,shift:O1,preventDefault:!0},{key:"Mod-Home",run:E1,shift:M1},{key:"End",run:x1,shift:T1,preventDefault:!0},{key:"Mod-End",run:R1,shift:D1},{key:"Enter",run:OE},{key:"Mod-a",run:pE},{key:"Backspace",run:im,shift:im},{key:"Delete",run:ov},{key:"Mod-Backspace",mac:"Alt-Backspace",run:av},{key:"Mod-Delete",mac:"Alt-Delete",run:bE},{mac:"Mod-Backspace",run:_E},{mac:"Mod-Delete",run:lv}].concat(ME.map(r=>({mac:r.key,run:r.run,shift:r.shift}))),pv=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:rE,shift:fE},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:nE,shift:uE},{key:"Alt-ArrowUp",run:wE},{key:"Shift-Alt-ArrowUp",run:SE},{key:"Alt-ArrowDown",run:xE},{key:"Shift-Alt-ArrowDown",run:CE},{key:"Escape",run:yE},{key:"Mod-Enter",run:EE},{key:"Alt-l",mac:"Ctrl-l",run:mE},{key:"Mod-i",run:gE,preventDefault:!0},{key:"Mod-[",run:dv},{key:"Mod-]",run:hv},{key:"Mod-Alt-\\",run:RE},{key:"Shift-Mod-k",run:AE},{key:"Shift-Mod-\\",run:aE},{key:"Mod-/",run:LO},{key:"Alt-A",run:BO}].concat(DE),mv={key:"Tab",run:hv,shift:dv};function Me(){var r=arguments[0];typeof r=="string"&&(r=document.createElement(r));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=t[n];typeof i=="string"?r.setAttribute(n,i):i!=null&&(r[n]=i)}e++}for(;e<arguments.length;e++)gv(r,arguments[e]);return r}function gv(r,e){if(typeof e=="string")r.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)r.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)gv(r,e[t]);else throw new RangeError("Unsupported child node: "+e)}var yv=typeof String.prototype.normalize=="function"?r=>r.normalize("NFKD"):r=>r,ki=class{constructor(e,t,n=0,i=e.length,o){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,i),this.bufferStart=n,this.normalize=o?s=>o(yv(s)):yv,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return lt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=za(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=er(e);let i=this.normalize(t);for(let o=0,s=n;;o++){let a=i.charCodeAt(o),l=this.match(a,s);if(l)return this.value=l,this;if(o==i.length-1)break;s==n&&o<t.length&&t.charCodeAt(o)==a&&s++}}}match(e,t){let n=null;for(let i=0;i<this.matches.length;i+=2){let o=this.matches[i],s=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?n={from:this.matches[i+1],to:t+1}:(this.matches[i]++,s=!0)),s||(this.matches.splice(i,2),i-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:t,to:t+1}:this.matches.push(1,t)),n}};typeof Symbol<"u"&&(ki.prototype[Symbol.iterator]=function(){return this});var kv={from:-1,to:-1,match:/.*/.exec("")},pm="gm"+(/x/.unicode==null?"":"u"),ou=class{constructor(e,t,n,i=0,o=e.length){if(this.to=o,this.curLine="",this.done=!1,this.value=kv,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new su(e,t,n,i,o);this.re=new RegExp(t,pm+(n?.ignoreCase?"i":"")),this.iter=e.iter();let s=e.lineAt(i);this.curLineStart=s.from,this.matchPos=i,this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let n=this.curLineStart+t.index,i=n+t[0].length;if(this.matchPos=i+(n==i?1:0),n==this.curLine.length&&this.nextLine(),n<i||n>this.value.to)return this.value={from:n,to:i,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}},lm=new WeakMap,_i=class{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,n){let i=lm.get(e);if(!i||i.from>=n||i.to<=t){let a=new _i(t,e.sliceString(t,n));return lm.set(e,a),a}if(i.from==t&&i.to==n)return i;let{text:o,from:s}=i;return s>t&&(o=e.sliceString(t,s)+o,s=t),i.to<n&&(o+=e.sliceString(i.to,n)),lm.set(e,new _i(s,o)),new _i(t,o.slice(t-s,n-s))}},su=class{constructor(e,t,n,i,o){this.text=e,this.to=o,this.done=!1,this.value=kv,this.matchPos=i,this.re=new RegExp(t,pm+(n?.ignoreCase?"i":"")),this.flat=_i.get(e,i,this.chunkEnd(i+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t&&this.flat.to<this.to&&t.index+t[0].length>this.flat.text.length-10&&(t=null),t){let n=this.flat.from+t.index,i=n+t[0].length;return this.value={from:n,to:i,match:t},this.matchPos=i+(n==i?1:0),this}else{if(this.flat.to==this.to)return this.done=!0,this;this.flat=_i.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}};typeof Symbol<"u"&&(ou.prototype[Symbol.iterator]=su.prototype[Symbol.iterator]=function(){return this});function NE(r){try{return new RegExp(r,pm),!0}catch{return!1}}function cm(r){let e=Me("input",{class:"cm-textfield",name:"line"}),t=Me("form",{class:"cm-gotoLine",onkeydown:i=>{i.keyCode==27?(i.preventDefault(),r.dispatch({effects:au.of(!1)}),r.focus()):i.keyCode==13&&(i.preventDefault(),n())},onsubmit:i=>{i.preventDefault(),n()}},Me("label",r.state.phrase("Go to line"),": ",e)," ",Me("button",{class:"cm-button",type:"submit"},r.state.phrase("go")));function n(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!i)return;let{state:o}=r,s=o.doc.lineAt(o.selection.main.head),[,a,l,c,f]=i,u=c?+c.slice(1):0,h=l?+l:s.number;if(l&&f){let m=h/100;a&&(m=m*(a=="-"?-1:1)+s.number/o.doc.lines),h=Math.round(o.doc.lines*m)}else l&&a&&(h=h*(a=="-"?-1:1)+s.number);let d=o.doc.line(Math.max(1,Math.min(o.doc.lines,h)));r.dispatch({effects:au.of(!1),selection:N.cursor(d.from+Math.max(0,Math.min(u,d.length))),scrollIntoView:!0}),r.focus()}return{dom:t}}var au=ae.define(),bv=Ee.define({create(){return!0},update(r,e){for(let t of e.effects)t.is(au)&&(r=t.value);return r},provide:r=>ho.from(r,e=>e?cm:null)}),PE=r=>{let e=mo(r,cm);if(!e){let t=[au.of(!0)];r.state.field(bv,!1)==null&&t.push(ae.appendConfig.of([bv,LE])),r.dispatch({effects:t}),e=mo(r,cm)}return e&&e.dom.querySelector("input").focus(),!0},LE=G.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),IE={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},wv=Z.define({combine(r){return Kt(r,IE,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function xv(r){let e=[FE,$E];return r&&e.push(wv.of(r)),e}var BE=Y.mark({class:"cm-selectionMatch"}),zE=Y.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function _v(r,e,t,n){return(t==0||r(e.sliceDoc(t-1,t))!=at.Word)&&(n==e.doc.length||r(e.sliceDoc(n,n+1))!=at.Word)}function jE(r,e,t,n){return r(e.sliceDoc(t,t+1))==at.Word&&r(e.sliceDoc(n-1,n))==at.Word}var $E=Pe.fromClass(class{constructor(r){this.decorations=this.getDeco(r)}update(r){(r.selectionSet||r.docChanged||r.viewportChanged)&&(this.decorations=this.getDeco(r.view))}getDeco(r){let e=r.state.facet(wv),{state:t}=r,n=t.selection;if(n.ranges.length>1)return Y.none;let i=n.main,o,s=null;if(i.empty){if(!e.highlightWordAroundCursor)return Y.none;let l=t.wordAt(i.head);if(!l)return Y.none;s=t.charCategorizer(i.head),o=t.sliceDoc(l.from,l.to)}else{let l=i.to-i.from;if(l<e.minSelectionLength||l>200)return Y.none;if(e.wholeWords){if(o=t.sliceDoc(i.from,i.to),s=t.charCategorizer(i.head),!(_v(s,t,i.from,i.to)&&jE(s,t,i.from,i.to)))return Y.none}else if(o=t.sliceDoc(i.from,i.to).trim(),!o)return Y.none}let a=[];for(let l of r.visibleRanges){let c=new ki(t.doc,o,l.from,l.to);for(;!c.next().done;){let{from:f,to:u}=c.value;if((!s||_v(s,t,f,u))&&(i.empty&&f<=i.from&&u>=i.to?a.push(zE.range(f,u)):(f>=i.to||u<=i.from)&&a.push(BE.range(f,u)),a.length>e.maxMatches))return Y.none}}return Y.set(a)}},{decorations:r=>r.decorations}),FE=G.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),VE=({state:r,dispatch:e})=>{let{selection:t}=r,n=N.create(t.ranges.map(i=>r.wordAt(i.head)||N.cursor(i.head)),t.mainIndex);return n.eq(t)?!1:(e(r.update({selection:n})),!0)};function UE(r,e){let{main:t,ranges:n}=r.selection,i=r.wordAt(t.head),o=i&&i.from==t.from&&i.to==t.to;for(let s=!1,a=new ki(r.doc,e,n[n.length-1].to);;)if(a.next(),a.done){if(s)return null;a=new ki(r.doc,e,0,Math.max(0,n[n.length-1].from-1)),s=!0}else{if(s&&n.some(l=>l.from==a.value.from))continue;if(o){let l=r.wordAt(a.value.from);if(!l||l.from!=a.value.from||l.to!=a.value.to)continue}return a.value}}var HE=({state:r,dispatch:e})=>{let{ranges:t}=r.selection;if(t.some(o=>o.from===o.to))return VE({state:r,dispatch:e});let n=r.sliceDoc(t[0].from,t[0].to);if(r.selection.ranges.some(o=>r.sliceDoc(o.from,o.to)!=n))return!1;let i=UE(r,n);return i?(e(r.update({selection:r.selection.addRange(N.range(i.from,i.to),!1),effects:G.scrollIntoView(i.to)})),!0):!1},mm=Z.define({combine(r){var e;return{top:r.reduce((t,n)=>t??n.top,void 0)||!1,caseSensitive:r.reduce((t,n)=>t??n.caseSensitive,void 0)||!1,createPanel:((e=r.find(t=>t.createPanel))===null||e===void 0?void 0:e.createPanel)||(t=>new dm(t))}}});var lu=class{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||NE(this.search)),this.unquoted=e.literal?this.search:this.search.replace(/\\([nrt\\])/g,(t,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp}create(){return this.regexp?new um(this):new fm(this)}getCursor(e,t=0,n=e.length){return this.regexp?Es(this,e,t,n):Os(this,e,t,n)}},cu=class{constructor(e){this.spec=e}};function Os(r,e,t,n){return new ki(e,r.unquoted,t,n,r.caseSensitive?void 0:i=>i.toLowerCase())}var fm=class extends cu{constructor(e){super(e)}nextMatch(e,t,n){let i=Os(this.spec,e,n,e.length).nextOverlapping();return i.done&&(i=Os(this.spec,e,0,t).nextOverlapping()),i.done?null:i.value}prevMatchInRange(e,t,n){for(let i=n;;){let o=Math.max(t,i-1e4-this.spec.unquoted.length),s=Os(this.spec,e,o,i),a=null;for(;!s.nextOverlapping().done;)a=s.value;if(a)return a;if(o==t)return null;i-=1e4}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.length)}getReplacement(e){return this.spec.replace}matchAll(e,t){let n=Os(this.spec,e,0,e.length),i=[];for(;!n.next().done;){if(i.length>=t)return null;i.push(n.value)}return i}highlight(e,t,n,i){let o=Os(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.length));for(;!o.next().done;)i(o.value.from,o.value.to)}};function Es(r,e,t,n){return new ou(e,r.search,r.caseSensitive?void 0:{ignoreCase:!0},t,n)}var um=class extends cu{nextMatch(e,t,n){let i=Es(this.spec,e,n,e.length).next();return i.done&&(i=Es(this.spec,e,0,t).next()),i.done?null:i.value}prevMatchInRange(e,t,n){for(let i=1;;i++){let o=Math.max(t,n-i*1e4),s=Es(this.spec,e,o,n),a=null;for(;!s.next().done;)a=s.value;if(a&&(o==t||a.from>o+10))return a;if(o==t)return null}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.length)}getReplacement(e){return this.spec.replace.replace(/\$([$&\d+])/g,(t,n)=>n=="$"?"$":n=="&"?e.match[0]:n!="0"&&+n<e.match.length?e.match[n]:t)}matchAll(e,t){let n=Es(this.spec,e,0,e.length),i=[];for(;!n.next().done;){if(i.length>=t)return null;i.push(n.value)}return i}highlight(e,t,n,i){let o=Es(this.spec,e,Math.max(0,t-250),Math.min(n+250,e.length));for(;!o.next().done;)i(o.value.from,o.value.to)}},pl=ae.define(),gm=ae.define(),vi=Ee.define({create(r){return new dl(hm(r).create(),null)},update(r,e){for(let t of e.effects)t.is(pl)?r=new dl(t.value.create(),r.panel):t.is(gm)&&(r=new dl(r.query,t.value?ym:null));return r},provide:r=>ho.from(r,e=>e.panel)});var dl=class{constructor(e,t){this.query=e,this.panel=t}},WE=Y.mark({class:"cm-searchMatch"}),qE=Y.mark({class:"cm-searchMatch cm-searchMatch-selected"}),KE=Pe.fromClass(class{constructor(r){this.view=r,this.decorations=this.highlight(r.state.field(vi))}update(r){let e=r.state.field(vi);(e!=r.startState.field(vi)||r.docChanged||r.selectionSet||r.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:r,panel:e}){if(!e||!r.spec.valid)return Y.none;let{view:t}=this,n=new cr;for(let i=0,o=t.visibleRanges,s=o.length;i<s;i++){let{from:a,to:l}=o[i];for(;i<s-1&&l>o[i+1].from-2*250;)l=o[++i].to;r.highlight(t.state.doc,a,l,(c,f)=>{let u=t.state.selection.ranges.some(h=>h.from==c&&h.to==f);n.add(c,f,u?qE:WE)})}return n.finish()}},{decorations:r=>r.decorations});function ml(r){return e=>{let t=e.state.field(vi,!1);return t&&t.query.spec.valid?r(e,t):Sv(e)}}var fu=ml((r,{query:e})=>{let{from:t,to:n}=r.state.selection.main,i=e.nextMatch(r.state.doc,t,n);return!i||i.from==t&&i.to==n?!1:(r.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:bm(r,i),userEvent:"select.search"}),!0)}),uu=ml((r,{query:e})=>{let{state:t}=r,{from:n,to:i}=t.selection.main,o=e.prevMatch(t.doc,n,i);return o?(r.dispatch({selection:{anchor:o.from,head:o.to},scrollIntoView:!0,effects:bm(r,o),userEvent:"select.search"}),!0):!1}),GE=ml((r,{query:e})=>{let t=e.matchAll(r.state.doc,1e3);return!t||!t.length?!1:(r.dispatch({selection:N.create(t.map(n=>N.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),ZE=({state:r,dispatch:e})=>{let t=r.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:n,to:i}=t.main,o=[],s=0;for(let a=new ki(r.doc,r.sliceDoc(n,i));!a.next().done;){if(o.length>1e3)return!1;a.value.from==n&&(s=o.length),o.push(N.range(a.value.from,a.value.to))}return e(r.update({selection:N.create(o,s),userEvent:"select.search.matches"})),!0},vv=ml((r,{query:e})=>{let{state:t}=r,{from:n,to:i}=t.selection.main;if(t.readOnly)return!1;let o=e.nextMatch(t.doc,n,n);if(!o)return!1;let s=[],a,l;if(o.from==n&&o.to==i&&(l=t.toText(e.getReplacement(o)),s.push({from:o.from,to:o.to,insert:l}),o=e.nextMatch(t.doc,o.from,o.to)),o){let c=s.length==0||s[0].from>=o.to?0:o.to-o.from-l.length;a={anchor:o.from-c,head:o.to-c}}return r.dispatch({changes:s,selection:a,scrollIntoView:!!a,effects:o?bm(r,o):void 0,userEvent:"input.replace"}),!0}),JE=ml((r,{query:e})=>{if(r.state.readOnly)return!1;let t=e.matchAll(r.state.doc,1e9).map(n=>{let{from:i,to:o}=n;return{from:i,to:o,insert:e.getReplacement(n)}});return t.length?(r.dispatch({changes:t,userEvent:"input.replace.all"}),!0):!1});function ym(r){return r.state.facet(mm).createPanel(r)}function hm(r,e){var t;let n=r.selection.main,i=n.empty||n.to>n.from+100?"":r.sliceDoc(n.from,n.to),o=(t=e?.caseSensitive)!==null&&t!==void 0?t:r.facet(mm).caseSensitive;return e&&!i?e:new lu({search:i.replace(/\n/g,"\\n"),caseSensitive:o})}var Sv=r=>{let e=r.state.field(vi,!1);if(e&&e.panel){let t=mo(r,ym);if(!t)return!1;let n=t.dom.querySelector("[name=search]");if(n!=r.root.activeElement){let i=hm(r.state,e.query.spec);i.valid&&r.dispatch({effects:pl.of(i)}),n.focus(),n.select()}}else r.dispatch({effects:[gm.of(!0),e?pl.of(hm(r.state,e.query.spec)):ae.appendConfig.of(XE)]});return!0},Cv=r=>{let e=r.state.field(vi,!1);if(!e||!e.panel)return!1;let t=mo(r,ym);return t&&t.dom.contains(r.root.activeElement)&&r.focus(),r.dispatch({effects:gm.of(!1)}),!0},Av=[{key:"Mod-f",run:Sv,scope:"editor search-panel"},{key:"F3",run:fu,shift:uu,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:fu,shift:uu,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Cv,scope:"editor search-panel"},{key:"Mod-Shift-l",run:ZE},{key:"Alt-g",run:PE},{key:"Mod-d",run:HE,preventDefault:!0}],dm=class{constructor(e){this.view=e;let t=this.query=e.state.field(vi).query.spec;this.commit=this.commit.bind(this),this.searchField=Me("input",{value:t.search,placeholder:Lr(e,"Find"),"aria-label":Lr(e,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit}),this.replaceField=Me("input",{value:t.replace,placeholder:Lr(e,"Replace"),"aria-label":Lr(e,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=Me("input",{type:"checkbox",name:"case",checked:t.caseSensitive,onchange:this.commit}),this.reField=Me("input",{type:"checkbox",name:"re",checked:t.regexp,onchange:this.commit});function n(i,o,s){return Me("button",{class:"cm-button",name:i,onclick:o,type:"button"},s)}this.dom=Me("div",{onkeydown:i=>this.keydown(i),class:"cm-search"},[this.searchField,n("next",()=>fu(e),[Lr(e,"next")]),n("prev",()=>uu(e),[Lr(e,"previous")]),n("select",()=>GE(e),[Lr(e,"all")]),Me("label",null,[this.caseField,Lr(e,"match case")]),Me("label",null,[this.reField,Lr(e,"regexp")]),...e.state.readOnly?[]:[Me("br"),this.replaceField,n("replace",()=>vv(e),[Lr(e,"replace")]),n("replaceAll",()=>JE(e),[Lr(e,"replace all")]),Me("button",{name:"close",onclick:()=>Cv(e),"aria-label":Lr(e,"close"),type:"button"},["\xD7"])]])}commit(){let e=new lu({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:pl.of(e)}))}keydown(e){s_(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?uu:fu)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),vv(this.view))}update(e){for(let t of e.transactions)for(let n of t.effects)n.is(pl)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(mm).top}};function Lr(r,e){return r.state.phrase(e)}var nu=30,iu=/[\s\.,:;?!]/;function bm(r,{from:e,to:t}){let n=r.state.doc.lineAt(e).from,i=r.state.doc.lineAt(t).to,o=Math.max(n,e-nu),s=Math.min(i,t+nu),a=r.state.sliceDoc(o,s);if(o!=n){for(let l=0;l<nu;l++)if(!iu.test(a[l+1])&&iu.test(a[l])){a=a.slice(l);break}}if(s!=i){for(let l=a.length-1;l>a.length-nu;l--)if(!iu.test(a[l-1])&&iu.test(a[l])){a=a.slice(0,l);break}}return G.announce.of(`${r.state.phrase("current match")}. ${a} ${r.state.phrase("on line")} ${r.state.doc.lineAt(e).number}`)}var YE=G.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),XE=[vi,Fn.lowest(KE),YE];var vm=class{constructor(e,t,n){this.from=e,this.to=t,this.diagnostic=n}},Kn=class{constructor(e,t,n){this.diagnostics=e,this.panel=t,this.selected=n}static init(e,t,n){let i=e,o=n.facet(Rs).markerFilter;o&&(i=o(i));let s=Y.set(i.map(a=>a.from==a.to||a.from==a.to-1&&n.doc.lineAt(a.from).to==a.from?Y.widget({widget:new km(a),diagnostic:a}).range(a.from):Y.mark({attributes:{class:"cm-lintRange cm-lintRange-"+a.severity},diagnostic:a}).range(a.from,a.to)),!0);return new Kn(s,t,Ms(s))}};function Ms(r,e=null,t=0){let n=null;return r.between(t,1e9,(i,o,{spec:s})=>{if(!(e&&s.diagnostic!=e))return n=new vm(i,o,s.diagnostic),!1}),n}function QE(r,e){return!!(r.effects.some(t=>t.is(wm))||r.changes.touchesRange(e.pos))}function Ov(r,e){return r.field(dr,!1)?e:e.concat(ae.appendConfig.of([dr,G.decorations.compute([dr],t=>{let{selected:n,panel:i}=t.field(dr);return!n||!i||n.from==n.to?Y.none:Y.set([tR.range(n.from,n.to)])}),__(rR,{hideOn:QE}),lR]))}function eR(r,e){return{effects:Ov(r,[wm.of(e)])}}var wm=ae.define(),xm=ae.define(),Ev=ae.define(),dr=Ee.define({create(){return new Kn(Y.none,null,null)},update(r,e){if(e.docChanged){let t=r.diagnostics.map(e.changes),n=null;if(r.selected){let i=e.changes.mapPos(r.selected.from,1);n=Ms(t,r.selected.diagnostic,i)||Ms(t,null,i)}r=new Kn(t,r.panel,n)}for(let t of e.effects)t.is(wm)?r=Kn.init(t.value,r.panel,e.state):t.is(xm)?r=new Kn(r.diagnostics,t.value?Ds.open:null,r.selected):t.is(Ev)&&(r=new Kn(r.diagnostics,r.panel,t.value));return r},provide:r=>[ho.from(r,e=>e.panel),G.decorations.from(r,e=>e.diagnostics)]});var tR=Y.mark({class:"cm-lintRange cm-lintRange-active"});function rR(r,e,t){let{diagnostics:n}=r.state.field(dr),i=[],o=2e8,s=0;n.between(e-(t<0?1:0),e+(t>0?1:0),(l,c,{spec:f})=>{e>=l&&e<=c&&(l==c||(e>l||t>0)&&(e<c||t<0))&&(i.push(f.diagnostic),o=Math.min(l,o),s=Math.max(c,s))});let a=r.state.facet(Rs).tooltipFilter;return a&&(i=a(i)),i.length?{pos:o,end:s,above:r.state.doc.lineAt(o).to<s,create(){return{dom:nR(r,i)}}}:null}function nR(r,e){return Me("ul",{class:"cm-tooltip-lint"},e.map(t=>Dv(r,t,!1)))}var iR=r=>{let e=r.state.field(dr,!1);(!e||!e.panel)&&r.dispatch({effects:Ov(r.state,[xm.of(!0)])});let t=mo(r,Ds.open);return t&&t.dom.querySelector(".cm-panel-lint ul").focus(),!0},Tv=r=>{let e=r.state.field(dr,!1);return!e||!e.panel?!1:(r.dispatch({effects:xm.of(!1)}),!0)},oR=r=>{let e=r.state.field(dr,!1);if(!e)return!1;let t=r.state.selection.main,n=e.diagnostics.iter(t.to+1);return!n.value&&(n=e.diagnostics.iter(0),!n.value||n.from==t.from&&n.to==t.to)?!1:(r.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},Rv=[{key:"Mod-Shift-m",run:iR},{key:"F8",run:oR}],sR=Pe.fromClass(class{constructor(r){this.view=r,this.timeout=-1,this.set=!0;let{delay:e}=r.state.facet(Rs);this.lintTime=Date.now()+e,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,e)}run(){let r=Date.now();if(r<this.lintTime-10)setTimeout(this.run,this.lintTime-r);else{this.set=!1;let{state:e}=this.view,{sources:t}=e.facet(Rs);Promise.all(t.map(n=>Promise.resolve(n(this.view)))).then(n=>{let i=n.reduce((o,s)=>o.concat(s));this.view.state.doc==e.doc&&this.view.dispatch(eR(this.view.state,i))},n=>{Pt(this.view.state,n)})}}update(r){let e=r.state.facet(Rs);(r.docChanged||e!=r.startState.facet(Rs))&&(this.lintTime=Date.now()+e.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,e.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),Rs=Z.define({combine(r){return Object.assign({sources:r.map(e=>e.source)},Kt(r.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null}))},enables:sR});function Mv(r){let e=[];if(r)e:for(let{name:t}of r){for(let n=0;n<t.length;n++){let i=t[n];if(/[a-zA-Z]/.test(i)&&!e.some(o=>o.toLowerCase()==i.toLowerCase())){e.push(i);continue e}}e.push("")}return e}function Dv(r,e,t){var n;let i=t?Mv(e.actions):[];return Me("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},Me("span",{class:"cm-diagnosticText"},e.message),(n=e.actions)===null||n===void 0?void 0:n.map((o,s)=>{let a=u=>{u.preventDefault();let h=Ms(r.state.field(dr).diagnostics,e);h&&o.apply(r,h.from,h.to)},{name:l}=o,c=i[s]?l.indexOf(i[s]):-1,f=c<0?l:[l.slice(0,c),Me("u",l.slice(c,c+1)),l.slice(c+1)];return Me("button",{type:"button",class:"cm-diagnosticAction",onclick:a,onmousedown:a,"aria-label":` Action: ${l}${c<0?"":` (access key "${i[s]})"`}.`},f)}),e.source&&Me("div",{class:"cm-diagnosticSource"},e.source))}var km=class extends ur{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return Me("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}},hu=class{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Dv(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}},Ds=class{constructor(e){this.view=e,this.items=[];let t=i=>{if(i.keyCode==27)Tv(this.view),this.view.focus();else if(i.keyCode==38||i.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(i.keyCode==40||i.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(i.keyCode==36)this.moveSelection(0);else if(i.keyCode==35)this.moveSelection(this.items.length-1);else if(i.keyCode==13)this.view.focus();else if(i.keyCode>=65&&i.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:o}=this.items[this.selectedIndex],s=Mv(o.actions);for(let a=0;a<s.length;a++)if(s[a].toUpperCase().charCodeAt(0)==i.keyCode){let l=Ms(this.view.state.field(dr).diagnostics,o);l&&o.actions[a].apply(e,l.from,l.to)}}else return;i.preventDefault()},n=i=>{for(let o=0;o<this.items.length;o++)this.items[o].dom.contains(i.target)&&this.moveSelection(o)};this.list=Me("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:n}),this.dom=Me("div",{class:"cm-panel-lint"},this.list,Me("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>Tv(this.view)},"\xD7")),this.update()}get selectedIndex(){let e=this.view.state.field(dr).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(dr),n=0,i=!1,o=null;for(e.between(0,this.view.state.doc.length,(s,a,{spec:l})=>{let c=-1,f;for(let u=n;u<this.items.length;u++)if(this.items[u].diagnostic==l.diagnostic){c=u;break}c<0?(f=new hu(this.view,l.diagnostic),this.items.splice(n,0,f),i=!0):(f=this.items[c],c>n&&(this.items.splice(n,c-n),i=!0)),t&&f.diagnostic==t.diagnostic?f.dom.hasAttribute("aria-selected")||(f.dom.setAttribute("aria-selected","true"),o=f):f.dom.hasAttribute("aria-selected")&&f.dom.removeAttribute("aria-selected"),n++});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)i=!0,this.items.pop();this.items.length==0&&(this.items.push(new hu(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),i=!0),o?(this.list.setAttribute("aria-activedescendant",o.id),this.view.requestMeasure({key:this,read:()=>({sel:o.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:s,panel:a})=>{s.top<a.top?this.list.scrollTop-=a.top-s.top:s.bottom>a.bottom&&(this.list.scrollTop+=s.bottom-a.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),i&&this.sync()}sync(){let e=this.list.firstChild;function t(){let n=e;e=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;e!=n.dom;)t();e=n.dom.nextSibling}else this.list.insertBefore(n.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(dr),n=Ms(t.diagnostics,this.items[e].diagnostic);!n||this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:Ev.of(n)})}static open(e){return new Ds(e)}};function aR(r,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(r)}</svg>')`}function _m(r){return aR(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${r}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}var lR=G.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:_m("#d11")},".cm-lintRange-warning":{backgroundImage:_m("orange")},".cm-lintRange-info":{backgroundImage:_m("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});var Nv=[S_(),C_(),p_(),I1(),J_(),c_(),d_(),de.allowMultipleSelections.of(!0),V_(),X_(Q_,{fallback:!0}),n1(),y1(),Gf(),g_(),y_(),m_(),xv(),po.of([...v1,...pv,...Av,...F1,...K_,...em,...Rv])];var Tz=Object.freeze({assertNever(r){throw new Error(`'${String(r)}' is not of type 'never'`)}});var Pv=Object.freeze({is(r){return r.startsWith("http:")||r.startsWith("https:")}}),Ez=Object.freeze({mock(r){return new Sm(r)}}),Sm=class{options;constructor(e){this.options=e}async get(e){if(!this.options.fixtures[e])throw new Error(`404 not found: ${e}`);let t=this.options.fixtures[e];return t instanceof Uint8Array?t:typeof t=="string"?new TextEncoder().encode(t):new TextEncoder().encode(JSON.stringify(t))}};var Ns;(function(r){function e(){return console}r.create=e;function t(){return new Cm}r.noop=t})(Ns||(Ns={}));var Cm=class{error(){}info(){}log(){}warn(){}};var gl=class{parent;constructor(e){this.parent=e}undoOps=[];redoOps=[];addUndoOp(e){this.undoOps.push(e),this.parent?.addUndoOp(e)}addRedoOp(e){this.redoOps.push(e),this.parent?.addRedoOp(e)}set(e,t,n,i=e){let o=Reflect.get(e,t,i),s=()=>{Reflect.set(e,t,n,i)},a=()=>{Reflect.set(e,t,o,i)};this.addRedoOp(s),this.addUndoOp(a),s()}undo(){for(let e=this.undoOps.length-1;e>=0;e--)this.undoOps[e]()}redo(){this.redoOps.forEach(e=>e())}};var zv=pn(du(),1),jv=pn(pu(),1),tr=URL;function wo(r=e=>e[0]){return(e,t,n)=>{let i=new Map,o=n.value;return n.value=function(...s){let a=r(s);if(i.has(a))return i.get(a);let l=o.apply(this,s).then(c=>(i.delete(a),c),c=>(i.delete(a),Promise.reject(c)));return i.set(a,l),l},n}}var se;(function(r){r.TagPrefix="#",r.NamespacePathSep=":",r.PathSep="/",r.DefaultNamespace="minecraft";function e(n){switch(n.indexOf(r.NamespacePathSep)){case-1:return`${r.DefaultNamespace}${r.NamespacePathSep}${n}`;case 0:return`${r.DefaultNamespace}${n}`;default:return n}}r.lengthen=e;function t(n){return n.replace(/^(?:minecraft)?:/,"")}r.shorten=t})(se||(se={}));function Ir(r){return new TextDecoder().decode(r)}var Le;(function(r){function e(n,i){return Array.isArray(n)?n.every(o=>i(o)):i(n)}r.is=e;function t(n){return Array.isArray(n)?n:[n]}r.toArray=t})(Le||(Le={}));var wi;(function(r){function e(t){return typeof t=="string"}r.isString=e})(wi||(wi={}));async function Am(r,e){return JSON.parse(Ir(await r.archive.gunzip(e)))}function Bv(r){return!!r&&typeof r=="object"&&!Array.isArray(r)}function yl(r,e){let t=(0,jv.default)()(r);for(let[n,i]of Object.entries(e))Bv(t[n])&&Bv(i)?t[n]=yl(t[n],i):i===void 0?delete t[n]:t[n]=i;return t}var xi;(function(r){let e=Symbol("LazyDiscriminator");function t(s){return{discriminator:e,getter:s}}r.create=t;function n(s){return s?.discriminator===e}r.isComplex=n;function i(s){return n(s)&&!("value"in s)}r.isUnresolved=i;function o(s){return i(s)?s.value=s.getter():s}r.resolve=o})(xi||(xi={}));function xo(r,e,t){let n={};e=e.map(se.lengthen);for(let i of e)t.symbols.query(t.doc,r,i).forEachMember((o,s)=>{let a=Object.keys(s.visibleMembers),l=n[o]??=new Set,c=s.symbol?.relations?.default;c&&l.add(c.path[c.path.length-1]);for(let f of a)l.add(f)});return Object.fromEntries(Object.entries(n).map(([i,o])=>[i,[...o]]))}var $v=zv.default;function Fv(r){return!!r[Symbol.iterator]}function Vv(r,e){return e>=0?r?.[e]:r?.[r.length+e]}function Ls(r,e,t){if(r.has(e)){let n=r.get(e);return t.update&&(n=t.update(n,e,r),r.set(e,n)),n}else if(t.insert){let n=t.insert(e,r);return r.set(e,n),n}else throw new Error(`No key ${e} in map and no insert handler provided`)}function mu(r){return typeof r=="function"||!!r&&typeof r=="object"}var uR=Object.freeze({create(r){return new Proxy(r,new Tm)}}),Tm=class{map=new Map;get(e,t,n){let i=Reflect.get(e,t,n);return t!=="prototype"&&mu(i)?Ls(this.map,t,{insert:()=>uR.create(i)}):i}set(e,t,n,i){throw new TypeError(`Cannot set property '${String(t)}' on a readonly proxy`)}deleteProperty(e,t){throw new TypeError(`Cannot delete property '${String(t)}' on a readonly proxy`)}};var Om=Symbol("StateBranchOff"),Em=Symbol("IsStateProxy"),Rm=Symbol("OriginState"),Mm=Symbol("RedoStateChanges"),Dm=Symbol("UndoStateChanges"),zt=Object.freeze({branchOff(r){return r[Om]()},create(r){if(zt.is(r))throw new TypeError("Cannot create a proxy over a proxy. You might want to use branchOff instead.");return Pm(r,new gl)},dereference(r){return zt.is(r)?r[Rm]:r},is(r){return r?.[Em]},redoChanges(r){r[Mm]()},undoChanges(r){r[Dm]()}}),gu,Uv,Nm=class{constructor(e){U(this,gu);ce(this,"rootOps");ce(this,"map",new Map);this.rootOps=e}get(e,t,n){switch(t){case Om:return()=>a0(this,gu,Uv).call(this,e);case Em:return!0;case Rm:return e;case Mm:return()=>this.rootOps.redo();case Dm:return()=>this.rootOps.undo()}let i=Reflect.get(e,t,n);return t!=="prototype"&&mu(i)?Ls(this.map,t,{insert:()=>Pm(i,this.rootOps)}):i}set(e,t,n,i){if(t===Om||t===Em||t===Rm||t===Mm||t===Dm)throw new TypeError(`Cannot set ${String(t)}`);return this.rootOps.set(e,t,zt.dereference(n),i),!0}};gu=new WeakSet,Uv=function(e){return Pm(e,new gl(this.rootOps))};function Pm(r,e){return new Proxy(r,new Nm(e))}var yu=class{_map=new Map;_reversedMap=new Map;constructor(e=[]){for(let[t,n]of e)this._map.set(t,n),this._reversedMap.set(n,t)}get size(){return this._map.size}clear(){this._map.clear(),this._reversedMap.clear()}delete(e){let t=this._map.get(e),n=this._map.delete(e);return t!==void 0&&this._reversedMap.delete(t),n}deleteValue(e){let t=this._reversedMap.get(e),n=this._reversedMap.delete(e);return t!==void 0&&this._map.delete(t),n}get(e){return this._map.get(e)}getKey(e){return this._reversedMap.get(e)}has(e){return this._map.has(e)}hasValue(e){return this._reversedMap.has(e)}set(e,t){return this._map.set(e,t),this._reversedMap.set(t,e),this}forEach(e,t){for(let[n,i]of this._map)e.apply(t,[i,n,this])}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.values()}[Symbol.iterator](){return this._map.entries()}[Symbol.toStringTag]="TwoWayMap"};var Wv=pn(du(),1);var hR=`\r
`,So="\r",Co=`
`,Hv=Object.freeze([" ",`
`,"\r","	"]),Ao=class{string;indexMap;innerCursor=0;constructor(e,t=[]){this.string=e,this.indexMap=t}get cursor(){return An.toOuterOffset(this.indexMap,this.innerCursor)}getCharRange(e=0){return An.toOuterRange(this.indexMap,k.create(this.innerCursor+e,this.innerCursor+e+1))}peek(e=1,t=0){return this.string.slice(this.innerCursor+t,this.innerCursor+t+e)}tryPeek(e,t=0){return this.peek(e.length,t)===e}tryPeekAfterWhitespace(e){let t=this.string.length-this.innerCursor,n=0;for(;n<t&&Ke.isWhitespace(this.peek(1,n));)n++;return this.tryPeek(e,n)}peekUntil(...e){let t="";for(let n=this.innerCursor;n<this.string.length;n++){let i=this.string.charAt(n);if(e.includes(i))return t;t+=i}return t}peekLine(){return this.peekUntil(So,Co)}hasNonSpaceAheadInLine(){for(let e=this.innerCursor;e<this.string.length;e++){let t=this.string.charAt(e);if(t===So||t===Co)break;if(!(t===" "||t==="	"))return!0}return!1}slice(e,t){if(typeof e=="number"){let i=An.toInnerOffset(this.indexMap,e),o=t!==void 0?An.toInnerOffset(this.indexMap,t):void 0;return this.string.slice(i,o)}let n=An.toInnerRange(this.indexMap,k.get(e));return this.string.slice(n.start,n.end)}sliceToCursor(e){let t=An.toInnerOffset(this.indexMap,e);return this.string.slice(t,this.innerCursor)}},Ke=class extends Ao{string;indexMap;constructor(e,t=[]){super(e,t),this.string=e,this.indexMap=t}get cursor(){return super.cursor}set cursor(e){this.innerCursor=An.toInnerOffset(this.indexMap,e)}clone(){let e=new Ke(this.string,this.indexMap);return e.innerCursor=this.innerCursor,e}canRead(e=1){return this.innerCursor+e<=this.string.length}canReadInLine(){return this.canRead()&&this.peek()!==So&&this.peek()!==Co}read(){return this.string.charAt(this.innerCursor++)}skip(e=1){return this.innerCursor+=e,this}trySkip(e){return this.peek(e.length)===e?(this.skip(e.length),!0):!1}readLine(){return this.readUntil(So,Co)}skipLine(){return this.readLine(),this}nextLine(){return this.skipLine(),this.peek(2)===hR?this.skip(2):(this.peek()===So||this.peek()===Co)&&this.skip(),this}readSpace(){let e=this.innerCursor;return this.skipSpace(),this.string.slice(e,this.innerCursor)}skipSpace(){for(;this.canRead()&&Ke.isSpace(this.peek());)this.skip();return this}readWhitespace(){let e=this.innerCursor;return this.skipWhitespace(),this.string.slice(e,this.innerCursor)}skipWhitespace(){for(;this.canRead()&&Ke.isWhitespace(this.peek());)this.skip();return this}readIf(e){let t="";for(;this.canRead();){let n=this.peek();if(e(n))this.skip(),t+=n;else break}return t}skipIf(e){return this.readIf(e),this}readUntil(...e){let t="";for(;this.canRead();){let n=this.peek();if(e.includes(n))return t;t+=n,this.skip()}return t}skipUntilOrEnd(...e){return this.readUntil(...e),this}readUntilLineEnd(){return this.readUntil(So,Co)}skipUntilLineEnd(){return this.skipUntilOrEnd(So,Co)}readRemaining(){let e=this.innerCursor;return this.innerCursor=this.string.length,this.string.slice(e)}skipRemaining(){return this.readRemaining(),this}static isDigit(e){return e>="0"&&e<="9"}static isBrigadierQuote(e){return e==='"'||e==="'"}static isNewline(e){return e===`\r
`||e==="\r"||e===`
`}static isSpace(e){return e===" "||e==="	"}static isWhitespace(e){return Ke.isSpace(e)||Ke.isNewline(e)}};var bl;(function(r){function e(t){return typeof t=="function"&&(t=t()),t instanceof Ao&&(t=t.cursor),t}r.get=e})(bl||(bl={}));var k;(function(r){function e(g){let v=typeof g=="function"?g():g;return r.is(v)?r.create(v.start,v.end):Lm.is(v)?r.create(v.range.start,v.range.end):r.create(v)}r.get=e;function t(g,v){return g=bl.get(g),{start:g,end:v!==void 0?bl.get(v):g}}r.create=t;function n(g,v){return{start:r.get(g).start,end:r.get(v).end}}r.span=n;function i(g){return!!g&&typeof g=="object"&&typeof g.start=="number"&&typeof g.end=="number"}r.is=i,r.Beginning=Object.freeze(r.create(0,1)),r.Full=Object.freeze(r.create(0,Number.POSITIVE_INFINITY));function o(g){return`[${g.start}, ${g.end})`}r.toString=o;function s(g,v,T=!1){return g=e(g),g.start<=v&&(T?v<=g.end:v<g.end)}r.contains=s;function a(g,v,T=!1){return g=e(g),v=e(v),s(g,v.start,T)&&s(g,v.end,!0)}r.containsRange=a;function l(g,v){return r.contains(g,v.start)||r.contains(v,g.start)}r.intersects=l;function c(g,v){return g.start===v.start&&g.end===v.end}r.equals=c;function f(g,v,T=!1){return T?g.end<r.get(v).start:g.end<=r.get(v).start}r.endsBefore=f;function u(g){return g=e(g),g.start===g.end}r.isEmpty=u;function h(g){return g.end-g.start}r.length=h;function d(g,v,T=!1){return(T?g.end<v.start:g.end<=v.start)?-1:(T?g.start>v.end:g.start>=v.end)?1:0}r.compare=d;function m(g,v,T=!1){return(T?g.end<v:g.end<=v)?-1:g.start>v?1:0}r.compareOffset=m;function y(g,v,T=v){return g=e(g),{start:g.start+v,end:g.end+T}}r.translate=y})(k||(k={}));var Lm;(function(r){function e(t){return!!t&&typeof t=="object"&&k.is(t.range)}r.is=e})(Lm||(Lm={}));var An;(function(r){function e(a,l,c,f,u){let h=l;for(let d of a){if(k.contains(d[c],l,u))return u?d[f].end:d[f].start;if(k.endsBefore(d[c],l))h=l-d[c].end+d[f].end;else break}return h}function t(a,l){return e(a,l,"outer","inner",!1)}r.toInnerOffset=t;function n(a,l){return k.create(t(a,l.start),e(a,l.end,"outer","inner",!0))}r.toInnerRange=n;function i(a,l){return e(a,l,"inner","outer",!1)}r.toOuterOffset=i;function o(a,l){return k.create(i(a,l.start),e(a,l.end,"inner","outer",!0))}r.toOuterRange=o;function s(a,l){return l.map(c=>({inner:c.inner,outer:o(a,c.outer)}))}r.merge=s})(An||(An={}));var bu;(function(r){function e(t,n,i=3,o){let s={range:n,message:t,severity:i};return o&&(s.info=o),s}r.create=e})(bu||(bu={}));var Jt;(function(r){function e(s,a){return typeof s=="object"?t(s):n(s,a)}r.create=e;function t(s){return{line:s.line??0,character:s.character??0}}function n(s,a){return t({line:s,character:a})}r.Beginning=r.create(0,0),r.Infinity=r.create(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);function i(s){return`<${s.line}, ${s.character}>`}r.toString=i;function o(s,a){return s.line<a.line||s.line===a.line&&s.character<a.character}r.isBefore=o})(Jt||(Jt={}));var Is;(function(r){function e(s,a,l,c){if(typeof s=="number")return{start:Jt.create(s,a),end:Jt.create(l,c)};if(a!==void 0)return{start:Jt.create(s),end:Jt.create(a)};{let f=s;return{start:Jt.create(f.start??{}),end:Jt.create(f.end??{})}}}r.create=e;function t(s,a){let l=k.get(s);return{start:a.positionAt(l.start),end:a.positionAt(l.end)}}r.from=t,r.Beginning=Object.freeze(r.create(0,0,0,1)),r.Full=Object.freeze(r.create(Jt.Beginning,Jt.Infinity));function n(s){return`[${Jt.toString(s.start)}, ${Jt.toString(s.end)})`}r.toString=n;function i(s,a){let{start:l,end:c}=s;return a.line<l.line||a.line>c.line?!1:l.line<a.line&&a.line<c.line?!0:(a.line===l.line?a.character>=l.character:!0)&&(a.line===c.line?a.character<c.character:!0)}r.contains=i;function o(s,a){return Jt.isBefore(Jt.create(s.end.line,s.end.character-1),a)}r.endsBefore=o})(Is||(Is={}));var _u;(function(r){function e(n){return{uri:n.uri??"",range:k.get(n.range??{start:0,end:0}),posRange:n.posRange??{start:{line:0,character:0},end:{line:0,character:0}}}}r.get=e;function t(n,i){return r.get({uri:n.uri,range:i,posRange:Is.from(i,n)})}r.create=t})(_u||(_u={}));var yt;(function(r){function e(u){return!!u&&typeof u=="object"&&typeof u.type=="string"&&k.is(u.range)}r.is=e;function t(u){for(let h of u.children??[])h.parent=u,t(h)}r.setParents=t;function n(u,h,d=!1){if(!u.children)return-1;let m=typeof h=="number"?k.compareOffset:k.compare;return(0,Wv.default)(u.children,h,(y,g)=>m(y.range,g,d))}r.findChildIndex=n;function i(u,h,d=!1){return u.children?.[n(u,h,d)]}r.findChild=i;function o(u,h,d=!1){if(!u.children)return-1;let m=-1;for(let[y,g]of u.children.entries())if(k.endsBefore(g.range,h,d))m=y;else break;return m}r.findLastChildIndex=o;function s(u,h,d=!1){return u.children?.[o(u,h,d)]}r.findLastChild=s;function a({node:u,needle:h,endInclusive:d=!1,predicate:m=()=>!0}){let y,g=k.contains(u,h,d)?u:void 0;for(;g&&m(g);)y=g,g=i(g,h,d);return y}r.findDeepestChild=a;function l({node:u,needle:h,endInclusive:d=!1,predicate:m=()=>!0}){let y=k.contains(u,h,d)?u:void 0;for(;y&&!m(y);)y=i(y,h,d);return y}r.findShallowestChild=l;function*c(u){let h=u;for(;h;)h.locals&&(yield h.locals),h=u.parent}r.getLocalsToRoot=c;function*f(u){u.locals&&(yield u.locals);for(let h of u.children??[])yield*f(h)}r.getLocalsToLeaves=f})(yt||(yt={}));var vu;(function(r){function e(n){return n.type==="boolean"}r.is=e;function t(n){return{type:"boolean",range:k.get(n)}}r.mock=t})(vu||(vu={}));var ku=Object.freeze({is(r){return r?.type==="comment"}});var qv;(function(r){function e(t){return t.type==="error"}r.is=e})(qv||(qv={}));var Bs;(function(r){function e(t){return[...t.parserErrors,...t.binderErrors??[],...t.checkerErrors??[],...t.linterErrors??[]]}r.getErrors=e})(Bs||(Bs={}));var Gn;(function(r){function e(n){return n.type==="float"}r.is=e;function t(n){return{type:"float",range:k.get(n),value:0}}r.mock=t})(Gn||(Gn={}));var zs;(function(r){function e(n){return n.type==="integer"}r.is=e;function t(n){return{type:"integer",range:k.get(n),value:0}}r.mock=t})(zs||(zs={}));var wu;(function(r){function e(t){return t?.type==="item"}r.is=e})(wu||(wu={}));var ht;(function(r){function e(n){return n?.type==="literal"}r.is=e;function t(n,i){return{type:"literal",range:k.get(n),options:i,value:""}}r.mock=t})(ht||(ht={}));var Kv;(function(r){function e(n){return n.type==="long"}r.is=e;function t(n){return{type:"long",range:k.get(n),value:0n}}r.mock=t})(Kv||(Kv={}));var To;(function(r){function e(t){return t?.type==="pair"}r.is=e})(To||(To={}));var le;(function(r){let e=se.TagPrefix,t=se.NamespacePathSep,n=se.PathSep,i=se.DefaultNamespace;function o(l){return l?.type==="resource_location"}r.is=o;function s(l,c){return{type:"resource_location",range:k.get(l),options:c}}r.mock=s;function a(l,c="origin"){let f=l.path?l.path.join(n):"",u;switch(c){case"origin":u=l.namespace!==void 0?`${l.namespace}${t}${f}`:f;break;case"full":u=`${l.namespace||i}${t}${f}`;break;case"short":u=l.namespace&&l.namespace!==i?`${l.namespace}${t}${f}`:f;break}return l.isTag?`${e}${u}`:u}r.toString=a})(le||(le={}));var vl=Symbol("SequenceUtilDiscriminator"),_l;(function(r){function e(t){return!!t&&t[vl]}r.is=e})(_l||(_l={}));var xu;(function(r){function e(t,n){return t?t.includes(n):!1}r.is=e})(xu||(xu={}));var Gv=new Map([['"','"'],["'","'"],["\\","\\"],["b","\b"],["f","\f"],["n",`
`],["r","\r"],["t","	"]]),Yt;(function(r){function e(n){return n?.type==="string"}r.is=e;function t(n,i){return n=k.get(n),{type:"string",range:n,options:i,value:"",valueMap:[{inner:k.create(0),outer:k.create(n.start)}]}}r.mock=t})(Yt||(Yt={}));var Br;(function(r){function e(n){return n?.type==="symbol"}r.is=e;function t(n,i){return{type:"symbol",range:k.get(n),options:i,value:""}}r.mock=t})(Br||(Br={}));var Zv={array:"an array",boolean:"a boolean","bug-of-mc":"Due to a bug of Minecraft (%0%), %1%. Please Mojang, fix your game","code-action.block-state-sort-keys":"Sort block state","code-action.command-replaceitem":"Update this command to /item \u2026 replace","code-action.fix-file":"Fix all auto-fixable problems in this file","code-action.fix-workspace":"Fix all auto-fixable problems in the workspace","code-action.id-attribute-datafix":"Update this attribute name to 1.16","code-action.id-complete-default-namespace":"Complete default namespace","code-action.id-create-file":"Create %0% in the same data pack","code-action.id-omit-default-namespace":"Omit default namespace","code-action.id-zombified-piglin-datafix":"Change this ID to Zombified Piglin's","code-action.nbt-compound-sort-keys":"Sort NBT compound tag","code-action.nbt-type-to-byte":"Convert to an NBT byte tag","code-action.nbt-type-to-double":"Convert to an NBT double tag","code-action.nbt-type-to-float":"Convert to an NBT float tag","code-action.nbt-type-to-int":"Convert to an NBT int tag","code-action.nbt-type-to-long":"Convert to an NBT long tag","code-action.nbt-type-to-short":"Convert to an NBT short tag","code-action.nbt-uuid-datafix":"Update this UUID to 1.16","code-action.selector-sort-keys":"Sort selector argument","code-action.string-double-quote":"Quote this string with double quotation marks","code-action.string-single-quote":"Quote this string with single quotation marks","code-action.string-unquote":"Unquote this string","code-action.vector-align-0.0":"Align this vector to block origin","code-action.vector-align-0.5":"Align this vector to block center",comment:"a comment starting with %0%","conjunction.and_2":" and ","conjunction.and_3+_1":", ","conjunction.and_3+_2":", and ","conjunction.or_2":" or ","conjunction.or_3+_1":", ","conjunction.or_3+_2":", or ","datafix.error.command-replaceitem":"/replaceitem was removed in 20w46a (the second snapshot of 1.17) in favour of /item","duplicate-key":"Duplicate key %0%","ending-quote":"an ending quote %0%",entity:"an entity","error.unparseable-content":"Encountered unparseable content",expected:"Expected %0%","expected-got":"Expected %0% but got %1%",float:"a float","float.between":"a float between %0% and %1%",integer:"an integer","integer.between":"an integer between %0% and %1%","json.doc.advancement.display":"Advancement display settings. If present, the advancement will be visible in the advancement tabs.","json.checker.item.duplicate":"Duplicate list item","json.checker.property.deprecated":"Property %0% is deprecated","json.checker.property.missing":"Missing property %0%","json.checker.property.unknown":"Unknown property %0%","json.checker.string.hex-color":"a 6-digit hexadecimal number","json.checker.tag-entry.duplicate":"Duplicate tag entry","key-not-following-convention":"Invalid key %0% which doesn't follow %1% convention","linter.diagnostic-message-wrapper":"%0% (rule: %1%)","linter.name-convention.illegal":"Name %0% doesn't match %1%","linter.undeclared-symbol.message":"Cannot find %0% %1%","linter-config-validator.name-convention.type":"Expects a string that contains a regular expression describing the name","linter-config-validator.wrapper":"%0%. See [the documentation](%1) for more information",long:"a long","mcfunction.checker.command.data-modify-unapplicable-operation":"Operation %0% can only be used on %1%; the target path has type %2% instead","mcfunction.completer.block.states.default-value":"Default: %0%","mcfunction.parser.entity-selector.arguments.not-applicable":"%0% is not applicable here","mcfunction.parser.entity-selector.arguments.unknown":"Unknown entity selector argument %0%","mcfunction.parser.entity-selector.entities-disallowed":"The selector contains non-player entities","mcfunction.parser.entity-selector.multiple-disallowed":"The selector contains multiple entities","mcfunction.parser.entity-selector.player-name.too-long":"Player names cannot be longer than %0% characters","mcfunction.parser.eoc-unexpected":"Expected more arguments","mcfunction.parser.leading-slash":"a leading slash %0%","mcfunction.parser.no-permission":"Permission level %0% is required, which is higher than %1% defined in config","mcfunction.parser.objective.too-long":"Objective names cannot be longer than %0% characters","mcfunction.parser.range.min>max":"The minimum value %0% is larger than the maximum value %1%","mcfunction.parser.score_holder.fake-name.too-long":"Fake names cannot be longer than %0% characters","mcfunction.parser.sep":"a space (%0%)","mcfunction.parser.trailing":"Trailing data encountered: %0%","mcfunction.parser.unknown-parser":"Parser %0% hasn't been supported yet","mcfunction.parser.uuid.invalid":"Invalid UUID format","mcfunction.parser.vector.local-disallowed":"Local coordinates disallowed","mcfunction.parser.vector.mixed":"Cannot mix local coordinates and world coordinates together","mcfunction.signature-help.command-documentation":"[Minecraft Wiki: `%0%` command](https://minecraft.fandom.com/wiki/Commands/%0%)","mcfunction.signature-help.argument-parser-documentation":"[Minecraft Wiki: `%0%` argument parser](https://minecraft.fandom.com/wiki/Argument_types#%0%)","missing-key":"Missing key %0%","nbt.checker.block-states.fake-boolean":"Boolean block state values should be quoted","nbt.checker.block-states.unexpected-value-type":"Block state values should be either a string or an int","nbt.checker.block-states.unknown-state":"Unknown block state %0% for the following block(s): %1%","nbt.checker.boolean.out-of-range":"A boolean value should be either %0% or %1%","nbt.checker.collection.length-between":"%0% with length between %1% and %2%","nbt.checker.compound.field.union-empty-members":"Disallowed property","nbt.checker.path.index-out-of-bound":"The provided index %0% is out of bound, as the collection can only have at most %1% elements","nbt.checker.path.unexpected-filter":"Compound filters can only be used on compound tags","nbt.checker.path.unexpected-index":"Indices can only be used on array or list tags","nbt.checker.path.unexpected-key":"String keys can only be specified for compound tags","nbt.node":"a tag","nbt.node.byte":"a byte tag","nbt.node.byte_array":"a byte array tag","nbt.node.compound":"a compound tag","nbt.node.double":"a double tag","nbt.node.float":"a float tag","nbt.node.int":"an int tag","nbt.node.int_array":"an int array tag","nbt.node.list":"a list tag","nbt.node.long":"a long tag","nbt.node.long_array":"a long array tag","nbt.node.path.end":"the end of path","nbt.node.path.filter":"a compound filter","nbt.node.path.index":"an index","nbt.node.path.key":"a key","nbt.node.short":"a short tag","nbt.node.string":"a string tag","nbt.parser.number.out-of-range":"This looks like %0%, but it is actually %1% due to the numeral value being out of [%2%, %3%]","mcdoc.binder.duplicated-path":"Duplicated path %0%","mcdoc.binder.duplicated-path.related":"Path %0% is declared here","mcdoc.binder.out-of-root":"File %0% is not under the root directory of any mcdoc project; semantic checking will be skipped","mcdoc.node.compound-definition":"a compound definition","mcdoc.node.enum-definition":"an enum definition","mcdoc.node.identifier":"an identifier","mcdoc.checker.entry.empty-mod-seg":"You cannot put \u201Cmod.mcdoc\u201D under a root directly","mcdoc.checker.ident-path.super-from-root":"This \u201Csuper\u201D it is out of the project's root","mcdoc.checker.ident-path.unknown-identifier":"Identifier %0% does not exist in module %1%","mcdoc.checker.ident-path.unknown-module":"Module %0% does not exist","mcdoc.checker.inject-clause.unmatched-injection":"Cannot inject %0% with %1%","mcdoc.checker.type-not-assignable":"Type %0% is not assignable to type %1%","mcdoc.parser.compound-definition.field-type":"a field type","mcdoc.parser.float.illegal":"Encountered illegal float number","mcdoc.parser.identifier.reserved-word":"%0% is a reserved word and cannot be used as an identifier name","mcdoc.parser.identifier.illegal":"%0% doesn't follow the format of %1%","mcdoc.parser.inject-clause.definition-expected":"Expected either an enum inject or a compound inject","mcdoc.parser.keyword.separation":"a separation","mcdoc.parser.resource-location.colon-expected":"Expected the colon (%0%) of resource locations","mcdoc.parser.syntax.doc-comment-unexpected":"Doc comments are not allowed here; you might want to replace the three slashes with two slashes","not-matching-any-child":"Invalid argument type",nothing:"nothing",number:"a number","number-range":"a number range","number-range.missing-min-and-max":"Expected either a minimum value or a maximum value","number.<=":"a number smaller than or equal to %0%","number.>=":"a number greater than or equal to %0%","number.between":"a number between %0% and %1%",object:"an object",objective:"an objective","objective-not-following-convention":"Invalid objective %0% which doesn't follow %1% convention","parser.float.illegal":"Illegal float numeral that doesn't follow %0%","parser.integer.illegal":"Illegal integer that doesn't follow %0%","parser.list.value":"a value","parser.list.trailing-sep":"Trailing separation","parser.record.key":"a key","parser.record.trailing-end":"Trailing separation","parser.record.unexpected-char":"Unexpected character %0%","parser.record.value":"a value","parser.resource-location.illegal":"Illegal character(s): %0%","parser.resource-location.namespace-expected":"Namespaces cannot be omitted here","parser.resource-location.tag-diallowed":"Tags are not allowed here","parser.string.illegal-brigadier":"Encountered non-[0-9A-Za-z_.+-] characters in %0%","parser.string.illegal-escape":"Unexpected escape character %0%","parser.string.illegal-quote":"Only %0% can be used to quote strings here","parser.string.illegal-unicode-escape":"Hexadecimal digit expected","punc.period":".","punc.quote":"\u201C%0%\u201D",quote:`a quote (\u201C'\u201D or \u201C"\u201D)`,quote_prefer_double:'Double quote (\u201C"\u201D) is preferable here',quote_prefer_single:"Single quote (\u201C'\u201D) is preferable here","resource-location":"a resource location","score-holder":"a score holder","scoreholder-not-following-convention":"Invalid score_holder %0% which doesn't follow %1% convention","server.new-version":"The Data-pack Language Server has been updated to a newer version: %0%","server.progress.fixing-workspace.begin":"Fixing all auto-fixable problems in the workspace","server.progress.fixing-workspace.report":"fixing %0%","server.progress.preparing.title":"Preparing Spyglass language features","server.remove-cache-file":"The cache file of DHP was moved to a storage location provided by VSCode. You can safely delete the ugly \u201C.datapack\u201D folder in your workspace root.","server.show-release-notes":"Show Release Notes",string:"a string",tag:"a tag","tag-not-following-convention":"Invalid tag %0% which doesn't follow %1% convention",team:"a team","team-not-following-convention":"Invalid team %0% which doesn't follow %1% convention","time-unit":"a time unit","too-many-block-affected":"Too many blocks in the specified area (maximum %0%, specified %1%)","too-many-chunk-affected":"Too many chunks in the specified area (maximum %0%, specified %1%)","unexpected-character":"Found non [a-z0-9/._-] character(s)","unexpected-datapack-tag":"Tags are not allowed here","unexpected-default-namespace":"Default namespace should be omitted here","unexpected-leading-slash":"Unexpected leading slash \u201C/\u201D","unexpected-local-coordinate":"Local coordinate %0% is not allowed","unexpected-nbt":"This tag doesn't exist here","unexpected-nbt-array-type":"Invalid array type %0%. Should be one of \u201CB\u201D, \u201CI\u201D, and \u201CL\u201D","unexpected-nbt-path-filter":"Compound filters are only used for compound tags","unexpected-nbt-path-index":"Indices are only used for lists/arrays tags","unexpected-nbt-path-key":"Keys are only used for compound tags","unexpected-nbt-path-sub":"The current tag doesn't have extra items","unexpected-omitted-default-namespace":"Default namespace shouldn't be omitted here","unexpected-relative-coordinate":"Relative coordinate %0% is not allowed","unexpected-scoreboard-sub-slot":"Only \u201Csidebar\u201D has sub slots","unknown-command":"Unknown command %0%","unknown-escape":"Unexpected escape character %0%","unknown-key":"Unknown key %0%","unquoted-string":"an unquoted string","unsorted-keys":"Unsorted keys",uuid:"a UUID",vector:"a vector"};var Jv={en:Zv},dR="en";function b(r,...e){let t=Jv[dR][r]??Jv.en[r];return pR(t,e)??""}function q(r){return b("punc.quote",r)}function pR(r,e){return r?.replace(/%\d+%/g,t=>{let n=parseInt(t.slice(1,-1)),i=e[n];return typeof i!="string"&&i[Symbol.iterator]&&(i=Zn(i)),`${i??t}`})}function Zn(r,e=!0,t="or"){let n=o=>e?q(o):o,i=(typeof r=="string"?[r]:Array.from(r)).map(n);switch(i.length){case 0:return b("nothing");case 1:return i[0];case 2:return i[0]+b(`conjunction.${t}_2`)+i[1];default:return`${i.slice(0,-1).join(b(`conjunction.${t}_3+_1`))}${b(`conjunction.${t}_3+_2`)}${i[i.length-1]}`}}function it(...r){let e=mR(r);return(t,n)=>{let i={type:"literal",range:k.create(t),options:e,value:""};for(let o of e.pool)if(t.trySkip(o))return i.value=o,i.range.end=t.cursor,i;return n.err.report(b("expected",e.pool),i),i}}function mR(r){let e;return typeof r[0]=="object"?e=r[0]:e={pool:r},e.pool=e.pool.sort((t,n)=>n.length-t.length),e}var Im=pn(pu(),1);var Bm=Object.freeze(["mcdoc","mcdoc/dispatcher"]),Jn=Object.freeze(["activity","attribute","block","block_entity_type","block_predicate_type","chunk_status","custom_stat","enchantment","entity_type","float_provider_type","fluid","game_event","height_provider_type","int_provider_type","item","loot_condition_type","loot_function_type","loot_nbt_provider_type","loot_number_provider_type","loot_pool_entry_type","loot_score_provider_type","memory_module_type","menu","mob_effect","motive","particle_type","point_of_interest_type","pos_rule_test","position_source_type","potion","recipe_serializer","recipe_type","rule_test","schedule","sensor_type","sound_event","stat_type","villager_profession","villager_type","worldgen/biome_source","worldgen/block_placer_type","worldgen/block_state_provider_type","worldgen/carver","worldgen/chunk_generator","worldgen/decorator","worldgen/feature","worldgen/feature_size_type","worldgen/foliage_placer_type","worldgen/material_condition","worldgen/material_rule","worldgen/placement_modifier_type","worldgen/structure_feature","worldgen/structure_piece","worldgen/structure_pool_element","worldgen/structure_processor","worldgen/surface_builder","worldgen/tree_decorator_type","worldgen/trunk_placer_type"]),ek=Object.freeze(["worldgen/biome","worldgen/configured_carver","worldgen/configured_feature","worldgen/configured_structure_feature","worldgen/configured_surface_builder","worldgen/noise","worldgen/noise_settings","worldgen/placed_feature","worldgen/processor_list","worldgen/template_pool"]),gR=Object.freeze(["function",...Jn,...ek]),yR=Object.freeze(gR.map(r=>`tag/${r}`)),$s=Object.freeze(["advancement","dimension","dimension_type","function","item_modifier","loot_table","predicate","recipe","structure",...yR,...ek]),bR=Object.freeze(["attribute_modifier_uuid","bossbar","objective","score_holder","storage","tag","team"]),_R=Object.freeze([...$s,...bR]),v$=Object.freeze([..._R,...Bm,...Jn]),vR=Object.freeze(["bossbar","storage","mcdoc/dispatcher",...$s,...Jn]),Yv;(function(r){function e(t){return vR.includes(t)}r.is=e})(Yv||(Yv={}));var rr;(function(r){function e(i){return i?{category:i.category,path:i.path}:void 0}r.fromSymbol=e;function t(i){return JSON.stringify({category:i.category,path:i.path})}r.toString=t;function n(i){return JSON.parse(i)}r.fromString=n})(rr||(rr={}));var js,Xv=class{constructor(){U(this,js,new Set)}add(e){!e||_(this,js).add(rr.toString(e))}has(e){return _(this,js).has(rr.toString(e))}collect(){return[..._(this,js)].map(rr.fromString)}};js=new WeakMap;var Oo=Object.freeze(["definition","declaration","implementation","reference","typeDefinition"]),kl;(function(r){function e(t){return Oo.includes(t)}r.is=e})(kl||(kl={}));var Qv;(function(r){function e(t,n,...i){if(Fv(t)){for(let s of t){let a=e(s,n,...i);if(a)return a}return}let o=t[n];for(let s of i);}r.get=e})(Qv||(Qv={}));var Su;(function(r){function e(t,n,i,o,s){return w(w(w(w({},_u.create(t,n)),i?{fullRange:k.get(i),fullPosRange:Is.from(i,t)}:{}),o?{contributor:o}:{}),s||{})}r.create=e})(Su||(Su={}));var wl;(function(r){function e(o){let s=(c,f,u,h,d)=>{c.category=h,c.identifier=d[d.length-1],c.path=d,c.parentMap=f,u&&(c.parentSymbol=u),c.members&&a(c.members,c,h,d)},a=(c,f,u,h)=>{for(let[d,m]of Object.entries(c))s(m,c,f,u,[...h,d])},l=(0,Im.default)()(o);for(let[c,f]of Object.entries(l))a(f,void 0,c,[]);return l}r.link=e;function t(o){let s=c=>{delete c.category,delete c.identifier,delete c.parentMap,delete c.parentSymbol,delete c.path,c.members&&a(c.members)},a=c=>{for(let f of Object.values(c))s(f)},l=(0,Im.default)({circles:!0})(o);for(let c of Object.values(l))a(c);return l}r.unlink=t;function n(o){return JSON.stringify(t(o))}r.serialize=n;function i(o){return e(JSON.parse(o))}r.deserialize=i})(wl||(wl={}));var rk=pn(Au(),1);var Ou=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Ci,Eo,xl,Ai,Ro,zr,pr=class{constructor(e,t,n,i=!1){U(this,Ci,void 0);U(this,Eo,void 0);U(this,xl,void 0);U(this,Ai,new Set);U(this,Ro,Object.create(null));U(this,zr,void 0);ce(this,"_delayedOps",[]);ce(this,"_inDelayMode");X(this,Eo,new t),X(this,xl,t),X(this,Ci,e),X(this,zr,n),this._inDelayMode=i,this.on("symbolCreated",({symbol:o})=>{_(this,Ai).add(rr.toString(o))}).on("symbolRemoved",({symbol:o})=>{_(this,Ai).delete(rr.toString(o))}).on("symbolLocationCreated",({symbol:o,location:s})=>{let a=_(this,Ro)[s.contributor??"undefined"]??=Object.create(null),l=a[s.uri]??=new Set,c=rr.toString(o);l.add(c),_(this,Ai).delete(c)}).on("symbolLocationRemoved",({symbol:o})=>{let s=rr.toString(o);_(this,Ai).add(s)})}get global(){return _(this,Ci)}on(e,t){return _(this,Eo).on(e,t),this}once(e,t){return _(this,Eo).once(e,t),this}emit(e,...t){return _(this,Eo).emit(e,...t)}buildCache(){pr.forEachSymbol(this.global,e=>{this.emit("symbolCreated",{symbol:e}),pr.forEachLocationOfSymbol(e,({type:t,location:n})=>{this.emit("symbolLocationCreated",{symbol:e,type:t,location:n})})})}clone(){return new pr(_(this,Ci),_(this,xl),_(this,zr),!0)}applyDelayedEdits(){this._delayedOps.forEach(e=>e()),this._delayedOps=[],this._inDelayMode=!1}contributeAs(e,t){let n=_(this,zr);X(this,zr,e);try{t()}finally{X(this,zr,n)}return this}async contributeAsAsync(e,t){let n=_(this,zr);X(this,zr,e);try{await t()}finally{X(this,zr,n)}return this}clear({uri:e,contributor:t,predicate:n=()=>!0}){let i=()=>t?_(this,Ro)[t]?[_(this,Ro)[t]]:[]:Object.values(_(this,Ro)),o=()=>{let c=i();return(e?c.map(u=>u[e]??new Set):c.map(u=>Object.values(u)).flat()).map(u=>[...u]).flat().map(rr.fromString)},s=()=>e?[_(this,Ci)]:[_(this,Ci)],a=o(),l=s();for(let c of l){for(let f of a){let{symbol:u}=pr.lookupTable(c,f.category,f.path);!u||this.removeLocationsFromSymbol(u,e?h=>h.location.uri===e&&n(h):n)}this.trim(c)}}lookup(e,t,n){return pr.lookupTable(this.global,e,t)}query(e,t,...n){let i=pr.toUri(e),{parentSymbol:o,parentMap:s,symbol:a}=this.lookup(t,n,$m(e)?e.node:void 0),l=a?pr.isVisible(a,i):!0;return new Tu({category:t,doc:e,contributor:_(this,zr),map:l?s:void 0,parentSymbol:o,path:n,symbol:l?a:void 0,util:this})}getVisibleSymbols(e,t){let n=this.lookup(e,[],void 0).parentMap??void 0;return pr.filterVisibleSymbols(t,n)}static toUri(e){return typeof e=="string"?e:$m(e)?e.doc.uri:e.uri}trim(e){let t=n=>{!n||pr.isTrimmable(n)&&(delete n.parentMap[n.identifier],this.emit("symbolRemoved",{symbol:n}),t(n.parentSymbol))};for(let n of _(this,Ai)){let i=rr.fromString(n),{symbol:o}=pr.lookupTable(e,i.category,i.path);t(o)}}removeLocationsFromSymbol(e,t){for(let n of Oo)!e[n]||(e[n]=e[n].reduce((i,o)=>(t({location:o,symbol:e,type:n})?this.emit("symbolLocationRemoved",{symbol:e,type:n,location:o}):i.push(o),i),[]))}enterMap(e,t,n,i,o,s,a,l){let c=t[o];return c?this.amendSymbol(c,s,a,l):c=this.createSymbol(n,e,t,i,o,s,a,l),this.emit("symbolAmended",{symbol:c}),c}static lookupTable(e,t,n){let i=e[t],o,s;for(let a=0;a<n.length;a++){if(s=i?.[n[a]],!s){a!==n.length-1&&(o=void 0,i=void 0);break}if(a===n.length-1)break;o=s,i=s.members}return{parentSymbol:o,parentMap:i,symbol:s}}static lookupTables(e,t,n){let i,o;for(let s=e.length-1;s>=0;s--){let a=e[s],l=this.lookupTable(a,t,n);if(l.symbol)return l;!o&&!i&&(l.parentSymbol||l.parentMap)&&(o=l.parentSymbol,i=l.parentMap)}return{parentSymbol:o,parentMap:i,symbol:void 0}}createSymbol(e,t,n,i,o,s,a,l){let c=n[o]=w(I(w({category:e,identifier:o},t?{parentSymbol:t}:{}),{parentMap:n,path:i}),s.data);return this.emit("symbolCreated",{symbol:c}),this.amendSymbolUsage(c,s.usage,a,l),c}amendSymbol(e,t,n,i){this.amendSymbolMetadata(e,t.data),this.amendSymbolUsage(e,t.usage,n,i)}amendSymbolMetadata(e,t){if(t){if("data"in t&&(e.data=t.data),"desc"in t&&(e.desc=t.desc),t.relations&&Object.keys(t.relations).length){e.relations??={};for(let n of Object.keys(t.relations))e.relations[n]=t.relations[n]}if("subcategory"in t&&(e.subcategory=t.subcategory),"visibility"in t){let n=i=>i===void 0||i===2||i===3;if(e.visibility===t.visibility||n(e.visibility)&&n(t.visibility))e.visibility=t.visibility;else throw new Error(`Cannot change visibility from ${e.visibility} to ${t.visibility}: ${JSON.stringify(rr.fromSymbol(e))}`)}t.visibilityRestriction?.length&&(e.visibilityRestriction=(e.visibilityRestriction??[]).concat(t.visibilityRestriction))}}amendSymbolUsage(e,t,n,i){if(t){let o=t.type??"reference",s=e[o]??=[],a=k.get((jm.is(t)?t.node:t.range)??0),l=Su.create(n,a,t.fullRange,i,{accessType:t.accessType,skipRenaming:t.skipRenaming});n.uri.startsWith("file:")||(delete l.range,delete l.posRange,delete l.fullRange,delete l.fullPosRange),s.push(l),this.emit("symbolLocationCreated",{symbol:e,type:o,location:l})}}resolveAlias(e){return e?.relations?.aliasOf?this.resolveAlias(this.lookup(e.relations.aliasOf.category,e.relations.aliasOf.path).symbol):e}static filterVisibleSymbols(e,t={}){let n={};for(let[i,o]of Object.entries(t))pr.isVisible(o,e)&&(n[i]=o);return n}static isTrimmable(e){return!Object.keys(e.members??{}).length&&!e.declaration?.length&&!e.definition?.length&&!e.implementation?.length&&!e.reference?.length&&!e.typeDefinition?.length}static isVisible(e,t){switch(e.visibility){case 3:return!1;case 0:case 1:case 2:default:return!0}}static isDeclared(e){return!!(e?.declaration?.length||e?.definition?.length)}static isDefined(e){return!!(e?.definition?.length||e?.definition?.length&&e?.implementation?.length)}static isImplemented(e){return!!(e?.implementation?.length||e?.definition?.length)}static isReferenced(e){return!!e?.reference?.length}static isTypeDefined(e){return!!e?.typeDefinition?.length}static getDeclaredLocation(e){return e.declaration?.[0]??e.definition?.[0]??(()=>{throw new Error(`Cannot get declared location of ${JSON.stringify(rr.fromSymbol(e))}`)})()}static forEachSymbolInMap(e,t){for(let n of Object.values(e))t(n),n.members&&this.forEachSymbolInMap(n.members,t)}static forEachSymbol(e,t){for(let n of Object.values(e))this.forEachSymbolInMap(n,t)}static forEachLocationOfSymbol(e,t){for(let n of Oo)e[n]?.forEach(i=>t({type:n,location:i}))}static isVisibilityInGlobal(e){return e===void 0||e===2||e===3}static areVisibilitiesCompatible(e,t){return this.isVisibilityInGlobal(e)&&this.isVisibilityInGlobal(t)||e===0&&t===0||e===1&&t===1}},Qe=pr;Ci=new WeakMap,Eo=new WeakMap,xl=new WeakMap,Ai=new WeakMap,Ro=new WeakMap,zr=new WeakMap;Ou([Eu()],Qe.prototype,"clear",null);Ou([Eu()],Qe.prototype,"trim",null);Ou([Eu()],Qe.prototype,"removeLocationsFromSymbol",null);var zm;(function(r){function e(t){return!!t?.range}r.is=e})(zm||(zm={}));var jm;(function(r){function e(t){return!!t?.node}r.is=e})(jm||(jm={}));var Tn,Ti,Mo,Fs,Sl,On,Yn,dt,Fm=class{constructor({category:e,contributor:t,doc:n,map:i,parentSymbol:o,path:s,symbol:a,util:l}){ce(this,"category");ce(this,"path");U(this,Tn,void 0);U(this,Ti,void 0);U(this,Mo,void 0);U(this,Fs,void 0);U(this,Sl,!1);U(this,On,void 0);U(this,Yn,void 0);U(this,dt,void 0);ce(this,"util");this.category=e,this.path=s,typeof n=="string"?(n=rk.TextDocument.create(n,"",0,""),X(this,Mo,!0)):$m(n)&&(X(this,Ti,n.node),n=n.doc),X(this,Tn,n),X(this,Fs,t),X(this,On,i),X(this,Yn,o),X(this,dt,a),this.util=l}get symbol(){return _(this,dt)}get visibleMembers(){return Qe.filterVisibleSymbols(_(this,Tn).uri,this.path.length===0?_(this,On):_(this,dt)?.members)}heyGimmeDaSymbol(){return _(this,dt)}with(e){return e(this),this}if(e,t){return e.call(this,_(this,dt),this)&&(t.call(this,_(this,dt),this),X(this,Sl,!0)),this}ifUnknown(e){return this.if(t=>t===void 0,e)}ifKnown(e){return this.if(t=>t!==void 0,e)}ifDeclared(e){return this.if(t=>Qe.isDeclared(t),e)}ifDefined(e){return this.if(Qe.isDefined,e)}ifImplemented(e){return this.if(Qe.isImplemented,e)}ifReferenced(e){return this.if(Qe.isReferenced,e)}ifTypeDefined(e){return this.if(Qe.isTypeDefined,e)}else(e){return _(this,Sl)||e.call(this,_(this,dt),this),this}elseEnter(e){return this.else(()=>this.enter(e))}elseResolveAlias(){return this.else(()=>this.resolveAlias())}_enter(e){let t=n=>{if(_(this,On)&&Qe.areVisibilitiesCompatible(n.data?.visibility,_(this,dt)?.visibility))return _(this,On);if(this.path.length>1){if(_(this,Yn)){if(!Qe.areVisibilitiesCompatible(n.data?.visibility,_(this,Yn).visibility))throw new Error(`Cannot enter member \u201C${this.getPath()}\u201D of ${Si.stringifyVisibility(n.data?.visibility)} visibility to parent of ${Si.stringifyVisibility(_(this,Yn).visibility)} visibility`);return _(this,Yn).members??={}}}else{let i;if(Qe.isVisibilityInGlobal(n.data?.visibility))i=this.util.global;else if(n.data?.visibility===1){if(!_(this,Ti))throw new Error(`Cannot enter \u201C${this.getPath()}\u201D with ${Si.stringifyVisibility(n.data?.visibility)} visibility as no node is supplied`);let o=_(this,Ti);for(;o;){if(o.type==="file"){i=o.locals;break}o=o.parent}if(!i)throw new Error(`Cannot enter \u201C${this.getPath()}\u201D with ${Si.stringifyVisibility(n.data?.visibility)} visibility as no file node is supplied`)}else{if(!_(this,Ti))throw new Error(`Cannot enter \u201C${this.getPath()}\u201D with ${Si.stringifyVisibility(n.data?.visibility)} visibility as no node is supplied`);let o=_(this,Ti);for(;o;){if(o.locals){i=o.locals;break}o=o.parent}if(!i)throw new Error(`Cannot enter \u201C${this.getPath()}\u201D with ${Si.stringifyVisibility(n.data?.visibility)} visibility as no node with locals is supplied`)}return i[this.category]??={}}throw new Error(`Cannot create the symbol map for \u201C${this.getPath()}\u201D`)};_(this,Mo)&&zm.is(e.usage)&&(e.usage.range=k.create(0,0)),X(this,On,t(e)),X(this,dt,this.util.enterMap(_(this,Yn),_(this,On),this.category,this.path,this.path[this.path.length-1],e,_(this,Tn),_(this,Fs))),e.usage?.node&&(e.usage.node.symbol=_(this,dt))}enter(e){return this._enter(e),this}amend(e){return this.ifKnown(()=>this.enter(e))}resolveAlias(){if(_(this,dt)){let e=this.util.resolveAlias(_(this,dt));if(!e)throw new Error("The current symbol points to an non-existent symbol.");X(this,dt,e),X(this,On,e.parentMap)}return this}member(){let e,t,n;if(arguments.length===2?(e=_(this,Mo)?_(this,Tn).uri:_(this,Tn),t=arguments[0],n=arguments[1]):(e=arguments[0],t=arguments[1],n=arguments[2]),_(this,dt)===void 0)throw new Error(`Tried to query member symbol \u201C${t}\u201D from an undefined symbol (path \u201C${this.path.join(".")}\u201D)`);let i=typeof e=="string"&&e===_(this,Tn).uri&&!_(this,Mo)?_(this,Tn):e,o=_(this,dt).members,s=o?.[t],a=new Fm({category:this.category,doc:i,contributor:_(this,Fs),map:o,parentSymbol:_(this,dt),path:[...this.path,t],symbol:s,util:this.util});return n(a),this}onEach(e,t){for(let n of e)t.call(this,n,this);return this}forEachMember(e){return this.onEach(Object.keys(this.visibleMembers),t=>this.member(t,n=>e(t,n)))}getPath(){return`${this.category}.${this.path.join("/")}`}},Tu=Fm;Tn=new WeakMap,Ti=new WeakMap,Mo=new WeakMap,Fs=new WeakMap,Sl=new WeakMap,On=new WeakMap,Yn=new WeakMap,dt=new WeakMap;Ou([Eu(r=>r.util)],Tu.prototype,"_enter",null);var Si;(function(r){let e="+ ";function t(c,f){if(c!==f)throw new Error(`Assertion error: ${c} !== ${f}`)}function n(c){return c.map(f=>i(f)).join(`
------------
`)}r.stringifySymbolStack=n;function i(c,f=""){let u=[];for(let h of Object.keys(c)){let d=c[h];u.push([h,o(d,`${f}${e}`)])}return u.map(h=>`CATEGORY ${h[0]}
${h[1]}`).join(`
${f}------------
`)||"EMPTY TABLE"}r.stringifySymbolTable=i;function o(c,f=""){if(!c)return"undefined";let u=[];for(let h of Object.keys(c)){let d=c[h];t(h,d.identifier),u.push(s(d,f))}return u.join(`
${f}------------
`)}r.stringifySymbolMap=o;function s(c,f=""){if(!c)return"undefined";let u=[];t(c.path[c.path.length-1],c.identifier),u.push(`SYMBOL ${c.path.join(".")} {${c.category}${c.subcategory?` (${c.subcategory})`:""}} [${a(c.visibility,c.visibilityRestriction)}]`),c.data&&u.push(`${e}data: ${JSON.stringify(c.data)}`),c.desc&&u.push(`${e}description: ${c.desc}`);for(let h of Oo)c[h]&&u.push(`${e}${h}:
${c[h].map(d=>`${f}${e.repeat(2)}${JSON.stringify(d)}`).join(`
${f}${e.repeat(2)}------------
`)}`);return c.relations&&u.push(`${e}relations: ${JSON.stringify(c.relations)}`),c.members&&u.push(`${e}members:
${o(c.members,`${f}${e.repeat(2)}`)}`),u.map(h=>`${f}${h}`).join(`
`)}r.stringifySymbol=s;function a(c,f){let u;switch(c){case 0:u="Block";break;case 1:u="File";break;case 3:u="Restricted";break;default:u="Public";break}return`${u}${f?` ${f.map(h=>`\u201C${h}\u201D`).join(", ")}`:""}`}r.stringifyVisibility=a;function l(c){return`parentSymbol:
${s(c.parentSymbol,e)}
parentMap:
${o(c.parentMap,e)}
symbol:
${s(c.symbol,e)}`}r.stringifyLookupResult=l})(Si||(Si={}));function Eu(r=e=>e){return(e,t,n)=>{let i=n.value;return n.value=function(...o){let s=r(this);s._inDelayMode?s._delayedOps.push(i.bind(this,...o)):i.apply(this,o)},n}}function $m(r){return!!r.doc}var ge;(function(r){function*e(A,L){for(let z of L)A.startsWith(z)&&(yield decodeURIComponent(A.slice(z.length)))}r.getRels=e;function t(A,L){return e(A,L).next().value}r.getRel=t;function n(A){return A.endsWith("/")}r.isRootUri=n;function i(A){return n(A)?A:`${A}/`}r.ensureEndingSlash=i;function o(A,L){return i(A)+(L.startsWith("/")?L.slice(1):L)}r.join=o;function s(A){return A.startsWith("file:")}r.isFileUri=s;function a(A){let L=A.lastIndexOf(".");return L>=0?A.slice(L):void 0}r.extname=a;function l(A){let L=A.lastIndexOf("/");return L>=0?A.slice(L+1):A}r.basename=l;function c(A,L){return new tr(".",L)}r.getParentOfFile=c;async function f(A,L,z=511){try{await A.fs.mkdir(L,{mode:z,recursive:!0})}catch($){if(!A.error.isKind($,"EEXIST"))throw $}}r.ensureDir=f;async function u(A,L,z=511){return f(A,c(A,L),z)}r.ensureParentOfFile=u;async function h(A,L,z){return A.fs.chmod(L,z)}r.chmod=h;async function d(A,L){try{await h(A,L,438)}catch(z){if(!A.error.isKind(z,"ENOENT"))throw z}}r.ensureWritable=d;async function m(A,L){return h(A,L,292)}r.markReadOnly=m;async function y(A,L){return A.fs.readFile(L)}r.readFile=y;async function g(A,L,z,$=438){return await u(A,L),await d(A,L),A.fs.writeFile(L,z,{mode:$})}r.writeFile=g;async function v(A,L){return JSON.parse(Ir(await y(A,L)))}r.readJson=v;async function T(A,L,z){return g(A,L,JSON.stringify(z))}r.writeJson=T;async function M(A,L){return A.archive.gunzip(await y(A,L))}r.readGzippedFile=M;async function x(A,L,z){return typeof z=="string"&&(z=new TextEncoder().encode(z)),g(A,L,await A.archive.gzip(z))}r.writeGzippedFile=x;async function D(A,L){return JSON.parse(Ir(await M(A,L)))}r.readGzippedJson=D;async function j(A,L,z){return x(A,L,JSON.stringify(z))}r.writeGzippedJson=j})(ge||(ge={}));var Vm=1,Ru;(function(r){function e(){return{files:{},roots:{},symbolRegistrars:{}}}r.create=e})(Ru||(Ru={}));var Vs,Du,Mu=class{constructor(e,t){ce(this,"cacheRoot");ce(this,"project");ce(this,"checksums",Ru.create());U(this,Vs,!1);U(this,Du,void 0);this.cacheRoot=e,this.project=t,this.project.on("documentUpdated",async({doc:n})=>{if(!!_(this,Vs))try{this.checksums.files[n.uri]=await this.project.externals.crypto.getSha1(n.getText())}catch(i){this.project.externals.error.isKind(i,"EISDIR")||this.project.logger.error(`[CacheService#hash-file] ${n.uri}`)}}),this.project.on("rootsUpdated",async({roots:n})=>{if(!!_(this,Vs))for(let i of n)try{this.checksums.roots[i]=await this.project.fs.hash(i)}catch(o){this.project.externals.error.isKind(o,"EISDIR")||this.project.logger.error(`[CacheService#hash-root] ${i}`)}}),this.project.on("symbolRegistrarExecuted",({id:n,checksum:i})=>{i!==void 0&&(this.checksums.symbolRegistrars[n]=i)})}async getCacheFileUri(){return _(this,Du)??X(this,Du,new tr(`symbols/${await this.project.externals.crypto.getSha1(this.project.projectRoot)}.json.gz`,this.cacheRoot).toString())}async load(){let e=this.project.profilers.get("cache#load"),t={symbols:{}},n;try{n=await this.getCacheFileUri(),this.project.logger.info(`[CacheService#load] symbolCachePath = \u201C${n}\u201D`);let i=await ge.readGzippedJson(this.project.externals,n);e.task("Read File"),i.version===Vm?(this.checksums=i.checksums,t.symbols=wl.link(i.symbols),e.task("Link Symbols")):this.project.logger.info(`[CacheService#load] Unsupported cache format ${i.version}; expected ${Vm}`)}catch(i){this.project.externals.error.isKind(i,"ENOENT")||this.project.logger.error("[CacheService#load] ",i)}return e.finalize(),t}async validate(){let e={addedFiles:[],changedFiles:[],removedFiles:[],unchangedFiles:[]},t=[];for(let[n,i]of Object.entries(this.checksums.roots))try{await this.project.fs.hash(n)===i&&t.push(n)}catch(o){this.project.externals.error.isKind(o,"EISDIR")||this.project.logger.error(`[CacheService#hash-file] ${n}`)}for(let[n,i]of Object.entries(this.checksums.files)){if(t.some(o=>n.startsWith(o))){e.unchangedFiles.push(n);continue}try{await this.project.fs.hash(n)===i?e.unchangedFiles.push(n):e.changedFiles.push(n)}catch(o){this.project.externals.error.isKind(o,"ENOENT")||this.project.externals.error.isKind(o,"EISDIR")?e.removedFiles.push(n):(this.project.logger.error(`[CacheService#validate] ${n}`,o),e.changedFiles.push(n))}}for(let n of this.project.getTrackedFiles())n in this.checksums.files||e.addedFiles.push(n);return X(this,Vs,!0),e}async save(){let e=this.project.profilers.get("cache#save"),t;try{t=await this.getCacheFileUri();let n={checksums:this.checksums,projectRoot:this.project.projectRoot,symbols:wl.unlink(this.project.symbols.global),version:Vm};return e.task("Unlink Symbols"),await ge.writeGzippedJson(this.project.externals,t,n),e.task("Write File").finalize(),!0}catch(n){this.project.logger.error(`[CacheService#save] path = \u201C${t}\u201D`,n)}return!1}reset(){this.checksums=Ru.create()}};Vs=new WeakMap,Du=new WeakMap;var nk=pn(pu(),1);var Oi;(function(r){function e(n){return n==="hint"||n==="information"||n==="warning"||n==="error"}r.is=e;function t(n){switch(n){case"error":return 3;case"hint":return 0;case"information":return 1;case"warning":return 2}}r.toErrorSeverity=t})(Oi||(Oi={}));var Hs;(function(r){function e(t){if(t!=null)return Oi.is(t)?{ruleSeverity:Oi.toErrorSeverity(t),ruleValue:!0}:Array.isArray(t)&&Oi.is(t[0])?{ruleSeverity:Oi.toErrorSeverity(t[0]),ruleValue:t[1]}:{ruleSeverity:2,ruleValue:t}}r.destruct=e})(Hs||(Hs={}));var Ei;(function(r){function e(o){return Le.is(o,t.is)||i.is(o)}r.is=e;let t;(function(o){function s(a){if(!a||typeof a!="object")return!1;let l=a;return(l.if===void 0||Le.is(l.if,n.is))&&(l.then===void 0||i.is(l.then))&&(l.override===void 0||Le.is(l.override,o.is))}o.is=s})(t=r.Complex||(r.Complex={}));let n;(function(o){function s(a){if(!a||typeof a!="object")return!1;let l=a;return(l.category===void 0||Le.is(l.category,wi.isString))&&(l.pattern===void 0||Le.is(l.pattern,wi.isString))&&(l.excludePattern===void 0||Le.is(l.excludePattern,wi.isString))&&(l.namespace===void 0||Le.is(l.namespace,wi.isString))&&(l.excludeNamespace===void 0||Le.is(l.excludeNamespace,wi.isString))}o.is=s})(n=r.Condition||(r.Condition={}));let i;(function(o){function s(c){return c!==void 0&&["block","file","public"].includes(c.declare)}o.isDeclare=s;function a(c){return c!==void 0&&["inherit","hint","information","warning","error"].includes(c.report)}o.isReport=a;function l(c){if(!c||typeof c!="object")return!1;let f=c;return s(f)||a(f)}o.is=l})(i=r.Action||(r.Action={}))})(Ei||(Ei={}));var Um={env:{dataSource:"GitHub",dependencies:["@vanilla-mcdoc"],feature:{codeActions:!0,colors:!0,completions:!0,documentHighlighting:!0,documentLinks:!0,foldingRanges:!0,formatting:!0,hover:!0,inlayHint:{enabledNodes:["mcfunction:command_child/unknown"]},semanticColoring:!0,selectionRanges:!0,signatures:!0},gameVersion:"Auto",language:"Default",permissionLevel:2,plugins:[],mcmetaSummaryOverrides:{}},format:{blockStateBracketSpacing:{inside:0},blockStateCommaSpacing:{before:0,after:1},blockStateEqualSpacing:{before:0,after:0},blockStateTrailingComma:!1,eol:"auto",nbtArrayBracketSpacing:{inside:0},nbtArrayCommaSpacing:{before:0,after:1},nbtArraySemicolonSpacing:{after:1},nbtArrayTrailingComma:!1,nbtByteSuffix:"b",nbtCompoundBracketSpacing:{inside:0},nbtCompoundColonSpacing:{before:0,after:1},nbtCompoundCommaSpacing:{before:0,after:1},nbtCompoundTrailingComma:!1,nbtDoubleOmitSuffix:!1,nbtDoubleSuffix:"d",nbtFloatSuffix:"f",nbtListBracketSpacing:{inside:0},nbtListCommaSpacing:{before:0,after:1},nbtListTrailingComma:!1,nbtLongSuffix:"L",nbtShortSuffix:"s",selectorBracketSpacing:{inside:0},selectorCommaSpacing:{before:0,after:1},selectorEqualSpacing:{before:0,after:0},selectorTrailingComma:!1,timeOmitTickUnit:!1},lint:{blockStateSortKeys:null,nbtCompoundSortKeys:null,selectorSortKeys:null,commandStringQuote:null,nbtKeyQuote:null,nbtPathQuote:null,nbtStringQuote:null,selectorKeyQuote:null,idOmitDefaultNamespace:null,nameOfNbtKey:null,nameOfObjective:null,nameOfScoreHolder:null,nameOfTag:null,nameOfTeam:null,nbtArrayLengthCheck:!0,nbtBoolean:null,nbtListLengthCheck:null,nbtTypeCheck:"loosely",undeclaredSymbol:[{if:[{category:Jn,namespace:"minecraft"},{category:[...$s,"bossbar","objective","team"]}],then:{report:"warning"}},{then:{declare:"block"}}]},snippet:{executeIfScoreSet:"execute if score ${1:score_holder} ${2:objective} = ${1:score_holder} ${2:objective} $0",summonAec:'summon minecraft:area_effect_cloud ~ ~ ~ {Age: -2147483648, Duration: -1, WaitTime: -2147483648, Tags: ["${1:tag}"]}'}},Do,Us=class{constructor(e,t=Um){ce(this,"project");ce(this,"defaultConfig");U(this,Do,void 0);this.project=e,this.defaultConfig=t,X(this,Do,new e.externals.event.EventEmitter);let n=async({uri:i})=>{Us.isConfigFile(i)&&this.emit("changed",{config:await this.load()})};e.on("fileCreated",n),e.on("fileModified",n),e.on("fileDeleted",n)}on(e,t){return _(this,Do).on(e,t),this}once(e,t){return _(this,Do).once(e,t),this}emit(e,...t){return _(this,Do).emit(e,...t)}async load(){let e=this.defaultConfig;for(let t of Us.ConfigFileNames){let n=this.project.projectRoot+t;try{e=JSON.parse(Ir(await this.project.externals.fs.readFile(n)))}catch(i){if(this.project.externals.error.isKind(i,"ENOENT"))continue;this.emit("error",{error:i,uri:n})}break}return Us.merge(this.defaultConfig,e)}static isConfigFile(e){return Us.ConfigFileNames.some(t=>e.endsWith(`/${t}`))}static merge(e,...t){let n=(0,nk.default)()(e);for(let i of t)for(let o of["env","format","lint","snippet"])n[o]=w(w({},n[o]),i[o]);return n}},No=Us;Do=new WeakMap,ce(No,"ConfigFileNames",Object.freeze(["spyglass.json",".spyglassrc.json"]));var Al={};dn(Al,{any:()=>kR,attempt:()=>Wm,dispatchSync:()=>SR,fallback:()=>xR,noop:()=>wR,registerBinders:()=>CR,resourceLocation:()=>ok,symbol:()=>sk});function jr(r,e,t,n){ik(r,e,t,n,[])}function ik(r,e,t,n,i){if(t(r,i)&&n(r,i),!(!r.children||!e(r,i)))for(let o of r.children??[])i.unshift(r),ik(o,e,t,n,i),i.shift()}var Hm=Symbol("IsAsyncBinder"),Ri=Object.freeze({create(r){return r},is(r){return!r[Hm]}}),Cl=Object.freeze({create(r){return Object.assign(r,{[Hm]:!0})},is(r){return r[Hm]}});function Wm(r,e,t){let n=I(w({},t),{err:new jt,symbols:t.symbols.clone()}),i=()=>{zt.undoChanges(e);let o=n.err.errors.map(s=>s.range.end-s.range.start).reduce((s,a)=>s+a,0);return{errorAmount:n.err.errors.length,totalErrorSpan:o,updateNodeAndCtx:()=>{t.err.absorb(n.err),zt.redoChanges(e),n.symbols.applyDelayedEdits()}}};return Ri.is(r)?(r(e,n),i()):(async()=>(await r(e,n),i()))()}function kR(r){if(r.length===0)throw new Error("Expected at least one binder");let e=(t,n)=>t.errorAmount-n.errorAmount||t.totalErrorSpan-n.totalErrorSpan;return r.every(Ri.is)?Ri.create((t,n)=>{r.map(o=>Wm(o,t,n)).sort(e)[0].updateNodeAndCtx()}):Cl.create(async(t,n)=>{(await Promise.all(r.map(o=>Wm(o,t,n)))).sort(e)[0].updateNodeAndCtx()})}var wR=Ri.create(()=>{}),xR=Cl.create(async(r,e)=>{let t=[];jr(r,n=>!e.meta.hasBinder(n.type),n=>e.meta.hasBinder(n.type),n=>{let o=e.meta.getBinder(n.type)(n,e);o instanceof Promise&&t.push(o)}),await Promise.allSettled(t)}),SR=Ri.create((r,e)=>{for(let t of r.children??[])e.meta.hasBinder(t.type)&&e.meta.getBinder(t.type)(t,e)}),ok=Ri.create((r,e)=>{if(r.options.category){let n=le.toString(r,"full"),i=se.lengthen(r.options.namespacePathSep==="."?n.replace(".",se.NamespacePathSep):n);e.symbols.query(e.doc,r.isTag?`tag/${r.options.category}`:r.options.category,i).enter({usage:{type:r.options.usageType,node:r,accessType:r.options.accessType}})}let t=le.toString(r,"full");if(r.options.pool){r.options.pool.includes(t)||e.err.report(b("expected",r.options.pool),r,3);return}}),sk=Ri.create((r,e)=>{if(r.value){let t=r.options.parentPath?[...r.options.parentPath,r.value]:[r.value];e.symbols.query(e.doc,r.options.category,...t).enter({usage:{type:r.options.usageType,node:r,accessType:r.options.accessType}})}});function CR(r){r.registerBinder("resource_location",ok),r.registerBinder("symbol",sk)}var nr={};dn(nr,{any:()=>AR,attempt:()=>ak,dispatchSync:()=>ER,fallback:()=>OR,noop:()=>TR,registerCheckers:()=>RR,resourceLocation:()=>lk,symbol:()=>ck});function ak(r,e,t){let n=I(w({},t),{err:new jt,symbols:t.symbols.clone()});r(e,n),zt.undoChanges(e);let i=n.err.errors.map(o=>o.range.end-o.range.start).reduce((o,s)=>o+s,0);return{errorAmount:n.err.errors.length,totalErrorSpan:i,updateNodeAndCtx:()=>{t.err.absorb(n.err),zt.redoChanges(e),n.symbols.applyDelayedEdits()}}}function AR(r){if(r.length===0)throw new Error("Expected at least one checker");return(e,t)=>{r.map(i=>ak(i,e,t)).sort((i,o)=>i.errorAmount-o.errorAmount||i.totalErrorSpan-o.totalErrorSpan)[0].updateNodeAndCtx()}}var TR=()=>{},OR=async(r,e)=>{let t=[];jr(r,n=>!e.meta.hasChecker(n.type),n=>e.meta.hasChecker(n.type),n=>{let o=e.meta.getChecker(n.type)(n,e);o instanceof Promise&&t.push(o)}),await Promise.allSettled(t)},ER=(r,e)=>{for(let t of r.children??[])e.meta.hasChecker(t.type)&&e.meta.getChecker(t.type)(t,e)},lk=(r,e)=>{let t=le.toString(r,"full");if(r.options.pool){r.options.pool.includes(t)||e.err.report(b("expected",r.options.pool),r,3);return}},ck=(r,e)=>{};function RR(r){r.registerChecker("resource_location",lk),r.registerChecker("symbol",ck)}var At;(function(r){r.NamedColors=new Map([["aqua",5636095],["black",0],["blue",5592575],["dark_aqua",43690],["dark_blue",170],["dark_gray",5592405],["dark_green",43520],["dark_purple",11141290],["dark_red",11141120],["gold",16755200],["gray",11184810],["green",5635925],["light_purple",16733695],["red",16733525],["white",16777215],["yellow",16777045]]),r.ColorNames=[...r.NamedColors.keys()];function e(s,a,l,c){return[s,a,l,c]}r.fromDecRGBA=e;function t(s,a,l){return e(s,a,l,1)}r.fromDecRGB=t;function n(s,a,l,c){return e(s/255,a/255,l/255,c/255)}r.fromIntRGBA=n;function i(s,a,l){return n(s,a,l,255)}r.fromIntRGB=i;function o(s){if(s<0)return t(1,1,1);let a=s%256;s>>=8;let l=s%256;s>>=8;let c=s%256;return i(c,l,a)}r.fromCompositeInt=o})(At||(At={}));var ir;(function(r){r[r.DecRGBA=0]="DecRGBA",r[r.DecRGB=1]="DecRGB",r[r.IntRGBA=2]="IntRGBA",r[r.IntRGB=3]="IntRGB",r[r.HexRGBA=4]="HexRGBA",r[r.HexRGB=5]="HexRGB",r[r.CompositeInt=6]="CompositeInt"})(ir||(ir={}));var Nu;(function(r){function e(n,i,o){let s=t(n,i);return{label:s,text:s,range:o}}r.fromColorFormat=e;function t(n,i){let o=s=>parseFloat(s.toFixed(3));switch(n){case ir.DecRGBA:return i.map(s=>o(s)).join(" ");case ir.DecRGB:return i.slice(0,3).map(s=>o(s)).join(" ");case ir.IntRGBA:return i.map(s=>Math.round(s*255)).join(" ");case ir.IntRGB:return i.slice(0,3).map(s=>Math.round(s*255)).join(" ");case ir.HexRGBA:return`#${Math.round((i[0]*255<<24)+(i[1]*255<<16)+i[2]*255<<8+i[3]*255).toString(16).padStart(8,"0")}`;case ir.HexRGB:return`#${Math.round((i[0]*255<<16)+(i[1]*255<<8)+i[2]*255).toString(16).padStart(6,"0")}`;case ir.CompositeInt:return`${Math.round((i[0]*255<<16)+(i[1]*255<<8)+i[2]*255)}`}}})(Nu||(Nu={}));var ot={};dn(ot,{boolean:()=>fk,comment:()=>uk,error:()=>hk,fallback:()=>MR,literal:()=>dk,number:()=>Pu,registerColorizers:()=>DR,resourceLocation:()=>pk,string:()=>mk,symbol:()=>gk});var Je;(function(r){function e(n,i,o){return{range:k.get(n),type:i,modifiers:o}}r.create=e;function t(n,i,o,s){let a=[],l=Math.min(i.start,n[0]?.range.start??1/0);for(let c of n)c.range.start>l&&a.push(r.create(k.create(l,c.range.start),o,s)),a.push(c),l=c.range.end;return l<i.end&&a.push(r.create(k.create(l,i.end),o,s)),a}r.fillGap=t})(Je||(Je={}));var i8=Object.freeze(["comment","enum","enumMember","function","keyword","modifier","number","operator","property","string","struct","type","type","variable","error","literal","operator","resourceLocation","vector"]),o8=Object.freeze(["declaration","defaultLibrary","definition","deprecated","documentation","modification","readonly"]);var MR=(r,e)=>{let t=[];return jr(r,n=>!e.meta.hasColorizer(n.type)&&(!e.range||k.intersects(n.range,e.range)),n=>e.meta.hasColorizer(n.type),n=>{let o=e.meta.getColorizer(n.type)(n,e);t.push(...o)}),Object.freeze(t)},fk=r=>[Je.create(r,"literal")],uk=r=>[Je.create(r,"comment")],hk=r=>[Je.create(r,"error")],dk=r=>[Je.create(r,r.options.colorTokenType??"literal")],Pu=r=>[Je.create(r,"number")],pk=(r,e)=>{let t;switch(r.options.category){case"function":case"tag/function":t="function";break;default:t="resourceLocation";break}return[Je.create(r,t)]},mk=(r,e)=>{if(r.children){let n=e.meta.getColorizer(r.children[0].type)(r.children[0],e);return Je.fillGap(n,r.range,r.options.colorTokenType??"string")}else return[Je.create(r,r.options.colorTokenType??"string")]},gk=r=>[Je.create(r,"variable")];function DR(r){r.registerColorizer("boolean",fk),r.registerColorizer("comment",uk),r.registerColorizer("error",hk),r.registerColorizer("float",Pu),r.registerColorizer("integer",Pu),r.registerColorizer("long",Pu),r.registerColorizer("literal",dk),r.registerColorizer("resource_location",pk),r.registerColorizer("string",mk),r.registerColorizer("symbol",gk)}var xe={};dn(xe,{boolean:()=>bk,dispatch:()=>qm,fallback:()=>NR,file:()=>PR,literal:()=>_k,noop:()=>Ol,record:()=>LR,registerCompleters:()=>IR,resourceLocation:()=>vk,string:()=>kk,symbol:()=>wk});var yk=pn(du(),1);var Ie;(function(r){function e(i,o,s){let a=s?.insertText===void 0&&t(i);return w(I(w({},s),{label:i,range:k.get(o)}),a?{insertText:n(i)}:{})}r.create=e;function t(i){return/[\\$}]/.test(i)}r.needsEscape=t;function n(i){return i.replace(/([\\$}])/g,"\\$1")}r.escape=n})(Ie||(Ie={}));var Xn,Po,Tl=class{constructor(){U(this,Xn,"");U(this,Po,1)}literal(e){return X(this,Xn,_(this,Xn)+Ie.escape(e)),this}placeholder(...e){return e.length===0?X(this,Xn,_(this,Xn)+`\${${_(this,Po)}}`):e.length===1?X(this,Xn,_(this,Xn)+`\${${_(this,Po)}:${Ie.escape(e[0])}}`):X(this,Xn,_(this,Xn)+`\${${_(this,Po)}|${e.map(t=>t.replace(/([\\$},|])/g,"\\$1")).join(",")}|}`),X(this,Po,_(this,Po)+1),this}exitPlace(){return X(this,Xn,_(this,Xn)+"$0"),this}build(){return _(this,Xn)}if(e,t){return e&&t(this),this}};Xn=new WeakMap,Po=new WeakMap;var qm=(r,e)=>{let t=yt.findShallowestChild({node:r,needle:e.offset,endInclusive:!0,predicate:n=>e.meta.hasCompleter(n.type)});return t?e.meta.getCompleter(t.type)(t,e):[]},NR=qm,bk=(r,e)=>[Ie.create("false",r,{kind:21}),Ie.create("true",r,{kind:21})],PR=(r,e)=>e.meta.getCompleterForLanguageID(e.doc.languageId)(r.children[0],e),_k=r=>{let e=new Map([["enum",13],["enumMember",20],["function",3],["keyword",14],["literal",14],["number",21],["operator",24],["property",10],["resourceLocation",17],["variable",6]]).get(r.options.colorTokenType??"keyword")??14;return r.options.pool.map(t=>Ie.create(t,r,{kind:e}))??[]},Ol=()=>[];function LR(r){return(e,t)=>{if(!k.contains(k.translate(e,1,-1),t.offset,!0))return[];let n=h=>r.key(e,h,t,h?.key??t.offset,!1,!1,o),i=h=>r.key(e,h,t,h??t.offset,!0,l||!!h?.end,o),o=e.children.filter(h=>!!h.key).map(h=>h.key),s=(0,yk.default)(e.children,t.offset,(h,d)=>h.end?k.compareOffset(k.translate(h,0,-1),d,!0):k.compareOffset(h.range,d,!0)),a=s>=0?e.children[s]:void 0,l=!!e.children.find(h=>h.range.start>t.offset);if(!a)return i(void 0);let{key:c,sep:f,value:u}=a;return!c&&!f&&!u?i(void 0):c&&k.contains(c,t.offset,!0)||f&&t.offset<=f.start||u&&t.offset<u.range.start?!u||k.isEmpty(u.range)?i(a):n(a):u&&k.contains(u,t.offset,!0)||f&&t.offset>=f.end||c&&t.offset>c.range.end?r.value(e,a,t):[]}}var vk=(r,e)=>{let t=Hs.destruct(e.config.lint.idOmitDefaultNamespace),n=!r.options.isPredicate&&r.namespace==="",i=r.options.isPredicate||t?.ruleValue!==!0,o=!r.options.isPredicate&&t?.ruleValue!==!1,s=c=>a(Object.keys(e.symbols.getVisibleSymbols(c,e.doc.uri))),a=c=>{let f=`${se.DefaultNamespace}${se.NamespacePathSep}`,u=[],h=[];for(let m of c)m.startsWith(f)?u.push(m):h.push(m);let d=[...h,...i?u:[],...o?u.map(m=>m.slice(f.length)):[],...n?u.map(m=>m.slice(se.DefaultNamespace.length)):[]];return r.options.namespacePathSep==="."?d.map(m=>m.replace(se.NamespacePathSep,".")):d};return(r.options.pool?a(r.options.pool):[...s(r.options.category),...r.options.allowTag?s(`tag/${r.options.category}`).map(c=>`${se.TagPrefix}${c}`):[]]).map(c=>Ie.create(c,r,{kind:3}))},kk=(r,e)=>r.children?.length?qm(r.children[0],e):r.options.quotes&&r.value===""?r.options.quotes.map(t=>Ie.create(`${t}${t}`,r,{insertText:`${t}$1${t}`,kind:12})):[],wk=(r,e)=>Object.keys(e.symbols.query(e.doc,r.options.category,...r.options.parentPath??[]).visibleMembers).map(t=>Ie.create(t,r,{kind:6}));function IR(r){r.registerCompleter("boolean",bk),r.registerCompleter("comment",Ol),r.registerCompleter("float",Ol),r.registerCompleter("integer",Ol),r.registerCompleter("long",Ol),r.registerCompleter("literal",_k),r.registerCompleter("resource_location",vk),r.registerCompleter("string",kk),r.registerCompleter("symbol",wk)}var En={};dn(En,{boolean:()=>Sk,comment:()=>Ck,fallback:()=>BR,file:()=>xk,float:()=>Ak,integer:()=>Tk,literal:()=>Ok,long:()=>Ek,registerFormatters:()=>zR,resourceLocation:()=>Rk,string:()=>Mk});var BR=r=>{throw new Error(`No formatter registered for type ${r.type}`)},xk=(r,e)=>r.children.map(t=>e.meta.getFormatter(t.type)(t,e)).join(""),Sk=r=>r.value?"true":"false",Ck=r=>"#"+r.comment,Ak=r=>r.value.toString(),Tk=r=>r.value.toFixed(),Ok=r=>r.value,Ek=r=>r.value.toString(),Rk=r=>le.toString(r,"origin"),Mk=r=>`"${r.value}"`;function zR(r){r.registerFormatter("file",xk),r.registerFormatter("boolean",Sk),r.registerFormatter("comment",Ck),r.registerFormatter("float",Ak),r.registerFormatter("integer",Tk),r.registerFormatter("long",Ek),r.registerFormatter("literal",Ok),r.registerFormatter("resource_location",Rk),r.registerFormatter("string",Mk)}function Km(r,e=0){let t=r.indentLevel+e;return r.insertSpaces?" ".repeat(t*r.tabSize):"	".repeat(t)}function Gm(r,e=1){return I(w({},r),{indentLevel:r.indentLevel+e,indent(t){return Km(this,t)}})}var Di={};dn(Di,{configValidator:()=>Mi,nameConvention:()=>El,noop:()=>FR,quote:()=>VR,registerLinters:()=>UR});var Dk=(r,e)=>{if(!r.symbol||Qe.isDeclared(r.symbol))return;let t=jR(e.ruleValue,r.symbol,e);if(Ei.Action.isDeclare(t)&&e.symbols.query({doc:e.doc,node:r},r.symbol.category,...r.symbol.path).amend({data:{visibility:$R(t.declare)},usage:{type:"declaration",node:r}}),Ei.Action.isReport(t)){let n=t.report==="inherit"?void 0:Oi.toErrorSeverity(t.report);e.err.lint(b("linter.undeclared-symbol.message",r.symbol.category,q(r.symbol.identifier)),r,void 0,n)}};function jR(r,e,t){if(Ei.Action.is(r))return r;function n(o){function s(a){let l=se.lengthen(e.identifier),c=l.slice(0,l.indexOf(se.NamespacePathSep));return(a.category?Le.toArray(a.category).includes(e.category):!0)&&(a.namespace?Le.toArray(a.namespace).includes(c):!0)&&(a.excludeNamespace?!Le.toArray(a.excludeNamespace).includes(c):!0)&&(a.pattern?Le.toArray(a.pattern).some(f=>new RegExp(f).test(e.identifier)):!0)&&(a.excludePattern?!Le.toArray(a.excludePattern).some(f=>new RegExp(f).test(e.identifier)):!0)}try{return Le.toArray(o).some(s)}catch(a){return t.logger.error("[undeclaredSymbol#getAction] Likely encountered an illegal regular expression in the config",a),!1}}function i(o){for(let s of Le.toArray(o))if(!(s.if&&!n(s.if)))return s.override?i(s.override)??s.then:s.then}return i(r)}function $R(r){switch(r){case"block":return 0;case"file":return 1;case"public":return 2}}var FR=()=>{};function El(r){return(e,t)=>{if(typeof e[r]!="string")throw new Error(`Trying to access property "${r}" of node type "${e.type}"`);let n=e[r];try{let i=new RegExp(t.ruleValue);n.match(i)||t.err.lint(b("linter.name-convention.illegal",q(n),q(t.ruleValue)),e)}catch(i){t.logger.error(`[nameConvention linter] The value \u201C${t.ruleValue}\u201D set for rule \u201C${t.ruleName}\u201D is not a valid regular expression.`,i)}}}var VR=(r,e)=>{let t=e.ruleValue,n=r.options.unquotable?[...r.value].some(l=>!Zm(l,r.options.unquotable)):!0,i=t.always||n,o=t.always===!1&&!n,s=e.src.slice(r.range.start,r.range.start+1),a=!!r.options.quotes?.includes(s);i&&a&&(t.avoidEscape,t.type)},Mi;(function(r){function e(o){return`https://spyglassmc.com/user/lint/${o}`}function t(o,s){return`[Invalid Linter Config] [${o}] ${b("linter-config-validator.wrapper",s,e(o))}`}function n(o,s,a){if(typeof s!="string")return a.error(t(o,b("linter-config-validator.name-convention.type"))),!1;try{new RegExp(s)}catch(l){return a.error(t(o,b("")),l),!1}return!0}r.nameConvention=n;function i(o,s,a){return Ei.is(s)}r.symbolLinterConfig=i})(Mi||(Mi={}));function UR(r){r.registerLinter("nameOfObjective",{configValidator:Mi.nameConvention,linter:El("value"),nodePredicate:e=>e.symbol&&e.symbol.category==="objective"}),r.registerLinter("nameOfScoreHolder",{configValidator:Mi.nameConvention,linter:El("value"),nodePredicate:e=>e.symbol&&e.symbol.category==="score_holder"}),r.registerLinter("nameOfTag",{configValidator:Mi.nameConvention,linter:El("value"),nodePredicate:e=>e.symbol&&e.symbol.category==="tag"}),r.registerLinter("nameOfTeam",{configValidator:Mi.nameConvention,linter:El("value"),nodePredicate:e=>e.symbol&&e.symbol.category==="team"}),r.registerLinter("undeclaredSymbol",{configValidator:Mi.symbolLinterConfig,linter:Dk,nodePredicate:e=>e.symbol&&!Bm.includes(e.symbol.category)})}var jt=class{errors=[];constructor(){}report(e,t,n=3,i){this.errors.push(bu.create(e,k.get(t),n,i))}dump(){let e=Object.freeze(this.errors);return this.errors=[],e}absorb(e){this.errors.push(...e.errors)}},Ws=class extends jt{ruleName;ruleSeverity;constructor(e,t){super(),this.ruleName=e,this.ruleSeverity=t}lint(e,t,n,i){return this.report(b("linter.diagnostic-message-wrapper",e,this.ruleName),t,i??this.ruleSeverity,n)}static fromErrorReporter(e,t,n){let i=new Ws(t,n);return i.errors=e.errors,i}};var Rl;(function(r){function e(t){return{fs:t.fs,getDocAndNode:t.get.bind(t),logger:t.logger,meta:t.meta,profilers:t.profilers,roots:t.roots,project:t.ctx}}r.create=e})(Rl||(Rl={}));var Lu;(function(r){function e(t,n){return I(w({},Rl.create(t)),{config:t.config,doc:n.doc,err:n.err??new jt})}r.create=e})(Lu||(Lu={}));var tn;(function(r){function e(t,n){return I(w({},Rl.create(t)),{config:t.config,doc:n.doc,src:n.src??new Ao(n.doc.getText()),symbols:t.symbols})}r.create=e})(tn||(tn={}));var Jm;(function(r){function e(t,n){return I(w({},tn.create(t,n)),{range:n.range})}r.create=e})(Jm||(Jm={}));var Ym;(function(r){function e(t,n){return I(w({},tn.create(t,n)),{offset:n.offset})}r.create=e})(Ym||(Ym={}));var Iu;(function(r){function e(t,n){return I(w({},tn.create(t,n)),{err:n.err??new jt,ensureBound:t.ensureBound?.bind(t)})}r.create=e})(Iu||(Iu={}));var Bu;(function(r){function e(t,n){return I(w({},tn.create(t,n)),{err:n.err??new jt,ensureChecked:t.ensureChecked?.bind(t)})}r.create=e})(Bu||(Bu={}));var zu;(function(r){function e(t,n){return I(w({},tn.create(t,n)),{err:n.err,ruleName:n.ruleName,ruleValue:n.ruleValue})}r.create=e})(zu||(zu={}));var ju;(function(r){function e(t,n){return I(w(w({},tn.create(t,n)),n),{indentLevel:0,indent(i){return Km(this,i)}})}r.create=e})(ju||(ju={}));var $u;(function(r){function e(t,n){return Jm.create(t,n)}r.create=e})($u||($u={}));var Fu;(function(r){function e(t,n){return I(w({},tn.create(t,n)),{offset:n.offset,triggerCharacter:n.triggerCharacter})}r.create=e})(Fu||(Fu={}));var Vu;(function(r){function e(t,n){return Ym.create(t,n)}r.create=e})(Vu||(Vu={}));var Uu;(function(r){function e(t){return I(w({},Rl.create(t)),{symbols:t.symbols})}r.create=e})(Uu||(Uu={}));var Hu;(function(r){function e(t){return t.startsWith("@")}r.is=e})(Hu||(Hu={}));var Ni,Wu=class{constructor(e,t,n){ce(this,"cacheRoot");ce(this,"externals");ce(this,"logger");U(this,Ni,new Map);this.cacheRoot=e,this.externals=t,this.logger=n}async download(e,t={}){let{id:n,cache:i,uri:o,options:s,transformer:a,ttl:l}=e;if(l&&_(this,Ni).has(o)){let{buffer:h,time:d}=_(this,Ni).get(o);if(d<=performance.now()+l)return this.logger.info(`[Downloader] [${n}] Skipped thanks to valid cache in memory`),await a(h);_(this,Ni).delete(o)}let c,f,u;if(i){let{checksumJob:h,checksumExtension:d}=i;t.cacheUri=f=new tr(`downloader/${n}`,this.cacheRoot).toString(),u=new tr(`downloader/${n}${d}`,this.cacheRoot).toString();try{t.checksum=c=await this.download(I(w({},h),{id:n+d}));try{let m=Ir(await ge.readFile(this.externals,u)).slice(0,-1);if(c===m)try{let y=await ge.readFile(this.externals,f);l&&_(this,Ni).set(o,{buffer:y,time:performance.now()});let g=i.deserializer??(T=>T),v=await a(g(y));return this.logger.info(`[Downloader] [${n}] Skipped downloading thanks to cache ${m}`),v}catch(y){if(this.logger.error(`[Downloader] [${n}] Loading cached file \u201C${f}\u201D`,y),this.externals.error.isKind(y,"ENOENT"))try{await this.externals.fs.unlink(u)}catch(g){this.logger.error(`[Downloader] [${n}] Removing invalid cache checksum \u201C${u}\u201D`,g)}}}catch(m){this.externals.error.isKind(m,"ENOENT")||this.logger.error(`[Downloader] [${n}] Loading cache checksum \u201C${u}\u201D`,m)}}catch(m){this.logger.error(`[Downloader] [${n}] Fetching latest checksum \u201C${h.uri}\u201D`,m)}}try{let h=await this.externals.downloader.get(o,s);if(l&&_(this,Ni).set(o,{buffer:h,time:performance.now()}),i&&f&&u){if(c)try{await ge.writeFile(this.externals,u,`${c}
`)}catch(d){this.logger.error(`[Downloader] [${n}] Saving cache checksum \u201C${u}\u201D`,d)}try{let d=i.serializer??(m=>m);await ge.writeFile(this.externals,f,d(h))}catch(d){this.logger.error(`[Downloader] [${n}] Caching file \u201C${f}\u201D`,d)}}return this.logger.info(`[Downloader] [${n}] Downloaded from \u201C${o}\u201D`),await a(h)}catch(h){if(this.logger.error(`[Downloader] [${n}] Downloading \u201C${o}\u201D`,h),i&&f)try{let d=await ge.readFile(this.externals,f),m=i.deserializer??(g=>g),y=await a(m(d));return this.logger.warn(`[Downloader] [${n}] Fell back to cached file \u201C${f}\u201D`),y}catch(d){this.logger.error(`[Downloader] [${n}] Fallback: loading cached file \u201C${f}\u201D`,d)}}}};Ni=new WeakMap;var Ml;(function(r){function e(t,n){let i=ge.ensureEndingSlash(new tr("virtual-uris/",n).toString());return new Xm(t,i)}r.create=e})(Ml||(Ml={}));var Xm=class{externals;virtualUrisRoot;supporters=new Map;map=new yu;constructor(e,t){this.externals=e,this.virtualUrisRoot=t}register(e,t,n=!1){if(!n&&this.supporters.has(e))throw new Error(`The protocol \u201C${e}\u201D is already associated with another supporter.`);this.supporters.set(e,t)}unregister(e){this.supporters.delete(e)}getSupportedProtocol(e){let t=new tr(e).protocol;if(!this.supporters.has(t))throw new Error(`The protocol \u201C${t}\u201D is unsupported.`);return t}async hash(e){let t=this.getSupportedProtocol(e);return this.supporters.get(t).hash(e)}readFile(e){let t=this.getSupportedProtocol(e);return this.supporters.get(t).readFile(e)}*listFiles(){for(let e of this.supporters.values())yield*e.listFiles()}*listRoots(){for(let e of this.supporters.values())yield*e.listRoots()}async mapToDisk(e){if(ge.isFileUri(e))return e;if(!!this.virtualUrisRoot)try{let t=this.map.getKey(e);if(t===void 0){t=`${this.virtualUrisRoot}${await this.externals.crypto.getSha1(e)}/${ge.basename(e)}`;let n=await this.readFile(e);await ge.writeFile(this.externals,t,n,292),this.map.set(t,e)}return t}catch{}}mapFromDisk(e){return this.virtualUrisRoot?this.map.get(e)??e:e}},qs=class{externals;roots;files;protocol="file:";constructor(e,t,n){this.externals=e,this.roots=t,this.files=n}async hash(e){return Qm(this.externals,e)}readFile(e){return this.externals.fs.readFile(e)}*listFiles(){for(let e of this.files.values())yield*e}listRoots(){return this.roots}async mapToDisk(e){return e}static async create(e,t,n){let i=[],o=new Map;for(let{uri:s}of e)try{ge.isFileUri(s)&&(await t.fs.stat(s)).isDirectory()&&(s=ge.ensureEndingSlash(s),i.push(s),o.set(s,await t.fs.getAllFiles(s)))}catch(a){n.error(`[FileUriSupporter#create] Bad dependency \u201C${s}\u201D`,a)}return new qs(t,i,o)}},mr=class{externals;entries;protocol=mr.Protocol;constructor(e,t){this.externals=e,this.entries=t}async hash(e){let{archiveUri:t,pathInArchive:n}=mr.decodeUri(new tr(e));return n?this.externals.crypto.getSha1(this.getDataInArchive(t,n)):Qm(this.externals,t)}async readFile(e){let{archiveUri:t,pathInArchive:n}=mr.decodeUri(new tr(e));return this.getDataInArchive(t,n)}getDataInArchive(e,t){let n=this.entries.get(e);if(!n)throw new Error(`Archive \u201C${e}\u201D has not been loaded into the memory`);let i=n.get(t);if(!i)throw new Error(`Path \u201C${t}\u201D does not exist in archive \u201C${e}\u201D`);if(i.type!=="file")throw new Error(`Path \u201C${t}\u201D in archive \u201C${e}\u201D is not a file`);return i.data}*listFiles(){for(let[e,t]of this.entries.entries())for(let n of t.values())yield mr.getUri(e,n.path)}*listRoots(){for(let e of this.entries.keys())yield mr.getUri(e)}static getUri(e,t=""){return`${mr.Protocol}//${encodeURIComponent(e)}/${t.replace(/\\/g,"/")}`}static decodeUri(e){if(e.protocol!==mr.Protocol)throw new Error(`Expected protocol \u201C${mr.Protocol}\u201D in \u201C${e}\u201D`);return{archiveUri:decodeURIComponent(e.hostname),pathInArchive:e.pathname.charAt(0)==="/"?e.pathname.slice(1):e.pathname}}static async create(e,t,n,i){let o=new Map;for(let{uri:s,info:a}of e)try{if(s.startsWith("file:")&&mr.SupportedArchiveExtnames.some(l=>s.endsWith(l))&&(await t.fs.stat(s)).isFile()){let l=mr.getUri(s),c=i[l];if(c!==void 0){let u=await Qm(t,s);if(c===u){n.info(`[SpyglassUriSupporter#create] Skipped decompressing \u201C${s}\u201D thanks to cache ${u}`);continue}}let f=await t.archive.decompressBall(await t.fs.readFile(s),{stripLevel:typeof a?.startDepth=="number"?a.startDepth:0});o.set(s,new Map(f.map(u=>[u.path.replace(/\\/g,"/"),u])))}}catch(l){n.error(`[SpyglassUriSupporter#create] Bad dependency \u201C${s}\u201D`,l)}return new mr(t,o)}},Lo=mr;ce(Lo,"Protocol","archive:"),ce(Lo,"SupportedArchiveExtnames",[".tar",".tar.bz2",".tar.gz",".zip"]);async function Qm(r,e){return r.crypto.getSha1(await r.fs.readFile(e))}var Dl;(function(r){function e(t,n){return{range:k.get(t),markdown:n}}r.create=e})(Dl||(Dl={}));var gr,Ks,Gs,Zs,Js,Nl,Ys,Pl,Ll,Xs,Il,Bl,zl,Qs,qu=class{constructor(){U(this,gr,new Map);U(this,Ks,new Map);U(this,Gs,new Map);U(this,Zs,new Map);U(this,Js,new Map);U(this,Nl,new Map);U(this,Ys,new Map);U(this,Pl,new Set);U(this,Ll,new Map);U(this,Xs,new Map);U(this,Il,new Set);U(this,Bl,new Map);U(this,zl,new Set);U(this,Qs,()=>0);Al.registerBinders(this),nr.registerCheckers(this),ot.registerColorizers(this),xe.registerCompleters(this),En.registerFormatters(this),Di.registerLinters(this)}registerLanguage(e,t){_(this,gr).set(e,t)}getLanguages(){return Array.from(_(this,gr).keys())}isSupportedLanguage(e){return _(this,gr).has(e)}getSupportedFileExtensions(){return[..._(this,gr).values()].flatMap(e=>e.extensions)}getTriggerCharacters(){return Array.from(_(this,gr).values()).flatMap(e=>e.triggerCharacters??[])}getLanguageID(e){for(let[t,{extensions:n}]of _(this,gr))if(n.includes(e))return t}hasBinder(e){return _(this,Ks).has(e)}getBinder(e){return _(this,Ks).get(e)??Al.fallback}registerBinder(e,t){_(this,Ks).set(e,t)}hasChecker(e){return _(this,Gs).has(e)}getChecker(e){return _(this,Gs).get(e)??nr.fallback}registerChecker(e,t){_(this,Gs).set(e,t)}hasColorizer(e){return _(this,Zs).has(e)}getColorizer(e){return _(this,Zs).get(e)??ot.fallback}registerColorizer(e,t){_(this,Zs).set(e,t)}hasCompleter(e){return _(this,Js).has(e)}getCompleter(e){return _(this,Js).get(e)??xe.fallback}registerCompleter(e,t){_(this,Js).set(e,t)}shouldComplete(e,t){let n=_(this,gr).get(e);return!t||!!n?.triggerCharacters?.includes(t)}getCompleterForLanguageID(e){return _(this,gr).get(e)?.completer??xe.fallback}getDependencyProvider(e){return _(this,Nl).get(e)}registerDependencyProvider(e,t){_(this,Nl).set(e,t)}hasFormatter(e){return _(this,Ys).has(e)}getFormatter(e){return _(this,Ys).get(e)??En.fallback}registerFormatter(e,t){_(this,Ys).set(e,t)}registerInlayHintProvider(e){_(this,Pl).add(e)}get inlayHintProviders(){return _(this,Pl)}getLinter(e){return _(this,Ll).get(e)??{configValidator:()=>!1,linter:Di.noop,nodePredicate:()=>!1}}registerLinter(e,t){_(this,Ll).set(e,t)}hasParser(e){return _(this,Xs).has(e)}getParser(e){let t=_(this,Xs).get(e);if(!t)throw new Error(`There is no parser '${e}'`);return t}getParserLazily(e){return xi.create(()=>this.getParser(e))}registerParser(e,t){_(this,Xs).set(e,t)}getParserForLanguageId(e){if(_(this,gr).has(e))return _(this,gr).get(e).parser;throw new Error(`There is no parser registered for language ID '${e}'`)}registerSignatureHelpProvider(e){_(this,Il).add(e)}get signatureHelpProviders(){return _(this,Il)}registerSymbolRegistrar(e,t){_(this,Bl).set(e,t)}get symbolRegistrars(){return _(this,Bl)}registerUriBinder(e){_(this,zl).add(e)}get uriBinders(){return _(this,zl)}setUriSorter(e){let t=_(this,Qs);X(this,Qs,(n,i)=>e(n,i,t))}get uriSorter(){return _(this,Qs)}};gr=new WeakMap,Ks=new WeakMap,Gs=new WeakMap,Zs=new WeakMap,Js=new WeakMap,Nl=new WeakMap,Ys=new WeakMap,Pl=new WeakMap,Ll=new WeakMap,Xs=new WeakMap,Il=new WeakMap,Bl=new WeakMap,zl=new WeakMap,Qs=new WeakMap;var Nk="Total",jl,$l,Io,ea,Pi,eg=class{constructor(e,t){ce(this,"id");ce(this,"logger");U(this,jl,!1);U(this,$l,void 0);U(this,Io,void 0);U(this,ea,[]);U(this,Pi,0);this.id=e,this.logger=t,X(this,$l,X(this,Io,performance.now()))}task(e){if(_(this,jl))throw new Error("The profiler is finalized.");let t=performance.now();return _(this,ea).push([e,t-_(this,Io)]),X(this,Io,t),X(this,Pi,Math.max(_(this,Pi),e.length)),this.logger.info(`[Profiler: ${this.id}] Done: ${e}`),this}finalize(){X(this,jl,!0),_(this,ea).push([Nk,_(this,Io)-_(this,$l)]),X(this,Pi,Math.max(_(this,Pi),Nk.length)),this.logger.info(`[Profiler: ${this.id}] == Summary ==`);for(let[e,t]of _(this,ea))this.logger.info(`[Profiler: ${this.id}] ${e}${" ".repeat(_(this,Pi)-e.length)} - ${t} ms`)}};jl=new WeakMap,$l=new WeakMap,Io=new WeakMap,ea=new WeakMap,Pi=new WeakMap;var tg=class{task(){return this}finalize(){}},Fl,rg=class{constructor(e,t){ce(this,"logger");U(this,Fl,void 0);this.logger=e,X(this,Fl,new Set(t))}get(e){return _(this,Fl).has(e)?new eg(e,this.logger):new tg}static noop(){return new rg(Ns.noop(),[])}},Li=rg;Fl=new WeakMap;var Ku=pn(Au(),1);var aa=function(r,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},HR=6e5,Vl,Ii,ra,Rn,Bo,na,Ul,Hl,Bi,ia,zi,Qn,Wl,zo,oa,sa,jo,ta=class{constructor({cacheRoot:e,defaultConfig:t,downloader:n,externals:i,fs:o=Ml.create(i,e),initializers:s=[],logger:a=Ns.create(),profilers:l=Li.noop(),projectRoot:c}){U(this,Vl,void 0);ce(this,"cacheService");U(this,Ii,new Set);U(this,ra,void 0);U(this,Rn,new Map);U(this,Bo,void 0);U(this,na,void 0);U(this,Ul,void 0);U(this,Hl,void 0);U(this,Bi,new Set);U(this,ia,void 0);U(this,zi,!1);U(this,Qn,!1);ce(this,"config");ce(this,"downloader");ce(this,"externals");ce(this,"fs");ce(this,"logger");ce(this,"meta",new qu);ce(this,"profilers");ce(this,"projectRoot");ce(this,"symbols");U(this,Wl,void 0);U(this,zo,void 0);U(this,oa,[]);U(this,sa,void 0);U(this,jo,void 0);X(this,jo,e),X(this,Bo,new i.event.EventEmitter),this.externals=i,this.fs=o,X(this,na,s),this.logger=a,this.profilers=l,this.projectRoot=c,this.cacheService=new Mu(e,this),X(this,ra,new No(this,t)),this.downloader=n??new Wu(e,i,a),this.symbols=new Qe({},i.event.EventEmitter),X(this,sa,{}),this.logger.info(`[Project] [init] cacheRoot = \u201C${e}\u201D`),_(this,ra).on("changed",({config:f})=>{this.config=f,this.logger.info("[Project] [Config] Changed")}).on("error",({error:f,uri:u})=>this.logger.error(`[Project] [Config] Failed loading \u201C${u}\u201D`,f)),this.setInitPromise(),this.setReadyPromise(),X(this,Vl,setInterval(()=>this.cacheService.save(),HR)),this.on("documentUpdated",({doc:f,node:u})=>{!_(this,Qn)||this.emit("documentErrorred",{doc:f,errors:Bs.getErrors(u),node:u})}).on("fileCreated",async({uri:f})=>(f.endsWith(ta.RootSuffix)&&this.updateRoots(),this.bindUri(f),this.ensureChecked(f))).on("fileModified",async({uri:f})=>{this.isOnlyWatched(f)&&(_(this,Rn).delete(f),await this.ensureChecked(f))}).on("fileDeleted",({uri:f})=>{f.endsWith(ta.RootSuffix)&&this.updateRoots(),this.symbols.clear({uri:f}),this.tryClearingCache(f)}).on("ready",()=>{X(this,Qn,!0);let f=[];for(let u of _(this,Ii)){let h=_(this,Rn).get(u);h&&(f.push(this.bind(h.doc,h.node)),f.push(this.check(h.doc,h.node)))}Promise.all(f).catch(u=>this.logger.error("[Project#ready] Error occurred when rechecking client managed files after ready",u))})}get isReady(){return _(this,Qn)}get roots(){return _(this,oa)}get ctx(){return _(this,sa)}get cacheRoot(){return _(this,jo)}updateRoots(){let e=[..._(this,Wl),this.projectRoot],t=new Set(e);for(let n of this.getTrackedFiles())n.endsWith(ta.RootSuffix)&&e.some(i=>n.startsWith(i))&&t.add(n.slice(0,1-ta.RootSuffix.length));X(this,oa,[...t].sort((n,i)=>i.length-n.length)),this.emit("rootsUpdated",{roots:_(this,oa)})}on(e,t){return _(this,Bo).on(e,t),this}once(e,t){return _(this,Bo).once(e,t),this}emit(e,...t){return _(this,Bo).emit(e,...t)}getTrackedFiles(){let e=this.meta.getSupportedFileExtensions();return[..._(this,zo),..._(this,Bi)].filter(t=>e.includes(ge.extname(t)??""))}setInitPromise(){let e=async()=>{this.config=await _(this,ra).load()},t=async()=>{let i={cacheRoot:this.cacheRoot,config:this.config,downloader:this.downloader,externals:this.externals,logger:this.logger,meta:this.meta,projectRoot:this.projectRoot},o=await Promise.allSettled(_(this,na).map(a=>a(i))),s={};o.forEach(async(a,l)=>{a.status==="rejected"?this.logger.error(`[Project] [callInitializers] [${l}] \u201C${_(this,na)[l].name}\u201D`,a.reason):a.value&&(s=w(w({},s),a.value))}),X(this,sa,s)};X(this,Ul,(async()=>{let i=this.profilers.get("project#init"),{symbols:o}=await this.cacheService.load();this.symbols=new Qe(o,this.externals.event.EventEmitter),this.symbols.buildCache(),i.task("Load Cache"),await e(),i.task("Load Config"),await t(),i.task("Initialize").finalize()})())}setReadyPromise(){let e=async()=>{let o=[];for(let s of this.config.env.dependencies)if(Hu.is(s)){let a=this.meta.getDependencyProvider(s);if(a)try{o.push(await a()),this.logger.info(`[Project] [getDependencies] Executed provider \u201C${s}\u201D`)}catch(l){this.logger.error(`[Project] [getDependencies] Bad provider \u201C${s}\u201D`,l)}else this.logger.error(`[Project] [getDependencies] Bad dependency \u201C${s}\u201D: no associated provider`)}else o.push({uri:s});return o},t=async()=>{let o=await e(),s=await qs.create(o,this.externals,this.logger),a=await Lo.create(o,this.externals,this.logger,this.cacheService.checksums.roots);this.fs.register("file:",s,!0),this.fs.register(Lo.Protocol,a,!0)},n=()=>new Promise(o=>{X(this,zi,!1),X(this,ia,this.externals.fs.watch(this.projectRoot).once("ready",()=>{X(this,zi,!0),o()}).on("add",s=>{_(this,Bi).add(s),_(this,zi)&&this.emit("fileCreated",{uri:s})}).on("change",s=>{_(this,zi)&&this.emit("fileModified",{uri:s})}).on("unlink",s=>{_(this,Bi).delete(s),_(this,zi)&&this.emit("fileDeleted",{uri:s})}).on("error",s=>{this.logger.error("[Project] [chokidar]",s)}))});X(this,Hl,(async()=>{await this.init();let o=this.profilers.get("project#ready"),s=this.ensureParsed.bind(this),a=this.bind.bind(this),l=this.check.bind(this);await Promise.all([t(),n()]),X(this,zo,new Set(this.fs.listFiles())),X(this,Wl,new Set(this.fs.listRoots())),this.updateRoots(),o.task("List Files");for(let[m,{checksum:y,registrar:g}]of this.meta.symbolRegistrars){let v=this.cacheService.checksums.symbolRegistrars[m];v===void 0||y!==v?(this.symbols.clear({contributor:`symbol_registrar/${m}`}),this.symbols.contributeAs(`symbol_registrar/${m}`,()=>{g(this.symbols,{logger:this.logger})}),this.emit("symbolRegistrarExecuted",{id:m,checksum:y})):this.logger.info(`[SymbolRegistrar] Skipped \u201C${m}\u201D thanks to cache ${y}`)}o.task("Register Symbols");let{addedFiles:c,changedFiles:f,removedFiles:u}=await this.cacheService.validate();for(let m of u)this.symbols.clear({uri:m});o.task("Validate Cache"),c.length>0&&this.bindUri(c),o.task("Bind URIs");let h=[...c,...f].sort(this.meta.uriSorter),d=(await Promise.all(h.map(m=>s(m)))).filter(m=>!!m);o.task("Parse Files"),await Promise.all(d.map(({doc:m,node:y})=>a(m,y))),o.task("Bind Files"),await Promise.all(d.map(({doc:m,node:y})=>l(m,y))),o.task("Check Files").finalize(),this.emit("ready",{})})())}async init(){return await _(this,Ul),this}async ready(){return await _(this,Hl),this}async close(){clearInterval(_(this,Vl)),await _(this,ia).close(),await this.cacheService.save()}async restart(){try{await _(this,ia).close(),this.setReadyPromise(),await this.ready()}catch(e){this.logger.error("[Project#reset]",e)}}resetCache(){return this.cacheService.reset()}normalizeUri(e){return this.fs.mapFromDisk(this.externals.uri.normalize(e))}getLanguageID(e){e=this.normalizeUri(e);let t=ge.extname(e)??".plaintext";return this.meta.getLanguageID(t)??t.slice(1)}get(e){return e=this.normalizeUri(e),_(this,Rn).get(e)}async ensureParsed(e){if(e=this.normalizeUri(e),_(this,Rn).has(e))return _(this,Rn).get(e);let t=this.getLanguageID(e);if(!!this.meta.isSupportedLanguage(t))try{let n=Ir(await this.fs.readFile(e)),i=Ku.TextDocument.create(e,t,-1,n);return this.parseAndCache(i)}catch(n){this.logger.warn(`[Project] [ensureParsed] Failed for \u201C${e}\u201D`,n);return}}parseAndCache(e){let t=this.parse(e);return this.cache(e,t)}parse(e){let t=Lu.create(this,{doc:e}),n=new Ke(e.getText());return Pk()(n,t)}cache(e,t){let n=Ls(_(this,Rn),e.uri,{insert:()=>({doc:e,node:t}),update:i=>(i.doc=e,i.node=t,i)});return this.emit("documentUpdated",n),n}async bind(e,t){if(!t.binderErrors)try{let n=this.meta.getBinder(t.type),i=Iu.create(this,{doc:e});i.symbols.clear({contributor:"binder",uri:e.uri}),await i.symbols.contributeAsAsync("binder",async()=>{let o=zt.create(t);await n(o,i),t.binderErrors=i.err.dump(),this.cache(e,t)})}catch(n){this.logger.error(`[Project] [bind] Failed for \u201C${e.uri}\u201D #${e.version}`,n)}}async check(e,t){if(!t.checkerErrors)try{let n=this.meta.getChecker(t.type),i=Bu.create(this,{doc:e});i.symbols.clear({contributor:"checker",uri:e.uri}),await i.symbols.contributeAsAsync("checker",async()=>{await n(zt.create(t),i),t.checkerErrors=i.err.dump(),this.ensureLinted(e,t),this.cache(e,t)})}catch(n){this.logger.error(`[Project] [check] Failed for \u201C${e.uri}\u201D #${e.version}`,n)}}lint(e,t){t.linterErrors=[];for(let[n,i]of Object.entries(this.config.lint)){let o=Hs.destruct(i);if(!o)continue;let{ruleSeverity:s,ruleValue:a}=o,{configValidator:l,linter:c,nodePredicate:f}=this.meta.getLinter(n);if(!l(n,a,this.logger))continue;let u=zu.create(this,{doc:e,err:new Ws(n,s),ruleName:n,ruleValue:a});jr(t,()=>!0,()=>!0,h=>{if(f(h)){let d=zt.create(h);c(d,u)}}),t.linterErrors.push(...u.err.dump())}this.cache(e,t)}ensureLinted(e,t){if(!t.linterErrors)try{this.lint(e,t)}catch(n){this.logger.error(`[Project] [ensureLinted] Failed for \u201C${e.uri}\u201D #${e.version}`,n)}}async ensureBound(e){let t=await this.ensureParsed(e);return t&&await this.bind(t.doc,t.node),t}async ensureChecked(e){let t=await this.ensureBound(e);return t&&await this.check(t.doc,t.node),t}async ensureCheckedOnlyWhenReady(e){let t=await this.ensureBound(e);return _(this,Qn)&&t&&await this.check(t.doc,t.node),t}bindUri(e){let t=Uu.create(this);typeof e=="string"&&t.symbols.clear({contributor:"uri_binder",uri:e}),t.symbols.contributeAs("uri_binder",()=>{let n=Array.isArray(e)?e:[e];for(let i of this.meta.uriBinders)i(n,t)})}async onDidOpen(e,t,n,i){if(e=this.normalizeUri(e),!ge.isFileUri(e))return;_(this,Ii).add(e);let o=Ku.TextDocument.create(e,t,n,i),{node:s}=this.parseAndCache(o);_(this,Qn)&&(await this.bind(o,s),await this.check(o,s))}async onDidChange(e,t,n){if(e=this.normalizeUri(e),!ge.isFileUri(e))return;let i=this.get(e);if(!i)throw new Error(`Document for \u201C${e}\u201D is not cached. This should not happen. Did the language client send a didChange notification without sending a didOpen one?`);Ku.TextDocument.update(i.doc,t,n);let{node:o}=this.parseAndCache(i.doc);_(this,Qn)&&(await this.bind(i.doc,i.node),await this.check(i.doc,o))}onDidClose(e){e=this.normalizeUri(e),ge.isFileUri(e)&&(_(this,Ii).delete(e),this.tryClearingCache(e))}async showCacheRoot(){if(!!_(this,jo))try{await this.externals.fs.showFile(_(this,jo))}catch(e){this.logger.error("[Service#showCacheRoot]",e)}}tryClearingCache(e){this.shouldRemove(e)&&(_(this,Rn).delete(e),this.emit("documentRemoved",{uri:e}))}shouldRemove(e){return!_(this,Ii).has(e)&&!_(this,zo).has(e)&&!_(this,Bi).has(e)}isOnlyWatched(e){return _(this,Bi).has(e)&&!_(this,Ii).has(e)&&!_(this,zo).has(e)}},rn=ta;Vl=new WeakMap,Ii=new WeakMap,ra=new WeakMap,Rn=new WeakMap,Bo=new WeakMap,na=new WeakMap,Ul=new WeakMap,Hl=new WeakMap,Bi=new WeakMap,ia=new WeakMap,zi=new WeakMap,Qn=new WeakMap,Wl=new WeakMap,zo=new WeakMap,oa=new WeakMap,sa=new WeakMap,jo=new WeakMap,ce(rn,"RootSuffix","/pack.mcmeta");aa([wo()],rn.prototype,"ensureParsed",null);aa([wo()],rn.prototype,"bind",null);aa([wo()],rn.prototype,"check",null);aa([wo()],rn.prototype,"ensureBound",null);aa([wo()],rn.prototype,"ensureChecked",null);aa([wo()],rn.prototype,"ensureCheckedOnlyWhenReady",null);var Gu;(function(r){function e(t,n){return{range:k.get(t),locations:n}}r.create=e})(Gu||(Gu={}));var Zu=class{isDebugging;logger;profilers;project;constructor({isDebugging:e=!1,logger:t,profilers:n=Li.noop(),project:i}){this.isDebugging=e,this.logger=t,this.profilers=n,this.project=new rn(w({logger:t,profilers:n},i))}debug(e){this.isDebugging&&this.logger.info(`[DEBUG] ${e}`)}colorize(e,t,n){try{return this.debug(`Colorizing '${t.uri}' # ${t.version}`),this.project.meta.getColorizer(e.type)(e,$u.create(this.project,{doc:t,range:n}))}catch(i){this.logger.error(`[Service] [colorize] Failed for \u201C${t.uri}\u201D #${t.version}`,i)}return[]}getColorInfo(e,t){try{this.debug(`Getting color info for '${t.uri}' # ${t.version}`);let n=[];return jr(e,i=>!0,i=>i.color,i=>n.push({color:Array.isArray(i.color)?i.color:i.color.value,range:Array.isArray(i.color)?i.range:i.color.range??i.range})),n}catch(n){this.logger.error(`[Service] [getColorInfo] Failed for \u201C${t.uri}\u201D #${t.version}`,n)}return[]}getColorPresentation(e,t,n,i){try{this.debug(`Getting color presentation for '${t.uri}' # ${t.version} @ ${k.toString(n)}`);let o=yt.findDeepestChild({node:e,needle:n.start});for(;o;){let s=o.color;if(s&&!Array.isArray(s)){let a=s.range??o.range;return s.format.map(l=>Nu.fromColorFormat(l,i,a))}o=o.parent}}catch(o){this.logger.error(`[Service] [getColorPresentation] Failed for \u201C${t.uri}\u201D #${t.version}`,o)}return[]}complete(e,t,n,i){try{if(this.debug(`Getting completion for '${t.uri}' # ${t.version} @ ${n}`),this.project.meta.shouldComplete(t.languageId,i))return xe.file(e,Fu.create(this.project,{doc:t,offset:n,triggerCharacter:i}))}catch(o){this.logger.error(`[Service] [complete] Failed for \u201C${t.uri}\u201D #${t.version}`,o)}return[]}dataHackPubify(e){let t=[["ata","ack","ub","elper","lus"],["ah","uh","ew","elpa","lush"]],n=t[Math.floor(Math.random()*t.length)];return[...e].map((i,o)=>`${i.toUpperCase()}${n[o%n.length]}`).join(" ")}format(e,t,n,i){try{return this.debug(`Formatting '${t.uri}' # ${t.version}`),this.project.meta.getFormatter(e.type)(e,ju.create(this.project,{doc:t,tabSize:n,insertSpaces:i}))}catch(o){throw this.logger.error(`[Service] [format] Failed for \u201C${t.uri}\u201D #${t.version}`,o),o}}getHover(e,t,n){try{this.debug(`Getting hover for '${t.uri}' # ${t.version} @ ${n}`);let i=yt.findDeepestChild({node:e,needle:n});for(;i;){let o=this.project.symbols.resolveAlias(i.symbol);if(o){let s=`\`\`\`typescript
(${o.category}${o.subcategory?`/${o.subcategory}`:""}) ${o.identifier}
\`\`\``+(o.desc?`
******
${o.desc}`:"");return Dl.create(i.range,s)}if(i.hover)return Dl.create(i.range,i.hover);i=i.parent}}catch(i){this.logger.error(`[Service] [getHover] Failed for \u201C${t.uri}\u201D #${t.version}`,i)}}getInlayHints(e,t,n){try{this.debug(`Getting inlay hints for '${t.uri}' # ${t.version}`);let i=[],o=tn.create(this.project,{doc:t});for(let s of this.project.meta.inlayHintProviders)i.push(...s(e,o));return i}catch(i){this.logger.error(`[Service] [getInlayHints] Failed for \u201C${t.uri}\u201D #${t.version}`,i)}return[]}getSignatureHelp(e,t,n){try{this.debug(`Getting signature help for '${t.uri}' # ${t.version} @ ${n}`);let i=Vu.create(this.project,{doc:t,offset:n});for(let o of this.project.meta.signatureHelpProviders){let s=o(e,i);if(s)return s}}catch(i){this.logger.error(`[Service] [getSignatureHelp] Failed for \u201C${t.uri}\u201D #${t.version}`,i)}}async getSymbolLocations(e,t,n,i=Oo,o=!1){try{this.debug(`Getting symbol locations of usage '${i.join(",")}' for '${t.uri}' # ${t.version} @ ${n} with currentFileOnly=${o}`);let s=yt.findDeepestChild({node:e,needle:n});for(;s;){let a=this.project.symbols.resolveAlias(s.symbol);if(a){let l=[];for(let f of i){let u=a[f]??[];o&&(u=u.filter(h=>h.uri===t.uri)),l.push(...u)}let c=[];for(let f of l){let u=ge.isFileUri(f.uri)?f.uri:await this.project.fs.mapToDisk(f.uri);u&&c.push(I(w({},f),{uri:u}))}return Gu.create(s.range,c.length?c:void 0)}s=s.parent}}catch(s){this.logger.error(`[Service] [getSymbolLocations] Failed for \u201C${t.uri}\u201D #${t.version}`,s)}}};var oe=Symbol("Failure");function yr(r,e,t){let n=e.clone(),i=I(w({},t),{err:new jt});return{result:r(n,i),endCursor:n.cursor,errorAmount:i.err.errors.length,updateSrcAndCtx:()=>{e.innerCursor=n.innerCursor,t.err.absorb(i.err)}}}function Fe(r,e){return(t,n)=>{let i={[vl]:!0,children:[],range:k.create(t)};for(let[o,s]of r.entries()){let a=typeof s=="function"?s:s.get(i);if(a===void 0)continue;o>0&&e&&i.children.push(...e(t,n));let l=a(t,n);if(l===oe)return oe;if(l===void 0)continue;_l.is(l)?i.children.push(...l.children):i.children.push(l)}return i.range.end=t.cursor,i}}function la(r,e){return(t,n)=>{let i={[vl]:!0,children:[],range:k.create(t)};for(;t.canRead();){e&&i.children.push(...e(t,n));let{result:o,updateSrcAndCtx:s}=yr(r,t,n);if(o===oe)break;s(),_l.is(o)?i.children.push(...o.children):i.children.push(o)}return i.range.end=t.cursor,i}}function $r(r,e){return(t,n)=>{let i=r.map((o,s)=>({attempt:yr(o,t,n),index:s})).filter(({attempt:o})=>o.result!==oe).sort((o,s)=>s.attempt.endCursor-o.attempt.endCursor||o.attempt.errorAmount-s.attempt.errorAmount);return i.length===0?(e&&(e.index=-1),oe):(i[0].attempt.updateSrcAndCtx(),e&&(e.index=i[0].index),i[0].attempt.result)}}function Ce(r){return(e,t)=>{let n=e.cursor,{endCursor:i,updateSrcAndCtx:o,result:s}=yr(r,e,t);return i-n>0?(o(),s):oe}}function ca(r){return(e,t)=>{let n=e.cursor,{errorAmount:i,updateSrcAndCtx:o,result:s}=yr(r,e,t);return i?oe:(o(),s)}}function De(r){return(e,t)=>{let{result:n,updateSrcAndCtx:i}=yr(r,e,t);if(n!==oe)return i(),n}}function Ae(r){return(e,t)=>{for(let{predicate:n,prefix:i,parser:o}of r)if(n?.(e)??(i!==void 0?e.tryPeek(i):void 0)??!0)return(typeof o=="object"?o.get():o)(e,t);throw new Error("The select parser util was called with non-exhaustive cases")}}function me(r,e){return(t,n)=>{let i=r(t,n);return i===oe?oe:e(i,t,n)}}function Oe(r,e){return me(e,t=>{let s=t,{type:n}=s,i=s0(s,["type"]),o=w({type:r},i);return delete o[vl],o})}function ql(r,e,t,n){return me(r,(i,o,s)=>(e(i,o,s)||s.err.report(t,i.range,n),i))}function ei(r,...e){let t=e.flat();return(n,i)=>{let o=n.clone();o.string=o.string.slice(0,t.reduce((a,l)=>{let c=o.string.indexOf(l,o.innerCursor);return Math.min(a,c===-1?1/0:c)},1/0));let s=r(o,i);return n.cursor=o.cursor,s}}var Ju=me(it("false","true"),r=>({type:"boolean",range:r.range,value:r.value===""?void 0:r.value==="true"}));function Kl({singleLinePrefixes:r,includesEol:e}){return(t,n)=>{let i=t.cursor,o={type:"comment",range:k.create(i),comment:""};for(let s of r)if(t.peek(s.length)===s)return e?t.nextLine():t.skipLine(),o.range.end=t.cursor,o.comment=t.sliceToCursor(i+s.length),o;return oe}}var Lk=(r,e)=>{if(!r.canRead())return;let t={type:"error",range:k.create(r,()=>r.skipRemaining())};return e.err.report(b("error.unparseable-content"),t),t};function Pk(){return(r,e)=>{let t=k.create(r,r.string.length),n={type:"file",range:t,children:[],locals:Object.create(null),parserErrors:[]};r.skipWhitespace();let o=e.meta.getParserForLanguageId(e.doc.languageId)(r,e);return o&&o!==oe&&n.children.push(o),r.skipWhitespace().canRead()&&n.children.push(Lk(r,e)),yt.setParents(n),n.parserErrors=e.err.dump(),n}}var WR=(r,e,t,n)=>{t.err.report(b("expected",b("float.between",n.min??"-\u221E",n.max??"+\u221E")),r,3)};function Mn(r){return(e,t)=>{let n={type:"float",range:k.create(e),value:0};for((e.peek()==="-"||e.peek()==="+")&&e.skip();e.canRead()&&Ke.isDigit(e.peek());)e.skip();if(e.trySkip("."))for(;e.canRead()&&Ke.isDigit(e.peek());)e.skip();if(e.peek().toLowerCase()==="e")for(e.skip(),(e.peek()==="-"||e.peek()==="+")&&e.skip();e.canRead()&&Ke.isDigit(e.peek());)e.skip();n.range.end=e.cursor;let i=e.sliceToCursor(n.range.start);if(n.value=parseFloat(i)||0,i)r.pattern.test(i)?(r.min&&n.value<r.min||r.max&&n.value>r.max)&&(r.onOutOfRange??WR)(n,e,t,r):t.err.report(b("parser.float.illegal",r.pattern),n);else{if(r.failsOnEmpty)return oe;t.err.report(b("expected",b("float")),n)}return n}}var qR=(r,e,t,n)=>{t.err.report(b("expected",b("integer.between",n.min??"-\u221E",n.max??"+\u221E")),r,3)};function nn(r){return(e,t)=>{let n={type:"integer",range:k.create(e),value:0};for((e.peek()==="-"||e.peek()==="+")&&e.skip();e.canRead()&&Ke.isDigit(e.peek());)e.skip();n.range.end=e.cursor;let i=e.sliceToCursor(n.range.start),o=i==="-"||i==="+";if(o||(n.value=Number(i)),i)!r.pattern.test(i)||o?t.err.report(b("parser.integer.illegal",r.pattern),n):(r.min!==void 0&&n.value<r.min||r.max!==void 0&&n.value>r.max)&&(r.onOutOfRange??qR)(n,e,t,r);else{if(r.failsOnEmpty)return oe;t.err.report(b("expected",b("integer")),n)}return n}}function ji({start:r,value:e,sep:t,trailingSep:n,end:i}){return(o,s)=>{let a={type:"list",range:k.create(o),children:[]};if(o.trySkip(r)){o.skipWhitespace();let l=!1,c=!1;for(;o.canRead()&&o.peek(i.length)!==i;){let f=o.cursor,u;l&&!c&&s.err.report(b("expected",q(t)),o),o.skipWhitespace();let{result:h,endCursor:d,updateSrcAndCtx:m}=yr(e,o,s);h===oe||d===o.cursor?s.err.report(b("expected",b("parser.list.value")),k.create(o,()=>o.skipUntilOrEnd(t,i,"\r",`
`))):(m(),u=h);let y;o.skipWhitespace(),l=!0,(c=o.peek(t.length)===t)&&(y=k.create(o,()=>o.skip(t.length))),a.children.push(I(w({type:"item",range:k.create(f,o)},u?{children:[u]}:{}),{value:u,sep:y})),o.skipWhitespace()}c&&!n&&s.err.report(b("parser.list.trailing-sep"),a.children[a.children.length-1].sep),o.trySkip(i)||s.err.report(b("expected",q(i)),o)}else s.err.report(b("expected",q(r)),o);return a.range.end=o.cursor,a}}var KR=(r,e,t,n)=>{t.err.report(b("expected",b("long.between",n.min??"-\u221E",n.max??"+\u221E")),r,3)};function Gl(r){return(e,t)=>{let n={type:"long",range:k.create(e),value:0n};for((e.peek()==="-"||e.peek()==="+")&&e.skip();e.canRead()&&Ke.isDigit(e.peek());)e.skip();n.range.end=e.cursor;let i=e.sliceToCursor(n.range.start),o=!1;try{n.value=BigInt(i)}catch{o=!0}if(i)!r.pattern.test(i)||o?t.err.report(b("parser.long.illegal",r.pattern),n):(r.min&&n.value<r.min||r.max&&n.value>r.max)&&(r.onOutOfRange??KR)(n,e,t,r);else{if(r.failsOnEmpty)return oe;t.err.report(b("expected",b("long")),n)}return n}}function on({start:r,pair:e,end:t}){return(n,i)=>{let o={type:"record",range:k.create(n),children:[]};if(n.trySkip(r)){n.skipWhitespace();let s=!1,a=!1;for(;n.canRead()&&n.peek(t.length)!==t;){let l=n.cursor,c,f;s&&!a&&i.err.report(b("expected",q(e.end)),n);let u=n.cursor,{result:h,updateSrcAndCtx:d,endCursor:m}=yr(e.key,n,i);h===oe||m-u===0&&![e.sep,e.end,t,"\r",`
`,"	"," "].includes(n.peek())?i.err.report(b("expected",b("parser.record.key")),k.create(n,()=>n.skipUntilOrEnd(e.sep,e.end,t,"\r",`
`))):(d(),c=h);let y;n.skipWhitespace(),n.peek(e.sep.length)===e.sep?y=k.create(n,()=>n.skip(e.sep.length)):i.err.report(b("expected",q(e.sep)),n),n.skipWhitespace();let g=typeof e.value=="function"?e.value:e.value.get(o,c),v=n.cursor,{result:T,updateSrcAndCtx:M,endCursor:x}=yr(g,n,i);T===oe||x-v===0&&![e.sep,e.end,t,"\r",`
`,"	"," "].includes(n.peek())?i.err.report(b("expected",b("parser.record.value")),k.create(n,()=>n.skipUntilOrEnd(e.sep,e.end,t,"\r",`
`))):(M(),f=T);let D;n.skipWhitespace(),s=!0,(a=n.peek(e.end.length)===e.end)&&(D=k.create(n,()=>n.skip(e.end.length))),o.children.push(I(w({type:"pair",range:k.create(l,n)},c||f?{children:[c,f].filter(j=>!!j)}:{}),{key:c,sep:y,value:f,end:D})),n.skipWhitespace()}a&&!e.trailingEnd&&i.err.report(b("parser.record.trailing-end"),o.children[o.children.length-1].end),n.trySkip(t)||i.err.report(b("expected",q(t)),n)}else i.err.report(b("expected",q(r)),n);return o.range.end=n.cursor,o}}var GR=new Set([" ","\r",`
`,"=",",",'"',"'","{","}","[","]","(",")",";"]),Ik=new Set(["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","_","-","."]);function et(r){return(e,t)=>{let n={type:"resource_location",range:k.create(e),options:r};e.trySkip(se.TagPrefix)&&(n.isTag=!0);let i=e.cursor;for(;e.canReadInLine()&&!GR.has(e.peek());)e.skip();let o=e.sliceToCursor(i);if(n.range.end=e.cursor,o.length===0)t.err.report(b("expected",b("resource-location")),n);else{let s=o.indexOf(r.namespacePathSep??se.NamespacePathSep);s>=0&&(n.namespace=o.slice(0,s));let a=o.slice(s+1);n.path=a.split(se.PathSep);let l=[...new Set([...[...n.namespace??[]].filter(c=>!Ik.has(c)),...[...a].filter(c=>c!=="/"&&!Ik.has(c))])];l.length&&t.err.report(b("parser.resource-location.illegal",Zn(l,!0,"and")),n),n.isTag&&!r.allowTag&&t.err.report(b("parser.resource-location.tag-diallowed"),n),!n.namespace&&r.isPredicate&&t.err.report(b("parser.resource-location.namespace-expected"),n)}return n}}var Bk=pn(Au(),1);function $t(r){return(e,t)=>{let n={type:"string",range:k.create(e),options:r,value:"",valueMap:[]},i=e.cursor;if(r.quotes?.length&&(e.peek()==='"'||e.peek()==="'")){let o=e.read(),s=e.cursor;for(;e.canRead()&&e.peek()!==o;){let a=e.peek();if(r.escapable&&a==="\\"){let l=e.cursor;e.skip();let c=e.read();if(c==="\\"||c===o||xu.is(r.escapable.characters,c))n.valueMap.push({inner:k.create(n.value.length,n.value.length+1),outer:k.create(l,e)}),n.value+=Gv.get(c);else if(r.escapable.unicode&&c==="u"){let f=e.peek(4);/^[0-9a-f]{4}$/i.test(f)?(e.skip(4),n.valueMap.push({inner:k.create(n.value.length,n.value.length+1),outer:k.create(l,e)}),n.value+=String.fromCharCode(parseInt(f,16))):(t.err.report(b("parser.string.illegal-unicode-escape"),k.create(e,e.getCharRange(3).end)),n.valueMap.push({inner:k.create(n.value.length,n.value.length+1),outer:k.create(l,e)}),n.value+=c)}else r.escapable.allowUnknown||t.err.report(b("parser.string.illegal-escape",q(c)),e.getCharRange(-1)),n.valueMap.push({inner:k.create(n.value.length,n.value.length+1),outer:k.create(l,e)}),n.value+=c}else e.skip(),n.value+=a}e.trySkip(o)||t.err.report(b("expected",q(o)),e),r.quotes.includes(o)||t.err.report(b("parser.string.illegal-quote",r.quotes),n),i=s}else if(r.unquotable){for(;e.canRead()&&Zm(e.peek(),r.unquotable);)n.value+=e.read();!n.value&&!r.unquotable.allowEmpty&&t.err.report(b("expected",b("string")),e)}else t.err.report(b("expected",r.quotes),e);if(n.valueMap.unshift({inner:k.create(0),outer:k.create(i)}),r.value?.parser){let o=$o(r.value.parser,n.value,n.valueMap,t);o!==oe&&(n.children=[o])}return n.range.end=e.cursor,n}}function $o(r,e,t,n){let i=new Ke(e,t),o=I(w({},n),{doc:Bk.TextDocument.create(n.doc.uri,n.doc.languageId,n.doc.version,e)});return r(i,o)}var ZR=Object.freeze(["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","_",".","+","-"]),JR=new Set(ZR),zk=/^[0-9A-Za-z_\.\+\-]*$/,Zl={allowEmpty:!0,allowList:JR},$i={escapable:{},quotes:['"',"'"],unquotable:Zl},Fo=$t($i);function Zm(r,e){return e.allowList?.has(r)??!e.blockList?.has(r)}function fa(r){let e=YR(r);return(t,n)=>{let i={type:"symbol",range:k.create(t),options:e,value:t.readRemaining()};return i.range.end=t.cursor,i}}function YR(r){return typeof r=="string"?{category:r}:r}var mh=pn($k(),1);function pa(r){let e=r.length;for(;--e>=0;)r[e]=0}var XR=0,Cw=1,QR=2,eM=3,tM=258,kg=29,fc=256,rc=fc+1+kg,da=30,wg=19,Aw=2*rc+1,Vo=15,ng=16,rM=7,xg=256,Tw=16,Ow=17,Ew=18,yg=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),nh=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),nM=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Rw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),iM=512,ri=new Array((rc+2)*2);pa(ri);var Ql=new Array(da*2);pa(Ql);var nc=new Array(iM);pa(nc);var ic=new Array(tM-eM+1);pa(ic);var Sg=new Array(kg);pa(Sg);var ah=new Array(da);pa(ah);function ig(r,e,t,n,i){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=i,this.has_stree=r&&r.length}var Mw,Dw,Nw;function og(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e}var Pw=r=>r<256?nc[r]:nc[256+(r>>>7)],oc=(r,e)=>{r.pending_buf[r.pending++]=e&255,r.pending_buf[r.pending++]=e>>>8&255},or=(r,e,t)=>{r.bi_valid>ng-t?(r.bi_buf|=e<<r.bi_valid&65535,oc(r,r.bi_buf),r.bi_buf=e>>ng-r.bi_valid,r.bi_valid+=t-ng):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t)},Nn=(r,e,t)=>{or(r,t[e*2],t[e*2+1])},Lw=(r,e)=>{let t=0;do t|=r&1,r>>>=1,t<<=1;while(--e>0);return t>>>1},oM=r=>{r.bi_valid===16?(oc(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},sM=(r,e)=>{let t=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,o=e.stat_desc.has_stree,s=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length,c,f,u,h,d,m,y=0;for(h=0;h<=Vo;h++)r.bl_count[h]=0;for(t[r.heap[r.heap_max]*2+1]=0,c=r.heap_max+1;c<Aw;c++)f=r.heap[c],h=t[t[f*2+1]*2+1]+1,h>l&&(h=l,y++),t[f*2+1]=h,!(f>n)&&(r.bl_count[h]++,d=0,f>=a&&(d=s[f-a]),m=t[f*2],r.opt_len+=m*(h+d),o&&(r.static_len+=m*(i[f*2+1]+d)));if(y!==0){do{for(h=l-1;r.bl_count[h]===0;)h--;r.bl_count[h]--,r.bl_count[h+1]+=2,r.bl_count[l]--,y-=2}while(y>0);for(h=l;h!==0;h--)for(f=r.bl_count[h];f!==0;)u=r.heap[--c],!(u>n)&&(t[u*2+1]!==h&&(r.opt_len+=(h-t[u*2+1])*t[u*2],t[u*2+1]=h),f--)}},Iw=(r,e,t)=>{let n=new Array(Vo+1),i=0,o,s;for(o=1;o<=Vo;o++)n[o]=i=i+t[o-1]<<1;for(s=0;s<=e;s++){let a=r[s*2+1];a!==0&&(r[s*2]=Lw(n[a]++,a))}},aM=()=>{let r,e,t,n,i,o=new Array(Vo+1);for(t=0,n=0;n<kg-1;n++)for(Sg[n]=t,r=0;r<1<<yg[n];r++)ic[t++]=n;for(ic[t-1]=n,i=0,n=0;n<16;n++)for(ah[n]=i,r=0;r<1<<nh[n];r++)nc[i++]=n;for(i>>=7;n<da;n++)for(ah[n]=i<<7,r=0;r<1<<nh[n]-7;r++)nc[256+i++]=n;for(e=0;e<=Vo;e++)o[e]=0;for(r=0;r<=143;)ri[r*2+1]=8,r++,o[8]++;for(;r<=255;)ri[r*2+1]=9,r++,o[9]++;for(;r<=279;)ri[r*2+1]=7,r++,o[7]++;for(;r<=287;)ri[r*2+1]=8,r++,o[8]++;for(Iw(ri,rc+1,o),r=0;r<da;r++)Ql[r*2+1]=5,Ql[r*2]=Lw(r,5);Mw=new ig(ri,yg,fc+1,rc,Vo),Dw=new ig(Ql,nh,0,da,Vo),Nw=new ig(new Array(0),nM,0,wg,rM)},Bw=r=>{let e;for(e=0;e<rc;e++)r.dyn_ltree[e*2]=0;for(e=0;e<da;e++)r.dyn_dtree[e*2]=0;for(e=0;e<wg;e++)r.bl_tree[e*2]=0;r.dyn_ltree[xg*2]=1,r.opt_len=r.static_len=0,r.last_lit=r.matches=0},zw=r=>{r.bi_valid>8?oc(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},lM=(r,e,t,n)=>{zw(r),n&&(oc(r,t),oc(r,~t)),r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t},Fk=(r,e,t,n)=>{let i=e*2,o=t*2;return r[i]<r[o]||r[i]===r[o]&&n[e]<=n[t]},sg=(r,e,t)=>{let n=r.heap[t],i=t<<1;for(;i<=r.heap_len&&(i<r.heap_len&&Fk(e,r.heap[i+1],r.heap[i],r.depth)&&i++,!Fk(e,n,r.heap[i],r.depth));)r.heap[t]=r.heap[i],t=i,i<<=1;r.heap[t]=n},Vk=(r,e,t)=>{let n,i,o=0,s,a;if(r.last_lit!==0)do n=r.pending_buf[r.d_buf+o*2]<<8|r.pending_buf[r.d_buf+o*2+1],i=r.pending_buf[r.l_buf+o],o++,n===0?Nn(r,i,e):(s=ic[i],Nn(r,s+fc+1,e),a=yg[s],a!==0&&(i-=Sg[s],or(r,i,a)),n--,s=Pw(n),Nn(r,s,t),a=nh[s],a!==0&&(n-=ah[s],or(r,n,a)));while(o<r.last_lit);Nn(r,xg,e)},bg=(r,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.elems,s,a,l=-1,c;for(r.heap_len=0,r.heap_max=Aw,s=0;s<o;s++)t[s*2]!==0?(r.heap[++r.heap_len]=l=s,r.depth[s]=0):t[s*2+1]=0;for(;r.heap_len<2;)c=r.heap[++r.heap_len]=l<2?++l:0,t[c*2]=1,r.depth[c]=0,r.opt_len--,i&&(r.static_len-=n[c*2+1]);for(e.max_code=l,s=r.heap_len>>1;s>=1;s--)sg(r,t,s);c=o;do s=r.heap[1],r.heap[1]=r.heap[r.heap_len--],sg(r,t,1),a=r.heap[1],r.heap[--r.heap_max]=s,r.heap[--r.heap_max]=a,t[c*2]=t[s*2]+t[a*2],r.depth[c]=(r.depth[s]>=r.depth[a]?r.depth[s]:r.depth[a])+1,t[s*2+1]=t[a*2+1]=c,r.heap[1]=c++,sg(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],sM(r,e),Iw(t,l,r.bl_count)},Uk=(r,e,t)=>{let n,i=-1,o,s=e[0*2+1],a=0,l=7,c=4;for(s===0&&(l=138,c=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)o=s,s=e[(n+1)*2+1],!(++a<l&&o===s)&&(a<c?r.bl_tree[o*2]+=a:o!==0?(o!==i&&r.bl_tree[o*2]++,r.bl_tree[Tw*2]++):a<=10?r.bl_tree[Ow*2]++:r.bl_tree[Ew*2]++,a=0,i=o,s===0?(l=138,c=3):o===s?(l=6,c=3):(l=7,c=4))},Hk=(r,e,t)=>{let n,i=-1,o,s=e[0*2+1],a=0,l=7,c=4;for(s===0&&(l=138,c=3),n=0;n<=t;n++)if(o=s,s=e[(n+1)*2+1],!(++a<l&&o===s)){if(a<c)do Nn(r,o,r.bl_tree);while(--a!==0);else o!==0?(o!==i&&(Nn(r,o,r.bl_tree),a--),Nn(r,Tw,r.bl_tree),or(r,a-3,2)):a<=10?(Nn(r,Ow,r.bl_tree),or(r,a-3,3)):(Nn(r,Ew,r.bl_tree),or(r,a-11,7));a=0,i=o,s===0?(l=138,c=3):o===s?(l=6,c=3):(l=7,c=4)}},cM=r=>{let e;for(Uk(r,r.dyn_ltree,r.l_desc.max_code),Uk(r,r.dyn_dtree,r.d_desc.max_code),bg(r,r.bl_desc),e=wg-1;e>=3&&r.bl_tree[Rw[e]*2+1]===0;e--);return r.opt_len+=3*(e+1)+5+5+4,e},fM=(r,e,t,n)=>{let i;for(or(r,e-257,5),or(r,t-1,5),or(r,n-4,4),i=0;i<n;i++)or(r,r.bl_tree[Rw[i]*2+1],3);Hk(r,r.dyn_ltree,e-1),Hk(r,r.dyn_dtree,t-1)},uM=r=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&r.dyn_ltree[t*2]!==0)return 0;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return 1;for(t=32;t<fc;t++)if(r.dyn_ltree[t*2]!==0)return 1;return 0},Wk=!1,hM=r=>{Wk||(aM(),Wk=!0),r.l_desc=new og(r.dyn_ltree,Mw),r.d_desc=new og(r.dyn_dtree,Dw),r.bl_desc=new og(r.bl_tree,Nw),r.bi_buf=0,r.bi_valid=0,Bw(r)},jw=(r,e,t,n)=>{or(r,(XR<<1)+(n?1:0),3),lM(r,e,t,!0)},dM=r=>{or(r,Cw<<1,3),Nn(r,xg,ri),oM(r)},pM=(r,e,t,n)=>{let i,o,s=0;r.level>0?(r.strm.data_type===2&&(r.strm.data_type=uM(r)),bg(r,r.l_desc),bg(r,r.d_desc),s=cM(r),i=r.opt_len+3+7>>>3,o=r.static_len+3+7>>>3,o<=i&&(i=o)):i=o=t+5,t+4<=i&&e!==-1?jw(r,e,t,n):r.strategy===4||o===i?(or(r,(Cw<<1)+(n?1:0),3),Vk(r,ri,Ql)):(or(r,(QR<<1)+(n?1:0),3),fM(r,r.l_desc.max_code+1,r.d_desc.max_code+1,s+1),Vk(r,r.dyn_ltree,r.dyn_dtree)),Bw(r),n&&zw(r)},mM=(r,e,t)=>(r.pending_buf[r.d_buf+r.last_lit*2]=e>>>8&255,r.pending_buf[r.d_buf+r.last_lit*2+1]=e&255,r.pending_buf[r.l_buf+r.last_lit]=t&255,r.last_lit++,e===0?r.dyn_ltree[t*2]++:(r.matches++,e--,r.dyn_ltree[(ic[t]+fc+1)*2]++,r.dyn_dtree[Pw(e)*2]++),r.last_lit===r.lit_bufsize-1),gM=hM,yM=jw,bM=pM,_M=mM,vM=dM,kM={_tr_init:gM,_tr_stored_block:yM,_tr_flush_block:bM,_tr_tally:_M,_tr_align:vM},wM=(r,e,t,n)=>{let i=r&65535|0,o=r>>>16&65535|0,s=0;for(;t!==0;){s=t>2e3?2e3:t,t-=s;do i=i+e[n++]|0,o=o+i|0;while(--s);i%=65521,o%=65521}return i|o<<16|0},sc=wM,xM=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e},SM=new Uint32Array(xM()),CM=(r,e,t,n)=>{let i=SM,o=n+t;r^=-1;for(let s=n;s<o;s++)r=r>>>8^i[(r^e[s])&255];return r^-1},bt=CM,Ho={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Go={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:AM,_tr_stored_block:TM,_tr_flush_block:OM,_tr_tally:Wi,_tr_align:EM}=kM,{Z_NO_FLUSH:Zo,Z_PARTIAL_FLUSH:RM,Z_FULL_FLUSH:MM,Z_FINISH:qi,Z_BLOCK:qk,Z_OK:Pn,Z_STREAM_END:Kk,Z_STREAM_ERROR:Fr,Z_DATA_ERROR:DM,Z_BUF_ERROR:ag,Z_DEFAULT_COMPRESSION:NM,Z_FILTERED:PM,Z_HUFFMAN_ONLY:Xu,Z_RLE:LM,Z_FIXED:IM,Z_DEFAULT_STRATEGY:BM,Z_UNKNOWN:zM,Z_DEFLATED:fh}=Go,jM=9,$M=15,FM=8,VM=29,UM=256,_g=UM+1+VM,HM=30,WM=19,qM=2*_g+1,KM=15,ye=3,Ui=258,sn=Ui+ye+1,GM=32,uh=42,vg=69,ih=73,oh=91,sh=103,Uo=113,Yl=666,pt=1,uc=2,Wo=3,ma=4,ZM=3,Hi=(r,e)=>(r.msg=Ho[e],e),Gk=r=>(r<<1)-(r>4?9:0),Vi=r=>{let e=r.length;for(;--e>=0;)r[e]=0},JM=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,Ki=JM,Fi=r=>{let e=r.state,t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Tt=(r,e)=>{OM(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,Fi(r.strm)},Se=(r,e)=>{r.pending_buf[r.pending++]=e},Jl=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=e&255},YM=(r,e,t,n)=>{let i=r.avail_in;return i>n&&(i=n),i===0?0:(r.avail_in-=i,e.set(r.input.subarray(r.next_in,r.next_in+i),t),r.state.wrap===1?r.adler=sc(r.adler,e,i,t):r.state.wrap===2&&(r.adler=bt(r.adler,e,i,t)),r.next_in+=i,r.total_in+=i,i)},$w=(r,e)=>{let t=r.max_chain_length,n=r.strstart,i,o,s=r.prev_length,a=r.nice_match,l=r.strstart>r.w_size-sn?r.strstart-(r.w_size-sn):0,c=r.window,f=r.w_mask,u=r.prev,h=r.strstart+Ui,d=c[n+s-1],m=c[n+s];r.prev_length>=r.good_match&&(t>>=2),a>r.lookahead&&(a=r.lookahead);do if(i=e,!(c[i+s]!==m||c[i+s-1]!==d||c[i]!==c[n]||c[++i]!==c[n+1])){n+=2,i++;do;while(c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&n<h);if(o=Ui-(h-n),n=h-Ui,o>s){if(r.match_start=e,s=o,o>=a)break;d=c[n+s-1],m=c[n+s]}}while((e=u[e&f])>l&&--t!==0);return s<=r.lookahead?s:r.lookahead},qo=r=>{let e=r.w_size,t,n,i,o,s;do{if(o=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-sn)){r.window.set(r.window.subarray(e,e+e),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,n=r.hash_size,t=n;do i=r.head[--t],r.head[t]=i>=e?i-e:0;while(--n);n=e,t=n;do i=r.prev[--t],r.prev[t]=i>=e?i-e:0;while(--n);o+=e}if(r.strm.avail_in===0)break;if(n=YM(r.strm,r.window,r.strstart+r.lookahead,o),r.lookahead+=n,r.lookahead+r.insert>=ye)for(s=r.strstart-r.insert,r.ins_h=r.window[s],r.ins_h=Ki(r,r.ins_h,r.window[s+1]);r.insert&&(r.ins_h=Ki(r,r.ins_h,r.window[s+ye-1]),r.prev[s&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=s,s++,r.insert--,!(r.lookahead+r.insert<ye)););}while(r.lookahead<sn&&r.strm.avail_in!==0)},XM=(r,e)=>{let t=65535;for(t>r.pending_buf_size-5&&(t=r.pending_buf_size-5);;){if(r.lookahead<=1){if(qo(r),r.lookahead===0&&e===Zo)return pt;if(r.lookahead===0)break}r.strstart+=r.lookahead,r.lookahead=0;let n=r.block_start+t;if((r.strstart===0||r.strstart>=n)&&(r.lookahead=r.strstart-n,r.strstart=n,Tt(r,!1),r.strm.avail_out===0)||r.strstart-r.block_start>=r.w_size-sn&&(Tt(r,!1),r.strm.avail_out===0))return pt}return r.insert=0,e===qi?(Tt(r,!0),r.strm.avail_out===0?Wo:ma):(r.strstart>r.block_start&&(Tt(r,!1),r.strm.avail_out===0),pt)},lg=(r,e)=>{let t,n;for(;;){if(r.lookahead<sn){if(qo(r),r.lookahead<sn&&e===Zo)return pt;if(r.lookahead===0)break}if(t=0,r.lookahead>=ye&&(r.ins_h=Ki(r,r.ins_h,r.window[r.strstart+ye-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-sn&&(r.match_length=$w(r,t)),r.match_length>=ye)if(n=Wi(r,r.strstart-r.match_start,r.match_length-ye),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=ye){r.match_length--;do r.strstart++,r.ins_h=Ki(r,r.ins_h,r.window[r.strstart+ye-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=Ki(r,r.ins_h,r.window[r.strstart+1]);else n=Wi(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(Tt(r,!1),r.strm.avail_out===0))return pt}return r.insert=r.strstart<ye-1?r.strstart:ye-1,e===qi?(Tt(r,!0),r.strm.avail_out===0?Wo:ma):r.last_lit&&(Tt(r,!1),r.strm.avail_out===0)?pt:uc},ua=(r,e)=>{let t,n,i;for(;;){if(r.lookahead<sn){if(qo(r),r.lookahead<sn&&e===Zo)return pt;if(r.lookahead===0)break}if(t=0,r.lookahead>=ye&&(r.ins_h=Ki(r,r.ins_h,r.window[r.strstart+ye-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=ye-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-sn&&(r.match_length=$w(r,t),r.match_length<=5&&(r.strategy===PM||r.match_length===ye&&r.strstart-r.match_start>4096)&&(r.match_length=ye-1)),r.prev_length>=ye&&r.match_length<=r.prev_length){i=r.strstart+r.lookahead-ye,n=Wi(r,r.strstart-1-r.prev_match,r.prev_length-ye),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=i&&(r.ins_h=Ki(r,r.ins_h,r.window[r.strstart+ye-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=ye-1,r.strstart++,n&&(Tt(r,!1),r.strm.avail_out===0))return pt}else if(r.match_available){if(n=Wi(r,0,r.window[r.strstart-1]),n&&Tt(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return pt}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=Wi(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<ye-1?r.strstart:ye-1,e===qi?(Tt(r,!0),r.strm.avail_out===0?Wo:ma):r.last_lit&&(Tt(r,!1),r.strm.avail_out===0)?pt:uc},QM=(r,e)=>{let t,n,i,o,s=r.window;for(;;){if(r.lookahead<=Ui){if(qo(r),r.lookahead<=Ui&&e===Zo)return pt;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=ye&&r.strstart>0&&(i=r.strstart-1,n=s[i],n===s[++i]&&n===s[++i]&&n===s[++i])){o=r.strstart+Ui;do;while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);r.match_length=Ui-(o-i),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=ye?(t=Wi(r,1,r.match_length-ye),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=Wi(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(Tt(r,!1),r.strm.avail_out===0))return pt}return r.insert=0,e===qi?(Tt(r,!0),r.strm.avail_out===0?Wo:ma):r.last_lit&&(Tt(r,!1),r.strm.avail_out===0)?pt:uc},eD=(r,e)=>{let t;for(;;){if(r.lookahead===0&&(qo(r),r.lookahead===0)){if(e===Zo)return pt;break}if(r.match_length=0,t=Wi(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(Tt(r,!1),r.strm.avail_out===0))return pt}return r.insert=0,e===qi?(Tt(r,!0),r.strm.avail_out===0?Wo:ma):r.last_lit&&(Tt(r,!1),r.strm.avail_out===0)?pt:uc};function Dn(r,e,t,n,i){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=i}var Xl=[new Dn(0,0,0,0,XM),new Dn(4,4,8,4,lg),new Dn(4,5,16,8,lg),new Dn(4,6,32,32,lg),new Dn(4,4,16,16,ua),new Dn(8,16,32,32,ua),new Dn(8,16,128,128,ua),new Dn(8,32,128,256,ua),new Dn(32,128,258,1024,ua),new Dn(32,258,258,4096,ua)],tD=r=>{r.window_size=2*r.w_size,Vi(r.head),r.max_lazy_match=Xl[r.level].max_lazy,r.good_match=Xl[r.level].good_length,r.nice_match=Xl[r.level].nice_length,r.max_chain_length=Xl[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=ye-1,r.match_available=0,r.ins_h=0};function rD(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=fh,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(qM*2),this.dyn_dtree=new Uint16Array((2*HM+1)*2),this.bl_tree=new Uint16Array((2*WM+1)*2),Vi(this.dyn_ltree),Vi(this.dyn_dtree),Vi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(KM+1),this.heap=new Uint16Array(2*_g+1),Vi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*_g+1),Vi(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Fw=r=>{if(!r||!r.state)return Hi(r,Fr);r.total_in=r.total_out=0,r.data_type=zM;let e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?uh:Uo,r.adler=e.wrap===2?0:1,e.last_flush=Zo,AM(e),Pn},Vw=r=>{let e=Fw(r);return e===Pn&&tD(r.state),e},nD=(r,e)=>!r||!r.state||r.state.wrap!==2?Fr:(r.state.gzhead=e,Pn),Uw=(r,e,t,n,i,o)=>{if(!r)return Fr;let s=1;if(e===NM&&(e=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>jM||t!==fh||n<8||n>15||e<0||e>9||o<0||o>IM)return Hi(r,Fr);n===8&&(n=9);let a=new rD;return r.state=a,a.strm=r,a.wrap=s,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+ye-1)/ye),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=(1+2)*a.lit_bufsize,a.level=e,a.strategy=o,a.method=t,Vw(r)},iD=(r,e)=>Uw(r,e,fh,$M,FM,BM),oD=(r,e)=>{let t,n;if(!r||!r.state||e>qk||e<0)return r?Hi(r,Fr):Fr;let i=r.state;if(!r.output||!r.input&&r.avail_in!==0||i.status===Yl&&e!==qi)return Hi(r,r.avail_out===0?ag:Fr);i.strm=r;let o=i.last_flush;if(i.last_flush=e,i.status===uh)if(i.wrap===2)r.adler=0,Se(i,31),Se(i,139),Se(i,8),i.gzhead?(Se(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Se(i,i.gzhead.time&255),Se(i,i.gzhead.time>>8&255),Se(i,i.gzhead.time>>16&255),Se(i,i.gzhead.time>>24&255),Se(i,i.level===9?2:i.strategy>=Xu||i.level<2?4:0),Se(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(Se(i,i.gzhead.extra.length&255),Se(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(r.adler=bt(r.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=vg):(Se(i,0),Se(i,0),Se(i,0),Se(i,0),Se(i,0),Se(i,i.level===9?2:i.strategy>=Xu||i.level<2?4:0),Se(i,ZM),i.status=Uo);else{let s=fh+(i.w_bits-8<<4)<<8,a=-1;i.strategy>=Xu||i.level<2?a=0:i.level<6?a=1:i.level===6?a=2:a=3,s|=a<<6,i.strstart!==0&&(s|=GM),s+=31-s%31,i.status=Uo,Jl(i,s),i.strstart!==0&&(Jl(i,r.adler>>>16),Jl(i,r.adler&65535)),r.adler=1}if(i.status===vg)if(i.gzhead.extra){for(t=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(r.adler=bt(r.adler,i.pending_buf,i.pending-t,t)),Fi(r),t=i.pending,i.pending===i.pending_buf_size));)Se(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>t&&(r.adler=bt(r.adler,i.pending_buf,i.pending-t,t)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=ih)}else i.status=ih;if(i.status===ih)if(i.gzhead.name){t=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(r.adler=bt(r.adler,i.pending_buf,i.pending-t,t)),Fi(r),t=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,Se(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>t&&(r.adler=bt(r.adler,i.pending_buf,i.pending-t,t)),n===0&&(i.gzindex=0,i.status=oh)}else i.status=oh;if(i.status===oh)if(i.gzhead.comment){t=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(r.adler=bt(r.adler,i.pending_buf,i.pending-t,t)),Fi(r),t=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,Se(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>t&&(r.adler=bt(r.adler,i.pending_buf,i.pending-t,t)),n===0&&(i.status=sh)}else i.status=sh;if(i.status===sh&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Fi(r),i.pending+2<=i.pending_buf_size&&(Se(i,r.adler&255),Se(i,r.adler>>8&255),r.adler=0,i.status=Uo)):i.status=Uo),i.pending!==0){if(Fi(r),r.avail_out===0)return i.last_flush=-1,Pn}else if(r.avail_in===0&&Gk(e)<=Gk(o)&&e!==qi)return Hi(r,ag);if(i.status===Yl&&r.avail_in!==0)return Hi(r,ag);if(r.avail_in!==0||i.lookahead!==0||e!==Zo&&i.status!==Yl){let s=i.strategy===Xu?eD(i,e):i.strategy===LM?QM(i,e):Xl[i.level].func(i,e);if((s===Wo||s===ma)&&(i.status=Yl),s===pt||s===Wo)return r.avail_out===0&&(i.last_flush=-1),Pn;if(s===uc&&(e===RM?EM(i):e!==qk&&(TM(i,0,0,!1),e===MM&&(Vi(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Fi(r),r.avail_out===0))return i.last_flush=-1,Pn}return e!==qi?Pn:i.wrap<=0?Kk:(i.wrap===2?(Se(i,r.adler&255),Se(i,r.adler>>8&255),Se(i,r.adler>>16&255),Se(i,r.adler>>24&255),Se(i,r.total_in&255),Se(i,r.total_in>>8&255),Se(i,r.total_in>>16&255),Se(i,r.total_in>>24&255)):(Jl(i,r.adler>>>16),Jl(i,r.adler&65535)),Fi(r),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Pn:Kk)},sD=r=>{if(!r||!r.state)return Fr;let e=r.state.status;return e!==uh&&e!==vg&&e!==ih&&e!==oh&&e!==sh&&e!==Uo&&e!==Yl?Hi(r,Fr):(r.state=null,e===Uo?Hi(r,DM):Pn)},aD=(r,e)=>{let t=e.length;if(!r||!r.state)return Fr;let n=r.state,i=n.wrap;if(i===2||i===1&&n.status!==uh||n.lookahead)return Fr;if(i===1&&(r.adler=sc(r.adler,e,t,0)),n.wrap=0,t>=n.w_size){i===0&&(Vi(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(e.subarray(t-n.w_size,t),0),e=l,t=n.w_size}let o=r.avail_in,s=r.next_in,a=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,qo(n);n.lookahead>=ye;){let l=n.strstart,c=n.lookahead-(ye-1);do n.ins_h=Ki(n,n.ins_h,n.window[l+ye-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--c);n.strstart=l,n.lookahead=ye-1,qo(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=ye-1,n.match_available=0,r.next_in=s,r.input=a,r.avail_in=o,n.wrap=i,Pn},lD=iD,cD=Uw,fD=Vw,uD=Fw,hD=nD,dD=oD,pD=sD,mD=aD,gD="pako deflate (from Nodeca project)",ec={deflateInit:lD,deflateInit2:cD,deflateReset:fD,deflateResetKeep:uD,deflateSetHeader:hD,deflate:dD,deflateEnd:pD,deflateSetDictionary:mD,deflateInfo:gD},yD=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),bD=function(r){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(!!t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)yD(t,n)&&(r[n]=t[n])}}return r},_D=r=>{let e=0;for(let n=0,i=r.length;n<i;n++)e+=r[n].length;let t=new Uint8Array(e);for(let n=0,i=0,o=r.length;n<o;n++){let s=r[n];t.set(s,i),i+=s.length}return t},hh={assign:bD,flattenChunks:_D},Hw=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Hw=!1}var ac=new Uint8Array(256);for(let r=0;r<256;r++)ac[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;ac[254]=ac[254]=1;var vD=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,i,o,s=r.length,a=0;for(i=0;i<s;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<s&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),o=0,i=0;o<a;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<s&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),t<128?e[o++]=t:t<2048?(e[o++]=192|t>>>6,e[o++]=128|t&63):t<65536?(e[o++]=224|t>>>12,e[o++]=128|t>>>6&63,e[o++]=128|t&63):(e[o++]=240|t>>>18,e[o++]=128|t>>>12&63,e[o++]=128|t>>>6&63,e[o++]=128|t&63);return e},kD=(r,e)=>{if(e<65534&&r.subarray&&Hw)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r[n]);return t},wD=(r,e)=>{let t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,i,o=new Array(t*2);for(i=0,n=0;n<t;){let s=r[n++];if(s<128){o[i++]=s;continue}let a=ac[s];if(a>4){o[i++]=65533,n+=a-1;continue}for(s&=a===2?31:a===3?15:7;a>1&&n<t;)s=s<<6|r[n++]&63,a--;if(a>1){o[i++]=65533;continue}s<65536?o[i++]=s:(s-=65536,o[i++]=55296|s>>10&1023,o[i++]=56320|s&1023)}return kD(o,i)},xD=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)===128;)t--;return t<0||t===0?e:t+ac[r[t]]>e?t:e},lc={string2buf:vD,buf2string:wD,utf8border:xD};function SD(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ww=SD,qw=Object.prototype.toString,{Z_NO_FLUSH:CD,Z_SYNC_FLUSH:AD,Z_FULL_FLUSH:TD,Z_FINISH:OD,Z_OK:lh,Z_STREAM_END:ED,Z_DEFAULT_COMPRESSION:RD,Z_DEFAULT_STRATEGY:MD,Z_DEFLATED:DD}=Go;function hc(r){this.options=hh.assign({level:RD,method:DD,chunkSize:16384,windowBits:15,memLevel:8,strategy:MD},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ww,this.strm.avail_out=0;let t=ec.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==lh)throw new Error(Ho[t]);if(e.header&&ec.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=lc.string2buf(e.dictionary):qw.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=ec.deflateSetDictionary(this.strm,n),t!==lh)throw new Error(Ho[t]);this._dict_set=!0}}hc.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?OD:CD,typeof r=="string"?t.input=lc.string2buf(r):qw.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(o===AD||o===TD)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(i=ec.deflate(t,o),i===ED)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),i=ec.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===lh;if(t.avail_out===0){this.onData(t.output);continue}if(o>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};hc.prototype.onData=function(r){this.chunks.push(r)};hc.prototype.onEnd=function(r){r===lh&&(this.result=hh.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function Cg(r,e){let t=new hc(e);if(t.push(r,!0),t.err)throw t.msg||Ho[t.err];return t.result}function ND(r,e){return e=e||{},e.raw=!0,Cg(r,e)}function PD(r,e){return e=e||{},e.gzip=!0,Cg(r,e)}var LD=hc,ID=Cg,BD=ND,zD=PD,jD=Go,$D={Deflate:LD,deflate:ID,deflateRaw:BD,gzip:zD,constants:jD},Qu=30,FD=12,VD=function(e,t){let n,i,o,s,a,l,c,f,u,h,d,m,y,g,v,T,M,x,D,j,A,L,z,$,K=e.state;n=e.next_in,z=e.input,i=n+(e.avail_in-5),o=e.next_out,$=e.output,s=o-(t-e.avail_out),a=o+(e.avail_out-257),l=K.dmax,c=K.wsize,f=K.whave,u=K.wnext,h=K.window,d=K.hold,m=K.bits,y=K.lencode,g=K.distcode,v=(1<<K.lenbits)-1,T=(1<<K.distbits)-1;e:do{m<15&&(d+=z[n++]<<m,m+=8,d+=z[n++]<<m,m+=8),M=y[d&v];t:for(;;){if(x=M>>>24,d>>>=x,m-=x,x=M>>>16&255,x===0)$[o++]=M&65535;else if(x&16){D=M&65535,x&=15,x&&(m<x&&(d+=z[n++]<<m,m+=8),D+=d&(1<<x)-1,d>>>=x,m-=x),m<15&&(d+=z[n++]<<m,m+=8,d+=z[n++]<<m,m+=8),M=g[d&T];r:for(;;){if(x=M>>>24,d>>>=x,m-=x,x=M>>>16&255,x&16){if(j=M&65535,x&=15,m<x&&(d+=z[n++]<<m,m+=8,m<x&&(d+=z[n++]<<m,m+=8)),j+=d&(1<<x)-1,j>l){e.msg="invalid distance too far back",K.mode=Qu;break e}if(d>>>=x,m-=x,x=o-s,j>x){if(x=j-x,x>f&&K.sane){e.msg="invalid distance too far back",K.mode=Qu;break e}if(A=0,L=h,u===0){if(A+=c-x,x<D){D-=x;do $[o++]=h[A++];while(--x);A=o-j,L=$}}else if(u<x){if(A+=c+u-x,x-=u,x<D){D-=x;do $[o++]=h[A++];while(--x);if(A=0,u<D){x=u,D-=x;do $[o++]=h[A++];while(--x);A=o-j,L=$}}}else if(A+=u-x,x<D){D-=x;do $[o++]=h[A++];while(--x);A=o-j,L=$}for(;D>2;)$[o++]=L[A++],$[o++]=L[A++],$[o++]=L[A++],D-=3;D&&($[o++]=L[A++],D>1&&($[o++]=L[A++]))}else{A=o-j;do $[o++]=$[A++],$[o++]=$[A++],$[o++]=$[A++],D-=3;while(D>2);D&&($[o++]=$[A++],D>1&&($[o++]=$[A++]))}}else if((x&64)===0){M=g[(M&65535)+(d&(1<<x)-1)];continue r}else{e.msg="invalid distance code",K.mode=Qu;break e}break}}else if((x&64)===0){M=y[(M&65535)+(d&(1<<x)-1)];continue t}else if(x&32){K.mode=FD;break e}else{e.msg="invalid literal/length code",K.mode=Qu;break e}break}}while(n<i&&o<a);D=m>>3,n-=D,m-=D<<3,d&=(1<<m)-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=o<a?257+(a-o):257-(o-a),K.hold=d,K.bits=m},ha=15,Zk=852,Jk=592,Yk=0,cg=1,Xk=2,UD=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),HD=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),WD=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),qD=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),KD=(r,e,t,n,i,o,s,a)=>{let l=a.bits,c=0,f=0,u=0,h=0,d=0,m=0,y=0,g=0,v=0,T=0,M,x,D,j,A,L=null,z=0,$,K=new Uint16Array(ha+1),Te=new Uint16Array(ha+1),ze=null,Dt=0,st,rt,Nt;for(c=0;c<=ha;c++)K[c]=0;for(f=0;f<n;f++)K[e[t+f]]++;for(d=l,h=ha;h>=1&&K[h]===0;h--);if(d>h&&(d=h),h===0)return i[o++]=1<<24|64<<16|0,i[o++]=1<<24|64<<16|0,a.bits=1,0;for(u=1;u<h&&K[u]===0;u++);for(d<u&&(d=u),g=1,c=1;c<=ha;c++)if(g<<=1,g-=K[c],g<0)return-1;if(g>0&&(r===Yk||h!==1))return-1;for(Te[1]=0,c=1;c<ha;c++)Te[c+1]=Te[c]+K[c];for(f=0;f<n;f++)e[t+f]!==0&&(s[Te[e[t+f]]++]=f);if(r===Yk?(L=ze=s,$=19):r===cg?(L=UD,z-=257,ze=HD,Dt-=257,$=256):(L=WD,ze=qD,$=-1),T=0,f=0,c=u,A=o,m=d,y=0,D=-1,v=1<<d,j=v-1,r===cg&&v>Zk||r===Xk&&v>Jk)return 1;for(;;){st=c-y,s[f]<$?(rt=0,Nt=s[f]):s[f]>$?(rt=ze[Dt+s[f]],Nt=L[z+s[f]]):(rt=32+64,Nt=0),M=1<<c-y,x=1<<m,u=x;do x-=M,i[A+(T>>y)+x]=st<<24|rt<<16|Nt|0;while(x!==0);for(M=1<<c-1;T&M;)M>>=1;if(M!==0?(T&=M-1,T+=M):T=0,f++,--K[c]===0){if(c===h)break;c=e[t+s[f]]}if(c>d&&(T&j)!==D){for(y===0&&(y=d),A+=u,m=c-y,g=1<<m;m+y<h&&(g-=K[m+y],!(g<=0));)m++,g<<=1;if(v+=1<<m,r===cg&&v>Zk||r===Xk&&v>Jk)return 1;D=T&j,i[D]=d<<24|m<<16|A-o|0}}return T!==0&&(i[A+T]=c-y<<24|64<<16|0),a.bits=d,0},tc=KD,GD=0,Kw=1,Gw=2,{Z_FINISH:Qk,Z_BLOCK:ZD,Z_TREES:eh,Z_OK:Ko,Z_STREAM_END:JD,Z_NEED_DICT:YD,Z_STREAM_ERROR:Vr,Z_DATA_ERROR:Zw,Z_MEM_ERROR:Jw,Z_BUF_ERROR:XD,Z_DEFLATED:ew}=Go,Yw=1,tw=2,rw=3,nw=4,iw=5,ow=6,sw=7,aw=8,lw=9,cw=10,ch=11,ti=12,fg=13,fw=14,ug=15,uw=16,hw=17,dw=18,pw=19,th=20,rh=21,mw=22,gw=23,yw=24,bw=25,_w=26,hg=27,vw=28,kw=29,Ue=30,Xw=31,QD=32,eN=852,tN=592,rN=15,nN=rN,ww=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function iN(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Qw=r=>{if(!r||!r.state)return Vr;let e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=Yw,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(eN),e.distcode=e.distdyn=new Int32Array(tN),e.sane=1,e.back=-1,Ko},ex=r=>{if(!r||!r.state)return Vr;let e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,Qw(r)},tx=(r,e)=>{let t;if(!r||!r.state)return Vr;let n=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?Vr:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,ex(r))},rx=(r,e)=>{if(!r)return Vr;let t=new iN;r.state=t,t.window=null;let n=tx(r,e);return n!==Ko&&(r.state=null),n},oN=r=>rx(r,nN),xw=!0,dg,pg,sN=r=>{if(xw){dg=new Int32Array(512),pg=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(tc(Kw,r.lens,0,288,dg,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;tc(Gw,r.lens,0,32,pg,0,r.work,{bits:5}),xw=!1}r.lencode=dg,r.lenbits=9,r.distcode=pg,r.distbits=5},nx=(r,e,t,n)=>{let i,o=r.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(e.subarray(t-n,t-n+i),o.wnext),n-=i,n?(o.window.set(e.subarray(t-n,t),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0},aN=(r,e)=>{let t,n,i,o,s,a,l,c,f,u,h,d,m,y,g=0,v,T,M,x,D,j,A,L,z=new Uint8Array(4),$,K,Te=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!r||!r.state||!r.output||!r.input&&r.avail_in!==0)return Vr;t=r.state,t.mode===ti&&(t.mode=fg),s=r.next_out,i=r.output,l=r.avail_out,o=r.next_in,n=r.input,a=r.avail_in,c=t.hold,f=t.bits,u=a,h=l,L=Ko;e:for(;;)switch(t.mode){case Yw:if(t.wrap===0){t.mode=fg;break}for(;f<16;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(t.wrap&2&&c===35615){t.check=0,z[0]=c&255,z[1]=c>>>8&255,t.check=bt(t.check,z,2,0),c=0,f=0,t.mode=tw;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((c&255)<<8)+(c>>8))%31){r.msg="incorrect header check",t.mode=Ue;break}if((c&15)!==ew){r.msg="unknown compression method",t.mode=Ue;break}if(c>>>=4,f-=4,A=(c&15)+8,t.wbits===0)t.wbits=A;else if(A>t.wbits){r.msg="invalid window size",t.mode=Ue;break}t.dmax=1<<t.wbits,r.adler=t.check=1,t.mode=c&512?cw:ti,c=0,f=0;break;case tw:for(;f<16;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(t.flags=c,(t.flags&255)!==ew){r.msg="unknown compression method",t.mode=Ue;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=Ue;break}t.head&&(t.head.text=c>>8&1),t.flags&512&&(z[0]=c&255,z[1]=c>>>8&255,t.check=bt(t.check,z,2,0)),c=0,f=0,t.mode=rw;case rw:for(;f<32;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}t.head&&(t.head.time=c),t.flags&512&&(z[0]=c&255,z[1]=c>>>8&255,z[2]=c>>>16&255,z[3]=c>>>24&255,t.check=bt(t.check,z,4,0)),c=0,f=0,t.mode=nw;case nw:for(;f<16;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}t.head&&(t.head.xflags=c&255,t.head.os=c>>8),t.flags&512&&(z[0]=c&255,z[1]=c>>>8&255,t.check=bt(t.check,z,2,0)),c=0,f=0,t.mode=iw;case iw:if(t.flags&1024){for(;f<16;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}t.length=c,t.head&&(t.head.extra_len=c),t.flags&512&&(z[0]=c&255,z[1]=c>>>8&255,t.check=bt(t.check,z,2,0)),c=0,f=0}else t.head&&(t.head.extra=null);t.mode=ow;case ow:if(t.flags&1024&&(d=t.length,d>a&&(d=a),d&&(t.head&&(A=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(o,o+d),A)),t.flags&512&&(t.check=bt(t.check,n,d,o)),a-=d,o+=d,t.length-=d),t.length))break e;t.length=0,t.mode=sw;case sw:if(t.flags&2048){if(a===0)break e;d=0;do A=n[o+d++],t.head&&A&&t.length<65536&&(t.head.name+=String.fromCharCode(A));while(A&&d<a);if(t.flags&512&&(t.check=bt(t.check,n,d,o)),a-=d,o+=d,A)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=aw;case aw:if(t.flags&4096){if(a===0)break e;d=0;do A=n[o+d++],t.head&&A&&t.length<65536&&(t.head.comment+=String.fromCharCode(A));while(A&&d<a);if(t.flags&512&&(t.check=bt(t.check,n,d,o)),a-=d,o+=d,A)break e}else t.head&&(t.head.comment=null);t.mode=lw;case lw:if(t.flags&512){for(;f<16;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(c!==(t.check&65535)){r.msg="header crc mismatch",t.mode=Ue;break}c=0,f=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=ti;break;case cw:for(;f<32;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}r.adler=t.check=ww(c),c=0,f=0,t.mode=ch;case ch:if(t.havedict===0)return r.next_out=s,r.avail_out=l,r.next_in=o,r.avail_in=a,t.hold=c,t.bits=f,YD;r.adler=t.check=1,t.mode=ti;case ti:if(e===ZD||e===eh)break e;case fg:if(t.last){c>>>=f&7,f-=f&7,t.mode=hg;break}for(;f<3;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}switch(t.last=c&1,c>>>=1,f-=1,c&3){case 0:t.mode=fw;break;case 1:if(sN(t),t.mode=th,e===eh){c>>>=2,f-=2;break e}break;case 2:t.mode=hw;break;case 3:r.msg="invalid block type",t.mode=Ue}c>>>=2,f-=2;break;case fw:for(c>>>=f&7,f-=f&7;f<32;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if((c&65535)!==(c>>>16^65535)){r.msg="invalid stored block lengths",t.mode=Ue;break}if(t.length=c&65535,c=0,f=0,t.mode=ug,e===eh)break e;case ug:t.mode=uw;case uw:if(d=t.length,d){if(d>a&&(d=a),d>l&&(d=l),d===0)break e;i.set(n.subarray(o,o+d),s),a-=d,o+=d,l-=d,s+=d,t.length-=d;break}t.mode=ti;break;case hw:for(;f<14;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(t.nlen=(c&31)+257,c>>>=5,f-=5,t.ndist=(c&31)+1,c>>>=5,f-=5,t.ncode=(c&15)+4,c>>>=4,f-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=Ue;break}t.have=0,t.mode=dw;case dw:for(;t.have<t.ncode;){for(;f<3;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}t.lens[Te[t.have++]]=c&7,c>>>=3,f-=3}for(;t.have<19;)t.lens[Te[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,$={bits:t.lenbits},L=tc(GD,t.lens,0,19,t.lencode,0,t.work,$),t.lenbits=$.bits,L){r.msg="invalid code lengths set",t.mode=Ue;break}t.have=0,t.mode=pw;case pw:for(;t.have<t.nlen+t.ndist;){for(;g=t.lencode[c&(1<<t.lenbits)-1],v=g>>>24,T=g>>>16&255,M=g&65535,!(v<=f);){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(M<16)c>>>=v,f-=v,t.lens[t.have++]=M;else{if(M===16){for(K=v+2;f<K;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(c>>>=v,f-=v,t.have===0){r.msg="invalid bit length repeat",t.mode=Ue;break}A=t.lens[t.have-1],d=3+(c&3),c>>>=2,f-=2}else if(M===17){for(K=v+3;f<K;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}c>>>=v,f-=v,A=0,d=3+(c&7),c>>>=3,f-=3}else{for(K=v+7;f<K;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}c>>>=v,f-=v,A=0,d=11+(c&127),c>>>=7,f-=7}if(t.have+d>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=Ue;break}for(;d--;)t.lens[t.have++]=A}}if(t.mode===Ue)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=Ue;break}if(t.lenbits=9,$={bits:t.lenbits},L=tc(Kw,t.lens,0,t.nlen,t.lencode,0,t.work,$),t.lenbits=$.bits,L){r.msg="invalid literal/lengths set",t.mode=Ue;break}if(t.distbits=6,t.distcode=t.distdyn,$={bits:t.distbits},L=tc(Gw,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,$),t.distbits=$.bits,L){r.msg="invalid distances set",t.mode=Ue;break}if(t.mode=th,e===eh)break e;case th:t.mode=rh;case rh:if(a>=6&&l>=258){r.next_out=s,r.avail_out=l,r.next_in=o,r.avail_in=a,t.hold=c,t.bits=f,VD(r,h),s=r.next_out,i=r.output,l=r.avail_out,o=r.next_in,n=r.input,a=r.avail_in,c=t.hold,f=t.bits,t.mode===ti&&(t.back=-1);break}for(t.back=0;g=t.lencode[c&(1<<t.lenbits)-1],v=g>>>24,T=g>>>16&255,M=g&65535,!(v<=f);){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(T&&(T&240)===0){for(x=v,D=T,j=M;g=t.lencode[j+((c&(1<<x+D)-1)>>x)],v=g>>>24,T=g>>>16&255,M=g&65535,!(x+v<=f);){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}c>>>=x,f-=x,t.back+=x}if(c>>>=v,f-=v,t.back+=v,t.length=M,T===0){t.mode=_w;break}if(T&32){t.back=-1,t.mode=ti;break}if(T&64){r.msg="invalid literal/length code",t.mode=Ue;break}t.extra=T&15,t.mode=mw;case mw:if(t.extra){for(K=t.extra;f<K;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}t.length+=c&(1<<t.extra)-1,c>>>=t.extra,f-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=gw;case gw:for(;g=t.distcode[c&(1<<t.distbits)-1],v=g>>>24,T=g>>>16&255,M=g&65535,!(v<=f);){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if((T&240)===0){for(x=v,D=T,j=M;g=t.distcode[j+((c&(1<<x+D)-1)>>x)],v=g>>>24,T=g>>>16&255,M=g&65535,!(x+v<=f);){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}c>>>=x,f-=x,t.back+=x}if(c>>>=v,f-=v,t.back+=v,T&64){r.msg="invalid distance code",t.mode=Ue;break}t.offset=M,t.extra=T&15,t.mode=yw;case yw:if(t.extra){for(K=t.extra;f<K;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}t.offset+=c&(1<<t.extra)-1,c>>>=t.extra,f-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=Ue;break}t.mode=bw;case bw:if(l===0)break e;if(d=h-l,t.offset>d){if(d=t.offset-d,d>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=Ue;break}d>t.wnext?(d-=t.wnext,m=t.wsize-d):m=t.wnext-d,d>t.length&&(d=t.length),y=t.window}else y=i,m=s-t.offset,d=t.length;d>l&&(d=l),l-=d,t.length-=d;do i[s++]=y[m++];while(--d);t.length===0&&(t.mode=rh);break;case _w:if(l===0)break e;i[s++]=t.length,l--,t.mode=rh;break;case hg:if(t.wrap){for(;f<32;){if(a===0)break e;a--,c|=n[o++]<<f,f+=8}if(h-=l,r.total_out+=h,t.total+=h,h&&(r.adler=t.check=t.flags?bt(t.check,i,h,s-h):sc(t.check,i,h,s-h)),h=l,(t.flags?c:ww(c))!==t.check){r.msg="incorrect data check",t.mode=Ue;break}c=0,f=0}t.mode=vw;case vw:if(t.wrap&&t.flags){for(;f<32;){if(a===0)break e;a--,c+=n[o++]<<f,f+=8}if(c!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=Ue;break}c=0,f=0}t.mode=kw;case kw:L=JD;break e;case Ue:L=Zw;break e;case Xw:return Jw;case QD:default:return Vr}return r.next_out=s,r.avail_out=l,r.next_in=o,r.avail_in=a,t.hold=c,t.bits=f,(t.wsize||h!==r.avail_out&&t.mode<Ue&&(t.mode<hg||e!==Qk))&&nx(r,r.output,r.next_out,h-r.avail_out),u-=r.avail_in,h-=r.avail_out,r.total_in+=u,r.total_out+=h,t.total+=h,t.wrap&&h&&(r.adler=t.check=t.flags?bt(t.check,i,h,r.next_out-h):sc(t.check,i,h,r.next_out-h)),r.data_type=t.bits+(t.last?64:0)+(t.mode===ti?128:0)+(t.mode===th||t.mode===ug?256:0),(u===0&&h===0||e===Qk)&&L===Ko&&(L=XD),L},lN=r=>{if(!r||!r.state)return Vr;let e=r.state;return e.window&&(e.window=null),r.state=null,Ko},cN=(r,e)=>{if(!r||!r.state)return Vr;let t=r.state;return(t.wrap&2)===0?Vr:(t.head=e,e.done=!1,Ko)},fN=(r,e)=>{let t=e.length,n,i,o;return!r||!r.state||(n=r.state,n.wrap!==0&&n.mode!==ch)?Vr:n.mode===ch&&(i=1,i=sc(i,e,t,0),i!==n.check)?Zw:(o=nx(r,e,t,t),o?(n.mode=Xw,Jw):(n.havedict=1,Ko))},uN=ex,hN=tx,dN=Qw,pN=oN,mN=rx,gN=aN,yN=lN,bN=cN,_N=fN,vN="pako inflate (from Nodeca project)",ni={inflateReset:uN,inflateReset2:hN,inflateResetKeep:dN,inflateInit:pN,inflateInit2:mN,inflate:gN,inflateEnd:yN,inflateGetHeader:bN,inflateSetDictionary:_N,inflateInfo:vN};function kN(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var wN=kN,ix=Object.prototype.toString,{Z_NO_FLUSH:xN,Z_FINISH:SN,Z_OK:cc,Z_STREAM_END:mg,Z_NEED_DICT:gg,Z_STREAM_ERROR:CN,Z_DATA_ERROR:Sw,Z_MEM_ERROR:AN}=Go;function dc(r){this.options=hh.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ww,this.strm.avail_out=0;let t=ni.inflateInit2(this.strm,e.windowBits);if(t!==cc)throw new Error(Ho[t]);if(this.header=new wN,ni.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=lc.string2buf(e.dictionary):ix.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=ni.inflateSetDictionary(this.strm,e.dictionary),t!==cc)))throw new Error(Ho[t])}dc.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i=this.options.dictionary,o,s,a;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?SN:xN,ix.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),o=ni.inflate(t,s),o===gg&&i&&(o=ni.inflateSetDictionary(t,i),o===cc?o=ni.inflate(t,s):o===Sw&&(o=gg));t.avail_in>0&&o===mg&&t.state.wrap>0&&r[t.next_in]!==0;)ni.inflateReset(t),o=ni.inflate(t,s);switch(o){case CN:case Sw:case gg:case AN:return this.onEnd(o),this.ended=!0,!1}if(a=t.avail_out,t.next_out&&(t.avail_out===0||o===mg))if(this.options.to==="string"){let l=lc.utf8border(t.output,t.next_out),c=t.next_out-l,f=lc.buf2string(t.output,l);t.next_out=c,t.avail_out=n-c,c&&t.output.set(t.output.subarray(l,l+c),0),this.onData(f)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===cc&&a===0)){if(o===mg)return o=ni.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};dc.prototype.onData=function(r){this.chunks.push(r)};dc.prototype.onEnd=function(r){r===cc&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=hh.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function Ag(r,e){let t=new dc(e);if(t.push(r),t.err)throw t.msg||Ho[t.err];return t.result}function TN(r,e){return e=e||{},e.raw=!0,Ag(r,e)}var ON=dc,EN=Ag,RN=TN,MN=Ag,DN=Go,NN={Inflate:ON,inflate:EN,inflateRaw:RN,ungzip:MN,constants:DN},{Deflate:PN,deflate:LN,deflateRaw:IN,gzip:BN}=$D,{Inflate:zN,inflate:jN,inflateRaw:$N,ungzip:FN}=NN,VN=PN,UN=LN,HN=IN,WN=BN,qN=zN,KN=jN,GN=$N,ZN=FN,JN=Go,Tg={Deflate:VN,deflate:UN,deflateRaw:HN,gzip:WN,Inflate:qN,inflate:KN,inflateRaw:GN,ungzip:ZN,constants:JN};var Ln,Og=class{constructor(){U(this,Ln,new Map)}emit(e,...t){let n=_(this,Ln).get(e);if(!n?.all?.size)return!1;for(let i of n.all)i(...t),n.once.has(i)&&(n.all.delete(i),n.once.delete(i));return!1}on(e,t){return _(this,Ln).has(e)||_(this,Ln).set(e,{all:new Set,once:new Set}),_(this,Ln).get(e).all.add(t),this}once(e,t){_(this,Ln).has(e)||_(this,Ln).set(e,{all:new Set,once:new Set});let n=_(this,Ln).get(e);return n.all.add(t),n.once.add(t),this}};Ln=new WeakMap;var Eg=class{async get(e,t={}){let n=new Headers;for(let[o,s]of Object.entries(t?.headers??{})){let a=typeof s=="string"?[s]:s;for(let l of a)n.append(o,l)}let i=await fetch(e,{headers:n,redirect:"follow"});if(i.ok)return new Uint8Array(await i.arrayBuffer());throw new Error(`Status code ${i.status}: ${i.ok}`)}},Rg=class{on(e,t){return e==="ready"&&t(),this}once(e,t){return e==="ready"&&t(),this}async close(){}},ph=class{states;constructor(){this.states=JSON.parse(localStorage.getItem(ph.LocalStorageKey)??"{}")}saveStates(){localStorage.setItem(ph.LocalStorageKey,JSON.stringify(this.states))}async chmod(e,t){}async getAllFiles(e){return[]}async mkdir(e,t){if(e=ge.ensureEndingSlash(e.toString()),this.states[e])throw new Error(`EEXIST: ${e}`);this.states[e]={type:"directory"},this.saveStates()}async readFile(e){e=e.toString();let t=this.states[e];if(t){if(t.type==="directory")throw new Error(`EISDIR: ${e}`)}else throw new Error(`ENOENT: ${e}`);return new Uint8Array((0,mh.decode)(t.content))}async showFile(e){throw new Error("showFile not supported on browser")}async stat(e){e=e.toString();let t=this.states[e];if(!t)throw new Error(`ENOENT: ${e}`);return{isDirectory:()=>t.type==="directory",isFile:()=>t.type==="file"}}async unlink(e){if(e=e.toString(),!this.states[e])throw new Error(`ENOENT: ${e}`);delete this.states[e],this.saveStates()}watch(e){return new Rg}async writeFile(e,t,n){e=e.toString(),typeof t=="string"&&(t=new TextEncoder().encode(t)),t=(0,mh.encode)(t),this.states[e]={type:"file",content:t},this.saveStates()}},dh=ph;ce(dh,"LocalStorageKey","spyglassmc-browser-fs");var Mg={archive:{decompressBall(r,e){throw new Error("decompressBall not supported on browser.")},async gunzip(r){return Tg.inflate(r)},async gzip(r){return Tg.gzip(r)}},crypto:{async getSha1(r){typeof r=="string"&&(r=new TextEncoder().encode(r));let e=await crypto.subtle.digest("SHA-1",r);return YN(new Uint8Array(e))}},downloader:new Eg,error:{isKind(r,e){return r instanceof Error&&r.message.startsWith(e)}},event:{EventEmitter:Og},fs:new dh,uri:{normalize(r){return new tr(r).toString()}}};function YN(r){let e="";for(let t of r)e+=t.toString(16).padStart(2,"0");return e}Object.freeze(Mg);var F6=Object.freeze({is(r){return r?.type==="mcdoc:module"}}),V6=Object.freeze({is(r){return ku.is(r)||XN.is(r)||yh.is(r)||bP.is(r)||bh.is(r)||Dg.is(r)||Ng.is(r)}}),XN=Object.freeze({is(r){return r?.type==="mcdoc:dispatch_statement"}}),ox=Object.freeze({is(r){return r?.type==="mcdoc:literal"}}),U6=Object.freeze({is(r){return r?.type==="mcdoc:index_body"}}),H6=Object.freeze({is(r){return QN.is(r)||eP.is(r)}}),QN=Object.freeze({is(r){return ox.is(r)||Gi.is(r)||Yt.is(r)||le.is(r)}}),Gi=Object.freeze({is(r){return r?.type==="mcdoc:identifier"}}),eP=Object.freeze({is(r){return r?.type==="mcdoc:dynamic_index"}}),W6=Object.freeze({is(r){return ox.is(r)||Gi.is(r)||Yt.is(r)}}),sx=Object.freeze({is(r){return rP.is(r)||nP.is(r)||iP.is(r)||oP.is(r)||aP.is(r)||lP.is(r)||cP.is(r)||fP.is(r)||yh.is(r)||bh.is(r)||_h.is(r)||gP.is(r)||yP.is(r)},asType(r){throw"// TODO"}}),gh=Object.freeze({is(r){return r?.type==="mcdoc:attribute"}}),q6=Object.freeze({is(r){return sx.is(r)||tP.is(r)}}),tP=Object.freeze({is(r){return r?.type==="mcdoc:attribute/tree"}}),K6=Object.freeze({is(r){return r?.type==="mcdoc:attribute/tree/pos"}}),G6=Object.freeze({is(r){return r?.type==="mcdoc:attribute/tree/named"}}),rP=Object.freeze({is(r){return r?.type==="mcdoc:type/any"}}),nP=Object.freeze({is(r){return r?.type==="mcdoc:type/boolean"}}),iP=Object.freeze({is(r){return r?.type==="mcdoc:type/string"}}),Z6=Object.freeze({is(r){return r?.type==="mcdoc:int_range"}}),oP=Object.freeze({is(r){return r?.type==="mcdoc:type/literal"}}),sP=Object.freeze({is(r){return r?.type==="mcdoc:typed_number"}}),aP=Object.freeze({is(r){return r?.type==="mcdoc:type/numeric_type"}}),J6=Object.freeze({is(r){return r?.type==="mcdoc:float_range"}}),lP=Object.freeze({is(r){return r?.type==="mcdoc:type/primitive_array"}}),cP=Object.freeze({is(r){return r?.type==="mcdoc:type/list"}}),fP=Object.freeze({is(r){return r?.type==="mcdoc:type/tuple"}}),yh=Object.freeze({kinds:new Set(["byte","short","int","long","float","double","string"]),destruct(r){return{attributes:r.children.filter(gh.is),block:r.children.find(uP.is),docComments:r.children.find(ga.is),identifier:r.children.find(Gi.is)}},is(r){return r?.type==="mcdoc:enum"}}),ga=Object.freeze({asText(r){if(!r)return;let e=r.children.map(t=>t.comment);return e.every(t=>t.length===0||t.startsWith(" "))&&(e=e.map(t=>t.slice(1))),e.join(`
`)},is(r){return r?.type==="mcdoc:doc_comments"}}),uP=Object.freeze({is(r){return r?.type==="mcdoc:enum/block"}}),Y6=Object.freeze({is(r){return r?.type==="mcdoc:enum/field"}}),X6=Object.freeze({is(r){return sP.is(r)||Yt.is(r)}}),Q6=Object.freeze({is(r){return gh.is(r)||ga.is(r)}}),bh=Object.freeze({destruct(r){return{attributes:r.children.filter(gh.is),block:r.children.find(hP.is),docComments:r.children.find(ga.is),identifier:r.children.find(Gi.is),typeParams:r.children.find(ax.is)}},is(r){return r?.type==="mcdoc:struct"}}),e4=Object.freeze({is(r){return r?.type==="mcdoc:type/path"}}),ax=Object.freeze({is(r){return r?.type==="mcdoc:type_param_block"}}),t4=Object.freeze({is(r){return r?.type==="mcdoc:type_param"}}),_h=Object.freeze({destruct(r){let e=Vv(r?.children,-1);return{isAbsolute:r?.isAbsolute,lastIdentifier:Gi.is(e)?e:void 0}},is(r){return r?.type==="mcdoc:path"}}),hP=Object.freeze({is(r){return r?.type==="mcdoc:struct/block"}}),lx=Object.freeze({is(r){return dP.is(r)||mP.is(r)}}),dP=Object.freeze({is(r){return r?.type==="mcdoc:struct/field/pair"}}),cx=Object.freeze({is(r){return Yt.is(r)||Gi.is(r)||pP.is(r)}}),pP=Object.freeze({is(r){return r?.type==="mcdoc:struct/map_key"}}),mP=Object.freeze({is(r){return r?.type==="mcdoc:struct/field/spread"}}),gP=Object.freeze({is(r){return r?.type==="mcdoc:type/dispatcher"}}),yP=Object.freeze({is(r){return r?.type==="mcdoc:type/union"}}),bP=Object.freeze({is(r){return r?.type==="mcdoc:injection"}}),r4=Object.freeze({is(r){return r?.type==="mcdoc:injection/enum"}}),n4=Object.freeze({is(r){return r?.type==="mcdoc:injection/struct"}}),Dg=Object.freeze({destruct(r){return{attributes:r.children.filter(gh.is),docComments:r.children.find(ga.is),identifier:r.children.find(Gi.is),typeParams:r.children.find(ax.is),rhs:r.children.find(sx.is)}},is(r){return r?.type==="mcdoc:type_alias"}}),Ng=Object.freeze({destruct(r){return{binding:r.children.find(Gi.is),path:r.children.find(_h.is)}},is(r){return r?.type==="mcdoc:use_statement"}});var _P=Cl.create(async(r,e)=>{let t=Object.values(e.symbols.global.mcdoc??{}).find(i=>i.subcategory==="module"&&i.definition?.some(o=>o.uri===e.doc.uri));if(!t){e.err.report(b("mcdoc.binder.out-of-root",q(e.doc.uri)),k.Beginning,0);return}let n=I(w({},e),{moduleIdentifier:t.identifier});return vP(r,n)});async function vP(r,e){kP(r,e)}function kP(r,e){for(let a of r.children)switch(a.type){case"mcdoc:enum":t(a);break;case"mcdoc:struct":n(a);break;case"mcdoc:type_alias":i(a);break;case"mcdoc:use_statement":o(a);break}function t(a){s("enum",a,yh.destruct)}function n(a){s("struct",a,bh.destruct)}function i(a){s("type_alias",a,Dg.destruct)}function o(a){let{binding:l,path:c}=Ng.destruct(a);if(!c)return;let{lastIdentifier:f}=_h.destruct(c),u=l??f;!u||e.symbols.query({doc:e.doc,node:a},"mcdoc",`${e.moduleIdentifier}::${u.value}`).ifDeclared(h=>fx(e,h,u)).elseEnter({data:{subcategory:"use_statement_binding",visibility:1},usage:{type:"definition",node:u,fullRange:a}})}function s(a,l,c){let{docComments:f,identifier:u}=c(l);!u?.value||e.symbols.query({doc:e.doc,node:l},"mcdoc",`${e.moduleIdentifier}::${u.value}`).ifDeclared(h=>fx(e,h,u)).elseEnter({data:{desc:ga.asText(f),subcategory:a},usage:{type:"definition",node:u,fullRange:l}})}}function ux(r){r.registerBinder("mcdoc:module",_P)}function fx(r,e,t){let n="mcdoc.binder.duplicated-path";r.err.report(b(n,q(e.identifier)),t,2,{related:[{location:Qe.getDeclaredLocation(e),message:b(`${n}.related`,q(e.identifier))}]})}var dx=async(r,e)=>{};var wP=r=>[Je.create(r,"variable")],xP=r=>[Je.create(r,r.colorTokenType??"literal")];function mx(r){r.registerColorizer("mcdoc:literal",xP),r.registerColorizer("mcdoc:identifier",wP)}var Sx=ql(Kl({singleLinePrefixes:new Set(["//"])}),(r,e)=>!e.slice(r).startsWith("///"),b("mcdoc.parser.syntax.doc-comment-unexpected"));function Cx(r=!1){return(e,t)=>{let n=[];for(e.skipWhitespace();e.canRead()&&e.peek(2)==="//"&&(!r||e.peek(3)!=="///");){let i=Sx(e,t);n.push(i),e.skipWhitespace()}return n}}function ee(r,e=!1){return(t,n)=>{t.skipWhitespace();let i=Fe(r,Cx(e))(t,n);return t.skipWhitespace(),i}}function an(r,e=!1){return la(r,Cx(e))}function br(r,e){return(t,n)=>{let i={type:"mcdoc:literal",range:k.create(t),value:"",colorTokenType:e?.colorTokenType};return i.value=t.readIf(o=>e?.allowedChars?.has(o)??(e?.specialChars?.has(o)||/[a-z]/i.test(o))),i.range.end=t.cursor,Le.toArray(r).every(o=>o!==i.value)&&n.err.report(b("expected-got",Zn(r),q(i.value)),i),i}}function ar(r,e={colorTokenType:"keyword"}){return(t,n)=>{let i=br(r,e)(t,n);return Le.toArray(r).includes(i.value)?i:oe}}function be(r){return(e,t)=>{e.skipWhitespace(),e.trySkip(r)||t.err.report(b("expected-got",q(r),q(e.peek())),e)}}function Re(r){return(e,t)=>{if(e.skipWhitespace(),!e.trySkip(r))return oe}}function Pg(r){return ql(et(r),e=>e.namespace!==void 0,b("mcdoc.parser.resource-location.colon-expected",q(se.NamespacePathSep)))}var SP=Object.freeze(["\0","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","","","\x7F"]),ya=ei($t({escapable:{characters:["b","f","n","r","t","\\",'"'],unicode:!0},quotes:['"']}),...SP),Ur=(r,e)=>{let t=/^[\p{L}\p{Nl}]$/u,n=/^[\p{L}\p{Nl}\u200C\u200D\p{Mn}\p{Mc}\p{Nd}\p{Pc}]$/u,i=new Set(["any","boolean","byte","double","enum","false","float","int","long","short","string","struct","super","true"]),o={type:"mcdoc:identifier",range:k.create(r),options:{category:"mcdoc"},value:""},s=r.innerCursor;if(t.test(r.peek()))for(r.skip();n.test(r.peek());)r.skip();else e.err.report(b("expected",b("mcdoc.node.identifier")),r);return o.value=r.string.slice(s,r.innerCursor),o.range.end=r.cursor,i.has(o.value)&&e.err.report(b("mcdoc.parser.identifier.reserved-word",q(o.value)),o),o};function Lg(r){let e=Ae([{prefix:"%",parser:br(["%key","%parent"],{specialChars:new Set(["%"])})},{prefix:'"',parser:ya},{parser:Ur}]),t=Oe("mcdoc:dynamic_index",ee([be("["),e,la(Fe([Re("."),e])),be("]")])),n=Ae([{prefix:"%",parser:br(["%fallback","%none","%unknown"],{specialChars:new Set(["%"])})},{prefix:'"',parser:ya},{prefix:"[",parser:t},{parser:$r([Pg({category:"mcdoc/dispatcher",accessType:r?.accessType}),Ur])}]);return Oe("mcdoc:index_body",ee([be("["),n,an(ee([Re(","),Ce(n)])),De(Re(",")),be("]")]))}var yx=Ae([{prefix:"super",parser:br("super")},{parser:Ur}]),mc=(r,e)=>{let t;return r.trySkip("::")&&(t=!0),me(Fe([yx,la(Fe([Re("::"),yx]))]),n=>({type:"mcdoc:path",children:n.children,range:n.range,isAbsolute:t}))(r,e)},bx=Oe("mcdoc:attribute/tree/pos",ee([{get:()=>vh},an(ee([Re(","),{get:()=>Ce(vh)}],!0),!0)],!0)),_x=ee([Ae([{prefix:'"',parser:ya},{parser:Ur}]),Ae([{prefix:"=",parser:ee([be("="),{get:()=>vh}],!0)},{parser:{get:()=>Ig}}])],!0),vx=Oe("mcdoc:attribute/tree/named",ee([_x,an(ee([Re(","),Ce(_x)],!0),!0)],!0)),CP=$r([ee([vx,De(Re(","))]),ee([bx,be(","),vx,De(Re(","))]),ee([bx,De(Re(","))])]),AP=Object.freeze({"(":")","[":"]","{":"}"}),Ig=(r,e)=>{let t=r.trySkip("(")?"(":r.trySkip("[")?"[":r.trySkip("{")?"{":void 0;if(!t)return oe;let n=CP(r,e),i={type:"mcdoc:attribute/tree",range:n.range,children:n.children,delim:t};return r.trySkip(AP[t]),i},vh=Ae([{predicate:r=>["(","[","{"].includes(r.peek()),parser:Ig},{parser:{get:()=>sr}}]),TP=Oe("mcdoc:attribute",ee([Re("#["),Ur,Ae([{prefix:"=",parser:ee([be("="),vh,be("]")],!0)},{predicate:r=>["(","[","{"].includes(r.peek()),parser:ee([Ig,be("]")],!0)},{parser:be("]")}])],!0)),kh=la(TP),OP=Oe("mcdoc:dispatch_statement",ee([kh,ar("dispatch"),Pg({category:"mcdoc/dispatcher",accessType:1}),Lg({noDynamic:!0}),br("to"),{get:()=>sr}],!0)),EP=Kl({singleLinePrefixes:new Set(["///"]),includesEol:!0}),RP=Oe("mcdoc:doc_comments",la(EP,r=>(r.skipWhitespace(),[]))),gc=ee([De(Ce(RP)),kh]),Ax=br(["byte","short","int","long","string","float","double"],{colorTokenType:"type"}),Tx=Mn({pattern:/^[-+]?(?:[0-9]+(?:[eE][-+]?[0-9]+)?|[0-9]*\.[0-9]+(?:[eE][-+]?[0-9]+)?)$/}),Ox=Oe("mcdoc:typed_number",Fe([Tx,De(ar(["b","B","d","D","f","F","l","L","s","S"],{colorTokenType:"keyword"}))])),MP=Ae([{prefix:'"',parser:ya},{parser:Ox}]),kx=Oe("mcdoc:enum/field",ee([gc,Ur,be("="),MP],!0)),Ex=Oe("mcdoc:enum/block",ee([be("{"),Ae([{prefix:"}",parser:be("}")},{parser:ee([kx,an(ee([Re(","),Ce(kx)],!0),!0),De(Re(",")),be("}")],!0)}])],!0)),Rx=Oe("mcdoc:enum",ee([gc,ar("enum"),be("("),Ax,be(")"),De(ca(Ur)),Ex],!0)),wx=Oe("mcdoc:type_param",ee([Ur,De(ee([ca(br("extends")),mc]))])),DP=Oe("mcdoc:type_param_block",ee([be("<"),Ae([{prefix:">",parser:be(">")},{parser:ee([wx,an(ee([Re(","),Ce(wx)])),De(Re(",")),be(">")])}])])),Bg=()=>{},zg=Ae([{prefix:"<",parser:DP},{parser:Bg}]),NP=Oe("mcdoc:struct/map_key",ee([be("["),{get:()=>sr},be("]")],!0)),PP=Ae([{prefix:'"',parser:ya},{prefix:"[",parser:NP},{parser:Ur}]),LP=(r,e)=>{let t,n=ee([gc,PP],!0)(r,e);r.trySkip("?")&&(t=!0);let i=ee([be(":"),{get:()=>sr}],!0)(r,e);return{type:"mcdoc:struct/field/pair",children:[...n.children,...i.children],range:k.span(n,i),isOptional:t}},IP=Oe("mcdoc:struct/field/spread",ee([kh,Re("..."),{get:()=>sr}],!0)),xx=$r([IP,LP]),Mx=Oe("mcdoc:struct/block",ee([be("{"),Ae([{prefix:"}",parser:be("}")},{parser:ee([xx,an(ee([Re(","),Ce(xx)],!0),!0),De(Re(",")),be("}")],!0)}])],!0)),Dx=Oe("mcdoc:struct",ee([gc,ar("struct"),De(Ce(Ur)),zg,Mx],!0)),BP=Oe("mcdoc:injection/enum",ee([br("enum"),be("("),Ax,be(")"),mc,Ex])),zP=Oe("mcdoc:injection/struct",ee([br("struct"),mc,zg,Mx])),jP=Oe("mcdoc:injection",ee([ar("inject"),Ae([{prefix:"enum",parser:BP},{parser:zP}])])),$P=Oe("mcdoc:type_alias",ee([gc,ar("type"),Ur,zg,be("="),{get:()=>sr}],!0)),FP=Oe("mcdoc:use_statement",ee([ar("use"),mc,Ae([{prefix:"as",parser:ee([br("as"),Ur])},{parser:Bg}])],!0)),VP=$r([Sx,OP,Rx,jP,Dx,$P,FP]),Nx=Oe("mcdoc:module",an(VP,!0));function ln(r,e){return Oe(r,ee([kh,e,an(ca(Lg()))],!0))}var UP=ln("mcdoc:type/any",ar("any",{colorTokenType:"type"})),HP=ln("mcdoc:type/boolean",ar("boolean",{colorTokenType:"type"})),WP=nn({pattern:/^(?:0|[-+]?[1-9][0-9]*)$/});function Px(r,e){return Oe(r,Ae([{prefix:"..",parser:Fe([br("..",{allowedChars:new Set(".")}),e])},{parser:Fe([ei(e,".."),Ae([{prefix:"..",parser:Fe([br("..",{allowedChars:new Set(".")}),De(Ce(e))])},{parser:Bg}])])}]))}var qP=Px("mcdoc:int_range",WP),pc=De((r,e)=>r.trySkip("@")?(r.skipWhitespace(),qP(r,e)):oe),KP=ln("mcdoc:type/string",ee([ar("string",{colorTokenType:"type"}),pc])),GP=ln("mcdoc:type/literal",Ae([{predicate:r=>r.tryPeek("false")||r.tryPeek("true"),parser:ar(["false","true"],{colorTokenType:"type"})},{prefix:'"',parser:Ce(ya)},{parser:ca(Ox)}])),ZP=Px("mcdoc:float_range",Tx),JP=De((r,e)=>r.trySkip("@")?(r.skipWhitespace(),ZP(r,e)):oe),YP=ln("mcdoc:type/numeric_type",Ae([{predicate:r=>r.tryPeek("float")||r.tryPeek("double"),parser:ee([ar(["float","double"],{colorTokenType:"type"}),JP])},{parser:ee([ar(["byte","short","int","long"],{colorTokenType:"type"}),pc])}])),XP=ln("mcdoc:type/primitive_array",ee([br(["byte","int","long"]),pc,ar("[]",{allowedChars:new Set(["[","]"]),colorTokenType:"type"}),pc])),QP=ln("mcdoc:type/list",ee([Re("["),{get:()=>sr},be("]"),pc],!0)),eL=ln("mcdoc:type/tuple",ee([Re("["),{get:()=>sr},Re(","),Ae([{prefix:"]",parser:be("]")},{parser:ee([{get:()=>sr},an(ee([Re(","),{get:()=>Ce(sr)}],!0),!0),De(Re(",")),be("]")],!0)}])],!0)),tL=ln("mcdoc:type/dispatcher",ee([ca(Pg({category:"mcdoc/dispatcher"})),Lg()])),rL=ln("mcdoc:type/union",ee([Re("("),Ae([{prefix:")",parser:be(")")},{parser:ee([{get:()=>sr},an(ee([Re("|"),{get:()=>Ce(sr)}],!0),!0),De(Re("|")),be(")")],!0)}])])),nL=ln("mcdoc:type/path",ee([mc,De(ee([Re("<"),Ae([{prefix:">",parser:be(">")},{parser:ee([{get:()=>sr},an(ee([Re(","),{get:()=>Ce(sr)}],!0),!0),De(Re(",")),be(">")],!0)}])]))])),sr=$r([UP,HP,tL,Rx,QP,GP,YP,XP,KP,Dx,eL,rL,nL]);function Lx(r){return`::${r.join("::")}`}var ba=".mcdoc",Ix="mcdoc/",Bx=(r,e)=>{let t=[];for(let n of r){if(!n.endsWith(ba))continue;let i=ge.getRel(n,e.roots);!i||(i=i.slice(0,-ba.length).replace(/(^|\/)mod$/,""),t.push([n,i]))}t.every(([n,i])=>i.startsWith(Ix))&&(t=t.map(([n,i])=>[n,i.slice(Ix.length)]));for(let[n,i]of t)e.symbols.query(n,"mcdoc",Lx(i.split("/"))).ifKnown(()=>{}).elseEnter({data:{subcategory:"module"},usage:{type:"definition"}})},zx=(r,e,t)=>r.endsWith(ba)&&!e.endsWith(ba)?-1:!r.endsWith(ba)&&e.endsWith(ba)?1:t(r,e);var b4=Object.freeze({kind:"union",members:[]});var wh;(function(r){function e(t){let n=o=>{if(!o)return"";let[s,a]=o;return s===a?` @ ${s}`:` @ ${s??""}..${a??""}`},i=o=>{let s=[];for(let a of Le.toArray(o))a===void 0?s.push("()"):s.push(a.kind==="static"?`[${a.value}]`:`[[${a.accessor.map(l=>typeof l=="string"?l:l.keyword).join(".")}]]`);return`[${s.join(", ")}]`};if(t===void 0)return"<unknown>";switch(t.kind){case"any":case"boolean":return t.kind;case"byte":return`byte${n(t.valueRange)}`;case"byte_array":return`byte${n(t.valueRange)}[]${n(t.lengthRange)}`;case"dispatcher":return`${t.registry??"spyglass:unknown"}[${i(t.index)}]`;case"double":return`double${n(t.valueRange)}`;case"enum":return"<anonymous_enum>";case"float":return`float${n(t.valueRange)}`;case"int":return`int${n(t.valueRange)}`;case"int_array":return`int${n(t.valueRange)}[]${n(t.lengthRange)}`;case"list":return`[${e(t.item)}]${n(t.lengthRange)}`;case"literal":return`${t.value}`;case"long":return`long${n(t.valueRange)}`;case"long_array":return`long${n(t.valueRange)}[]${n(t.lengthRange)}`;case"reference":return t.symbol?.path.join("::")??"<unknown_reference>";case"short":return`short${n(t.valueRange)}`;case"string":return`string${n(t.lengthRange)}`;case"struct":return"<anonymous_compound>";case"tuple":return`[${t.items.map(o=>e(o)).join(",")}${t.items.length===1?",":""}]`;case"union":return`(${t.members.map(e).join(" | ")})`}}r.toString=e})(wh||(wh={}));var Ot;(function(r){r[r.Nah=0]="Nah",r[r.Assignable=1]="Assignable",r[r.StrictlyAssignable=3]="StrictlyAssignable"})(Ot||(Ot={}));var yc=(r,e)=>{if(!e)return!0;if(!r)return!1;let[t,n]=r,[i,o]=e;return(i===void 0||t!==void 0&&t>=i)&&(o===void 0||n!==void 0&&n<=o)},xh=r=>{let e=new Set,t=n=>{for(let i of e){if((_a(n,i)&Ot.StrictlyAssignable)===Ot.StrictlyAssignable)return;(_a(i,n)&Ot.StrictlyAssignable)===Ot.StrictlyAssignable&&e.delete(i)}e.add(n)};for(let n of r.members)n.kind==="union"?xh(n).members.forEach(t):t(n);return{kind:"union",members:[...e]}};var sL=r=>(r=xh(r),r.members.length===1?r.members[0]:r),$g=r=>w({kind:"list",item:jg(r.item)},r.lengthRange?{lengthRange:[...r.lengthRange]}:{}),jg=r=>(r.kind==="union"?r=sL(r):r.kind==="list"&&(r=$g(r)),r),_a=(r,e,t=[])=>{let n=s=>s?Ot.StrictlyAssignable:Ot.Nah,i=s=>s?Ot.Assignable:Ot.Nah,o;return r=jg(r),e=jg(e),r.kind==="any"||r.kind==="reference"||e.kind==="reference"?o=Ot.Assignable:e.kind==="any"?o=Ot.StrictlyAssignable:r.kind==="union"?o=i(r.members.every(s=>_a(s,e,t))):e.kind==="union"?o=i(e.members.some(s=>_a(r,s))):r.kind==="boolean"?o=n(e.kind==="boolean"||e.kind==="byte"):r.kind==="byte"?e.kind==="boolean"?o=_a(r,{kind:"byte",valueRange:[0,1]},t):e.kind==="byte"?o=n(yc(r.valueRange,e.valueRange)):e.kind==="enum"?o=i(!e.enumKind||e.enumKind==="byte"):o=Ot.Nah:r.kind==="byte_array"||r.kind==="int_array"||r.kind==="long_array"?o=n(e.kind===r.kind&&yc(r.lengthRange,e.lengthRange)&&yc(r.valueRange,e.valueRange)):r.kind==="struct"||r.kind==="dispatcher"?o=i(e.kind==="struct"||e.kind==="dispatcher"):r.kind==="enum"?o=i((e.kind==="byte"||e.kind==="float"||e.kind==="double"||e.kind==="int"||e.kind==="long"||e.kind==="short"||e.kind==="string")&&(!r.enumKind||r.enumKind===e.kind)):r.kind==="float"||r.kind==="double"||r.kind==="int"||r.kind==="long"||r.kind==="short"?e.kind===r.kind?o=n(yc(r.valueRange,e.valueRange)):e.kind==="enum"?o=i(!e.enumKind||e.enumKind===r.kind):o=Ot.Nah:r.kind==="list"?e.kind==="list"&&yc(r.lengthRange,e.lengthRange)?o=_a(r.item,e.item,t):o=Ot.Nah:r.kind==="string"?e.kind==="string"?o=Ot.StrictlyAssignable:o=i(e.kind==="enum"&&(!e.enumKind||e.enumKind==="string")):o=Ot.Nah,o||t.push(b("mcdoc.checker.type-not-assignable",q(wh.toString(r)),q(wh.toString(e)))),o};var jx=({meta:r})=>{r.registerLanguage("mcdoc",{extensions:[".mcdoc"],parser:Nx}),r.registerChecker("mcdoc:module",dx),r.registerUriBinder(Bx),r.setUriSorter(zx),ux(r),mx(r)};function $x(r){r.registerColorizer("nbt:byte",ot.number),r.registerColorizer("nbt:short",ot.number),r.registerColorizer("nbt:int",ot.number),r.registerColorizer("nbt:long",ot.number),r.registerColorizer("nbt:float",ot.number),r.registerColorizer("nbt:double",ot.number)}var In={};dn(In,{byteArray:()=>Hg,compound:()=>Zi,entry:()=>Ji,intArray:()=>Wg,list:()=>Ug,longArray:()=>qg,path:()=>Kg,primitive:()=>Jo,string:()=>Vg});function Hr(r){return b(`nbt.node.${r.replace(/^nbt:/,"")}`)}var Zi=(r,e)=>Oe("nbt:compound",on({start:"{",pair:{key:Ce($t(I(w({},$i),{colorTokenType:"property"}))),sep:":",value:Ji,end:",",trailingEnd:!1},end:"}"}))(r,e);var Vx=(2-2**-23)*2**127,aL=[{pattern:/^[-+]?(?:0|[1-9][0-9]*)b$/i,type:"nbt:byte",hasSuffix:!0,group:2,min:-128,max:127},{pattern:/^[-+]?(?:0|[1-9][0-9]*)s$/i,type:"nbt:short",hasSuffix:!0,group:2,min:-32768,max:32767},{pattern:/^[-+]?(?:0|[1-9][0-9]*)$/,type:"nbt:int",hasSuffix:!1,group:2,min:-2147483648,max:2147483647},{pattern:/^[-+]?(?:0|[1-9][0-9]*)l$/i,type:"nbt:long",hasSuffix:!0,group:3,min:-9223372036854775808n,max:9223372036854775807n},{pattern:/^[-+]?(?:[0-9]+\.?|[0-9]*\.[0-9]+)(?:e[-+]?[0-9]+)?f$/i,type:"nbt:float",hasSuffix:!0,group:1,min:-Vx,max:Vx},{pattern:/^[-+]?(?:[0-9]+\.|[0-9]*\.[0-9]+)(?:e[-+]?[0-9]+)?$/i,type:"nbt:double",hasSuffix:!1,group:1,min:-Number.MAX_VALUE,max:Number.MAX_VALUE},{pattern:/^[-+]?(?:[0-9]+\.?|[0-9]*\.[0-9]+)(?:e[-+]?[0-9]+)?d$/i,type:"nbt:double",hasSuffix:!0,group:1,min:-Number.MAX_VALUE,max:Number.MAX_VALUE},{pattern:/^true$/i,type:"nbt:byte",value:1,group:0},{pattern:/^false$/i,type:"nbt:byte",value:0,group:0}],Vg=Fo,Jo=(r,e)=>{if(Ke.isBrigadierQuote(r.peek()))return Vg(r,e);let{result:t,updateSrcAndCtx:n}=yr(Vg,r,e);for(let i of aL)if(i.pattern.test(t.value)){if(i.group===0){let f={type:"nbt:byte",range:t.range,value:i.value};return n(),f}let o=!1,s=()=>o=!0,a=i.group===2?nn({pattern:/./,min:i.min,max:i.max,onOutOfRange:s}):i.group===3?Gl({pattern:/./,min:i.min,max:i.max,onOutOfRange:s}):Mn({pattern:/./,min:i.min,max:i.max,onOutOfRange:s}),{result:l,updateSrcAndCtx:c}=yr(a,r,e);if(o){e.err.report(b("nbt.parser.number.out-of-range",Hr(i.type),b("nbt.node.string"),i.min,i.max),t,2);break}return c(),i.hasSuffix&&(r.skip(),l.range.end++),I(w({},l),{type:i.type})}return n(),t};var Ji=(r,e)=>Ce(Ae([{predicate:t=>t.tryPeek("[B;"),parser:Hg},{predicate:t=>t.tryPeek("[I;"),parser:Wg},{predicate:t=>t.tryPeek("[L;"),parser:qg},{predicate:t=>t.tryPeek("["),parser:Ug},{predicate:t=>t.tryPeek("{"),parser:Zi},{parser:Jo}]))(r,e);var Ug=(r,e)=>{let n=ji({start:"[",value:Ji,sep:",",trailingSep:!1,end:"]"})(r,e);if(n.type="nbt:list",n.valueType=n.children[0]?.value?.type,n.valueType)for(let{value:i}of n.children)i&&i.type!==n.valueType&&e.err.report(b("expected-got",Hr(n.valueType),Hr(i.type)),i);return n},Hg=(r,e)=>{let n=ji({start:"[B;",value:Jo,sep:",",trailingSep:!1,end:"]"})(r,e);n.type="nbt:byte_array";for(let{value:i}of n.children)i&&i.type!=="nbt:byte"&&e.err.report(b("expected-got",b("nbt.node.byte"),Hr(i.type)),i);return n},Wg=(r,e)=>{let n=ji({start:"[I;",value:Jo,sep:",",trailingSep:!1,end:"]"})(r,e);n.type="nbt:int_array";for(let{value:i}of n.children)i&&i.type!=="nbt:int"&&e.err.report(b("expected-got",b("nbt.node.int"),Hr(i.type)),i);return n},qg=(r,e)=>{let n=ji({start:"[L;",value:Jo,sep:",",trailingSep:!1,end:"]"})(r,e);n.type="nbt:long_array";for(let{value:i}of n.children)i&&i.type!=="nbt:long"&&e.err.report(b("expected-got",b("nbt.node.long"),Hr(i.type)),i);return n};var Kg=(r,e)=>{let t={type:"nbt:path",children:[],range:k.create(r)},n=["filter","key"],i=Ux(r),o;for(;o!==r.cursor&&(n.includes(i)||e.err.report(b("expected-got",Zn(n.map(Hx),!1,"or"),Hx(i)),r),i!=="end");)o=r.cursor,n=uL[i](t.children,r,e),i=Ux(r);return t.range.end=r.cursor,t},lL=(r,e,t)=>(r.push(Zi(e,t)),e.trySkip(".")?["key"]:["end"]),cL=(r,e,t)=>{let n={type:"nbt:path/index",children:void 0,range:k.create(e)};if(!e.trySkip("["))throw new Error(`NBT path index parser called at illegal position: \u201C${e.peek()}\u201D at ${e.cursor}`);e.skipSpace();let i=e.peek();return i==="{"?n.children=[Zi(e,t)]:i!=="]"&&(n.children=[nn({pattern:/^-?\d+$/})(e,t)]),e.skipSpace(),e.trySkip("]")||t.err.report(b("expected-got",q("]"),q(e.peek())),e),n.range.end=e.cursor,r.push(n),e.trySkip(".")?["index","key"]:["end","index"]},fL=(r,e,t)=>{let n=$t({colorTokenType:"property",escapable:{},quotes:['"'],unquotable:{blockList:new Set([`
`,"\r","	"," ",'"',"[","]",".","{","}"])}})(e,t);return r.push(n),e.trySkip(".")?["index","key"]:["end","filter","index"]};function Ux(r){switch(r.peek()){case"":case" ":case`
`:case"\r":return"end";case"{":return"filter";case"[":return"index";default:return"key"}}function Hx(r){return b(`nbt.node.path.${r}`)}var uL={filter:lL,index:cL,key:fL};var Et={};dn(Et,{blockStates:()=>cy,compound:()=>mL,definition:()=>pL,enum_:()=>gL,fieldValue:()=>Sh,index:()=>Jx,path:()=>yL});var Wx;(function(r){function e(t){return Gg.is(t)||cn.is(t)||iy.is(t)}r.is=e})(Wx||(Wx={}));var Gg;(function(r){function e(t){return Zg.is(t)||Yt.is(t)}r.is=e})(Gg||(Gg={}));var Zg;(function(r){function e(t){return Jg.is(t)||ty.is(t)}r.is=e})(Zg||(Zg={}));var Jg;(function(r){function e(t){return Yg.is(t)||Xg.is(t)||Qg.is(t)||ey.is(t)}r.is=e})(Jg||(Jg={}));var Yg;(function(r){function e(t){return t?.type==="nbt:byte"}r.is=e})(Yg||(Yg={}));var Xg;(function(r){function e(t){return t?.type==="nbt:short"}r.is=e})(Xg||(Xg={}));var Qg;(function(r){function e(t){return t?.type==="nbt:int"}r.is=e})(Qg||(Qg={}));var ey;(function(r){function e(t){return t?.type==="nbt:long"}r.is=e})(ey||(ey={}));var ty;(function(r){function e(t){return ry.is(t)||ny.is(t)}r.is=e})(ty||(ty={}));var ry;(function(r){function e(t){return t?.type==="nbt:float"}r.is=e})(ry||(ry={}));var ny;(function(r){function e(t){return t?.type==="nbt:double"}r.is=e})(ny||(ny={}));var cn;(function(r){function e(t){return t?.type==="nbt:compound"}r.is=e})(cn||(cn={}));var iy;(function(r){function e(t){return bc.is(t)||oy.is(t)}r.is=e})(iy||(iy={}));var bc;(function(r){function e(t){return t?.type==="nbt:list"}r.is=e})(bc||(bc={}));var oy;(function(r){function e(t){return sy.is(t)||ay.is(t)||ly.is(t)}r.is=e})(oy||(oy={}));var sy;(function(r){function e(t){return t?.type==="nbt:byte_array"}r.is=e})(sy||(sy={}));var ay;(function(r){function e(t){return t?.type==="nbt:int_array"}r.is=e})(ay||(ay={}));var ly;(function(r){function e(t){return t?.type==="nbt:long_array"}r.is=e})(ly||(ly={}));var va;(function(r){function e(t){return t?.type==="nbt:path"}r.is=e})(va||(va={}));var qx;(function(r){function e(t){return t?.type==="nbt:path/index"}r.is=e})(qx||(qx={}));var hL={"minecraft:brain_coral_fan":["minecraft:brain_coral_fan","minecraft:brain_coral_wall_fan"],"minecraft:bubble_coral_fan":["minecraft:bubble_coral_fan","minecraft:bubble_coral_wall_fan"],"minecraft:fire_coral_fan":["minecraft:fire_coral_fan","minecraft:fire_coral_wall_fan"],"minecraft:horn_coral_fan":["minecraft:horn_coral_fan","minecraft:horn_coral_wall_fan"],"minecraft:tube_coral_fan":["minecraft:tube_coral_fan","minecraft:tube_coral_wall_fan"],"minecraft:creeper_head":["minecraft:creeper_head","minecraft:creeper_wall_head"],"minecraft:dragon_head":["minecraft:dragon_head","minecraft:dragon_wall_head"],"minecraft:player_head":["minecraft:player_head","minecraft:player_wall_head"],"minecraft:skeleton_skull":["minecraft:skeleton_skull","minecraft:skeleton_wall_skull"],"minecraft:wither_skeleton_skull":["minecraft:wither_skeleton_skull","minecraft:wither_skeleton_wall_skull"],"minecraft:dead_brain_coral_fan":["minecraft:dead_brain_coral_fan","minecraft:dead_brain_coral_wall_fan"],"minecraft:dead_bubble_coral_fan":["minecraft:dead_bubble_coral_fan","minecraft:dead_bubble_coral_wall_fan"],"minecraft:dead_fire_coral_fan":["minecraft:dead_fire_coral_fan","minecraft:dead_fire_coral_wall_fan"],"minecraft:dead_horn_coral_fan":["minecraft:dead_horn_coral_fan","minecraft:dead_horn_coral_wall_fan"],"minecraft:dead_tube_coral_fan":["minecraft:dead_tube_coral_fan","minecraft:dead_tube_coral_wall_fan"],"minecraft:torch":["minecraft:torch","minecraft:wall_torch"],"minecraft:soul_torch":["minecraft:soul_torch","minecraft:soul_wall_torch"],"minecraft:redstone_torch":["minecraft:redstone_torch","minecraft:redstone_wall_torch"],"minecraft:beetroot_seeds":["minecraft:beetroots"],"minecraft:carrot":["minecraft:carrots"],"minecraft:cocoa_beans":["minecraft:cocoa"],"minecraft:glow_berries":["minecraft:cave_vines"],"minecraft:melon_seeds":["minecraft:melon_stem"],"minecraft:potato":["minecraft:potatoes"],"minecraft:pumpkin_seeds":["minecraft:pumpkin_stem"],"minecraft:redstone":["minecraft:redstone_wire"],"minecraft:string":["minecraft:tripwire"],"minecraft:sweat_berries":["minecraft:sweat_berry_bush"],"minecraft:wheat_seeds":["minecraft:wheat"]};function Kx(r){return hL[r]}function Gx(r){if(r==="minecraft:armor_stand")return r;let e=r.match(/^minecraft:([a-z0-9_]+)_spawn_egg$/);if(e)return`minecraft:${e[1]}`}var dL={"::minecraft::block::banner::Banner.CustomName":"mcfunction:component","::minecraft::block::brewingstand::BrewingStand.CustomName":"mcfunction:component","::minecraft::block::commandblock::CommandBlock.Command":"mcfunction:command","::minecraft::block::commandblock::CommandBlock.CustomName":"mcfunction:component","::minecraft::block::container::ContainerBase.CustomName":"mcfunction:component","::minecraft::block::enchantingtable::EnchantingTable.CustomName":"mcfunction:component","::minecraft::block::furnace::Furnace.CustomName":"mcfunction:component","::minecraft::block::hopper::Hopper.CustomName":"mcfunction:component","::minecraft::block::sign::Sign.Text1":"mcfunction:component","::minecraft::block::sign::Sign.Text2":"mcfunction:component","::minecraft::block::sign::Sign.Text3":"mcfunction:component","::minecraft::block::sign::Sign.Text4":"mcfunction:component","::minecraft::entity::effectcloud::EffectCloud.Particle":"mcfunction:particle","::minecraft::entity::minecart::CommandMinecart.Command":"mcfunction:command","::minecraft::entity::mob::LivingEntity.Team":"mcfunction:team","::minecraft::entity::EntityBase.Tags[]":"mcfunction:tag","::minecraft::item::blockitem::BlockItem.CanPlaceOn[]":"mcfunction:block_predicate","::minecraft::item::book::WrittenBook.pages[]":"mcfunction:component","::minecraft::item::ItemBase.CanDestroy[]":"mcfunction:block_predicate"};function Zx(r){return dL[r]}function Jx(r,e,t={}){switch(r){case"custom:blockitemstates":let n=Kx(e);return n?cy(n,t):nr.noop;case"custom:blockstates":return cy([e],t);case"custom:spawnitemtag":let i=Gx(e);return i?Jx("entity_type",i,t):nr.noop;default:return(o,s)=>{}}}function pL(r,e={}){let t=r.lastIndexOf("::"),n=r.slice(0,t),i=r.slice(t+2),o={category:"mcdoc",path:[n,i]};return(s,a)=>{}}function cy(r,e={}){return(t,n)=>{let i=xo("block",r,n);for(let{key:o,value:s}of t.children)if(!(!o||!s)){if(s.type==="nbt:byte"&&(n.src.slice(s.range).toLowerCase()==="false"||n.src.slice(s.range).toLowerCase()==="true")){n.err.report(b("nbt.checker.block-states.fake-boolean"),s,2);continue}else if(s.type!=="string"&&s.type!=="nbt:int"){n.err.report(b("nbt.checker.block-states.unexpected-value-type"),s,2);continue}if(Object.keys(i).includes(o.value)){let a=i[o.value];a.includes(s.value.toString())||n.err.report(b("expected-got",a,q(s.value.toString())),s,2)}else n.err.report(b("nbt.checker.block-states.unknown-state",q(o.value),r),o,2)}}}function mL(r,e={}){return(t,n)=>{for(let{key:i,value:o}of t.children){if(!i||!o)continue;let s=i.value,a=r[s];a?(a.query.enter({usage:{type:"reference",node:i}}),Sh(a.data,e)(o,n)):e.allowUnknownKey||n.err.report(b("unknown-key",q(s)),i,2)}}}function gL(r,e={}){return r?(t,n)=>{}:nr.noop}function yL(r,e){return(t,n)=>{}}function Sh(r,e){let t=(i,[o,s])=>(o??-1/0)<=i&&i<=(s??1/0),n={boolean:"nbt:byte",byte:"nbt:byte",byte_array:"nbt:byte_array",double:"nbt:double",float:"nbt:float",int:"nbt:int",int_array:"nbt:int_array",list:"nbt:list",long:"nbt:long",long_array:"nbt:long_array",short:"nbt:short",string:"string",struct:"nbt:compound",tuple:"nbt:list"};return(i,o)=>{if(r.kind!=="any"&&r.kind!=="dispatcher"&&r.kind!=="enum"&&r.kind!=="literal"&&r.kind!=="reference"&&r.kind!=="union"&&i.type!==n[r.kind]){o.err.report(b("expected",Hr(n[r.kind])),i,2);return}switch(r.kind){case"boolean":i=i,i.value!==0&&i.value!==1&&o.err.report(b("nbt.checker.boolean.out-of-range",q("0b"),q("1b")),i,2);break;case"byte_array":case"int_array":case"long_array":if(i=i,r.lengthRange&&!t(i.children.length,r.lengthRange)&&o.err.report(b("expected",b("nbt.checker.collection.length-between",Hr(i.type),r.lengthRange[0]??"-\u221E",r.lengthRange[1]??"+\u221E")),i,2),r.valueRange)for(let{value:l}of i.children)l&&!t(Number(l.value),r.valueRange)&&o.err.report(b("number.between",r.valueRange[0]??"-\u221E",r.valueRange[1]??"+\u221E"),i,2);break;case"byte":case"short":case"int":case"long":case"float":case"double":i=i,r.valueRange&&!t(Number(i.value),r.valueRange)&&o.err.report(b("number.between",r.valueRange[0]??"-\u221E",r.valueRange[1]??"+\u221E"),i,2);break;case"dispatcher":i=i;break;case"list":i=i,r=$g(r),r.lengthRange&&!t(i.children.length,r.lengthRange)&&o.err.report(b("expected",b("nbt.checker.collection.length-between",Hr(i.type),r.lengthRange[0]??"-\u221E",r.lengthRange[1]??"+\u221E")),i,2);for(let{value:l}of i.children)l&&Sh(r.item,e)(l,o);break;case"string":i=i;let s="",a=i;if(wu.is(i.parent)&&bc.is(i.parent.parent)&&(s="[]",a=i.parent.parent),To.is(a.parent)){let l=a.parent.key?.symbol?.parentSymbol?.path.join("::"),c=a.parent.key?.value,f=`${l}.${c}${s}`,u=Zx(f);if(u)try{let h=o.meta.getParser(u),d=$o(h,i.value,i.valueMap,o);d!==oe&&(i.children=[d],d.parent=i)}catch(h){o.logger.error("[nbt.checker.fieldValue#string]",h)}}break;case"reference":i=i;break;case"union":r=xh(r),r.members.length===0?o.err.report(b("nbt.checker.compound.field.union-empty-members"),To.is(i.parent)?i.parent.key??i.parent:i,2):nr.any(r.members.map(l=>Sh(l,e)))(i,o);break}}}var Yx=({meta:r})=>{r.registerLanguage("nbt",{extensions:[".snbt"],parser:Ji}),r.registerParser("nbt:entry",Ji),r.registerParser("nbt:compound",Zi),r.registerParser("nbt:path",Kg),$x(r)};var _r;(function(r){function e(t,n){return Math.sign(Number(t.slice(2))-Number(n.slice(2)))}r.cmp=e})(_r||(_r={}));var uy={5:/^1\.15.*$/,6:/^1\.16.*$/,7:/^1\.17.*$/,8:/^1\.18(\.1)?$/,9:/^1\.18.*$/,10:/^1\.19.*$/},Ch;(function(r){function e(t){let n=t?.pack?.pack_format?.toString();if(!n)throw new Error("\u201Cpack.pack_format\u201D undefined");if(!Object.keys(uy).includes(n))throw new Error(`Unknown pack_format \u201C${n}\u201D`)}r.assert=e})(Ch||(Ch={}));function Xx(r,{packMcmeta:e,versions:t}){function n(i){i<0&&(i=0);let o=t[i];return{id:o.id,name:o.name,release:o.release_target,isLatest:i===0}}if(t.length===0)throw new Error("mcmeta version list is empty");if(r=r.toLowerCase(),t=t.sort((i,o)=>o.data_version-i.data_version),r==="auto"){if(e){let i=uy[e.pack.pack_format];if(i)return n(t.findIndex(o=>i.test(o.release_target)))}return n(0)}else{if(r==="latest release")return n(t.findIndex(i=>i.type==="release"));if(r==="latest snapshot")return n(t.findIndex(i=>i.type==="snapshot"))}return n(t.findIndex(i=>r===i.id.toLowerCase()||r===i.name.toLowerCase()))}var bL={fastly:"https://fastly.jsdelivr.net/gh/${user}/${repo}@${tag}/${path}",github:"https://raw.githubusercontent.com/${user}/${repo}/${tag}/${path}",jsdelivr:"https://cdn.jsdelivr.net/gh/${user}/${repo}@${tag}/${path}"};function Qx(r,e,t){let n=e?"summary":`${r}-summary`;function i(o){let a=(bL[t.toLowerCase()]??t).replace(/\${user}/g,"misode").replace(/\${repo}/g,"mcmeta").replace(/\${tag}/g,n).replace(/\${path}/g,o);if(!Pv.is(a))throw new Error(`Expected a remote URI from data source template but got ${a}`);return a}return{blocks:i("blocks/data.json.gz"),commands:i("commands/data.json.gz"),registries:i("registries/data.json.gz")}}function eS(r){let e="mcmeta://summary/registries.json";function t(i,o,s){let a=`${i[0].toUpperCase()}${i.slice(1)}`;for(let[l,[c,f]]of Object.entries(o)){let u=e;s.query(u,i,se.lengthen(l)).onEach(Object.entries(c),([h,d],m)=>{let y=f[h];m.member(`${u}#${a}_states`,h,g=>{g.enter({data:{subcategory:"state"},usage:{type:"declaration"}}).onEach(d,v=>{g.member(v,T=>{T.enter({data:{subcategory:"state_value"},usage:{type:"declaration"}}),v===y&&g.amend({data:{relations:{default:{category:i,path:T.path}}}})})})})})}}function n(i,o){function s(a){return $s.includes(a)||Jn.includes(a)}for(let[a,l]of Object.entries(i))if(s(a))for(let c of l)o.query(e,a,se.lengthen(c)).enter({usage:{type:"declaration"}})}return i=>{n(r.registries,i),t("block",r.blocks,i),t("fluid",r.fluids,i)}}var tS={flowing_lava:[{falling:["false","true"],level:["1","2","3","4","5","6","7","8"]},{falling:"false",level:"1"}],flowing_water:[{falling:["false","true"],level:["1","2","3","4","5","6","7","8"]},{falling:"false",level:"1"}],lava:[{falling:["false","true"]},{falling:"false"}],water:[{falling:["false","true"]},{falling:"false"}]};var Ah=15e3;async function rS(r,e){return e.download({id:"mc-je/versions.json.gz",uri:"https://raw.githubusercontent.com/misode/mcmeta/summary/versions/data.json.gz",transformer:t=>Am(r,t),cache:hy("misode","mcmeta","refs/heads/summary"),ttl:Ah})}async function nS(r,e,t,n,i,o,s={}){let a=iS({defaultBranch:"summary",getTag:g=>`${g}-summary`,isLatest:i,version:n}),l=Qx(n,i,o),c;async function f(g,v){if(v)try{let T=await ge.readJson(r,v.path);return v.replace?T:yl(g,T)}catch(T){t.error(`[je] [mcmeta-overrides] Failed loading customized mcmeta summary file \u201C${v.path}\u201D`,T)}return g}let u=async(g,v)=>{let T={},M=await e.download({id:`mc-je/${n}/${g}.json.gz`,uri:l[g],transformer:x=>Am(r,x),cache:hy("misode","mcmeta",a),ttl:Ah},T);return c||=T.checksum,f(M,v)},[h,d,m,y]=[await u("blocks",s.blocks),await u("commands",s.commands),await f(tS,s.fluids),await u("registries",s.registries)];return{blocks:h,commands:d,fluids:m,registries:y,checksum:c}}function iS({defaultBranch:r,getTag:e,isLatest:t,version:n}){return t?`refs/heads/${r}`:`refs/tags/${e(n)}`}var oS={headers:{Accept:"application/vnd.github.v3+json","User-Agent":"SpyglassMC"}};function hy(r,e,t){return{checksumExtension:".commit-sha",checksumJob:{uri:`https://api.github.com/repos/${r}/${e}/git/${t}`,transformer:n=>{let i=JSON.parse(Ir(n));if(Array.isArray(i))return i[0].object.sha;if(i.message===void 0)return i.object.sha;throw new Error(i.message)},options:oS,ttl:Ah}}}async function _L({defaultBranch:r,downloader:e,externals:t,getTag:n,repo:i,isLatest:o,owner:s,version:a}){let l=iS({defaultBranch:r,getTag:n,isLatest:o,version:a}),c={};return await e.download({id:`mc-je/${a}/${i}.tar.gz`,uri:`https://api.github.com/repos/${s}/${i}/tarball/${l}`,transformer:f=>f,cache:hy(s,i,l),options:oS,ttl:Ah},c),c.cacheUri}async function sS(r,e,t,n){return{info:{startDepth:1},uri:await _L({defaultBranch:"main",downloader:e,externals:r,getTag:i=>i,isLatest:n,owner:"SpyglassMC",repo:"vanila-mcdoc",version:t})}}var kL=(()=>{let r=new Set(["block","fluid","game_event","item","worldgen/block_placer_type","worldgen/surface_builder"]),e=new Map([["advancements",{category:"advancement",extname:".json"}],["dimension",{category:"dimension",extname:".json",since:"1.16"}],["dimension_type",{category:"dimension_type",extname:".json",since:"1.16"}],["functions",{category:"function",extname:".mcfunction"}],["item_modifiers",{category:"item_modifier",extname:".json",since:"1.17"}],["loot_tables",{category:"loot_table",extname:".json"}],["predicates",{category:"predicate",extname:".json"}],["recipes",{category:"recipe",extname:".json"}],["tags/blocks",{category:"tag/block",extname:".json"}],["tags/entity_types",{category:"tag/entity_type",extname:".json"}],["tags/fluids",{category:"tag/fluid",extname:".json"}],["tags/functions",{category:"tag/function",extname:".json"}],["tags/game_events",{category:"tag/game_event",extname:".json",since:"1.17"}],["tags/items",{category:"tag/item",extname:".json"}],["worldgen/biome",{category:"worldgen/biome",extname:".json",since:"1.16"}],["worldgen/configured_carver",{category:"worldgen/configured_carver",extname:".json",since:"1.16"}],["worldgen/configured_feature",{category:"worldgen/configured_feature",extname:".json",since:"1.16"}],["worldgen/configured_structure_feature",{category:"worldgen/configured_structure_feature",extname:".json",since:"1.16"}],["worldgen/configured_surface_builder",{category:"worldgen/configured_surface_builder",extname:".json",since:"1.16",until:"1.17"}],["worldgen/noise",{category:"worldgen/noise",extname:".json",since:"1.18"}],["worldgen/noise_settings",{category:"worldgen/noise_settings",extname:".json",since:"1.16"}],["worldgen/placed_feature",{category:"worldgen/placed_feature",extname:".json",since:"1.18"}],["worldgen/processor_list",{category:"worldgen/processor_list",extname:".json",since:"1.16"}],["worldgen/template_pool",{category:"worldgen/template_pool",extname:".json",since:"1.16"}]]);for(let t of Jn)r.has(t)||e.set(`tags/${t}`,{category:`tag/${t}`,extname:".json",since:"1.18"});return e})();function*wL(r,e){yield*ge.getRels(r,e);let t=r.split("/");for(let n=t.length-2;n>=0;n--)t[n]==="data"&&(yield t.slice(n).join("/"))}function ka(r,e){let t=/^data\/([^\/]+)\/((?:tags\/|worldgen\/)?[a-z_]+)\/(.*)(\.(?:mcfunction|json))$/,n=wL(r,e.roots);for(let i of n){let o=i.match(t);if(!o)continue;let s=kL.get(o[2]);if(!(!s||s.extname!==o[4])&&!!xL(e.project.loadedVersion,s.since,s.until))return{category:s.category,namespace:o[1],identifier:o[3]}}}var aS=(r,e)=>{for(let t of r){let n=ka(t,e);n&&e.symbols.query(t,n.category,`${n.namespace}:${n.identifier}`).enter({usage:{type:"definition"}})}};function xL(r,e,t){return!(e&&_r.cmp(r,e)<0||t&&_r.cmp(t,r)<0)}var SL=r=>[Je.create(r,"literal")],CL=r=>[Je.create(r,"literal")],AL=(r,e)=>{let t=[];for(let n of r.children)if(n.key&&t.push(Je.create(n.key,"property")),n.value){let i=e.meta.getColorizer(n.value.type);t.push(...i(n.value,e))}return t};function lS(r){r.registerColorizer("json:boolean",SL),r.registerColorizer("json:null",CL),r.registerColorizer("json:number",ot.number),r.registerColorizer("json:object",AL),r.registerColorizer("json:string",ot.string)}var vc={};dn(vc,{JsonStringOptions:()=>Th,array:()=>my,entry:()=>Yi,json:()=>hS,number:()=>dy,object:()=>py,string:()=>_c});var fS=(r,e)=>{let t=r.cursor;return r.trySkip("false")?{type:"json:boolean",range:k.create(t,r),value:!1}:r.trySkip("true")?{type:"json:boolean",range:k.create(t,r),value:!0}:oe};var uS=(r,e)=>{let t=r.cursor;return r.trySkip("null")?{type:"json:null",range:k.create(t,r)}:oe};var dy=(r,e)=>{let n=Mn({pattern:/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][-+]?\d+)?$/})(r,e);return n.type="json:number",n};var Th={escapable:{characters:["b","f","n","r","t"],unicode:!0},quotes:['"']},_c=(r,e)=>{let n=$t(Th)(r,e);return n.type="json:string",n};var py=(r,e)=>Oe("json:object",on({start:"{",pair:{key:_c,sep:":",value:Yi,end:",",trailingEnd:!1},end:"}"}))(r,e);var TL=new Set(["0","1","2","3","4","5","6","7","8","9","-"]);function hS(r=!1){return(e,t)=>{let n=Ae([{predicate:i=>i.tryPeek("["),parser:my},{predicate:i=>i.tryPeek("false")||i.tryPeek("true"),parser:fS},{predicate:i=>i.tryPeek("null"),parser:uS},{predicate:i=>TL.has(i.peek()),parser:dy},{predicate:i=>i.tryPeek("{"),parser:py},{parser:_c}])(e,t);return r&&t.err.dump(),n}}var Yi=hS(!0);var my=(r,e)=>{let n=ji({start:"[",value:Yi,sep:",",trailingSep:!1,end:"]"})(r,e);return n.type="json:array",n};var Oh;(function(r){function e(n){return Xt.is(n)||fn.is(n)||Ft.is(n)||Xo.is(n)||kc.is(n)||by.is(n)}r.is=e;function t(n){return r.is(n)||gy.is(n)||yy.is(n)}r.isRelated=t})(Oh||(Oh={}));var Yo;(function(r){function e(i){return i.type==="json:array"}r.isArray=e;function t(i){return i.type==="json:object"}r.isObject=t;function n(i){return i.type==="json:string"}r.isString=n})(Yo||(Yo={}));var Xt;(function(r){function e(n){return n?.type==="json:object"}r.is=e;function t(n){return{type:"json:object",range:k.get(n),children:[]}}r.mock=t})(Xt||(Xt={}));var gy;(function(r){function e(t){return t.type==="pair"}r.is=e})(gy||(gy={}));var fn;(function(r){function e(n){return n?.type==="json:array"}r.is=e;function t(n){return{type:"json:array",range:k.get(n),children:[]}}r.mock=t})(fn||(fn={}));var yy;(function(r){function e(t){return t.type==="item"}r.is=e})(yy||(yy={}));var Eh;(function(r){function e(t){return t.type==="json:string"}r.is=e})(Eh||(Eh={}));var Ft;(function(r){function e(n){return n?.type==="json:string"}r.is=e;function t(n){return I(w({},Yt.mock(n,Th)),{type:"json:string"})}r.mock=t})(Ft||(Ft={}));var Xo;(function(r){function e(t){return t.type==="json:number"}r.is=e})(Xo||(Xo={}));var kc;(function(r){function e(t){return t.type==="json:boolean"}r.is=e})(kc||(kc={}));var by;(function(r){function e(t){return t.type==="json:null"}r.is=e})(by||(by={}));var dS=[`
`,":",'"'],_y={"json:object":"{$1}","json:array":"[$1]","json:string":'"$1"',"json:boolean":"${1|false,true|}","json:number":"${1:0}"},OL=(r,e)=>xe.dispatch(r,e),EL=xe.record({key:(r,e,t,n,i,o)=>r.expectation?xc(r.expectation.filter(Yo.isObject).flatMap(s=>NL(n,r,s,t,i,o,e?.key?.value))):[],value:(r,e,t)=>e.value&&!k.isEmpty(e.value)?xe.dispatch(e.value,t):r.expectation?xc(r.expectation.filter(Yo.isObject).filter(n=>n.fields).map(n=>n.fields.find(i=>i.key===e.key?.value)).flatMap(n=>pS(t.offset,n.value,t))):[]}),RL=(r,e)=>{let t=$v(r.children,e.offset,(i,o)=>i.sep?k.compareOffset(k.translate(i,0,-1),o,!0):k.compareOffset(i.range,o,!0)),n=t>=0?r.children[t]:void 0;return n?.value?xe.dispatch(n.value,e):r.expectation&&k.contains(k.translate(r,1,-1),e.offset,!0)?xc(r.expectation.filter(Yo.isArray).filter(i=>i.items).flatMap(i=>pS(e.offset,i.items,e))):[]},ML=r=>["false","true"].map(e=>wc(r,e)),DL=(r,e)=>r.children?.length?xe.string(r,e):r.expectation?xc(r.expectation.filter(Yo.isString).flatMap(t=>vy(r,t,e))):[];function NL(r,e,t,n,i,o,s){return t.fields?t.fields.filter(a=>a.key===s||!e.children.find(l=>a.key===l.key?.value)).map(a=>PL(r,a,i,o)):t.keys?t.keys.flatMap(a=>vy(r,a,n).map(l=>w(w({},l),i?{insertText:`${l.insertText}: ${o?",":""}`}:{}))):[]}function PL(r,e,t,n){let i=e.value?.[0]?_y[e.value[0].type]:"";return Ie.create(e.key,r,{kind:10,detail:e.value?.map(o=>o.typedoc).join(" | "),sortText:`${e.deprecated?2:e.opt?1:0}${e.key}`,deprecated:e.deprecated,filterText:`"${e.key}"`,insertText:`"${e.key}"${t?`: ${i}`:""}${n?",":""}`})}function pS(r,e,t){return xc(e.flatMap(n=>{switch(n.type){case"json:object":case"json:array":return[wc(r,_y[n.type])];case"json:string":return vy(t.offset,n,t);case"json:boolean":return["false","true"].map(i=>wc(r,i));case"json:number":return[wc(r,"0")]}}))}function vy(r,e,t){return Array.isArray(e.pool)?e.pool.map(n=>Ie.create(n,r,{kind:12,filterText:`"${n}"`,insertText:`"${n}"`})):[wc(r,_y[e.type])]}function wc(r,e){return Ie.create(e.replace("$1",""),r,{kind:12,insertText:e})}function xc(r){let e=[],t=new Set;return r.forEach(n=>{t.has(n.label)||(t.add(n.label),e.push(n))}),e}function mS(r){r.registerCompleter("json:entry",OL),r.registerCompleter("json:array",RL),r.registerCompleter("json:boolean",ML),r.registerCompleter("json:object",EL),r.registerCompleter("json:string",DL)}var LL=(r,e)=>r.children.length===0?"[]":`[
${r.children.map(n=>{let i=n.value&&e.meta.getFormatter(n.value.type)(n.value,Gm(e));return`${e.indent(1)}${i??""}`}).join(`,
`)}
${e.indent()}]`,IL=(r,e)=>r.children.length===0?"{}":`{
${r.children.map(n=>{let i=n.key&&En.string(n.key,e),o=n.value&&e.meta.getFormatter(n.value.type)(n.value,Gm(e));return`${e.indent(1)}${i??""}: ${o??""}`}).join(`,
`)}
${e.indent()}}`;function yS(r){r.registerFormatter("json:array",LL),r.registerFormatter("json:boolean",En.boolean),r.registerFormatter("json:null",()=>"null"),r.registerFormatter("json:number",En.float),r.registerFormatter("json:object",IL),r.registerFormatter("json:string",En.string)}function P(r,e){r.expectation=[{type:"json:boolean",typedoc:"Boolean"}],kc.is(r)||e.err.report(b("expected",b("boolean")),r)}function _t(r){return(e,t)=>r()(e,t)}function V(r,e){return(t,n)=>{e(t,I(w({},n),{context:r}))}}function BL(r,e,t){let n=I(w({},t),{err:new jt,symbols:t.symbols.clone()});r(e,n);let i=e.expectation;return zt.undoChanges(e),{totalErrorSpan:n.err.errors.map(s=>s.range.end-s.range.start).reduce((s,a)=>s+a,0),maxSeverity:Math.max(...n.err.errors.map(s=>s.severity)),expectation:i,updateNodeAndCtx:()=>{t.err.absorb(n.err),zt.redoChanges(e),n.symbols.applyDelayedEdits()}}}function ie(r=[]){return(e,t)=>{if(r.length===0)return;let n=r.map(s=>BL(s,e,t)).sort((s,a)=>s.maxSeverity-a.maxSeverity||s.totalErrorSpan-a.totalErrorSpan),i=n.filter(s=>s.expectation?.map(a=>a.type).includes(e.type)),o=n.filter(s=>s.expectation).flatMap(s=>s.expectation);if(i.length===0){let s=o.map(a=>b(a.type.slice(5)));t.err.report(b("expected",Zn(s,!1)),e)}else i[0].updateNodeAndCtx();e.expectation=o}}function Sc(r,e){let t={type:"json:null",range:k.create(0)},n=I(w({},e),{err:new jt,depth:(e.depth??0)+1});return r(t,n),t.expectation}function R(r){return(e,t)=>{e.expectation=[{type:"json:array",typedoc:"Array"}],(!t.depth||t.depth<=0)&&(e.expectation[0].items=Sc(r,t)),fn.is(e)?e.children.filter(n=>n.value).forEach(n=>r(n.value,t)):t.err.report(b("expected",b("array")),e)}}function _S(r,e={}){let t=e.items??(i=>[Ft.is(i)?i.value:void 0,i]),n=e.report??((i,o)=>o.err.report(b("json.checker.item.duplicate"),i,2));return(i,o)=>{if(R(r)(i,o),fn.is(i)){let s=new Map,a=new Set;i.children.forEach(l=>{if(!l.value)return;let[c,f]=t(l.value);if(!c)return;let u=s.get(c);u&&(a.add(u),a.add(f)),s.set(c,f)}),a.forEach(l=>n(l,o))}}}var Rh=r=>(e,t)=>(n,i)=>{let o="Number"+(e===void 0&&t===void 0?"":`(${e??"-\u221E"}, ${t??"+\u221E"})`);n.expectation=[{type:"json:number",typedoc:o}],!Xo.is(n)||r==="integer"&&!Number.isInteger(n.value)?i.err.report(b("expected",b(r)),n):e!==void 0&&t!==void 0&&(n.value<e||n.value>t)?i.err.report(b("expected",b("number.between",e,t)),n):e!==void 0&&n.value<e?i.err.report(b("expected",b("number.>=",e)),n):t!==void 0&&n.value>t&&i.err.report(b("expected",b("number.<=",t)),n)},B=Rh("integer")(void 0,void 0),re=Rh("float")(void 0,void 0),E=Rh("integer"),W=Rh("float");function lr(r){return r?.checker!==void 0}function Ye(r,e,t={}){return(n,i)=>{if(n.expectation=[{type:"json:object",typedoc:"Object"}],!i.depth||i.depth<=0)if(Array.isArray(r)&&e){let o=r.map(s=>[s,e(s,i)]).filter(([s,a])=>a!==void 0);n.expectation[0].fields=o.map(([s,a])=>w(w({key:s,value:Sc(lr(a)?a.checker:a,i)},lr(a)&&(a.opt||a.deprecated)?{opt:!0}:{}),lr(a)&&a.deprecated?{deprecated:!0}:{}))}else typeof r=="function"&&e&&(n.expectation[0].keys=Sc(r,i)?.filter(Eh.is));if(!Xt.is(n))i.err.report(b("expected",b("object")),n);else if(Array.isArray(r)&&e){let o=n.children.map(s=>s.key?.value);r.forEach(s=>{let a=e(s,i);!a||lr(a)&&(a.opt||a.deprecated)||o.includes(s)||i.err.report(b("json.checker.property.missing",q(s)),k.create(n.range.start,n.range.start+1))}),n.children.filter(s=>s.key).forEach(s=>{let a=s.key.value,l=e(a,i);if(!l||!r.includes(a)){t.allowUnknownProperties||i.err.report(b("json.checker.property.unknown",q(a)),s.key,2);return}lr(l)&&l.deprecated&&i.err.report(b("json.checker.property.deprecated",q(a)),s.key,0,{deprecated:!0});let c=i.context+(lr(l)&&l.context?`.${l.context}`:""),f=b(`json.doc.${c}`),u=s.value!==void 0?s.value:{type:"json:null",range:k.create(0)},h=lr(l)?l.checker:l;try{h(u,I(w({},i),{context:`${c}.${a}`}))}catch(y){let g=i.doc.positionAt(s.range.start);i.logger.error(`Checking "${a}" at ${g.line}:${g.character} in "${i.doc.uri}"`,y)}let d=lr(l)?l.def:void 0,m=u.expectation?.map(y=>y.typedoc).join(" | ");s.key.hover=`\`\`\`typescript
${c}.${a}: ${m}
\`\`\`${f||d!==void 0?`
******
 `:""}${f}${d!==void 0?`
\`@default\` ${JSON.stringify(d)}`:""}`})}else typeof r=="function"&&e&&n.children.filter(o=>o.key).forEach(o=>{if(r(o.key,i),o.value!==void 0){let s=e(o.key.value,i);s&&(lr(s)?s.checker:s)(o.value,i)}})}}function C(r,e){return Ye(Object.keys(r),t=>r[t],e)}function p(r,e){if(r!==void 0)return lr(r)?I(w({},r),{opt:!0,def:e}):{checker:r,opt:!0,def:e}}function vS(r){if(r!==void 0)return lr(r)?I(w({},r),{deprecated:!0}):{checker:r,deprecated:!0}}function Q(r,e){return(t,n)=>{if(!Xt.is(t))n.err.report(b("expected",b("object")),t);else if(e){let i=t.children.findIndex(a=>a.key?.value===r),o=t.children[i],s=o?.value?.type==="json:string"?o.value.value:void 0;e(s,t.children,n)(t,n)}else r(t.children,n)(t,n)}}function he(r,e){if(r===void 0)return{};let t=e[se.shorten(r)];return t===void 0?{}:(Object.keys(t).forEach(n=>{let i=t[n];i!==void 0&&(t[n]={checker:lr(i)?i.checker:i,opt:lr(i)?i.opt:void 0,deprecated:lr(i)?i.deprecated:void 0,context:se.shorten(r)})}),t)}function Wr(r,e,t,n={}){return r===void 0?{}:e.includes(se.shorten(r))?t:n}function Xe(r,e){let t=e?.find(n=>n.key?.value===r);return t?.value?.type==="json:string"?t.value.value:void 0}function kS(r,e,t){let n=t?.find(o=>o.key?.value===r);if(n?.value?.type!=="json:object")return;let i=n.children?.find(o=>o.key?.value===e);return i?.type==="json:string"?i.value:void 0}function Mh(r,e){let t=e?.find(n=>n.key?.value===r);return t?.value?.type==="json:array"&&t.value.children?.every(n=>n.value?.type==="json:string")?t.value.children.map(n=>n.value.value):void 0}function ky(r,e,t){let n=new Set(Xt.is(r)?r.children.map(s=>s.key?.value):[]),i=Object.keys(t).find(s=>n.has(s));if(i===void 0)return e.err.report(b("json.checker.property.missing",Object.keys(t)),k.create(r.range.start,r.range.start+1)),Object.fromEntries(Object.entries(t).map(([s,a])=>[s,p(typeof a=="function"?ie():a[s]??ie())]));let o=t[i];return typeof o=="function"?o():o}function S(r,e=!1){return Rt(r,et(typeof r=="string"?{category:r,allowTag:e}:{pool:r.map(se.lengthen)}),nr.resourceLocation)}function J(r){return typeof r=="string"?Rt(r,fa(r)):Rt(r,it(...r))}function Rt(r,e,t,n){return(i,o)=>{if(i.expectation=[w({type:"json:string",typedoc:zL(r)},n)],!Ft.is(i))o.err.report(b("expected",b("string")),i);else if(e){let s=$o(xi.resolve(e),i.value,i.valueMap,o);s!==oe&&(i.children=[s],s.parent=i,t&&xi.resolve(t)(s,o))}else t&&xi.resolve(t)(i,o)}}function zL(r){return r?typeof r=="string"?`String("${r}")`:r.slice(0,10).map(e=>`"${e}"`).join(" | ")+(r.length>10?" | ...":""):"String"}var fe=Rt();var wS=({meta:r})=>{r.registerLanguage("json",{extensions:[".json",".mcmeta"],triggerCharacters:dS,parser:Yi}),r.registerParser("json:entry",Yi),lS(r),mS(r),yS(r)};function wy(r){return(e,t)=>{if(!t.ensureChecked){fe(e,t);return}let n=Object.values(t.symbols.query(t.doc,"advancement",r).symbol?.members??{}).filter(i=>i?.subcategory==="criterion").map(i=>i.identifier);J(n)(e,t)}}function $L(r,e,t){return t.symbols.query(t.doc,r,se.lengthen(e)).symbol?.definition?.map(n=>n.uri)??[]}function ii(r,e,t){let n=o=>Ft.is(o)?o.value:o.children.find(s=>s.key?.value==="id").value.value;return[...$L(r,e,t).reduce((o,s)=>{let a=t.getDocAndNode(s);if(!a||a.node.parserErrors.length||a.node.checkerErrors?.length)return o;let l=a.node.children[0],c=l.children.find(d=>d.key?.value==="replace")?.value,f=l.children.find(d=>d.key?.value==="values")?.value,u=c?.value,h=f.children.map(d=>se.lengthen(n(d.value)));u&&(o=new Set);for(let d of h)o.add(d);return o},new Set)]}function Bn({category:r,id:e,ids:t,tag:n,mixedTypes:i,requireAll:o}){return(s,a)=>{if(n?t=ii(`tag/${r??"block"}`,n,a):e&&(t=[e]),!t?.length||!a.ensureChecked){let c=i?ie([P,fe,xS()]):fe;Ye(fe,()=>o?c:p(c))(s,a);return}let l=xo(r??"block",t,a);Ye(Object.keys(l),c=>{let f=l[c]??[],u=[J(f)];i&&f.length&&(["true","false"].includes(f[0])?u.push(P):f[0].match(/^\d+$/)&&u.push(xS(parseInt(f[0]),parseInt(f[f.length-1]))));let h=u.length>1?ie(u):u[0];return o?h:p(h)})(s,a)}}function SS({category:r,id:e,ids:t,tag:n}){return(i,o)=>{if(n?t=ii(`tag/${r??"block"}`,n,o):e&&(t=[e]),!t?.length||!o.ensureChecked){R(fe)(i,o);return}let s=xo(r??"block",t,o);R(J(Object.keys(s)))(i,o)}}function xS(r=void 0,e=void 0){return ie([E(r,e),C({min:p(E(r,e)),max:p(E(r,e))})])}function CS(){let r=/^[0-9a-f]{1,6}$/i,e=(t,n)=>{let i=0,o=t.cursor;if(t.trySkip("#")){let s=t.readRemaining();s.match(r)?i=parseInt(s,16):n.err.report(b("expected",b("json.checker.string.hex-color")),k.create(o,t))}else{let s=t.readRemaining();At.NamedColors.has(s)?i=At.NamedColors.get(s):n.err.report(b("expected",At.ColorNames),k.create(o,t))}return At.fromCompositeInt(i)};return(t,n)=>{if(t.expectation=[{type:"json:string",typedoc:'String("Color")',pool:At.ColorNames}],!Ft.is(t))n.err.report(b("expected",b("string")),t);else{let i=$o(e,t.value,t.valueMap,n);i!==oe&&(t.color={value:i,format:[ir.HexRGB],range:{start:t.range.start+1,end:t.range.end-1}})}}}function Qo(){return(r,e)=>{!Xo.is(r)||!Number.isInteger(r.value)?e.err.report(b("expected",b("integer")),r):r.color={value:At.fromCompositeInt(r.value),format:[ir.CompositeInt]}}}function qr(r){return FL(r)?VL(r):UL(r)}function FL(r){return typeof r.definition=="string"}function VL({definition:r}){return(e,t)=>{if(!t.ensureChecked){fe(e,t);return}let n=t.meta.getParserLazily("nbt:compound"),i=Et.definition(r);Rt("nbt",n,i)(e,t)}}function UL(r){return(e,t)=>{let n=AS(r,t);if(!t.ensureChecked){fe(e,t);return}let i=t.meta.getParser("nbt:compound"),o=Et.index(r.registry,n);Rt("nbt",i,o)(e,t)}}function es(r){return(e,t)=>{let n=AS(r,t);if(!t.ensureChecked){fe(e,t);return}let i=t.meta.getParser("nbt:path"),o=Et.path(r.registry,n);Rt("nbt_path",i,o)(e,t)}}function AS({registry:r,id:e,idOrTag:t,ids:n,tag:i},o){return t&&(t.startsWith("#")?i=t.slice(1):e=t),i&&(r==="block"||r==="item"||r==="entity_type")?n=ii(`tag/${r}`,i,o):e&&(n=[e]),n?.map(se.lengthen)}var TS=Rt("recipe_group",fa("recipe_group"));function OS(r){return[...new Set((r.find(e=>e.key?.value==="pattern"&&e.value?.type==="json:array")?.value?.children??[]).map(e=>e.value).filter(e=>e&&e.type==="json:string").flatMap(e=>[...e.value]).filter(e=>e!==" "))]}var HL=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,Ac=Rt(void 0,void 0,(r,e)=>{r.value.match(HL)||e.err.report(b("expected",b("uuid")),r)});function WL(r){return r.project.loadedVersion}function xy(r,e){return _r.cmp(WL(r),e)}function O(r,e,t,n){if(typeof e=="string"){let i=xy(r,e)>=0;return t===void 0?t:Array.isArray(t)?i?t:[]:i?t:void 0}else{let i=xy(r,t)<0;return e===void 0?e:Array.isArray(e)?i?e:n??[]:i?e:n??void 0}}function ES(r,e,t,n,i){return O(r,{[e]:i},t,{[n]:i})}function vr(r,e,t){return xy(r,e)<0?t:vS(t)}function qL(r){return r=r-1,r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r+1}var KL=64-2*(1+Math.log2(qL(3e7))),Nh=(1<<KL)-32,Dh=(Nh>>1)-1,Sy=Dh-Nh+1,Ut=V("range",ie([re,Q("type",r=>C(w(w({type:p(S("loot_number_provider_type"))},r===void 0?{min:Ut,max:Ut}:{}),he(r,{constant:{value:re},uniform:{min:Ut,max:Ut},binomial:{n:Ut,p:Ut},score:{target:GL,score:J("objective"),scale:p(re)}}))))])),GL=ie([J(["this","killer","player_killer","direct_killer"]),Q("type",r=>C(w({type:S("loot_score_provider_type")},he(r,{context:{target:J(["this","killer","player_killer","direct_killer"])},fixed:{name:fe}}))))]),RS=ie([J(["this","killer","killer_player","block_entity"]),Q("type",r=>C(w({type:S("loot_nbt_provider_type")},he(r,{context:{target:J(["this","killer","killer_player","block_entity"])},storage:{source:S("storage")}}))))]),He=V("bounds",ie([B,ie([C({min:B,max:p(B)}),C({min:p(B),max:B})])])),Mt=V("bounds",ie([re,ie([C({min:re,max:p(re)}),C({min:p(re),max:re})])])),te=V("block_state",Q(r=>C({Name:S("block"),Properties:p(Bn({id:Xe("Name",r),requireAll:!0}))}))),MS=V("fluid_state",Q(r=>C({Name:S("fluid"),Properties:p(Bn({id:Xe("Name",r),category:"fluid",requireAll:!0}))}))),Vt=V("vertical_anchor",ie([C({absolute:E(Sy,Dh)}),C({above_bottom:E(Sy,Dh)}),C({below_top:E(Sy,Dh)})])),Xi=V("height_provider",ie([Vt,Q("type",r=>C(w({type:S("height_provider_type")},he(r,{constant:{value:Vt},uniform:{min_inclusive:Vt,max_inclusive:Vt},biased_to_bottom:{min_inclusive:Vt,max_inclusive:Vt,inner:p(E(1,void 0),1)},very_biased_to_bottom:{min_inclusive:Vt,max_inclusive:Vt,inner:p(E(1,void 0),1)},trapezoid:{min_inclusive:Vt,max_inclusive:Vt,plateau:p(B,0)},weighted_list:{distribution:R(C({data:_t(()=>Xi),weight:B}))}}))))])),Ht=(r=void 0,e=void 0)=>V("float_provider",ie([W(r,e),Q("type",t=>C(w({type:S("float_provider_type")},he(t,{constant:{value:W(r,e)},uniform:{value:C({min_inclusive:W(r,e),max_exclusive:W(r,e)})},clamped_normal:{value:C({mean:re,deviation:re,min:W(r,e),max:W(r,e)})},trapezoid:{value:C({min:W(r,e),max:W(r,e),plateau:re})}}))))])),_e=(r=void 0,e=void 0)=>V("int_provider",ie([E(r,e),Q("type",t=>C(w({type:S("int_provider_type")},he(t,{constant:{value:E(r,e)},uniform:{value:C({min_inclusive:E(r,e),max_inclusive:E(r,e)})},biased_to_bottom:{value:C({min_inclusive:E(r,e),max_inclusive:E(r,e)})},clamped:{value:C({min_inclusive:E(r,e),max_inclusive:E(r,e),source:_t(()=>_e())})},clamped_normal:{value:C({mean:re,deviation:re,min_inclusive:E(r,e),max_inclusive:E(r,e)})},weighted_list:{distribution:R(C({data:_t(()=>_e()),weight:B}))}}))))])),kr=(r,e,t)=>V("uniform_int",ie([E(r,e),C({base:E(r,e),spread:E(0,t)})])),DS=(r,e)=>V("inclusive_range",ie([C({min_inclusive:E(r,e),max_inclusive:E(r,e)}),R(E(r,e))])),Qi=C({firstOctave:B,amplitudes:R(re)}),eo=["MOTION_BLOCKING","MOTION_BLOCKING_NO_LEAVES","OCEAN_FLOOR","OCEAN_FLOOR_WG","WORLD_SURFACE","WORLD_SURFACE_WG"],Tc=["mainhand","offhand","head","chest","legs","feet"],Ph=["up","down","north","east","south","west"];var ZL=["key.jump","key.sneak","key.sprint","key.left","key.right","key.back","key.forward","key.attack","key.pickItem","key.use","key.drop","key.hotbar.1","key.hotbar.2","key.hotbar.3","key.hotbar.4","key.hotbar.5","key.hotbar.6","key.hotbar.7","key.hotbar.8","key.hotbar.9","key.inventory","key.swapOffhand","key.loadToolbarActivator","key.saveToolbarActivator","key.playerlist","key.chat","key.command","key.socialInteractions","key.advancements","key.spectatorOutlines","key.screenshot","key.smoothCamera","key.fullscreen","key.togglePerspective"],JL=V("text_component",(r,e)=>C(I(w({},ky(r,e,{text:{text:fe},translate:{translate:fe,with:p(R(vt),[])},selector:{selector:fe,separator:p(O(e,"1.17",vt))},score:{score:C({name:fe,objective:fe,value:p(fe)})},keybind:{keybind:J(ZL)},nbt:()=>I(w({nbt:fe},ky(r,e,{block:{block:fe,nbt:es({registry:"block"})},entity:{entity:fe,nbt:es({registry:"entity_type"})},storage:{storage:S("storage"),nbt:es({registry:"storage"})}})),{interpret:p(P,!1),separator:p(O(e,"1.17",vt))})})),{color:p(CS()),font:p(fe),bold:p(P),italic:p(P),underlined:p(P),strikethrough:p(P),obfuscated:p(P),insertion:p(fe),clickEvent:p(Q("action",t=>C(w({action:J(["open_url","open_file","run_command","suggest_command","change_page","copy_to_clipboard"]),value:fe},he(t,{run_command:{value:Rt("command",e.meta.getParserLazily("mcfunction:command"),e.meta.getChecker("mcfunction:command"))},change_page:{value:Rt("number",nn({pattern:/\d+/,min:0}))}}))))),hoverEvent:p(Q("action",(t,n,i)=>C(w({action:J(["show_text","show_item","show_entity"])},he(t,{show_text:{value:vr(i,"1.16",vt),contents:p(O(i,"1.16",vt))},show_item:{value:vr(i,"1.16",qr({definition:"::minecraft::util::invitem::InventoryItem"})),contents:p(O(i,"1.16",Q(o=>C({id:S("item"),count:p(B),tag:p(qr({registry:"item",id:Xe("id",o)}))}))))},show_entity:{value:vr(i,"1.16",C({name:p(fe),type:p(S("entity_type")),id:p(Ac)})),contents:p(O(i,"1.16",C({name:p(vt),type:p(S("entity_type")),id:p(Ac)})))}}))))),extra:p(R(vt))}))(r,e)),vt=V("text_component",ie([fe,JL,R(_t(()=>vt))]));var YL=["empty","chest","command","selector","fishing","entity","gift","barter","advancement_reward","advancement_entity","generic","block"],XL=["mansion","monument","player","frame","red_marker","blue_marker","target_x","target_point","player_off_map","player_off_limits","red_x","banner_white","banner_orange","banner_magenta","banner_light_blue","banner_yellow","banner_lime","banner_pink","banner_gray","banner_light_gray","banner_cyan","banner_purple","banner_blue","banner_brown","banner_green","banner_red","banner_black"],oi=V("predicate",Q("condition",(r,e)=>C(w({condition:S("loot_condition_type")},he(r,{alternative:{terms:R(oi)},block_state_property:{block:S("block"),properties:Bn({id:Xe("block",e)})},damage_source_properties:{predicate:Rc},entity_properties:{entity:J(["this","killer","killer_player","direct_killer"]),predicate:we},entity_scores:{entity:J(["this","killer","killer_player","direct_killer"]),scores:Ye(J("objective"),()=>He)},inverted:{term:oi},killed_by_player:{inverse:p(P,!1)},location_check:{offsetX:p(B,0),offsetY:p(B,0),offsetZ:p(B,0),predicate:Qt},match_tool:{predicate:kt},random_chance:{chance:W(0,1)},random_chance_with_looting:{chance:W(0,1),looting_multiplier:re},reference:{name:S("predicate")},table_bonus:{enchantment:S("enchantment"),chances:R(W(0,1))},time_check:{value:He,period:p(B)},value_check:{value:Ut,range:He},weather_check:{raining:p(P),thundering:p(P)}}))))),NS=ie([oi,R(oi)]),Ec=V("item_modifier",Q("function",(r,e,t)=>C(I(w({function:S("loot_function_type")},he(r,{apply_bonus:w({enchantment:S("enchantment"),formula:S(["binomial_with_bonus_count","ore_drops","uniform_bonus_count"])},he(Xe("formula",e),{binomial_with_bonus_count:{parameters:C({extra:re,probability:W(0,1)})},uniform_bonus_count:{parameters:C({bonusMultiplier:re})}})),copy_name:{source:J(["this","killer","killer_player","block_entity"])},copy_nbt:{source:RS,ops:R(C({source:es({registry:"entity_type"}),target:es({registry:"item"}),op:J(["replace","append","merge"])}))},copy_state:{block:S("block"),properties:SS({id:Xe("block",e)})},enchant_randomly:{enchantments:p(R(S("enchantment")))},enchant_with_levels:{levels:Ut,treasure:p(P,!1)},exploration_map:{destination:p(S("worldgen/structure_feature"),"buried_treasure"),decoration:p(J(XL),"mansion"),zoom:p(B,2),search_radius:p(B,50),skip_existing_chunks:p(P,!0)},fill_player_head:{entity:J(["this","killer","killer_player","direct_killer"])},limit_count:{limit:He},looting_enchant:{count:Ut,limit:p(B,0)},set_attributes:{modifiers:R(C({attribute:S("attribute"),name:fe,operation:J(["addition","multiply_base","multiply_total"]),id:p(Ac),amount:Ut,slot:ie([J(Tc),R(J(Tc))])}))},set_contents:{type:O(t,"1.18",S("block_entity_type")),entries:R(Oc)},set_count:{count:Ut,add:p(O(t,"1.17",P),!1)},set_damage:{damage:Ut,add:p(O(t,"1.17",P),!1)},set_loot_table:{name:S("loot_table"),seed:p(B,0)},set_lore:{entity:p(J(["this","killer","killer_player","direct_killer"])),lore:R(vt),replace:p(P,!1)},set_name:{entity:p(J(["this","killer","killer_player","direct_killer"])),name:p(vt)},set_nbt:{tag:qr({registry:"item"})},set_potion:{id:S("potion")},set_stew_effect:{effects:p(R(C({type:S("mob_effect"),duration:Ut})),[])}})),{conditions:p(R(oi))})))),PS=ie([Ec,R(Ec)]),Oc=V("loot_entry",Q("type",r=>C(I(w({type:S("loot_pool_entry_type"),weight:p(E(1,void 0),1),quality:p(B,0)},he(r,{alternatives:{children:R(Oc)},dynamic:{name:S(["contents"])},group:{children:R(Oc)},item:{name:S("item")},loot_table:{name:S("loot_table")},sequence:{children:R(Oc)},tag:{name:S("tag/item"),expand:P}})),{functions:p(R(Ec),[]),conditions:p(R(oi),[])})))),QL=V("loot_pool",C({rolls:Ut,bonus_rolls:p(Ut,0),entries:R(Oc),functions:p(R(Ec),[]),conditions:p(R(oi),[])})),LS=V("loot_table",C({type:p(S(YL)),pools:p(R(QL),[]),functions:p(R(Ec),[])}));var eI=r=>["minecraft:bee_nest_destroyed","minecraft:bred_animals","minecraft:brewed_potion","minecraft:changed_dimension","minecraft:channeled_lightning","minecraft:construct_beacon","minecraft:consume_item","minecraft:cured_zombie_villager","minecraft:effects_changed","minecraft:enchanted_item","minecraft:enter_block","minecraft:entity_hurt_player","minecraft:entity_killed_player",...O(r,"1.18",["minecraft:fall_from_height"]),"minecraft:filled_bucket","minecraft:fishing_rod_hooked","minecraft:hero_of_the_village","minecraft:impossible","minecraft:inventory_changed","minecraft:item_durability_changed",...O(r,"1.16",["minecraft:item_used_on_block"]),"minecraft:killed_by_crossbow","minecraft:levitation",...O(r,"1.17",["minecraft:lightning_strike"]),"minecraft:location","minecraft:nether_travel","minecraft:placed_block",...O(r,"1.16",["minecraft:player_generates_container_loot"]),"minecraft:player_hurt_entity",...O(r,"1.16",["minecraft:player_interacted_with_entity"]),"minecraft:player_killed_entity","minecraft:recipe_unlocked",...O(r,"1.18",["minecraft:ride_entity_in_lava"]),"minecraft:shot_crossbow",...O(r,["minecraft:safely_harvest_honey"],"1.16"),"minecraft:slept_in_bed","minecraft:slide_down_block",...O(r,"1.17",["minecraft:started_riding"]),"minecraft:summoned_entity","minecraft:tame_animal",...O(r,"1.16",["minecraft:target_hit"]),"minecraft:tick",...O(r,"1.16",["minecraft:thrown_item_picked_up_by_entity"]),"minecraft:used_ender_eye","minecraft:used_totem",...O(r,"1.17",["minecraft:using_item"]),"minecraft:villager_trade","minecraft:voluntary_exile"],kt=V("item",Q((r,e)=>C(I(w({},O(e,{item:p(S("item"))},"1.17",{items:p(R(S("item")))})),{tag:p(S("tag/item")),count:p(He),durability:p(Mt),potion:p(S("potion")),nbt:p(qr({registry:"item",ids:Mh("items",r),tag:Xe("tag",r)})),enchantments:p(R(C({enchantment:p(S("enchantment")),levels:p(He)})))})))),BS=V("block",Q((r,e)=>C(I(w({},O(e,{block:p(S("block"))},"1.17",{blocks:p(R(S("block")))})),{tag:p(S("tag/block")),nbt:p(qr({registry:"block",ids:Mh("blocks",r),tag:Xe("tag",r)})),state:p(Bn({ids:Mh("blocks",r),tag:Xe("tag",r),mixedTypes:!0}))})))),zS=V("fluid",Q(r=>C({fluid:p(S("fluid")),tag:p(S("tag/fluid")),state:p(Bn({category:"fluid",id:Xe("fluid",r),tag:Xe("tag",r),mixedTypes:!0}))}))),Qt=V("location",Q((r,e)=>C({position:p(C({x:p(Mt),y:p(Mt),z:p(Mt)})),biome:p(S("worldgen/biome")),feature:p(fe),dimension:p(S("dimension")),block:p(BS),fluid:p(zS),light:p(C({light:He})),smokey:p(O(e,"1.16",P))}))),Mc=V("distance",C({x:p(Mt),y:p(Mt),z:p(Mt),absolute:p(Mt),horizontal:p(Mt)})),jS=V("mob_effect",C({amplifier:p(He),duration:p(He),ambient:p(P),visible:p(P)})),tI=V("statistic",Q("type",r=>C(I(w({type:S("stat_type")},he(r,{mined:{stat:S("block")},crafted:{stat:S("item")},used:{stat:S("item")},broken:{stat:S("item")},picked_up:{stat:S("item")},dropped:{stat:S("item")},killed:{stat:S("entity_type")},killed_by:{stat:S("entity_type")},custom:{stat:S("custom_stat")}})),{value:He})))),rI=V("player",Q((r,e)=>C({gamemode:p(J(["survival","adventure","creative","spectator"])),level:p(He),advancements:p(Ye(S("advancement"),t=>ie([P,Ye(wy(t),()=>P)]))),recipes:p(Ye(S("recipe"),()=>P)),stats:p(R(tI)),looking_at:p(O(e,"1.17",_t(()=>we)))}))),we=V("entity",Q((r,e)=>C({type:p(S("entity_type",!0)),nbt:p(qr({registry:"entity_type",idOrTag:Xe("type",r)})),team:p(J("team")),location:p(Qt),stepping_on:p(O(e,"1.17",Qt)),distance:p(Mc),flags:p(C({is_on_fire:p(P),is_sneaking:p(P),is_sprinting:p(P),is_swimming:p(P),is_baby:p(P)})),equipment:p(Ye(J(Tc),()=>kt)),effects:p(Ye(fe,()=>jS)),player:p(rI),vehicle:p(O(e,"1.16",_t(()=>we))),passenger:p(O(e,"1.17",_t(()=>we))),targeted_entity:p(O(e,"1.16",_t(()=>we))),lightning_bolt:p(O(e,"1.17",C({blocks_set_on_fire:p(He),entity_struck:p(_t(()=>we))}))),fishing_hook:p(O(e,"1.16",C({in_open_water:p(P)}))),catType:p(fe)}))),Rc=V("damage_source",C({is_explosion:p(P),is_fire:p(P),is_magic:p(P),is_projectile:p(P),is_lightning:p(P),bypasses_armor:p(P),bypasses_invulnerability:p(P),bypasses_magic:p(P),source_entity:p(we),direct_entity:p(we)})),IS=V("damage",C({dealt:p(He),taken:p(He),blocked:p(P),source_entity:p(we),type:p(Rc)})),tt=ie([we,R(_t(()=>oi))]),nI=V("criterion",Q("trigger",(r,e,t)=>C({trigger:S(eI(t)),conditions:p(Q(n=>C(w(w(w({},O(t,"1.16",Wr(r,["impossible"],{},{player:p(O(t,we,"1.16",tt))}))),he(r,{bee_nest_destroyed:{block:p(S("block")),item:p(kt),num_bees_inside:p(B)},bred_animals:{parent:p(O(t,we,"1.16",tt)),partner:p(O(t,we,"1.16",tt)),child:p(O(t,we,"1.16",tt))},brewed_potion:{potion:p(S("potion"))},changed_dimension:{from:p(S("dimension")),to:p(S("dimension"))},channeled_lightning:{victims:p(R(O(t,we,"1.16",tt)))},construct_beacon:{level:p(He)},consume_item:{item:p(kt)},cured_zombie_villager:{villager:p(O(t,we,"1.16",tt)),zombie:p(O(t,we,"1.16",tt))},effects_changed:{effects:p(Ye(S("mob_effect"),()=>jS)),source:p(O(t,we,"1.16",tt))},enter_block:{block:p(S("block")),state:p(Bn({id:Xe("block",n)}))},enchanted_item:{levels:p(He),item:p(kt)},entity_hurt_player:{damage:p(IS)},entity_killed_player:{entity:p(O(t,we,"1.16",tt)),killing_blow:p(Rc)},fall_from_height:{start_position:p(Qt),distance:p(Mc)},filled_bucket:{item:p(kt)},fishing_rod_hooked:{entity:p(O(t,we,"1.16",tt)),item:p(kt)},hero_of_the_village:{location:p(O(t,"1.16",Qt))},inventory_changed:{slots:p(C({empty:p(He),occupied:p(He),full:p(He)})),items:p(R(kt))},item_durability_changed:{delta:p(Mt),durability:p(Mt),item:p(kt)},item_used_on_block:{item:p(kt),location:p(Qt)},killed_by_crossbow:{unique_entity_types:p(He),victims:p(R(O(t,we,"1.16",tt)))},levitation:{distance:p(Mc),duration:p(Mt)},lightning_strike:{lightning:p(O(t,we,"1.16",tt)),bystander:p(O(t,we,"1.16",tt))},location:{location:p(O(t,"1.16",Qt))},nether_travel:I(w({},O(t,{entered:p(Qt)},"1.18",{start_position:p(Qt)})),{exited:p(O(t,Qt,"1.18")),distance:p(Mc)}),placed_block:{block:p(S("block")),state:p(Bn({id:Xe("block",n)})),item:p(kt),location:p(Qt)},player_generates_container_loot:{loot_table:S("loot_table")},player_hurt_entity:{damage:p(IS),entity:p(O(t,we,"1.16",tt))},player_interacted_with_entity:{item:p(kt),entity:p(O(t,we,"1.16",tt))},player_killed_entity:{entity:p(O(t,we,"1.16",tt)),killing_blow:p(Rc)},recipe_unlocked:{recipe:S("recipe")},ride_entity_in_lava:{start_position:p(Qt),distance:p(Mc)},slept_in_bed:{location:p(O(t,"1.16",Qt))},slide_down_block:{block:p(S("block"))},shot_crossbow:{item:p(kt)},summoned_entity:{entity:p(O(t,we,"1.16",tt))},tame_animal:{entity:p(O(t,we,"1.16",tt))},target_hit:{projectile:p(O(t,we,"1.16",tt)),shooter:p(O(t,we,"1.16",tt)),signal_strength:p(He)},thrown_item_picked_up_by_entity:{entity:p(O(t,we,"1.16",tt)),item:p(kt)},used_ender_eye:{distance:p(Mt)},used_totem:{item:p(kt)},using_item:{item:p(kt)},villager_trade:{villager:p(we),item:p(kt)},voluntary_exile:{location:p(O(t,"1.16",Qt))}})),Wr(r,["hero_of_the_village","location","slept_in_bed","voluntary_exile"],{position:p(vr(t,"1.16",C({x:p(Mt),y:p(Mt),z:p(Mt)}))),biome:p(vr(t,"1.16",S("worldgen/biome"))),feature:p(vr(t,"1.16",fe)),dimension:p(vr(t,"1.16",S("dimension"))),block:p(vr(t,"1.16",BS)),fluid:p(vr(t,"1.16",zS)),light:p(vr(t,"1.16",C({light:He}))),smokey:p(vr(t,"1.16",P))})))))}))),$S=V("advancement",C({display:p(C({icon:Q(r=>C({item:S("item"),nbt:p(qr({registry:"item",id:Xe("item",r)}))})),title:vt,description:vt,background:p(fe),frame:p(J(["task","challenge","goal"]),"task"),show_toast:p(P,!0),announce_to_chat:p(P,!0),hidden:p(P,!1)})),parent:p(S("advancement")),criteria:Ye(Rt(void 0,void 0,(r,e)=>{if(!e.ensureChecked)return;let t=ka(e.doc.uri,e),n=`${t?.namespace}:${t?.identifier}`,i=r.value;e.symbols.query(e.doc,"advancement",n,i).enter({data:{subcategory:"criterion"},usage:{type:"definition",node:r}})}),()=>nI),requirements:p(R(R((r,e)=>{if(!e.ensureChecked)return;let t=ka(e.doc.uri,e),n=`${t?.namespace}:${t?.identifier}`;wy(n)(r,e)}))),rewards:p(C({function:p(S("function")),loot:p(R(S("loot_table"))),recipes:p(R(S("recipe"))),experience:p(B)}))}));var wa=V("rule_test",Q("predicate_type",r=>C(w({predicate_type:S("rule_test")},he(r,{block_match:{block:S("block")},blockstate_match:{block_state:te},random_block_match:{block:S("block"),probability:W(0,1)},random_blockstate_match:{block_state:te,probability:W(0,1)},tag_match:{tag:S("tag/block")}}))))),iI=V("pos_rule_test",Q("predicate_type",r=>C(w(w({predicate_type:S("pos_rule_test")},he(r,{axis_aligned_linear_pos:{axis:J(["x","y","z"]),min_dist:p(E(0,255)),max_dist:p(E(0,255)),min_chance:p(W(0,1)),max_chance:p(W(0,1))}})),Wr(r,["axis_aligned_linear_pos","linear_pos"],{}))))),oI=V("processor_rule",Q(r=>C({position_predicate:p(iI,{predicate_type:"always_true"}),input_predicate:wa,location_predicate:wa,output_state:te,output_nbt:p(qr({registry:"block",id:kS("output_state","Name",r)}))}))),FS=V("processor",Q("processor_type",r=>C(w({processor_type:S("worldgen/structure_processor")},he(r,{block_age:{mossiness:re},block_ignore:{blocks:R(te)},block_rot:{integrity:W(0,1)},gravity:{heightmap:J(eo)},protected_blocks:{value:S("tag/block")},rule:{rules:R(oI)}}))))),Cy=V("processor_list",ie([C({processors:R(FS)}),R(FS)])),Dc=V("processor_list",ie([S("worldgen/processor_list"),Cy])),VS=V("template_element",Q("element_type",(r,e,t)=>C(w(w({element_type:S("worldgen/structure_pool_element")},Wr(r,["empty_pool_element"],{},{projection:J(["rigid","terrain_matching"])})),he(r,{feature_pool_element:{feature:O(t,zn,"1.18",si)},legacy_single_pool_element:{location:S("structure"),processors:Dc},list_pool_element:{elements:R(VS)},single_pool_element:{location:S("structure"),processors:Dc}}))))),Ay=V("template_pool",C({name:fe,fallback:S("worldgen/template_pool"),elements:R(C({weight:E(1,void 0),element:VS}))})),sI=ie([S("worldgen/template_pool"),Ay]),Lh=V("structure_feature",Q("type",r=>C({type:S("worldgen/structure_feature"),config:C(w({},Wr(r,["bastion_remnant","pillager_outpost","village"],{start_pool:sI,size:E(0,7)},he(r,{buried_treasure:{probability:W(0,1)},mineshaft:{type:J(["normal","mesa"]),probability:W(0,1)},nether_fossil:{height:Xi},ocean_ruin:{biome_temp:J(["cold","warm"]),large_probability:W(0,1),cluster_probability:W(0,1)},ruined_portal:{portal_type:J(["standard","desert","jungle","mountain","nether","ocean","swamp"])},shipwreck:{is_beached:p(P,!1)}}))))})));function My(...r){return[...new Set([].concat(...r).filter(e=>r.every(t=>t.includes(e))))]}function Sa(r,e){if(r&&Xt.is(r)){let t=Xe("Name",r.children);if(t)return t.startsWith("minecraft:")||(t=`minecraft:${t}`),Object.values(e.symbols.query(e.doc,"block",t).symbol?.members??{}).filter(n=>n?.subcategory==="state").filter(n=>Object.keys(n.members??{})[0]?.match(/^\d+$/)).map(n=>n.identifier)}else if(r&&fn.is(r)){let t=r.children.map(n=>n.value).filter(n=>n).map(n=>Sa(n,e));return My(...t)}return[]}function qS(r,e){if(!r||!Xt.is(r))return[];switch(Xe("type",r.children)?.replace(/^minecraft:/,"")){case"dual_noise_provider":case"noise_provider":let t=r.children.find(l=>l.key?.value==="states")?.value;return Sa(t,e);case"noise_threshold":let n=r.children.find(l=>l.key?.value==="low_states")?.value,i=r.children.find(l=>l.key?.value==="high_states")?.value;return My(Sa(n,e),Sa(i,e));case"randomized_int_state_provider":let o=r.children.find(l=>l.key?.value==="source")?.value;return qS(o,e);case"rotated_block_provider":case"simple_state_provider":let s=r.children.find(l=>l.key?.value==="state")?.value;return Sa(s,e);case"weighted_state_provider":let a=r.children.find(l=>l.key?.value==="entries")?.value;if(a&&fn.is(a)){let l=a.children.map(c=>c.value&&Xt.is(c.value)&&c.value.children.find(f=>f.key?.value==="data")?.value).filter(c=>c).map(c=>Sa(c,e));return My(...l)}}return[]}var Ty={seed:B,noise:Qi,scale:W(0,void 0)},Be=V("block_state_provider",Q("type",(r,e,t)=>C(w({type:S("worldgen/block_state_provider_type")},he(r,{dual_noise_provider:I(w({},Ty),{variety:DS(1,64),slow_noise:Qi,slow_scale:W(0,void 0),states:R(te)}),noise_threshold_provider:I(w({},Ty),{threshold:W(-1,1),high_chance:W(0,1),default_state:te,low_states:R(te),high_states:R(te)}),noise_provider:I(w({},Ty),{states:R(te)}),randomized_int_state_provider:{property:t.ensureChecked?J(qS(e.find(n=>n.key?.value==="source")?.value,t)):fe,values:_e(),source:Be},rotated_block_provider:{state:te},simple_state_provider:{state:te},weighted_state_provider:{entries:R(C({weight:E(1,void 0),data:te}))}}))))),xa={offset:p(R(E(-16,16)))},to=V("block_predicate_worldgen",Q("type",r=>C(w({type:S("block_predicate_type")},he(r,{all_of:{predicates:R(to)},any_of:{predicates:R(to)},has_sturdy_face:I(w({},xa),{direction:J(Ph)}),inside_world_bounds:w({},xa),matching_block_tag:I(w({},xa),{tag:S("tag/block")}),matching_blocks:I(w({},xa),{blocks:R(S("block"))}),matching_fluids:I(w({},xa),{fluids:R(S("fluid"))}),not:{predicate:to},would_survive:I(w({},xa),{state:te})}))))),aI=V("block_placer",Q("type",(r,e,t)=>C(w({type:S("worldgen/block_placer_type")},he(r,{column_placer:w({},O(t,{min_size:B,extra_size:B},"1.17",{size:_e(0,void 0)}))}))))),lI=V("feature_size",Q("type",r=>C(w({type:S("worldgen/feature_size_type"),min_clipped_height:p(E(0,80))},he(r,{two_layers_feature_size:{limit:p(E(0,81),1),lower_size:p(E(0,16),0),upper_size:p(E(0,16),1)},three_layers_feature_size:{limit:p(E(0,81),1),upper_limit:p(E(0,80),1),lower_size:p(E(0,16),0),middle_size:p(E(0,16),1),upper_size:p(E(0,16),1)}}))))),cI=V("trunk_placer",Q("type",r=>C(w({type:S("worldgen/trunk_placer_type"),base_height:E(0,32),height_rand_a:E(0,24),height_rand_b:E(0,24)},he(r,{bending_trunk_placer:{bend_length:_e(1,64),min_height_for_leaves:p(E(1,void 0),1)}}))))),fI=V("foliage_placer",Q("type",(r,e,t)=>C(w({type:S("worldgen/foliage_placer_type"),radius:O(t,kr(0,8,8),"1.17",_e(0,16)),offset:O(t,kr(0,8,8),"1.17",_e(0,16))},he(r,{blob_foliage_placer:{height:E(0,16)},bush_foliage_placer:{height:E(0,16)},fancy_foliage_placer:{height:E(0,16)},jungle_foliage_placer:{height:E(0,16)},mega_pine_foliage_placer:{crown_height:O(t,kr(0,16,8),"1.17",_e(0,24))},pine_foliage_placer:{height:O(t,kr(0,16,8),"1.17",_e(0,24))},random_spread_foliage_placer:{foliage_height:_e(1,512),leaf_placement_attempts:E(0,256)},spruce_foliage_placer:{trunk_height:O(t,kr(0,16,8),"1.17",_e(0,24))}}))))),uI=V("tree_decorator",Q("type",r=>C(w({type:S("worldgen/tree_decorator_type")},he(r,{alter_ground:{provider:Be},beehive:{probability:W(0,1)},cocoa:{probability:W(0,1)}}))))),US=r=>({state:te,radius:O(r,kr(0,4,4),"1.17",_e(0,8)),half_height:E(0,4),targets:R(te)}),Oy=r=>O(r,w({state_provider:Be,block_placer:aI,whitelist:R(te),blacklist:R(te)},O(r,{tries:B,xspread:B,yspread:B,zspread:B,can_replace:P,project:P,need_water:P},"1.17",{tries:p(E(1,void 0),128),xspread:p(E(0,void 0),7),yspread:p(E(0,void 0),3),zspread:p(E(0,void 0),7),can_replace:p(P,!1),project:p(P,!0),need_water:p(P,!1)})),"1.18",{tries:p(E(1,void 0),128),xz_spread:p(E(0,void 0)),y_spread:p(E(0,void 0)),feature:si}),HS={foliage_radius:p(B,2),cap_provider:Be,stem_provider:Be},Ey=r=>w({size:E(0,64)},O(r,{state:te,target:wa},"1.17",{discard_chance_on_air_exposure:W(0,1),targets:R(C({state:te,target:wa}))})),Nc=r=>({count:O(r,kr(-10,128,128),"1.17",_e(0,256))}),Ry={maximum:B,bottom_offset:B,top_offset:B},WS=r=>({surface:J(["floor","ceiling"]),depth:_e(1,128),vertical_range:E(1,256),extra_bottom_block_chance:W(0,1),extra_edge_column_chance:W(0,1),vegetation_chance:W(0,1),xz_radius:_e(),replaceable:S("tag/block"),ground_state:Be,vegetation_feature:O(r,_t(()=>zn),"1.18",_t(()=>si))}),Dy=V("decorator",Q("type",(r,e,t)=>C({type:S("worldgen/decorator"),config:C(he(r,{carving_mask:{step:J(["air","liquid"]),probability:O(t,W(0,1),"1.16")},cave_surface:{surface:J(["floor","ceiling"]),floor_to_ceiling_search_range:B},chance:{chance:B},count:Nc(t),count_extra:{count:B,extra_chance:re,extra_count:B},count_multilayer:Nc(t),count_noise:{noise_level:re,below_noise:B,above_noise:B},count_noise_biased:{noise_to_count_ratio:B,noise_factor:re,noise_offset:p(re,0)},decorated:{outer:Dy,inner:Dy},depth_average:{baseline:B,spread:B},fire:Nc(t),glowstone:Nc(t),heightmap:{heightmap:O(t,"1.17",J(eo))},heightmap_spread_double:{heightmap:O(t,"1.17",J(eo))},lava_lake:{chance:B},range:w({},O(t,Ry,"1.17",{height:Xi})),range_biased:Ry,range_very_biased:Ry,water_depth_threshold:{max_water_depth:B},water_lake:{chance:B}}))}))),hI=V("placement_modifier",Q("type",r=>C(w({type:S("worldgen/placement_modifier_type")},he(r,{block_predicate_filter:{predicate:to},carving_mask:{step:J(["air","liquid"])},rarity_filter:{chance:E(1,void 0)},count:{count:_e(0,256)},count_on_every_layer:{count:_e(0,256)},noise_threshold_count:{noise_level:re,below_noise:B,above_noise:B},noise_based_count:{noise_to_count_ratio:B,noise_factor:re,noise_offset:p(re)},environment_scan:{direction_of_search:J(["up","down"]),max_steps:E(1,32),target_condition:to,allowed_search_condition:p(to)},heightmap:{heightmap:J(eo)},height_range:{height:Xi},random_offset:{xz_spread:_e(-16,16),y_spread:_e(-16,16)},surface_relative_threshold_filter:{heigtmap:J(eo),min_inclusive:p(B),max_inclusive:p(B)},surface_water_depth_filter:{max_water_depth:B}}))))),Ih=V("feature",Q("type",(r,e,t)=>C({type:S("worldgen/feature"),config:C(he(r,{bamboo:{probability:W(0,1)},basalt_columns:{reach:O(t,kr(0,2,1),"1.17",_e(0,3)),height:O(t,kr(1,5,5),"1.17",_e(1,10))},block_column:{direction:J(Ph),allowed_placement:to,prioritize_tip:P,layers:R(C({height:_e(0,void 0),provider:Be}))},block_pile:{state_provider:Be},decorated:{decorator:Dy,feature:zn},delta_feature:{contents:te,rim:te,size:O(t,kr(0,8,8),"1.17",_e(0,16)),rim_size:O(t,kr(0,8,8),"1.17",_e(0,16))},disk:US(t),dripstone_cluster:{floor_to_ceiling_search_range:E(1,512),height:_e(0,128),radius:_e(0,128),max_stalagmite_stalactite_height_diff:E(0,64),height_deviation:E(0,64),dripstone_block_layer_thickness:_e(0,128),density:Ht(0,2),wetness:Ht(0,2),chance_of_dripstone_column_at_max_distance_from_center:W(0,1),max_distance_from_edge_affecting_chance_of_dripstone_column:E(1,64),max_distance_from_center_affecting_height_bias:E(1,64)},emerald_ore:{state:te,target:te},end_gateway:{exit:p(R(B)),exact:P},end_spike:{crystal_invulnerable:p(P,!1),crystal_beam_target:p(R(B)),spikes:R(C({centerX:p(B,0),centerZ:p(B,0),radius:p(B,0),height:p(B,0),guarded:p(P,!1)}))},fill_layer:{height:E(0,Nh),state:te},flower:Oy(t),forest_rock:{state:te},fossil:{max_empty_corners_allowed:E(0,7),fossil_structures:R(S("structure")),overlay_structures:R(S("structure")),fossil_processors:Dc,overlay_processors:Dc},geode:{blocks:C({filling_provider:Be,inner_layer_provider:Be,alternate_inner_layer_provider:Be,middle_layer_provider:Be,outer_layer_provider:Be,inner_placements:R(te),cannot_replace:S("tag/block"),invalid_blocks:S("tag/block")}),layers:C({filling:p(W(.01,50),1.7),inner_layer:p(W(.01,50),2.2),middle_layer:p(W(.01,50),3.2),outer_layer:p(W(.01,50),4.2)}),crack:C({generate_crack_chance:p(W(0,1),1),base_crack_size:p(W(0,5),2),crack_point_offset:p(E(0,10),2)}),noise_multiplier:p(W(0,1),.05),use_potential_placements_chance:p(W(0,1),.35),use_alternate_layer0_chance:p(W(0,1),0),placements_require_layer0_alternate:p(P,!0),outer_wall_distance:p(_e(0,10),{value:{min_inclusive:0,max_inclusive:10}}),distribution_points:p(_e(1,20),{value:{min_inclusive:3,max_inclusive:4}}),point_offset:p(_e(0,10),{value:{min_inclusive:1,max_inclusive:2}}),min_gen_offset:p(B,-16),max_gen_offset:p(B,16),invalid_blocks_threshold:B},glow_lichen:{search_range:p(E(1,64),10),chance_of_spreading:p(W(0,1),.5),can_place_on_floor:p(P,!1),can_place_on_wall:p(P,!1),can_place_on_ceiling:p(P,!1),can_be_placed_on:R(O(t,te,"1.18",S("block")))},growing_plant:{direction:J(Ph),allow_water:P,height_distribution:R(C({weight:B,data:_e()})),body_provider:Be,head_provider:Be},huge_brown_mushroom:HS,huge_fungus:{planted:p(P,!1),hat_state:te,decor_state:te,stem_state:te,valid_base_block:te},huge_red_mushroom:HS,ice_patch:US(t),iceberg:{state:te},lake:O(t,{state:te},"1.18",{fluid:Be,barrier:Be}),large_dripstone:{floor_to_ceiling_search_range:p(E(1,512),30),column_radius:_e(0,20),height_scale:Ht(0,20),max_column_radius_to_cave_height_ratio:W(0,1),stalactite_bluntness:Ht(.1,10),stalagmite_bluntness:Ht(.1,10),wind_speed:Ht(0,2),min_radius_for_wind:E(0,100),min_bluntness_for_wind:W(0,5)},nether_forest_vegetation:w({state_provider:Be},O(t,"1.18",{spread_width:E(1,void 0),spread_height:_e(1,void 0)})),netherrack_replace_blobs:{radius:O(t,kr(),"1.17",_e(0,12)),state:te,target:te},no_bonemeal_flower:Oy(t),no_surface_ore:Ey(t),ore:Ey(t),pointed_dripstone:{chance_of_taller_dripstone:W(0,1),chance_of_directional_spread:W(0,1),chance_of_spread_radius2:W(0,1),chance_of_spread_radius3:W(0,1)},random_boolean_selector:{feature_false:O(t,zn,"1.18",si),feature_true:O(t,zn,"1.18",si)},random_patch:Oy(t),random_selector:{features:R(C({chance:W(0,1),feature:O(t,zn,"1.18",si)})),default:O(t,zn,"1.18",si)},replace_single_block:{targets:R(C({state:te,target:wa}))},root_system:{required_vertical_space_for_tree:E(1,64),root_radius:E(1,64),root_placement_attempts:E(1,256),root_column_max_height:E(1,4096),hanging_root_radius:E(1,64),hanging_roots_vertical_span:E(0,16),hanging_root_placement_attempts:E(0,256),allowed_vertical_water_for_tree:E(1,64),root_replaceable:S("tag/block"),root_state_provider:Be,hanging_root_state_provider:Be,allowed_tree_position:O(t,"1.18",to),feature:O(t,zn,"1.18",si)},scattered_ore:Ey(t),sea_pickle:Nc(t),seagrass:{probability:W(0,1)},simple_block:w({},O(t,O(t,{to_place:te,place_on:R(te),place_in:R(te),place_under:R(te)},"1.17",{to_place:Be,place_on:p(R(te),[]),place_in:p(R(te),[]),place_under:p(R(te),[])}),"1.18",{to_place:Be})),simple_random_selector:{features:O(t,Ny,"1.18",Py)},small_dripstone:{max_placements:p(E(0,100),5),empty_space_search_radius:p(E(0,20),10),max_offset_from_origin:p(E(0,20),2),chance_of_taller_dripstone:p(W(0,1),.2)},spring_feature:{requires_block_below:p(P,!0),rock_count:p(B,4),hole_count:p(B,1),state:MS,valid_blocks:R(S("block"))},tree:I(w({ignore_vines:p(P,!1),force_dirt:p(O(t,"1.17",P),!1),max_water_depth:O(t,B,"1.17"),heightmap:O(t,J(eo),"1.17"),minimum_size:lI,dirt_provider:O(t,"1.17",Be),sapling_provider:O(t,"1.17",O(t,Be,"1.18")),trunk_provider:Be},ES(t,"leaves_provider","1.17","foliage_provider",Be)),{trunk_placer:cI,foliage_placer:fI,decorators:R(uI)}),twisting_vines:O(t,{},"1.18",{spread_width:E(1,void 0),spread_height:E(1,void 0),max_height:E(1,void 0)}),underwater_magma:{floor_search_range:E(0,512),placement_radius_around_floor:E(0,64),placement_probability_per_valid_position:W(0,1)},vegetation_patch:WS(t),waterlogged_vegetation_patch:WS(t)}))}))),zn=ie([S("worldgen/configured_feature"),Ih]),Ny=ie([R(S("worldgen/configured_feature")),R(Ih)]),KS=V("placed_feature",C({feature:zn,placement:R(hI)})),si=ie([S("worldgen/placed_feature"),KS]),Py=ie([R(S("worldgen/placed_feature")),R(KS)]);var dI=r=>["beach","desert","extreme_hills","forest","icy","jungle","mesa",...O(r,"1.18",["mountain"]),"mushroom","nether","none","ocean","plains","river","savanna","swamp","taiga","the_end",...O(r,"1.17",["underground"])],pI=r=>[...O(r,"1.18",["axolotls"]),"monster","creature","ambient","water_creature","water_ambient",...O(r,"1.17",["underground_water_creature"]),"misc"],Ly=V("surface_builder",C({type:S("worldgen/surface_builder"),config:C({top_material:te,under_material:te,underwater_material:te})})),Iy=V("carver",Q("type",(r,e,t)=>C({type:S("worldgen/carver"),config:C(w({probability:W(0,1)},O(t,"1.17",w(w({y:Xi,yScale:Ht(),lava_level:Vt,aquifers_enabled:O(t,P,"1.18"),debug_settings:p(C({debug_mode:p(P),air_state:p(te),water_state:p(te),lava_state:p(te),barrier_state:p(te)}))},Wr(r,["cave","nether_cave","underwater_cave"],{horizontal_radius_multiplier:Ht(),vertical_radius_multiplier:Ht(),floor_level:Ht(-1,1)})),Wr(r,["canyon","underwater_canyon"],{vertical_rotation:Ht(),shape:C({distance_factor:Ht(),thickness:Ht(),width_smoothness:E(0,void 0),horizontal_radius_factor:Ht(),vertical_radius_default_factor:re,vertical_radius_center_factor:re})})))))}))),GS=V("biome",Q((r,e)=>C(I(w({},O(e,{depth:re,scale:re},"1.18")),{downfall:re,temperature:re,temperature_modifier:p(J(["none","frozen"])),precipitation:J(["none","rain","snow"]),category:J(dI(e)),effects:C({sky_color:Qo(),fog_color:Qo(),water_color:Qo(),water_fog_color:Qo(),grass_color:p(Qo()),foliage_color:p(Qo()),grass_color_modifier:p(J(["none","dark_forest","swamp"])),particle:p(C({options:C({type:S("particle_type")}),probability:W(0,1)})),ambient_sound:p(S("sound_event")),mood_sound:p(C({sound:S("sound_event"),tick_delay:B,block_search_extent:B,offset:re})),additions_sound:p(C({sound:S("sound_event"),tick_chance:W(0,1)})),music:p(C({sound:S("sound_event"),min_delay:B,max_delay:B,replace_current_music:P}))}),player_spawn_friendly:p(O(e,P,"1.18")),creature_spawn_probability:p(W(0,.9999999)),spawners:Ye(J(pI(e)),()=>R(C({type:S("entity_type"),weight:B,minCount:B,maxCount:B}))),spawn_costs:Ye(S("entity_type"),()=>C({energy_budget:re,charge:re})),surface_builder:O(e,ie([S("worldgen/configured_surface_builder"),Ly]),"1.18"),carvers:Ye(["air","liquid"],()=>p(ie([R(S("worldgen/configured_carver")),R(Iy)]))),starts:O(e,ie([R(S("worldgen/configured_structure_feature")),R(Lh)]),"1.18"),features:R(O(e,Ny,"1.18",Py))}))));var JS=V("material_condition",Q("type",r=>C(w({type:S("worldgen/material_condition")},he(r,{biome:{biome_is:R(S("worldgen/biome"))},noise_threshold:{noise:S("worldgen/noise"),min_threshold:re,max_threshold:re},not:{invert:JS},stone_depth:{offset:B,surface_type:J(["floor","ceiling"]),add_surface_depth:P,add_surface_secondary_depth:P},vertical_gradient:{random_name:fe,true_at_and_below:Vt,false_at_and_above:Vt},water:{offset:B,surface_depth_multiplier:E(-20,20),add_stone_depth:P},y_above:{anchor:Vt,surface_depth_multiplier:E(-20,20),add_stone_depth:P}}))))),By=V("material_rule",Q("type",r=>C(w({type:S("worldgen/material_rule")},he(r,{block:{result_state:te},condition:{if_true:JS,then_run:By},sequence:{sequence:R(By)}}))))),Bh=V("terrain_spline",ie([re,C({coordinate:J(["continents","erosion","weirdness","ridges"]),points:R(C({location:re,value:_t(()=>Bh),derivative:re}))})])),YS=V("structure_settings",C({stronghold:p(C({distance:E(0,1023),spread:E(0,1023),count:E(1,4095)})),structures:Ye(S("worldgen/structure_feature"),()=>C({spacing:E(0,4096),separation:E(0,4096),salt:E(0,void 0)}))})),ZS=Q((r,e)=>C({target:re,size:O(e,B,"1.17",E(0,void 0)),offset:B})),zy=V("noise_settings",Q((r,e)=>C(I(w({bedrock_roof_position:O(e,B,"1.18"),bedrock_floor_position:O(e,B,"1.18"),sea_level:B,min_surface_level:O(e,"1.17",O(e,B,"1.18")),disable_mob_generation:P},O(e,"1.17",{noise_caves_enabled:P,noodle_caves_enabled:P,aquifers_enabled:P,deepslate_enabled:O(e,P,"1.18"),ore_veins_enabled:P})),{legacy_random_source:O(e,"1.18",P),default_block:te,default_fluid:te,noise:C({min_y:O(e,"1.17",E(-2048,2047)),height:E(0,4096),size_horizontal:E(1,4),size_vertical:E(1,4),density_factor:O(e,re,"1.18"),density_offset:O(e,re,"1.18"),simplex_surface_noise:O(e,P,"1.18"),random_density_offset:p(O(e,P,"1.18"),!1),island_noise_override:p(P,!1),amplified:p(P,!1),large_biomes:p(O(e,"1.18",P),!1),sampling:C({xz_scale:W(.001,1e3),y_scale:W(.001,1e3),xz_factor:W(.001,1e3),y_factor:W(.001,1e3)}),top_slide:ZS,bottom_slide:ZS,terrain_shaper:O(e,"1.18",C({offset:Bh,factor:Bh,jaggedness:Bh}))}),surface_rule:O(e,"1.18",By),structures:YS})))),Ca=ie([W(-2,2),R(W(-2,2))]),mI=V("biome_source",Q("type",(r,e,t)=>C(w({type:S("worldgen/biome_source")},he(r,{checkerboard:{scale:p(E(0,62),2),biomes:R(S("worldgen/biome"))},fixed:{biome:S("worldgen/biome")},multi_noise:I(w({seed:O(t,B,"1.18"),preset:p(O(t,J(["nether"]),"1.18",S(["minecraft:overworld","minecraft:nether"])))},O(t,{altitude_noise:Qi,temperature_noise:Qi,humidity_noise:Qi,weirdness_noise:Qi},"1.18")),{biomes:R(C({biome:S("worldgen/biome"),parameters:C(O(t,{altitude:re,temperature:re,humidity:re,weirdness:re,offset:re},"1.18",{temperature:Ca,humidity:Ca,continentalness:Ca,erosion:Ca,weirdness:Ca,depth:Ca,offset:W(0,1)}))}))}),the_end:{seed:B},vanilla_layered:{seed:B,large_biomes:p(P,!1),legacy_biome_init_layer:p(P,!1)}}))))),jy=V("dimension_type",Q((r,e)=>C({min_y:O(e,"1.17",E(-2048,2047)),height:O(e,"1.17",E(0,4096)),logical_height:O(e,E(0,256),"1.17",E(0,4096)),coordinate_scale:W(1e-5,3e7),ambient_light:re,fixed_time:p(B),infiniburn:S("tag/block"),effects:p(S(["overworld","the_nether","the_end"]),"overworld"),ultrawarm:P,natural:P,piglin_safe:P,respawn_anchor_works:P,bed_works:P,has_raids:P,has_skylight:P,has_ceiling:P}))),XS=V("dimension",C({type:ie([S("dimension_type"),jy]),generator:V("chunk_generator",Q("type",r=>C(w({type:S("worldgen/chunk_generator")},he(r,{flat:{settings:C({layers:R(C({block:S("block"),height:E(0,4096)})),biome:S("worldgen/biome"),lakes:p(P,!1),features:p(P,!1),structures:YS})},noise:{seed:B,settings:ie([S("worldgen/noise_settings"),zy]),biome_source:mI}})))))}));var jh=ie([C({item:S("item")}),C({tag:S("tag/item")})]),zh=ie([jh,R(jh)]),$y=C({item:S("item"),count:p(E(1,64),1)}),QS=V("recipe",Q("type",(r,e)=>C(w(w({type:S("recipe_serializer"),group:p(TS)},he(r,{crafting_shaped:{pattern:R(fe),key:Ye(OS(e),()=>zh),result:$y},crafting_shapeless:{ingredients:R(zh),result:$y},stonecutting:{ingredient:zh,result:S("item"),count:B},smithing:{base:jh,addition:jh,result:$y}})),Wr(r,["blasting","campfire_cooking","smelting","smoking"],{ingredient:zh,result:S("item"),experience:p(re,0),cookingtime:p(B,r==="smelting"?200:100)})))));var Aa=r=>C({replace:p(P,!1),values:_S(ie([S(r,!0),C({id:S(r,!0),required:p(P,!0)})]),{items:e=>{if(Ft.is(e))return[se.shorten(e.value),e];if(Xt.is(e)){let t=e.children.find(n=>n.key?.value==="id");if(t&&t.value&&Ft.is(t.value))return[se.shorten(t.value.value),t.value]}return[void 0,e]},report:(e,t)=>t.err.report(b("json.checker.tag-entry.duplicate"),e,2)})}),eC=Aa("block"),tC=Aa("entity_type"),rC=Aa("fluid"),nC=Aa("function"),iC=Aa("game_event"),oC=Aa("item");var sC=V("pack",C({pack:C({pack_format:B,description:vt})},{allowUnknownProperties:!0})),Fy=new Map([["advancement",$S],["dimension",XS],["dimension_type",jy],["item_modifier",PS],["loot_table",LS],["predicate",NS],["recipe",QS],["tag/block",eC],["tag/entity_type",tC],["tag/fluid",rC],["tag/function",nC],["tag/game_event",iC],["tag/item",oC],["worldgen/biome",GS],["worldgen/configured_carver",Iy],["worldgen/configured_surface_builder",Ly],["worldgen/configured_feature",Ih],["worldgen/configured_structure_feature",Lh],["worldgen/noise_settings",zy],["worldgen/processor_list",Cy],["worldgen/template_pool",Ay]]);var Ta=(r,e)=>{let t=ka(e.doc.uri,e);if(t&&Fy.has(t.category))Fy.get(t.category)(r,I(w({},e),{context:""}));else if(e.doc.uri.endsWith("/pack.mcmeta"))sC(r,I(w({},e),{context:""}));else return};function aC(r){r.registerChecker("json:array",Ta),r.registerChecker("json:boolean",Ta),r.registerChecker("json:null",Ta),r.registerChecker("json:number",Ta),r.registerChecker("json:object",Ta),r.registerChecker("json:string",Ta)}var cC=r=>{wS(r),aC(r.meta)};function uC(r){r.registerColorizer("mcfunction:command_child/literal",ot.literal),r.registerColorizer("mcfunction:command_child/trailing",ot.error)}var Wh={};dn(Wh,{command:()=>pC,entry:()=>gI});var $h;(function(r){function e(n){return n.type==="mcfunction:command"}r.is=e;function t(n){return{type:"mcfunction:command",range:k.get(n),children:[]}}r.mock=t})($h||($h={}));var Fh;(function(r){function e(t){return t.type==="mcfunction:command_child"}r.is=e})(Fh||(Fh={}));var dC;(function(r){function e(t){return t?.type==="mcfunction:command_child/literal"}r.is=e})(dC||(dC={}));var Vh;(function(r){function e(t){return t?.type==="mcfunction:entry"}r.is=e})(Vh||(Vh={}));var Pc,Uh=class{constructor(){U(this,Pc,new Map);if(Uh._instance)throw new Error("Use the `instance` static property to get an instance.")}register(e,t,n){_(this,Pc).set(e,n?yl(t,n):t)}get(e){let t=_(this,Pc).get(e);if(!t)throw new Error(`No command tree exist for version \u201C${e}\u201D`);return t}static get instance(){return this._instance??(this._instance=new Uh)}},Kr=Uh;Pc=new WeakMap,ce(Kr,"_instance");function Vy(r,e){return e.reduce((t,n)=>t?.children?.[n],r)}function ts(r,e,t){return r?.redirect?{treeNode:Vy(e,r.redirect),path:[...r.redirect]}:r&&!r.children&&!r.executable?{treeNode:e,path:[]}:{treeNode:r,path:t}}function Hh(r){let e={literalTreeNodes:[],argumentTreeNodes:[]};for(let t of Object.entries(r))t[1].type==="literal"?e.literalTreeNodes.push(t):t[1].type==="argument"&&e.argumentTreeNodes.push(t);return e}function gI(r,e){return(t,n)=>{let i=Kr.instance.get(r),o=yt.findChild(t,n.offset,!0);return ku.is(o)?[]:pC(i,e)(o??$h.mock(n.offset),n)}}function pC(r,e){return(t,n)=>{let i=yt.findChildIndex(t,n.offset,!0),o=t.children[i]?.children[0];if(o)return xe.dispatch(o,n);let s=yt.findLastChild(t,n.offset);if(!s)return Object.keys(r.children??{}).map(u=>Ie.create(u,n.offset,{kind:14}));let a=s.path,{treeNode:l}=ts(Vy(r,a),r);if(!l?.children)return[];let{literalTreeNodes:c,argumentTreeNodes:f}=Hh(l.children);return[...c.map(([u])=>Ie.create(u,n.offset,{kind:14})),...f.flatMap(([u,h])=>Le.toArray(e(h,n.offset)).flatMap(d=>xe.dispatch(d,n)))]}}function mC(r,e){let t=e.parser.slice(e.parser.indexOf(":")+1);return`<${r}: ${t}>`}var Lc=(r,e)=>{let t=r.cursor,n=r.readSpace();return n!==" "&&e.err.report(b("expected",b("mcfunction.parser.sep",q(" "))),k.create(t,r)),n};function gC(r,e=!1){let t={pool:r,colorTokenType:e?"keyword":"literal"};return(n,i)=>{let o=n.cursor,s=n.readUntil(" ","\r",`
`);if(!s.length)return oe;let a={type:"mcfunction:command_child/literal",range:k.create(o,n),options:t,value:s};return r.includes(s)||i.err.report(b("expected",r),a),a}}function qh(r,e){return(t,n)=>{let i={type:"mcfunction:command",range:k.create(t),children:[]},o=t.cursor;if(t.trySkip("/")&&(i.slash=k.create(o,t.cursor)),yI(i.children,t,n,[],r,r,e),t.canReadInLine()){let s=_I(t,n);i.children.push({type:"mcfunction:command_child",range:s.range,children:[s],path:[]})}return i.range.end=t.cursor,i}}function yI(r,e,t,n,i,o,s){function a(c,f){let{treeNode:u,path:h}=ts(f,i,c);c=h;let d=u?.children;if(!d)return!1;let{literalTreeNodes:m,argumentTreeNodes:y}=Hh(d),g=y.map(([j,A])=>({name:j,parser:s(A)??bI(A)})),v=m.length?gC(m.map(([j,A])=>j),u.type==="root"):void 0,T=[...v?[v]:[],...g.map(j=>j.parser)],M={index:0},D=(T.length>1?$r(T,M):T[0])(e,t);if(D!==oe){let j=g[M.index-(v?1:0)]?.name??D.value,A=[...c,j];r.push({type:"mcfunction:command_child",range:D.range,children:[D],path:A});let L=d[j];if(!L)return!1;let z=L.permission??2;if(t.config.env.permissionLevel<z&&t.err.report(b("mcfunction.parser.no-permission",z,t.config.env.permissionLevel),D),D.type==="mcfunction:command_child/unknown")return!1;if(e.canReadInLine())return Lc(e,t),{childPath:A,childTreeNode:L};L.executable||t.err.report(b("mcfunction.parser.eoc-unexpected"),e)}else t.err.report(b("expected",kI(d)),k.create(e));return!1}let l=a(n,o);for(;l;)l=a(l.childPath,l.childTreeNode)}function bI(r){return(e,t)=>{let n=e.cursor,i=e.readUntilLineEnd(),o=k.create(n,e);return t.err.report(b("mcfunction.parser.unknown-parser",q(r.parser)),o,0),{type:"mcfunction:command_child/unknown",range:o,value:i}}}var _I=(r,e)=>{let t=r.cursor,n=r.readUntilLineEnd(),i=k.create(t,r);return e.err.report(b("mcfunction.parser.trailing",q(n)),i),{type:"mcfunction:command_child/trailing",range:i,value:n}};function vI(r,e){return e?`[${r}]`:r}function Uy(r,e=!1){return Object.entries(r).map(([n,i])=>vI(Hy(n,i),e))}function kI(r){let e=Uy(r);return e.length>5?`${e.slice(0,3).join("|")}|...|${e.slice(-2).join("|")}`:e.join("|")}function Hy(r,e){return e.type==="argument"?mC(r,e):r}function yC(r,e){return(t,n)=>{let i={type:"mcfunction:entry",range:k.create(t),children:[]};for(;t.skipWhitespace().canReadInLine();){let o;t.peek()==="#"?o=wI(t,n):o=qh(Kr.instance.get(r),e)(t,n),i.children.push(o),t.nextLine()}return i.range.end=t.cursor,i}}var wI=Kl({singleLinePrefixes:new Set(["#"])});var bC=({meta:r})=>{uC(r),r.registerCompleter("mcfunction:command_child/literal",xe.literal)};var Kh;(function(r){function e(t){return t.type==="mcfunction:block/states"}r.is=e})(Kh||(Kh={}));var un;(function(r){function e(n){return n?.type==="mcfunction:block"}r.is=e;function t(n,i){let o=le.mock(n,{category:"block",allowTag:i});return{type:"mcfunction:block",range:k.get(n),children:[o],id:o}}r.mock=t})(un||(un={}));var Gh;(function(r){function e(n){return{type:"mcfunction:coordinate",range:k.get(n),notation:"",value:0}}r.mock=e;function t(n){let i=n.value%360;return i>=180?i-360:i<-180?i+360:i}r.toDegree=t})(Gh||(Gh={}));var Zh;(function(r){function e(t){return t.type==="mcfunction:entity_selector/arguments"}r.is=e})(Zh||(Zh={}));var vC=["a","e","p","r","s"],_C;(function(r){function e(t){return vC.includes(t)}r.is=e})(_C||(_C={}));var Bc=vC.map(r=>`@${r}`),Oa;(function(r){function e(t){return Bc.includes(t)}r.is=e})(Oa||(Oa={}));var hn;(function(r){function e(i){return i?.type==="mcfunction:entity_selector"}r.is=e;function t(i){let o=ht.mock(i,{pool:Bc,colorTokenType:"keyword"});return{type:"mcfunction:entity_selector",range:k.get(i),children:[o],variable:"e"}}r.mock=t,r.ArgumentKeys=new Set(["advancements","distance","gamemode","level","limit","name","nbt","predicate","scores","sort","tag","team","type","x","y","z","dx","dy","dz","x_rotation","y_rotation"]);function n(i,o,s){let a=c=>!!o.children.find(f=>f.key?.value===c),l=c=>!!o.children.find(f=>f.key?.value===c&&!f.value?.inverted);switch(s){case"advancements":case"distance":case"level":case"scores":case"x":case"y":case"z":case"dx":case"dy":case"dz":case"x_rotation":case"y_rotation":return a(s)?1:0;case"gamemode":case"name":case"team":return l(s)?1:0;case"limit":case"sort":return i.currentEntity?2:a(s)?1:0;case"type":return i.typeLimited?a(s)?1:2:0}return 0}r.canKeyExist=n})(hn||(hn={}));var Ea;(function(r){function e(t){return t?.type==="mcfunction:entity"}r.is=e})(Ea||(Ea={}));var ro;(function(r){function e(n){return n?.type==="mcfunction:item"}r.is=e;function t(n,i){let o=le.mock(n,{category:"item",allowTag:i});return{type:"mcfunction:item",range:k.get(n),children:[o],id:o}}r.mock=t})(ro||(ro={}));var Jh;(function(r){function e(t){return{type:"mcfunction:int_range",range:k.get(t),children:[],value:[void 0,void 0]}}r.mock=e})(Jh||(Jh={}));var no;(function(r){r.SimpleValues=["air","armor","deathCount","dummy","food","health","level","playerKillCount","totalKillCount","trigger","xp"],r.ComplexCategories=new Map([["broken","item"],["crafted","item"],["custom","custom_stat"],["dropped","item"],["killed","entity_type"],["killed_by","entity_type"],["mined","block"],["picked_up","item"],["used","item"]]),r.ComplexSep=":";function e(t){return{type:"mcfunction:objective_criteria",range:k.get(t)}}r.mock=e})(no||(no={}));var rs;(function(r){let e=new Set(["block","block_marker","dust","dust_color_transition","falling_dust","item","sculk_charge","vibration"]);function t(o){return e.has(o)}r.isSpecialType=t;function n(o){return o?.type==="mcfunction:particle"}r.is=n;function i(o){let s=le.mock(o,{category:"particle_type"});return{type:"mcfunction:particle",range:k.get(o),children:[s],id:s}}r.mock=i})(rs||(rs={}));var Yh;(function(r){function e(t){let n=Br.mock(t,{category:"score_holder"});return{type:"mcfunction:score_holder",range:k.get(t),children:[n],fakeName:n}}r.mock=e})(Yh||(Yh={}));var Xh;(function(r){r.UnitToTicks=new Map([["",1],["t",1],["s",20],["d",24e3]]),r.Units=[...r.UnitToTicks.keys()]})(Xh||(Xh={}));var wr;(function(r){function e(t,n){return{type:"mcfunction:vector",range:k.get(t),children:[],options:n,system:0}}r.mock=e})(wr||(wr={}));var xI=(r,e)=>{r.slash&&r.parent&&Vh.is(r.parent)&&e.err.report(b("unexpected-leading-slash"),r.slash),kC(r.children,0,e)},xr=(r,e)=>r[e]?.path[r[e].path.length-1],Sr=(r,e)=>r[e]?.children[0],kC=(r,e,t)=>{for(let{children:[n]}of r)un.is(n)?wC(n,t):Ea.is(n)?xC(n,t):ro.is(n)?SC(n,t):rs.is(n)?CC(n,t):Oh.is(n)&&vt(n,I(w({},t),{context:""}));if(xr(r,e)==="data")if(xr(r,e+1)==="get")Qh(r,e+2,t);else if(xr(r,e+1)==="merge")SI(r,e+2,t);else if(xr(r,e+1)==="modify"){Qh(r,e+2,t);let n=Sr(r,e+4)}else xr(r,e+1)==="remove"&&Qh(r,e+2,t);else if(xr(r,e)==="execute"){for(let n=e+1;n<r.length;n++)if((xr(r,n)==="if"||xr(r,n)==="unless")&&xr(r,n+1)==="data")Qh(r,n+2,t),n+=2;else if(xr(r,n)==="run"){kC(r,n+1,t);break}}else xr(r,e)==="summon"&&CI(r,e+1,t)},wC=(r,e)=>{!r.nbt||Et.index("block",le.toString(r.id,"full"))(r.nbt,e)},xC=(r,e)=>{let t=r.selector?.arguments?.children.find(o=>o.key?.value==="nbt");if(!t)return;let n=Wy(r,e),i=t.value;Et.index("entity_type",n)(i,e)},SC=(r,e)=>{!r.nbt||Et.index("item",le.toString(r.id,"full"))(r.nbt,e)},CC=(r,e)=>{nr.dispatchSync(r,e)},SI=(r,e,t)=>{switch(xr(r,e)){case"block":{let i=Sr(r,e+2);cn.is(i)&&Et.index("block",void 0)(i,t);break}case"entity":{let i=Sr(r,e+1),o=Sr(r,e+2);if(Ea.is(i)&&cn.is(o)){let s=Wy(i,t);Et.index("entity_type",s)(o,t)}break}case"storage":{let i=Sr(r,e+1),o=Sr(r,e+2);le.is(i)&&cn.is(o)&&Et.index("storage",le.toString(i,"full"))(o,t);break}}},Qh=(r,e,t)=>{switch(xr(r,e)){case"block":{let i=Sr(r,e+2);va.is(i)&&Et.path("block",void 0)(i,t);break}case"entity":{let i=Sr(r,e+1),o=Sr(r,e+2);if(Ea.is(i)&&va.is(o)){let s=Wy(i,t);Et.path("entity_type",s)(o,t)}break}case"storage":{let i=Sr(r,e+1),o=Sr(r,e+2);le.is(i)&&va.is(o)&&Et.path("storage",le.toString(i,"full"))(o,t);break}}},CI=(r,e,t)=>{let n=Sr(r,e),i=Sr(r,e+2);le.is(n)&&cn.is(i)&&Et.index("entity_type",le.toString(n,"full"))(i,t)},Wy=(r,e)=>{if(r.playerName!==void 0||r.selector?.playersOnly)return["minecraft:player"];if(r.selector){let t=r.selector.arguments;if(!t)return;let n=[];for(let i of t.children){if(i.key?.value!=="type")continue;let o=i.value;if(!o||o.inverted)continue;let s=le.toString(o.value,"full");if(s.startsWith(se.TagPrefix)){let a=ii("tag/entity_type",s.slice(1),e);n=n.filter(l=>a.includes(l))}else n=[s]}return n}};function AC(r){r.registerChecker("mcfunction:command",xI),r.registerChecker("mcfunction:block",wC),r.registerChecker("mcfunction:entity",xC),r.registerChecker("mcfunction:item",SC),r.registerChecker("mcfunction:particle",CC)}var AI=r=>[Je.create(r,"type")],TI=r=>[Je.create(r,"vector")];function OC(r){r.registerColorizer("mcfunction:coordinate",ot.number),r.registerColorizer("mcfunction:vector",TI),r.registerColorizer("mcfunction:objective_criteria",AI)}var ed=[...At.ColorNames,"reset"],td=["feet","eyes"],rd=[...[...Array(54).keys()].map(r=>`container.${r}`),...[...Array(27).keys()].map(r=>`enderchest.${r}`),...[...Array(15).keys()].map(r=>`horse.${r}`),...[...Array(9).keys()].map(r=>`hotbar.${r}`),...[...Array(27).keys()].map(r=>`inventory.${r}`),...[...Array(8).keys()].map(r=>`villager.${r}`),"armor.chest","armor.feet","armor.head","armor.legs","horse.armor","horse.chest","horse.saddle","weapon","weapon.mainhand","weapon.offhand"],nd=["=","+=","-=","*=","/=","%=","<",">","><"],id=["belowName","list","sidebar",...At.ColorNames.map(r=>`sidebar.team.${r}`)],od=["x","xy","xz","xyz","xzy","y","yx","yz","yxz","yzx","z","zx","zy","zxy","zyx"];var RC=(r,e)=>{let t=r;switch(t.parser){case"brigadier:bool":return vu.mock(e);case"brigadier:double":case"brigadier:float":case"brigadier:integer":case"brigadier:long":case"minecraft:float_range":case"minecraft:message":case"minecraft:time":case"minecraft:uuid":return[];case"brigadier:string":return t.properties.type==="phrase"?Yt.mock(e,$i):[];case"minecraft:angle":return Gh.mock(e);case"minecraft:block_pos":return wr.mock(e,{dimension:3,integersOnly:!0});case"minecraft:block_predicate":return un.mock(e,!0);case"minecraft:block_state":return un.mock(e,!1);case"minecraft:color":return ht.mock(e,{pool:ed});case"minecraft:column_pos":return wr.mock(e,{dimension:2,integersOnly:!0});case"minecraft:component":return[fn.mock(e),Xt.mock(e),Ft.mock(e)];case"minecraft:dimension":return le.mock(e,{category:"dimension"});case"minecraft:entity":case"minecraft:game_profile":return hn.mock(e);case"minecraft:entity_anchor":return ht.mock(e,{pool:td});case"minecraft:entity_summon":return le.mock(e,{category:"entity_type"});case"minecraft:function":return le.mock(e,{category:"function"});case"minecraft:int_range":return Jh.mock(e);case"minecraft:item_enchantment":return le.mock(e,{category:"enchantment"});case"minecraft:item_predicate":return ro.mock(e,!0);case"minecraft:item_slot":return ht.mock(e,{pool:rd});case"minecraft:item_stack":return ro.mock(e,!1);case"minecraft:mob_effect":return le.mock(e,{category:"mob_effect"});case"minecraft:objective":return Br.mock(e,{category:"objective"});case"minecraft:objective_criteria":return no.mock(e);case"minecraft:operation":return ht.mock(e,{pool:nd,colorTokenType:"operator"});case"minecraft:particle":return rs.mock(e);case"minecraft:resource":case"minecraft:resource_or_tag":return le.mock(e,{category:se.shorten(t.properties.registry),allowTag:t.parser==="minecraft:resource_or_tag"});case"minecraft:resource_location":return le.mock(e,t.properties??{pool:[],allowUnknown:!0});case"minecraft:rotation":return wr.mock(e,{dimension:2,noLocal:!0});case"minecraft:scoreboard_slot":return ht.mock(e,{pool:id});case"minecraft:score_holder":return Yh.mock(e);case"minecraft:swizzle":return ht.mock(e,{pool:od});case"minecraft:team":return Br.mock(e,{category:"team"});case"minecraft:vec2":return wr.mock(e,{dimension:2,integersOnly:!0});case"minecraft:vec3":return wr.mock(e,{dimension:3});case"spyglassmc:tag":return Br.mock(e,{category:"tag"});case"minecraft:nbt_compound_tag":case"minecraft:nbt_path":case"minecraft:nbt_tag":default:return[]}},OI=(r,e)=>{let t=[];return k.contains(r.id,e.offset,!0)&&t.push(...xe.resourceLocation(r.id,e)),r.states&&k.contains(k.translate(r.states,1,-1),e.offset,!0)&&t.push(...EI(r.states,e)),t},EI=(r,e)=>{if(!un.is(r.parent))return[];let t=r.parent.id,n=le.toString(t,"full"),i=t.isTag?ii("tag/block",n,e):[n],o=xo("block",i,e);return xe.record({key:(s,a,l,c,f,u,h)=>Object.keys(o).filter(d=>a?.key?.value===d||!h.some(m=>m.value===d)).map(d=>Ie.create(d,c,{kind:10,detail:b("mcfunction.completer.block.states.default-value",q(o[d][0])),insertText:new Tl().literal(d).if(f,m=>m.literal("=").placeholder(...o[d])).if(u,m=>m.literal(",")).build()})),value:(s,a,l)=>a.key&&o[a.key.value]?o[a.key.value].map(c=>Ie.create(c,a.value??l.offset,{kind:12})):[]})(r,e)},RI=(r,e)=>[Ie.create("~",r)],MI=(r,e)=>{let t=[];return k.contains(r.id,e.offset,!0)&&t.push(...xe.resourceLocation(r.id,e)),t},DI=(r,e)=>{let t=no.SimpleValues.map(n=>Ie.create(n,r));return(!r.children?.[0]||k.contains(r.children[0],e.offset,!0))&&t.push(...xe.resourceLocation(r.children?.[0]??le.mock(r,{category:"stat_type",namespacePathSep:"."}),e)),r.children?.[1]&&k.contains(r.children[1],e.offset,!0)&&t.push(...xe.resourceLocation(r.children[1],e)),t},NI=(r,e)=>{let t=yt.findChild(r,e.offset,!0);if(t)return xe.dispatch(t,e);let n=le.toString(r.id,"short"),i={block:[un.mock(e.offset,!1)],block_marker:[un.mock(e.offset,!1)],dust:[wr.mock(e.offset,{dimension:3}),Gn.mock(e.offset)],dust_color_transition:[wr.mock(e.offset,{dimension:3}),Gn.mock(e.offset),wr.mock(e.offset,{dimension:3})],falling_dust:[un.mock(e.offset,!1)],item:[ro.mock(e.offset,!1)],sculk_charge:[Gn.mock(e.offset)],vibration:[wr.mock(e.offset,{dimension:3}),wr.mock(e.offset,{dimension:3}),zs.mock(e.offset)]};if(rs.isSpecialType(n)){let o=r.children?.slice(1).filter(a=>a.range.end<e.offset).length??0,s=i[n][o];if(s)return xe.dispatch(s,e)}return[]},PI=(r,e)=>{let t;return r.selector&&k.contains(r.selector,e.offset,!0)?(t=qy(r.selector,e),k.contains(r.children[0],e.offset,!0)&&t.push(...xe.symbol(Br.mock(r,{category:"score_holder"}),e))):(t=xe.symbol(r.fakeName??Br.mock(r,{category:"score_holder"}),e),t.push(...qy(hn.mock(r),e))),t},qy=(r,e)=>k.contains(r.children[0],e.offset,!0)?xe.literal(r.children[0],e):r.arguments&&k.contains(k.translate(r.arguments,1,-1),e.offset,!0)?MC(r.arguments,e):[],MC=(r,e)=>{let t=r.parent;return hn.is(t)?xe.record({key:(n,i,o,s,a,l)=>[...hn.ArgumentKeys].filter(c=>hn.canKeyExist(t,n,c)===0).map(c=>Ie.create(c,s,{kind:10,insertText:new Tl().literal(c).if(a,f=>f.literal("=").placeholder()).if(l,f=>f.literal(",")).build()})),value:(n,i,o)=>i.value?xe.dispatch(i.value,o):[]})(r,e):[]},LI=(r,e)=>[Ie.create("-2147483648..2147483647",r,{kind:21})],II=(r,e)=>{let t=(i,o)=>Ie.create(new Array(r.options.dimension).fill(i).join(" "),r,{sortText:o}),n=[];return n.push(t("~","a")),r.options.noLocal||n.push(t("^","b")),n.push(t("0.0","c")),n};function DC(r){r.registerCompleter("mcfunction:block",OI),r.registerCompleter("mcfunction:coordinate",RI),r.registerCompleter("mcfunction:entity_selector",qy),r.registerCompleter("mcfunction:entity_selector/arguments",MC),r.registerCompleter("mcfunction:int_range",LI),r.registerCompleter("mcfunction:item",MI),r.registerCompleter("mcfunction:objective_criteria",DI),r.registerCompleter("mcfunction:particle",NI),r.registerCompleter("mcfunction:score_holder",PI),r.registerCompleter("mcfunction:vector",II)}var PC=(r,e)=>{if(r.children[0]?.type!=="mcfunction:entry")return[];let t=[];return jr(r,n=>!0,Fh.is,n=>{let i=n,o=e.config.env.feature.inlayHint;(o===!0||typeof o=="object"&&o.enabledNodes.includes(i.children[0].type))&&t.push({offset:i.range.start,text:`${i.path[i.path.length-1]}:`})}),t};var IC=/^-?\d+$/,BC=/^-?(?:\d+\.?\d*|\.\d+)$/,zC=Number.MAX_VALUE,BI=-zC,jC=(2-2**-23)*2**127,zI=-jC,jI=2**31-1,$I=-(2**31),$C=9223372036854775807n,FI=-9223372036854775808n,VI=40,UI=16,HI=16;function WI(r){let e=r.project.loadedVersion;return!e||_r.cmp(e,"1.18")<0}var Gy=r=>{let e=r,t=n=>Ce(ei(n,"\r",`
`));switch(e.parser){case"brigadier:bool":return t(Ju);case"brigadier:double":return t(ad(e.properties?.min,e.properties?.max));case"brigadier:float":return t(Da(e.properties?.min,e.properties?.max));case"brigadier:integer":return t(zc(e.properties?.min,e.properties?.max));case"brigadier:long":return t(qI(e.properties?.min,e.properties?.max));case"brigadier:string":switch(e.properties.type){case"word":return t(KC);case"phrase":return t(Fo);case"greedy":default:return t(VC)}case"minecraft:angle":return t(ql(Ky(),n=>n.notation!=="^",b("mcfunction.parser.vector.local-disallowed")));case"minecraft:block_pos":return t(Ra({dimension:3,integersOnly:!0}));case"minecraft:block_predicate":return t(Zy);case"minecraft:block_state":return t(sd);case"minecraft:color":return t(me(it(...ed),n=>I(w({},n),{color:At.NamedColors.has(n.value)?At.fromCompositeInt(At.NamedColors.get(n.value)):void 0})));case"minecraft:column_pos":return t(Ra({dimension:2,integersOnly:!0}));case"minecraft:component":return t(Jy);case"minecraft:dimension":return t(et({category:"dimension"}));case"minecraft:entity":return t(LC(e.properties.amount,e.properties.type));case"minecraft:entity_anchor":return t(it(...td));case"minecraft:entity_summon":return t(et({category:"entity_type"}));case"minecraft:float_range":return t(Ma("float"));case"minecraft:function":return t(et({category:"function",allowTag:!0}));case"minecraft:game_profile":return t(LC("multiple","players"));case"minecraft:int_range":return t(Ma("integer"));case"minecraft:item_enchantment":return t(et({category:"enchantment"}));case"minecraft:item_predicate":return t(KI);case"minecraft:item_slot":return t(it(...rd));case"minecraft:item_stack":return t(HC);case"minecraft:message":return t(GI);case"minecraft:mob_effect":return t(et({category:"mob_effect"}));case"minecraft:nbt_compound_tag":return t(In.compound);case"minecraft:nbt_path":return t(In.path);case"minecraft:nbt_tag":return t(In.entry);case"minecraft:objective":return t(qC(kl.is(e.properties?.usageType)?e.properties?.usageType:void 0));case"minecraft:objective_criteria":return t(XI);case"minecraft:operation":return t(it({pool:nd,colorTokenType:"operator"}));case"minecraft:particle":return t(Yy);case"minecraft:resource":case"minecraft:resource_or_tag":return t(et({category:se.shorten(e.properties.registry),allowTag:e.parser==="minecraft:resource_or_tag"}));case"minecraft:resource_location":return t(et(e.properties??{pool:[],allowUnknown:!0}));case"minecraft:rotation":return t(Ra({dimension:2,noLocal:!0}));case"minecraft:score_holder":return t(YI(e.properties.amount));case"minecraft:scoreboard_slot":return t(it(...id));case"minecraft:swizzle":return t(it(...od));case"minecraft:team":return t(cd(kl.is(e.properties?.usageType)?e.properties?.usageType:void 0));case"minecraft:time":return t(QI);case"minecraft:uuid":return t(GC);case"minecraft:vec2":return t(Ra({dimension:2,noLocal:!0}));case"minecraft:vec3":return t(Ra({dimension:3}));case"spyglassmc:tag":return t(ld());default:return}};function FC(r){return me(Fe([et({category:"block",allowTag:r}),De(me(Ce(on({start:"[",pair:{key:$t(I(w({},$i),{colorTokenType:"property"})),sep:"=",value:Fo,end:",",trailingEnd:!0},end:"]"})),e=>I(w({},e),{type:"mcfunction:block/states"}))),De(Ce(In.compound))]),e=>({type:"mcfunction:block",range:e.range,children:e.children,id:e.children.find(le.is),states:e.children.find(Kh.is),nbt:e.children.find(cn.is)}))}var sd=FC(!1),Zy=FC(!0),Jy=vc.json();function ad(r=BI,e=zC){return Mn({pattern:BC,min:r,max:e})}function Da(r=zI,e=jC){return Mn({pattern:BC,min:r,max:e})}function zc(r=$I,e=jI){return nn({pattern:IC,min:r,max:e})}function qI(r,e){return Gl({pattern:IC,min:BigInt(r??FI),max:BigInt(e??$C)})}function Ky(r=!1){return(e,t)=>{let n={type:"mcfunction:coordinate",notation:"",range:k.create(e),value:0};if(e.trySkip("^")?n.notation="^":e.trySkip("~")&&(n.notation="~"),e.canReadInLine()&&e.peek()!==" "||n.notation===""){let i=(r&&n.notation===""?zc:ad)()(e,t);n.value=Number(i.value)}return n.range.end=e.cursor,n}}function LC(r,e){return me(Ae([{predicate:t=>Oa.is(t.peek(2)),parser:Xy()},{parser:$r([e0(Fo,HI,"mcfunction.parser.entity-selector.player-name.too-long"),GC])}]),(t,n,i)=>{let o={type:"mcfunction:entity",range:t.range,children:[t]};return Yt.is(t)?o.playerName=t:hn.is(t)?o.selector=t:o.uuid=t,r==="single"&&o.selector&&!o.selector.single&&i.err.report(b("mcfunction.parser.entity-selector.multiple-disallowed"),o),e==="players"&&(o.uuid||o.selector&&!o.selector.playersOnly&&!o.selector.currentEntity)&&i.err.report(b("mcfunction.parser.entity-selector.entities-disallowed"),o),o})}var VC=$t({unquotable:{blockList:new Set([`
`,"\r"])}});function UC(r){return me(Fe([et({category:"item",allowTag:r}),De(Ce(In.compound))]),e=>({type:"mcfunction:item",range:e.range,children:e.children,id:e.children.find(le.is),nbt:e.children.find(cn.is)}))}var HC=UC(!1),KI=UC(!0),GI=(r,e)=>{let t={type:"mcfunction:message",range:k.create(r),children:[]};for(;r.canReadInLine();)Oa.is(r.peek(2))?t.children.push(Xy()(r,e)):t.children.push(ei(VC,...Bc)(r,e));return t},Yy=(()=>{let r=me(Lc,()=>[]),e=Ra({dimension:3}),t=me(e,i=>I(w({},i),{color:i.children.length===3?{value:At.fromDecRGB(i.children[0].value,i.children[1].value,i.children[2].value),format:[ir.DecRGB]}:void 0})),n={block:sd,block_marker:sd,dust:Fe([t,Da()],r),dust_color_transition:Fe([t,Da(),t],r),falling_dust:sd,item:HC,sculk_charge:Da(),vibration:Fe([e,e,zc()],r)};return me(Fe([et({category:"particle_type"}),{get:i=>n[le.toString(i.children[0],"short")]}],r),i=>({type:"mcfunction:particle",range:i.range,children:i.children,id:i.children.find(le.is)}))})();function Ma(r,e,t,n){let i=r==="float"?Da(e,t):zc(e,t),o=Ce(ei(i,"..")),s=Ce(it({pool:[".."],colorTokenType:"keyword"})),a=Ce(i);return me($r([Fe([o]),Fe([o,s]),Fe([s,a]),Fe([o,s,a])]),(l,c,f)=>{let u=r==="float"?l.children.filter(Gn.is):l.children.filter(zs.is),h=l.children.find(ht.is),d={type:r==="float"?"mcfunction:float_range":"mcfunction:int_range",range:l.range,children:l.children,value:h?u.length===2?[u[0].value,u[1].value]:k.endsBefore(u[0].range,h.range.start)?[u[0].value,void 0]:[void 0,u[0].value]:[u[0].value,u[0].value]};return!n&&d.value[0]!==void 0&&d.value[1]!==void 0&&d.value[0]>d.value[1]&&f.err.report(b("mcfunction.parser.range.min>max",d.value[0],d.value[1]),l),d})}function Xy(){let r,e,t,n,i,o,s;return me(Fe([Ce(it({pool:Bc,colorTokenType:"keyword"})),{get:a=>{let l=ht.is(a.children?.[0])?a.children[0].value:void 0;e=l?l==="@s":void 0,n=l?l==="@p"||l==="@a"||l==="@r":void 0,i=l==="@e"?["Entity::isAlive"]:void 0,o=l?l==="@p"||l==="@r"||l==="@s":void 0,s=n;function c(f){return me(Fe([De(Ce(it({pool:["!"],colorTokenType:"keyword"}))),u=>{u.skipSpace()},f]),u=>({type:"mcfunction:entity_selector/arguments/value/invertable",range:u.range,children:u.children,inverted:!!u.children.find(d=>ht.is(d)&&d.value==="!"),value:u.children.find(d=>!ht.is(d)||d.value!=="!")}))}return De(me(Ce(on({start:"[",pair:{key:$t(I(w({},$i),{value:{parser:it({pool:[...hn.ArgumentKeys],colorTokenType:"property"}),type:"literal"}})),sep:"=",value:{get:(f,u)=>{let h=m=>!!f.children.find(y=>y.key?.value===m),d=m=>!!f.children.find(y=>y.key?.value===m&&!y.value?.inverted);switch(u?.value){case"advancements":return me(on({start:"{",pair:{key:et({category:"advancement"}),sep:"=",value:Ae([{predicate:m=>m.peek()==="{",parser:me(on({start:"{",pair:{key:KC,sep:"=",value:Ju,end:",",trailingEnd:!0},end:"}"}),m=>I(w({},m),{type:"mcfunction:entity_selector/arguments/advancements/criteria"}))},{parser:Ju}]),end:",",trailingEnd:!0},end:"}"}),(m,y,g)=>(h(u.value)&&g.err.report(b("duplicate-key",q(u.value)),u),I(w({},m),{type:"mcfunction:entity_selector/arguments/advancements"})));case"distance":return me(Ma("float",0),(m,y,g)=>(t=!0,r??=!n&&m.value[1]!==void 0,h(u.value)&&g.err.report(b("duplicate-key",q(u.value)),u),m));case"gamemode":return me(c($t({unquotable:Zl,value:{type:"literal",parser:it("adventure","creative","spectator","survival")}})),(m,y,g)=>(n=!0,(m.inverted?d(u.value):h(u.value))&&g.err.report(b("duplicate-key",q(u.value)),u),m));case"limit":return me(zc(0),(m,y,g)=>(o=m.value<=1,h(u.value)&&g.err.report(b("duplicate-key",q(u.value)),u),e&&g.err.report(b("mcfunction.parser.entity-selector.arguments.not-applicable",q(u.value)),u),m));case"level":return me(Ma("integer",0),(m,y,g)=>(n=!0,h(u.value)&&g.err.report(b("duplicate-key",q(u.value)),u),m));case"name":return me(c(Fo),(m,y,g)=>((m.inverted?d(u.value):h(u.value))&&g.err.report(b("duplicate-key",q(u.value)),u),m));case"nbt":return c(In.compound);case"predicate":return c(et({category:"predicate"}));case"scores":return me(on({start:"{",pair:{key:qC("reference",["[","=",",","]","{","}"]),sep:"=",value:Ma("integer"),end:",",trailingEnd:!0},end:"}"}),(m,y,g)=>(h(u.value)&&g.err.report(b("duplicate-key",q(u.value)),u),I(w({},m),{type:"mcfunction:entity_selector/arguments/scores"})));case"sort":return me($t({unquotable:Zl,value:{type:"literal",parser:it("arbitrary","furthest","nearest","random")}}),(m,y,g)=>(h(u.value)&&g.err.report(b("duplicate-key",q(u.value)),u),e&&g.err.report(b("mcfunction.parser.entity-selector.arguments.not-applicable",q(u.value)),u),m));case"tag":return c(ld(["[","=",",","]","{","}"]));case"team":return me(c(cd("reference",["[","=",",","]","{","}"])),(m,y,g)=>((m.inverted?d(u.value):h(u.value))&&g.err.report(b("duplicate-key",q(u.value)),u),m));case"type":return me(c(et({category:"entity_type",allowTag:!0})),(m,y,g)=>(s?h(u.value)?g.err.report(b("duplicate-key",q(u.value)),u):g.err.report(b("mcfunction.parser.entity-selector.arguments.not-applicable",q(u.value)),u):!m.inverted&&!m.value.isTag&&(s=!0,le.toString(m.value,"short")==="player"&&(n=!0)),m));case"x":case"y":case"z":return me(ad(),(m,y,g)=>(t=!0,h(u.value)&&g.err.report(b("duplicate-key",q(u.value)),u),m));case"dx":case"dy":case"dz":return me(ad(),(m,y,g)=>(t=!0,r=!n,h(u.value)&&g.err.report(b("duplicate-key",q(u.value)),u),m));case"x_rotation":case"y_rotation":return me(Ma("float",void 0,void 0,!0),(m,y,g)=>(h(u.value)&&g.err.report(b("duplicate-key",q(u.value)),u),m));case void 0:return()=>oe;default:return(m,y)=>(y.err.report(b("mcfunction.parser.entity-selector.arguments.unknown",q(u.value)),u),oe)}}},end:",",trailingEnd:!0},end:"]"})),f=>I(w({},f),{type:"mcfunction:entity_selector/arguments"})))}}]),a=>{let l={type:"mcfunction:entity_selector",range:a.range,children:a.children,variable:a.children.find(ht.is).value.slice(1),arguments:a.children.find(Zh.is),chunkLimited:r,currentEntity:e,dimensionLimited:t,playersOnly:n,predicates:i,single:o,typeLimited:s};return l.hover=ZI(l),l})}function ZI(r){let e=new Map([[0,"\u{1F922}"],[1,"\u{1F605}"],[2,"Good"],[3,"Great"],[4,"\u{1F60C}\u{1F44C}"]]),t;if(r.currentEntity)t=`**Performance**: ${e.get(4)}  
- \`currentEntity\`: \`${r.currentEntity}\``;else{let n=[r.chunkLimited,r.dimensionLimited,r.playersOnly,r.typeLimited].filter(i=>i).length;t=`**Performance**: ${e.get(n)}  
- \`chunkLimited\`: \`${!!r.chunkLimited}\`
- \`dimensionLimited\`: \`${!!r.dimensionLimited}\`
- \`playersOnly\`: \`${!!r.playersOnly}\`
- \`typeLimited\`: \`${!!r.chunkLimited}\``}return r.predicates?.length&&(t+=`

------
**Predicates**: 
${r.predicates.map(n=>`- \`${n}\``).join(`
`)}`),t}var JI=e0(WC("score_holder"),VI,"mcfunction.parser.score_holder.fake-name.too-long");function YI(r){return me(Ae([{predicate:e=>Oa.is(e.peek(2)),parser:Xy()},{parser:JI}]),(e,t,n)=>{let i={type:"mcfunction:score_holder",range:e.range,children:[e]};return Br.is(e)?i.fakeName=e:i.selector=e,r==="single"&&i.selector&&!i.selector.single&&n.err.report(b("mcfunction.parser.entity-selector.multiple-disallowed"),i),i})}function WC(r,e=[]){return ei(fa(r),Hv,e)}function qC(r,e=[]){return e0(Qy({category:"objective",usageType:r},e),UI,"mcfunction.parser.objective.too-long")}var XI=me($r([Fe([ei(et({category:"stat_type",namespacePathSep:"."}),":"),Ce(it(":")),{get:r=>{if(le.is(r.children[0])){let e=no.ComplexCategories.get(le.toString(r.children[0],"short"));if(e)return et({category:e,namespacePathSep:"."})}return et({pool:[],allowUnknown:!0,namespacePathSep:"."})}}]),it(...no.SimpleValues)]),r=>{let e={type:"mcfunction:objective_criteria",range:r.range};return ht.is(r)?e.simpleValue=r.value:e.children=r.children.filter(le.is),e});function ld(r=[]){return Qy("tag",r)}function cd(r,e=[]){return Qy({category:"team",usageType:r},e)}function Qy(r,e){return tB(WC(r,e))}var QI=me(Fe([Da(0,void 0),De(Ce(it(...Xh.Units)))]),r=>{let e=r.children.find(Gn.is),t=r.children.find(ht.is);return{type:"mcfunction:time",range:r.range,children:r.children,value:e.value,unit:t?.value}}),KC=$t({unquotable:Zl}),eB=/^[0-9a-f]+-[0-9a-f]+-[0-9a-f]+-[0-9a-f]+-[0-9a-f]+$/i,GC=(r,e)=>{let t={type:"mcfunction:uuid",range:k.create(r),bits:[0n,0n]},n=r.readUntil(" ","\r",`
`,"\r"),i=!1;if(n.match(eB))try{let o=n.split("-").map(s=>BigInt(`0x${s}`));o.every(s=>s<=$C)&&(i=!0,t.bits[0]=BigInt.asIntN(64,o[0]<<32n|o[1]<<16n|o[2]),t.bits[1]=BigInt.asIntN(64,o[3]<<48n|o[4]))}catch{}return t.range.end=r.cursor,i||e.err.report(b("mcfunction.parser.uuid.invalid"),t),t};function e0(r,e,t){return(n,i)=>WI(i)?me(r,(o,s,a)=>(o.value.length>e&&a.err.report(b(t,e),o),o))(n,i):r(n,i)}function tB(r){return me(r,(e,t,n)=>(e.value.match(zk)||n.err.report(b("parser.string.illegal-brigadier",q(e.value)),e),e))}function Ra(r){return(e,t)=>{let n={type:"mcfunction:vector",range:k.create(e),children:[],options:r,system:0};e.peek()==="^"&&(n.system=1);for(let i=0;i<r.dimension;i++){i>0&&Lc(e,t);let o=(r.integersOnly,Ky(r.integersOnly)(e,t));n.children.push(o),n.system===1!=(o.notation==="^")&&t.err.report(b("mcfunction.parser.vector.mixed"),o)}return r.noLocal&&n.system===1&&t.err.report(b("mcfunction.parser.vector.local-disallowed"),n),n.range.end=e.cursor,n}}function JC(r){let e=Kr.instance.get(r);return(t,n)=>{if(t.children[0]?.type!=="mcfunction:entry")return;let i=rB(t,n.offset),o=i?i.children:[],s=nB(e,o);if(s.length===0)return;let a=0;for(let c of o)if(n.offset>c.range.end)a+=1;else break;if(a>=s[0].length)return;let l={activeSignature:0,signatures:[]};return l.signatures=s.map(c=>{let f=c[a],u=a+1<c.length?` ${c[a+1]}`:"",h=`${f}${u}`;return{label:h,activeParameter:0,parameters:[{label:[0,f.length]},{label:[f.length,h.length]}]}}),l}}function rB(r,e){return yt.findChild(r.children[0],e,!0)}function nB(r,e){let t=[],n=r;for(let i of e){let o=i.path[i.path.length-1];if(!o||(n=ts(n,r).treeNode?.children?.[o],!n))break;t.push(Hy(o,n))}return n&&(n=ts(n,r).treeNode,n?.children)?Uy(n.children,n.executable).map(i=>[...t,i]):t.length?[t]:[]}function tA(r){return{children:I(w(I(w(I(w({advancement:{children:{grant:YC,revoke:YC}}},_r.cmp(r,"1.16")>=0?{attribute:{children:{target:{children:{attribute:{properties:{category:"attribute"},children:{modifier:{children:{add:{children:{uuid:{properties:{category:"attribute_modifier_uuid",usageType:"definition"}}}},remove:{children:{uuid:{properties:{category:"attribute_modifier_uuid"}}}},value:{children:{get:{children:{uuid:{properties:{category:"attribute_modifier_uuid"}}}}}}}}}}}}}}}:{}),{ban:{permission:3},"ban-ip":{permission:3},banlist:{permission:3},bossbar:{children:{add:{children:{id:{properties:{category:"bossbar",usageType:"definition"}}}},get:{children:{id:{properties:{category:"bossbar"}}}},remove:{children:{id:{properties:{category:"bossbar"}}}},set:{children:{id:{properties:{category:"bossbar",accessType:1}}}}}},data:{children:{get:fd,merge:rA,modify:{children:{block:{children:{targetPos:{children:{targetPath:t0}}}},entity:{children:{target:{children:{targetPath:t0}}}},storage:{children:{target:{properties:{category:"storage",accessType:1},children:{targetPath:t0}}}}}},remove:fd}},debug:{permission:3},deop:{permission:3},execute:{children:{if:XC,store:{children:{result:QC,success:QC}},unless:XC}}}),_r.cmp(r,"1.17")>=0?{item:{children:{replace:{children:{block:{children:{pos:{children:{slot:{children:{from:{children:{block:{children:{source:{children:{sourceSlot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}},entity:{children:{source:{children:{sourceSlot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}}}}}}}}}},entity:{children:{targets:{children:{slot:{children:{from:{children:{block:{children:{source:{children:{sourceSlot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}},entity:{children:{source:{children:{sourceSlot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}}}}}}}}}}}},modify:{children:{block:{children:{pos:{children:{slot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}},entity:{children:{targets:{children:{slot:{children:{modifier:{properties:{category:"item_modifier"}}}}}}}}}}}}}:{}),{help:{permission:0},kick:{permission:3},list:{permission:0}}),_r.cmp(r,"1.16")>=0?{locatebiome:{children:{biome:{properties:{category:"worldgen/biome"}}}}}:{}),{loot:{children:{give:{children:{players:ns}},insert:{children:{targetPos:ns}},replace:{children:{block:{children:{targetPos:{children:{slot:{children:I(w({},ns.children),{count:ns})}}}}},entity:{children:{entities:{children:{slot:{children:I(w({},ns.children),{count:ns})}}}}}}},spawn:{children:{targetPos:ns}}}},me:{permission:0},msg:{permission:0},op:{permission:3},pardon:{permission:3},"pardon-ip":{permission:3},playsound:Gr,publish:{permission:4},recipe:{children:{give:eA,take:eA}},"save-all":{permission:4},"save-off":{permission:4},"save-on":{permission:4},scoreboard:{children:{objectives:{children:{add:{children:{objective:{parser:"minecraft:objective",properties:{usageType:"definition"}}}}}},players:{children:{add:$c,operation:$c,remove:$c,reset:$c,set:$c}}}},setidletimeout:{permission:3},stop:{permission:4},stopsound:{children:{targets:{children:{"*":Gr,ambient:Gr,block:Gr,hostile:Gr,master:Gr,music:Gr,neutral:Gr,player:Gr,record:Gr,voice:Gr,weather:Gr}}}},tag:{children:{targets:{children:{add:{children:{name:{parser:"spyglassmc:tag"}}},remove:{children:{name:{parser:"spyglassmc:tag"}}}}}}},team:{children:{add:{children:{team:{parser:"minecraft:team",properties:{usageType:"definition"}}}}}},teammsg:{permission:0},teleport:{children:{destination:void 0,targets:{executable:!0}}},tell:{permission:0},tm:{permission:0},trigger:{permission:0,children:{objective:{properties:{category:"objective",accessType:1}}}},w:{permission:0},whitelist:{permission:3}})}}var YC=Object.freeze({children:{targets:{children:{from:{children:{advancement:{properties:{category:"advancement"}}}},only:{children:{advancement:{properties:{category:"advancement"}}}},through:{children:{advancement:{properties:{category:"advancement"}}}},until:{children:{advancement:{properties:{category:"advancement"}}}}}}}}),fd=Object.freeze({children:{storage:{children:{source:{properties:{category:"storage"}}}}}}),rA=Object.freeze({children:{storage:{children:{target:{properties:{category:"storage",accessType:1}}}}}}),jc=Object.freeze({children:{from:fd}}),t0=Object.freeze({children:{append:jc,insert:{children:{index:jc}},merge:jc,prepend:jc,set:jc}}),XC=Object.freeze({children:{data:fd,predicate:{children:{predicate:{properties:{category:"predicate"}}}}}}),QC=Object.freeze({children:I(w({},rA.children),{bossbar:{children:{id:{properties:{category:"bossbar",accessType:1}}}}})}),ns=Object.freeze({children:{fish:{children:{loot_table:{properties:{category:"loot_table"}}}},loot:{children:{loot_table:{properties:{category:"loot_table"}}}}}}),$c=Object.freeze({children:{targets:{children:{objective:{properties:{accessType:1}}}}}}),eA=Object.freeze({children:{targets:{children:{recipe:{properties:{category:"recipe"}}}}}}),Gr=Object.freeze({children:{sound:{properties:{category:"sound_event"}}}});var nA=(r,e,t)=>{let{meta:n}=r;bC(r),Kr.instance.register(t,e,tA(t)),n.registerLanguage("mcfunction",{extensions:[".mcfunction"],parser:yC(t,Gy),completer:Wh.entry(t,RC),triggerCharacters:[" ","[","=","!",",","{",":","/",".",'"',"'"]}),n.registerParser("mcfunction:block_predicate",Zy),n.registerParser("mcfunction:component",Jy),n.registerParser("mcfunction:particle",Yy),n.registerParser("mcfunction:tag",ld()),n.registerParser("mcfunction:team",cd()),n.registerParser("mcfunction:command",qh(Kr.instance.get(t),Gy)),AC(n),OC(n),DC(n),n.registerInlayHintProvider(PC),n.registerSignatureHelpProvider(JC(t))};var oA=async r=>{let{config:e,downloader:t,externals:n,logger:i,meta:o,projectRoot:s}=r;async function a(){let m,y=`${s}pack.mcmeta`;try{let g=await ge.readJson(n,y);Ch.assert(g),m=g}catch(g){n.error.isKind(g,"ENOENT")||i.error(`[je.initialize] Failed loading pack.mcmeta \u201C${y}\u201D`,g)}return m}o.registerUriBinder(aS);let l=await rS(r.externals,r.downloader);if(!l){r.logger.error("[je-initialize] Failed loading game version list. Expect everything to be broken.");return}let c=await a(),{release:f,id:u,isLatest:h}=Xx(e.env.gameVersion,{packMcmeta:c,versions:l});o.registerDependencyProvider("@vanilla-mcdoc",()=>sS(n,t,u,h));let d=await nS(r.externals,t,i,u,h,e.env.dataSource,e.env.mcmetaSummaryOverrides);if(!d.blocks||!d.commands||!d.fluids||!d.registries){r.logger.error("[je-initialize] Failed loading mcmeta summaries. Expect everything to be broken.");return}return o.registerSymbolRegistrar("mcmeta-summary",{checksum:d.checksum,registrar:eS(d)}),o.registerLinter("nameOfNbtKey",{configValidator:Di.configValidator.nameConvention,linter:Di.nameConvention("value"),nodePredicate:m=>!m.symbol&&m.parent?.parent?.type==="nbt:compound"&&To.is(m.parent)&&m.type==="string"&&m.parent.key===m||!m.symbol&&m.parent?.type==="nbt:path"&&m.type==="string"||lx.is(m.parent)&&cx.is(m)&&!m.symbol?.path[0]?.startsWith("::minecraft")}),cC(r),nA(r,d.commands,f),Yx(r),{loadedVersion:f}};var ud=document.getElementById("language"),oB=document.getElementById("editor-container"),io=document.getElementById("uri"),sA="execute as @a run say hello world",aA=()=>ud.selectedOptions[0]?.dataset?.language??ud.value,lA=r=>cA.state.sliceDoc(0),r0=0,jn=new Zu({logger:console,profilers:new Li(console,["cache#load","cache#save","project#init","project#ready"]),project:{cacheRoot:"file:///.cache/",defaultConfig:No.merge(Um,{env:{dependencies:[]}}),externals:Mg,initializers:[jx,oA],projectRoot:"file:///root/"}});await jn.project.ready();jn.project.onDidOpen(io.value,aA(),0,sA);var sB=G.updateListener.of(r=>{if(!r.docChanged)return;let e=lA(r.state);jn.project.onDidChange(io.value,[{text:e}],++r0)});async function aB(r){let e=await jn.project.ensureCheckedOnlyWhenReady(io.value);if(!e)return null;let t=jn.complete(e.node,e.doc,r.pos);return t.length?{from:t[0].range.start,to:t[0].range.end,options:t.map(n=>({label:n.label,detail:n.detail,info:n.documentation}))}:null}var lB=Ee.define({create(){return Y.none},update(r,e){let t=jn.project.get(io.value);if(!t)return r;let{node:n}=t;r=Y.none;for(let i of Bs.getErrors(n))r=r.update({add:[cB(i).range(i.range.start,i.range.end===i.range.start?i.range.start+1:i.range.end)]});return r},provide:r=>G.decorations.from(r)}),cB=r=>Y.mark({attributes:{"data-diagnostic-message":r.message},class:`spyglassmc-diagnostic spyglassmc-diagnostic-${r.severity}`}),fB=G.baseTheme({".spyglassmc-diagnostic::before":{content:"attr(data-diagnostic-message)",display:"none",position:"absolute",transform:"translateY(-100%)",border:"1px solid black","background-color":"wheat",opacity:"90%","white-space":"break-spaces",overflow:"hidden",height:"fit-content",width:"fit-content","max-height":"4em","max-width":"60em"},".spyglassmc-diagnostic:hover::before":{display:"block"},".spyglassmc-diagnostic-0":{textDecoration:"underline 1.5px darkgray"},".spyglassmc-diagnostic-1":{textDecoration:"underline 1.5px lightblue"},".spyglassmc-diagnostic-2":{textDecoration:"underline 1.5px orange"},".spyglassmc-diagnostic-3":{textDecoration:"underline 1.5px red"}}),uB=Ee.define({create(){return Y.none},update(r,e){let t=jn.project.get(io.value);if(!t)return r;let{node:n,doc:i}=t,o=jn.colorize(n,i);r=Y.none;for(let s of o)s.range.start!==s.range.end&&(r=r.update({add:[hB(s).range(s.range.start,s.range.end)]}));return r},provide:r=>G.decorations.from(r)}),hB=r=>Y.mark({class:`spyglassmc-color-token-${r.type} ${r.modifiers?.map(e=>`spyglassmc-color-token-modifier-${e}`).join()??""}`}),dB=G.baseTheme({".spyglassmc-color-token-comment":{color:"#008000"},".spyglassmc-color-token-enum":{color:"#0070C1"},".spyglassmc-color-token-enumMember":{color:"#0070C1"},".spyglassmc-color-token-function":{color:"#795E26"},".spyglassmc-color-token-keyword":{color:"#AF00DB"},".spyglassmc-color-token-modifier":{color:"#001080"},".spyglassmc-color-token-number":{color:"#098658"},".spyglassmc-color-token-operator":{color:"#AF00DB"},".spyglassmc-color-token-property":{color:"#001080"},".spyglassmc-color-token-string":{color:"#A31515"},".spyglassmc-color-token-struct":{color:"#001080"},".spyglassmc-color-token-type":{color:"#267F99"},".spyglassmc-color-token-variable":{color:"#001080"},".spyglassmc-color-token-error":{color:"#FF0000"},".spyglassmc-color-token-literal":{color:"#0000FF"},".spyglassmc-color-token-resourceLocation":{color:"#795E26"},".spyglassmc-color-token-vector":{color:"#098658"}}),pB=G.theme({"&":{maxHeight:"40em"},".cm-gutter,.cm-content":{height:"40em"},".cm-scroller":{overflow:"auto"}}),cA=new G({parent:oB,state:de.create({doc:sA,extensions:[Nv,po.of([mv]),Gf({override:[aB]}),sB,lB,fB,uB,dB,pB]})});ud.onchange=()=>{jn.project.onDidClose(io.value),io.value=`file:///root/foo.${ud.value}`,r0=0,jn.project.onDidOpen(io.value,aA(),r0,lA(cA.state))};
/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */
